import{r as i,z as pe,_ as ue,d as R,k as $e,u as De,j as e,F as T,B as b,I as q,E as Ye,m as Ze,i as de,a as F,M as xe,$ as Pe,b as Ke,t as j,p as Ae,P as A,al as Me,y as el,a0 as ll,A as nl,l as me,am as Ee}from"./main-B2jPVJuc.js";import{F as tl}from"./index-D5lQbqN-.js";import{C as ze}from"./index-01a6DBbv.js";import{S as al}from"./index-ROS2ditM.js";import{F as Te,S as ke,D as sl,b as ol}from"./Table-D1zuQkUf.js";import{A as il}from"./react-window-DDxMxsOy.js";import{u as rl}from"./index-DI5YvQtd.js";import{D as cl,T as dl,U as ml,R as ye}from"./index-umuRLg26.js";import{S as Ie}from"./index-IGtn9UM1.js";import{T as pl}from"./index-bd5EV77p.js";import{R as Fe}from"./DeleteOutlined-7aDqphvw.js";import{R as Re}from"./RedoOutlined-B2jLc-U5.js";var ul={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},xl=function(a,o){return i.createElement(pe,ue({},a,{ref:o,icon:ul}))},fl=i.forwardRef(xl),jl={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},gl=function(a,o){return i.createElement(pe,ue({},a,{ref:o,icon:jl}))},_l=i.forwardRef(gl),hl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},wl=function(a,o){return i.createElement(pe,ue({},a,{ref:o,icon:hl}))},vl=i.forwardRef(wl);const Cl=({parseData:s,columns:a,importData:o})=>e.jsx(Te,{size:"small",bordered:!0,pagination:!1,footer:()=>e.jsxs("div",{style:{textAlign:"right"},children:["A total of",s.length," records   ",e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:o,children:"Ok"})]}),columns:a,dataSource:s}),ce=({component_type:s,component_id:a,component_name:o,inputForm:r,operatePipeline:p,name:g,file_type:S,callback:O})=>{const[y]=R.useForm();console.log("-->ImportFile渲染");const{messageApi:$,project:te}=$e(),[M,c]=i.useState([]);De(u=>u.global.setting);const[E,B]=i.useState(!1),[W,ae]=i.useState(),f=i.useRef(null);i.useEffect(()=>{if(r){let x=r.map(d=>Array.isArray(d.name)?d.name[1]:d.name).map(d=>({title:d,dataIndex:d,key:d,render:h=>e.jsx("span",{children:h})}));x=[{title:"Sample Name",dataIndex:"sample_name",key:"sample_name",render:d=>e.jsx("span",{children:d})},...x,{title:"Action",dataIndex:"action",key:"action",ellipsis:!0,render:(d,h)=>e.jsx(T,{gap:"small",children:e.jsx(b,{size:"small",danger:!0,onClick:()=>{G(h.sample_name)},children:"删除"})})}],console.log(x),f.current=x,ae(x)}},[r]);const G=u=>{c(x=>x.filter(d=>d.sample_name!==u))},Q=u=>{const{content:x,sample_name:d,file_name:h}=u;return E?M.map(_=>{const{sample_name:D,...w}=_;return{...u,project:te,component_id:a,file_type:S,content:JSON.stringify(w),sample_name:D}}):[{...u,project:te,component_id:a,file_name:h,file_type:S,content:S&&S=="collected"?x:JSON.stringify(x),sample_name:d}]},n=async()=>{const u=await y.validateFields();if(u.length==0){$.error("No data added!");return}if(r&&r.length==0){$.error("This component does not have inputForm configured!");return}const x=Q(u);try{const d=await F.post("/import-data",x);$.success("Imported successfully!"),O&&O()}catch(d){$.error(d.response.data.detail)}},ee=async()=>{const u=await y.validateFields();if(r&&r.length==0){$.error("This component does not have inputForm configured!");return}const x=await F.post("/parse-import-data",{content:JSON.stringify(u.content)});console.log(x),c(x.data)};return i.useEffect(()=>{const u=x=>{var V;const d=((V=x.clipboardData)==null?void 0:V.getData("Text"))||"";if(!d)return;const h=d.includes("	")?"	":",",D=d.split(/\r?\n/).filter(z=>z.trim()!=="").map(z=>z.split(h).map(L=>L.trim()));console.log(D);const w=D.map(z=>{const L={};return f.current.forEach((le,U)=>{z.length<=U?L[le.dataIndex]="unknown":L[le.dataIndex]=z[U]}),L});c(w),$.success("Paste successful!")};return document.addEventListener("paste",u),()=>{document.removeEventListener("paste",u)}},[]),e.jsx(e.Fragment,{children:e.jsx(ze,{variant:"borderless",size:"small",style:{boxShadow:"none"},title:`${o}(${a})`,extra:e.jsxs(T,{gap:"small",children:[e.jsx(al,{value:E,onChange:u=>B(u)}),e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:()=>{p.openModal("modalC",{data:{component_id:a},structure:{component_type:s}})},children:"Edit InputForm"}),e.jsx(b,{size:"small",color:"cyan",variant:"solid",disabled:!M,onClick:()=>c([]),children:"Clear"}),e.jsx(b,{size:"small",color:"cyan",variant:"solid",disabled:!r,onClick:ee,children:"Parse"})]}),children:e.jsxs(R,{form:y,children:[e.jsx(R.Item,{name:"sample_source",label:"Sample Source",rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(q,{placeholder:"gut,brain..."})}),!E&&e.jsx(e.Fragment,{children:S&&S=="collected"?e.jsx(R.Item,{name:"file_name",label:"File Name",rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(q,{})}):e.jsx(R.Item,{name:"sample_name",label:"Sample Name",rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(q,{})})}),r?e.jsx(e.Fragment,{children:e.jsx(tl,{formJson:r,dataMap:{}})}):e.jsx(e.Fragment,{children:e.jsx(Ye,{description:"This component does not have inputForm configured!",children:e.jsx(b,{color:"cyan",variant:"solid",onClick:()=>{p.openModal("modalC",{data:{component_id:a},structure:{component_type:s}})},children:"Config InputForm"})})}),E&&e.jsx(Cl,{parseData:M,columns:W,importData:n}),!E&&e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:n,children:"Ok"}),e.jsx(Ze,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(R.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(de,{children:e.jsx("pre",{children:JSON.stringify(Q(y.getFieldsValue()),null,2)})})})})}]})]})})})},bl=({visible:s,onClose:a,params:o,callback:r})=>s?e.jsx(e.Fragment,{children:e.jsx(xe,{open:s,onClose:a,width:"80%",onCancel:a,title:"Import Data",footer:null,children:e.jsx(kl,{params:o,type:"inputFile",callback:()=>{a(),r&&r()}})})}):null,Sl=({params:s,type:a,callback:o})=>{if(!s)return e.jsx(e.Fragment,{children:"无数据"});if(s.component_type=="software"){if(s[a]&&Array.isArray(s[a])&&s[a].length>0)return s[a].map((r,p)=>i.createElement(ce,{...r,operatePipeline:s.operatePipeline,key:p,callback:o}))}else{if(s.component_type=="pipeline")return e.jsx(ce,{...s});if(s.component_type=="file")return e.jsx(ce,{...s,callback:o})}},kl=i.memo(Sl),yl=({visible:s,onClose:a,params:o,callback:r})=>{if(!s)return null;const[p]=R.useForm(),g=async()=>{const O=await F(`/analysis-result/find-by-id/${o==null?void 0:o.analysis_result_id}`);p.setFieldsValue(O.data)};i.useEffect(()=>{o!=null&&o.analysis_result_id&&g()},[o==null?void 0:o.analysis_result_id]);const S=async()=>{const y={...await p.validateFields(),id:o.id};console.log(y);const $=await rl(o==null?void 0:o.analysis_result_id,y);console.log($),r&&r(),a()};return e.jsx(xe,{title:"Edit Analsyis Result",open:s,onClose:a,onCancel:a,onOk:S,children:e.jsxs(R,{form:p,children:[e.jsx(R.Item,{label:"File Name",name:"file_name",children:e.jsx(q,{})}),e.jsx(R.Item,{label:"Sample Source",name:"sample_source",children:e.jsx(q,{})})]})})},Il=i.forwardRef(({pipeline:s,software:a,title:o,form:r,appendSampleColumns:p=[],setResultTableList:g,cleanDom:S,analysisType:O,setRecord:y,setTableLoading:$,setTabletData:te,shouldTrigger:M,analysisMethod:c,columnsParamsALL:E,activeTabKey:B,setActiveTabKey:W,cardExtra:ae,operatePipeline:f,relationType:G,onChangeAnalysisResultId:Q,currentAnalysisMethod:n,setCurrentAnalysisMethod:ee,params:u,...x},d)=>{i.useImperativeHandle(d,()=>({reload:v}));const{project:h,projectObj:_}=$e(),D=el(),[w,V]=i.useState([]),[z,L]=i.useState(),[le,U]=i.useState(!0),{eventSourceRef:ne,status:$l,reconnect:Dl}=Pe(),{modal:J,openModal:fe,closeModal:je}=Ke(),[se,ge]=i.useState([]),[Le,Ne]=i.useState({}),[Oe,Be]=i.useState([]),[Ve,oe]=i.useState(!0),[I,Ue]=i.useState(),[_e,Je]=i.useState(200),{baseURL:ie}=De(l=>l.user),X=l=>{Ue(l),Q&&Q(l)},Y=l=>{l.map(t=>t.columns_name),Be([])};i.useEffect(()=>{var t;if(!ne)return;const l=m=>{const C=JSON.parse(m.data);if(C.msgType==="analysis_result"){const k=c.map(K=>K.component_id);console.log("componentIdList",k),console.log("data.component_id ",C.component_id),console.log(" componentIdList.includes(data.component_id) ",k.includes(C.component_id)),k.includes(C.component_id)&&v()}};return(t=ne.current)==null||t.addEventListener("message",l),()=>{var m;console.log("removeEventListener"),(m=ne.current)==null||m.removeEventListener("message",l)}},[ne.current]);const v=()=>{if(console.log("analysisMethod: ",c),c&&Array.isArray(c)){const l=c.flatMap(t=>t.component_id);ve({componentIdList:l})}else ve({params:u})},he=l=>c.reduce((C,k)=>(C[k==null?void 0:k.component_id]=k,C),{})[l];i.useEffect(()=>{var l,t;if(c&&Array.isArray(c)&&c.length>0&&W){W((l=c[0])==null?void 0:l.component_id);const m=he((t=c[0])==null?void 0:t.component_id);ee(m)}v()},[JSON.stringify(u),JSON.stringify(c),h,_==null?void 0:_.metadata_form]);const He=l=>{const t=z[l];V(t),W(l);const m=he(l);ee(m),t.length>0?(X(t[0].analysis_result_id),Y(t[0].columns)):(Y([]),X(void 0))},we=async()=>{if((n==null?void 0:n.file_type)=="collected"&&I){oe(!0);const l=await F.get(`/analysis-result/table/${I}?row_num=${_e}`,{timeout:2e4});ge(l.data.tables),Ne({nrow:l.data.nrow,ncol:l.data.ncol}),oe(!1)}else ge([]),oe(!1)};i.useEffect(()=>{we()},[I]);const ve=async({analysisMethodValues:l,params:t,componentIdList:m})=>{var C,k;if(U(!0),m){let K=await F.post("/analysis-result/list-analysis-result-grouped",{project:h,component_ids:m,...t});U(!1);const N=K.data;console.log("groupedData",N),g&&g(N),L(N);let H;B?H=N[B]?N[B]:[]:H=N[(C=c[0])==null?void 0:C.component_id]?N[(k=c[0])==null?void 0:k.component_id]:[],V(H),H.length>0?(X(H[0].analysis_result_id),Y(H[0].columns)):(Y([]),X(void 0))}else{let K=await F.post("/analysis-result/list-analysis-result",{project:h,component_ids:m,...t});V(K.data)}U(!1)},Ce=async l=>{await F.delete(`/analyais-result/delete-by-id/${l}`),D.success("删除成功!"),v()};let qe=[{title:"Project Name",dataIndex:"project_name",key:"project_name",width:100,ellipsis:!0,render:(l,t)=>e.jsx(j,{title:t.project,children:e.jsx("span",{style:{cursor:"pointer"},children:l})})},{title:"Analysis Result ID",dataIndex:"analysis_result_id",key:"analysis_result_id",width:50,ellipsis:!0,render:(l,t)=>e.jsx(j,{title:t.analysis_result_id,children:e.jsx("span",{style:{cursor:"pointer"},children:String(l).slice(0,8)})})},{title:"Analysis Id",dataIndex:"analysis_id",key:"analysis_id",width:50,ellipsis:!0,render:(l,t)=>e.jsx(j,{title:t.analysis_id,children:e.jsx("span",{style:{cursor:"pointer"},children:l?String(l).slice(0,8):""})})},{title:"Component Name",dataIndex:"component_name",key:"component_name",width:100,ellipsis:!0,render:(l,t)=>e.jsx(j,{title:e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["analysis_id: ",t.analysis_id]}),e.jsxs("li",{children:["component_id: ",t.component_id]}),e.jsxs("li",{children:["analysis_result_id: ",t.analysis_result_id]}),e.jsxs("li",{children:["sample_id: ",t.sample_id]}),e.jsxs("li",{children:["file_name: ",t.file_name]}),e.jsxs("li",{children:["analysis_result_hash: ",t.analysis_result_hash]})]})}),children:e.jsx("span",{style:{cursor:"pointer"},children:l})})},{title:"Sample Name",dataIndex:"sample_name",key:"sample_name",width:100,ellipsis:!0,render:(l,t)=>e.jsx(j,{title:e.jsx(e.Fragment,{children:e.jsx("ul",{children:e.jsxs("li",{children:["sample_id: ",t.sample_id]})})}),children:e.jsx("span",{style:{cursor:"pointer"},children:l})})},{title:"Sample Source",dataIndex:"sample_source",key:"sample_source",width:100,ellipsis:!0},...(()=>{var l;return!(_!=null&&_.metadata_form)||!Array.isArray(_==null?void 0:_.metadata_form)?[]:(l=_==null?void 0:_.metadata_form)==null?void 0:l.map(t=>({title:t.label,dataIndex:t.name,key:t.name,ellipsis:!0}))})(),...p,{title:"Action",key:"action",fixed:"right",ellipsis:!0,width:200,render:(l,t)=>e.jsxs(ke,{size:"middle",children:[e.jsx(Ae,{content:e.jsx(e.Fragment,{children:e.jsx(de,{children:e.jsx("pre",{children:JSON.stringify(t.content,null,2)})})}),children:e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:()=>{y&&y(t),f.openModal("openFile",{content:t.content,fileType:t.file_type,description:n.description})},children:"Open"})}),t.sample_name?e.jsx(e.Fragment,{children:e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f.openModal("metadataForm",{analysis_result_id:t.analysis_result_id,sample_id:t.sample_id,callback:v})},children:"metadata"})}):e.jsx(e.Fragment,{children:e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f.openModal("metadataForm",{analysis_result_id:t.analysis_result_id,callback:v})},children:"Add Metadata"})}),e.jsx(b,{size:"small",color:"cyan",variant:"solid",onClick:()=>{console.log(f),f.openModals("bindSample",{analysis_result_id:t.analysis_result_id,callback:v})},children:"Bind Sample "}),e.jsx(A,{title:"Are you sure you want to delete it?",onConfirm:async()=>{await Ce(t.analysis_result_id)},children:e.jsx(b,{size:"small",color:"danger",variant:"solid",children:"Delete"})})]})}];const[Z,We]=i.useState("");let P=i.useMemo(()=>Z?(n==null?void 0:n.file_type)=="collected"?se.filter(l=>Object.values(l).some(t=>String(t).toLowerCase().includes(Z.toLowerCase()))):w.filter(l=>Object.values(l).some(t=>String(t).toLowerCase().includes(Z.toLowerCase()))):(n==null?void 0:n.file_type)=="collected"?se:w,[w,se,Z]);const[re,Ge]=i.useState([]),[Qe,be]=i.useState(!1),Se={onRemove:l=>{const t=re.indexOf(l),m=re.slice();m.splice(t,1),Ge(m)},beforeUpload:l=>(Xe(l),!1),fileList:re},Xe=async l=>{be(!0);const t=new FormData;t.append("file",l),t.append("project",h),t.append("component_id",n==null?void 0:n.component_id);for(let[m,C]of t.entries())console.log(m,C);try{const m=await F.post("/analysis-result/upload",t,{timeout:6e4});D.success(`${m.data.file_path} file uploaded successfully`)}catch{}be(!1),v()};return e.jsxs(e.Fragment,{children:[e.jsxs(ze,{size:"small",variant:"borderless",style:{boxShadow:"none"},styles:{body:{padding:"0.5rem"}},title:e.jsxs(T,{gap:"small",children:[e.jsx(ol,{})," ",o,(n==null?void 0:n.component_name)&&e.jsx(j,{title:e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["namespace: ",n==null?void 0:n.namespace_name]}),(s==null?void 0:s.component_id)&&e.jsxs("li",{children:["pipeline: ",s==null?void 0:s.component_id]}),(a==null?void 0:a.component_id)&&e.jsxs("li",{children:["software: ",a==null?void 0:a.component_id]}),(n==null?void 0:n.component_id)&&e.jsxs("li",{children:["file: ",n==null?void 0:n.component_id]}),(n==null?void 0:n.name)&&e.jsxs("li",{children:["name: ",n==null?void 0:n.name]})]})}),children:e.jsxs("span",{style:{cursor:"pointer"},children:["(",n==null?void 0:n.component_name,")"]})}),e.jsx(me,{color:"success",children:n==null?void 0:n.file_type})]}),extra:e.jsxs(e.Fragment,{children:[ae,e.jsxs(T,{gap:"small",wrap:!0,children:[e.jsx(q.Search,{size:"small",placeholder:"搜索结果...",allowClear:!0,enterButton:!0,value:Z,onChange:l=>We(l.target.value),style:{width:300}}),e.jsx(A,{title:"Confirm adding example?",onConfirm:async()=>{await F.post(`/analysis-result/add-example/${n.component_id}?project=${h}`),D.success("Example added successfully!"),v()},children:e.jsx("a",{children:"Example"})}),e.jsx(j,{title:"Download Example File",children:e.jsxs("a",{onClick:async()=>{const l=await F.get(`/analysis-result/download-example/${n.component_id}`);window.open(`${ie}${l.data.example_url}`,"_blank"),D.success(`Example ${ie}${l.data.example_url} downloading...`)},children:["Example ",e.jsx(ye,{})]})}),(n==null?void 0:n.relation_id)&&e.jsx(A,{title:"Are you sure to delete?",onConfirm:()=>{f.deletePipelineRelation(n.relation_id)},children:e.jsx(j,{title:`Delete ${n==null?void 0:n.component_name}`,children:e.jsx(Fe,{style:{cursor:"pointer",color:"red"}})})}),(f==null?void 0:f.openModal)&&e.jsxs(e.Fragment,{children:[e.jsx(fl,{style:{cursor:"pointer"},onClick:()=>{fe("importFile",{...n,operatePipeline:f})}}),e.jsx(Re,{style:{cursor:"pointer"},onClick:v}),(x.component_type=="software"||x.component_type=="file"||x.component_type=="script")&&e.jsx(e.Fragment,{children:e.jsx(sl,{menu:{items:[{key:"4",label:e.jsx(j,{title:n==null?void 0:n.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalC",{data:void 0,structure:{relation_type:G,parent_component_id:a.component_id,component_type:"file"}})},children:"Add File"})})},{key:"3",label:e.jsx(j,{title:n==null?void 0:n.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalC",{data:n,structure:{component_type:"file"}})},children:"Edit File"})})},{key:"2",label:e.jsx(j,{title:n==null?void 0:n.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:G,parent_component_id:a.component_id}})},children:"New File"})})},{key:"1",label:e.jsx(j,{title:n==null?void 0:n.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalA",{data:n,pipelineStructure:{relation_type:G}})},children:"Replace File"})})},{label:e.jsx(j,{title:n==null?void 0:n.component_name,children:e.jsx(A,{title:"Whether to remove file?",onConfirm:()=>{f.deletePipelineRelation(n.relation_id)},children:e.jsx("a",{children:"Remove File"})})}),key:"0"}]},children:e.jsx("a",{onClick:l=>l.preventDefault(),children:e.jsxs(ke,{children:["More",e.jsx(ll,{})]})})})})]}),e.jsx(nl,{onClick:()=>{f.openModal("descriptionModal",n.description)},style:{cursor:"pointer"}})]})]}),tabList:c&&Array.isArray(c)&&c.length>1?c.map(l=>({key:l.component_id,label:e.jsx(j,{title:l.component_id,children:l.component_name?l.component_name:"no_name"})})):void 0,activeTabKey:B,onTabChange:He,children:[(n==null?void 0:n.file_type)=="collected"?e.jsx(e.Fragment,{children:e.jsx(Ie,{spinning:Qe,tip:"Uploading...",children:Array.isArray(w)&&w.length==0?e.jsx(e.Fragment,{children:e.jsxs(cl,{...Se,maxCount:1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(_l,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(pl,{activeKey:I,onChange:l=>{const t=w.filter(m=>m.analysis_result_id==l);t.length>0&&Y(t[0].columns),X(l)},tabBarExtraContent:e.jsxs(T,{gap:"small",children:[e.jsx(dl,{size:"small",value:_e,onChange:l=>Je(l)}),e.jsx(ml,{...Se,children:e.jsx(j,{title:"Upload new file",children:e.jsx(vl,{style:{cursor:"pointer"}})})}),e.jsx(ye,{style:{cursor:"pointer"},onClick:()=>{const l=w.find(t=>t.analysis_result_id==I);console.log("currentData",l),window.open(`${ie}${l.url}`,"_blank")}}),e.jsx(Me,{style:{cursor:"pointer"},onClick:()=>{console.log("analysisResultId",I),fe("analysisResultEdit",{analysis_result_id:I})}}),e.jsx(A,{title:`Are you sure you want to delete ${I}?`,onConfirm:async()=>{await Ce(I)},children:e.jsx(j,{title:`Delete current tab ${I}`,children:e.jsx(Fe,{style:{cursor:"pointer",color:"red"}})})}),e.jsx(Re,{style:{cursor:"pointer"},onClick:()=>we()})]}),items:w.map((l,t)=>({key:l.analysis_result_id,label:e.jsx(j,{title:`${l==null?void 0:l.content} ${l.analysis_result_id}`,children:`${l==null?void 0:l.file_name}`})}))}),e.jsx(Ie,{spinning:Ve,tip:"Loading table data...",children:e.jsx("div",{style:{height:"50vh"},children:e.jsx(Fl,{shape:Le,rows:[Oe,...P]})})})]})})}):e.jsx(e.Fragment,{children:e.jsx(Te,{rowKey:l=>l.id,size:"small",pagination:{pageSize:10},loading:le,scroll:{x:"max-content",y:55*5},columns:E||qe,footer:()=>`A total of ${P&&Array.isArray(P)&&P.length} records`,dataSource:P})}),(n==null?void 0:n.parseFormat)&&(n==null?void 0:n.relation_type)=="software_output_file"&&e.jsx(de,{children:e.jsx("pre",{children:JSON.stringify(n.parseFormat,null,2)})})]}),e.jsx(bl,{visible:J.visible&&J.key=="importFile",params:J.params,callback:v,onClose:je}),e.jsx(yl,{visible:J.visible&&J.key=="analysisResultEdit",params:J.params,callback:v,onClose:je})]})}),Gl=({visible:s,onClose:a,params:o})=>s?e.jsx(e.Fragment,{children:e.jsx(xe,{title:"分析结果",open:s,onCancel:a,width:"80%",children:e.jsx(Il,{...o,analysisType:"sample"})})}):null;function Fl({rows:s,shape:a,columns:o}){const{token:r}=Ee.useToken();return e.jsxs(e.Fragment,{children:[o&&e.jsx(T,{align:"center",style:{background:r.colorBgContainerDisabled,borderBottom:`1px solid ${r.colorBorderSecondary}`,padding:"0 8px",fontWeight:500},children:Array.isArray(o)&&e.jsx(e.Fragment,{children:o.map((p,g)=>e.jsx("span",{children:e.jsx("div",{style:{flex:"0 0 200px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",padding:"0 8px"},title:p.columns_name,children:e.jsx(j,{title:p.analysis_result_id,children:p.columns_name})},g)},g))})}),e.jsx(il,{rowComponent:Rl,rowCount:s==null?void 0:s.length,rowHeight:30,rowProps:{rows:s}}),e.jsxs(T,{justify:"end",gap:"small",children:[e.jsxs(me,{color:"default",children:["Rows: ",a==null?void 0:a.nrow]}),e.jsxs(me,{color:"default",children:["Columns: ",a==null?void 0:a.ncol]})]})]})}function Rl({index:s,rows:a,style:o}){const r=a[s],{token:p}=Ee.useToken();return e.jsx(T,{align:"center",style:{...o,backgroundColor:s%2?p.colorBgContainer:p.colorFillQuaternary,borderBottom:`1px solid ${p.colorBorderSecondary}`,padding:"0 8px",fontSize:13,minWidth:"fit-content",transition:"background-color 0.2s"},className:"table-row",onMouseEnter:g=>{g.currentTarget.style.backgroundColor=p.colorFillTertiary},onMouseLeave:g=>{g.currentTarget.style.backgroundColor=s%2?p.colorBgContainer:p.colorFillQuaternary},children:r.map((g,S)=>e.jsx("div",{style:{flex:"0 0 200px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",padding:"0 8px"},title:String(g),children:String(g)},S))})}export{Gl as A,Il as R};

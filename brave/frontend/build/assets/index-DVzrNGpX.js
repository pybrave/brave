import{r as b,e as Ci,j as x,g as ht,B as se,a as ot,F as ve,d as st,h as ac,E as Mi,i as Ni,c as zr,M as It,I as bt,P as cc,k as Ai,l as lc,R as fe,m as xo,n as Lt,o as Di,u as uc,f as dc,p as fc,q as hc,t as gc}from"./index-sBAHO47Q.js";import{U as Ii,A as ki,a as pc}from"./index-B7aA0onY.js";import{c as mc}from"./utils-D2B0dIuM.js";import{s as yc,a as xc,C as vc,b as wc,d as bc}from"./index-Y3JoGWg-.js";import{M as Sc,a as _c}from"./index-BucwCZva.js";import{D as Ec}from"./index-D9ThUF_S.js";import{T as Or,C as Ri}from"./index-BGYi6o0L.js";import{F as Cc}from"./index-C7wSNqdv.js";import{F as Fr}from"./Table-DgCb1KGo.js";import{D as Mc}from"./index-DaVX8YAY.js";import{f as Nc,u as Ac,a as Dc,M as Ic,B as kc}from"./index-345IE2ra.js";import{O as Rc}from"./index-TCmcr2I_.js";import{T as Tc,c as Pc,i as En,a as Cn,d as Br,t as jc,n as $c}from"./index-DfjJlo8H.js";import{M as Lc}from"./index-DWBzt4pJ.js";import{T as zc}from"./index-D7kmkYxD.js";import"./index-BCFuwjSR.js";import"./index-eXUHhOoM.js";import"./index-apqBY_Ve.js";import"./index-EtHiVJbx.js";import"./addEventListener-DLw2X560.js";import"./index-DAIVK2_5.js";function vo(e,t,n){var r=new Tc;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}function Oc(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(i){for(o=0;o<n;++o)r[o]=e[o]*(1-i)+t[o]*i;return r}}function Fc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Bc(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,o=new Array(r),i=new Array(n),s;for(s=0;s<r;++s)o[s]=zt(e[s],t[s]);for(;s<n;++s)i[s]=t[s];return function(a){for(s=0;s<r;++s)i[s]=o[s](a);return i}}function Hc(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Le(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Vc(e,t){var n={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?n[o]=zt(e[o],t[o]):r[o]=t[o];return function(i){for(o in n)r[o]=n[o](i);return r}}var br=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rr=new RegExp(br.source,"g");function Xc(e){return function(){return e}}function Yc(e){return function(t){return e(t)+""}}function Ti(e,t){var n=br.lastIndex=rr.lastIndex=0,r,o,i,s=-1,a=[],c=[];for(e=e+"",t=t+"";(r=br.exec(e))&&(o=rr.exec(t));)(i=o.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(r=r[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,c.push({i:s,x:Le(r,o)})),n=rr.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?c[0]?Yc(c[0].x):Xc(t):(t=c.length,function(u){for(var l=0,f;l<t;++l)a[(f=c[l]).i]=f.x(u);return a.join("")})}function zt(e,t){var n=typeof t,r;return t==null||n==="boolean"?Pc(t):(n==="number"?Le:n==="string"?(r=Cn(t))?(t=r,En):Ti:t instanceof Cn?En:t instanceof Date?Hc:Fc(t)?Oc:Array.isArray(t)?Bc:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Vc:Le)(e,t)}var wo=180/Math.PI,Sr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Pi(e,t,n,r,o,i){var s,a,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),e*r<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*wo,skewX:Math.atan(c)*wo,scaleX:s,scaleY:a}}var un;function Wc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Sr:Pi(t.a,t.b,t.c,t.d,t.e,t.f)}function Uc(e){return e==null||(un||(un=document.createElementNS("http://www.w3.org/2000/svg","g")),un.setAttribute("transform",e),!(e=un.transform.baseVal.consolidate()))?Sr:(e=e.matrix,Pi(e.a,e.b,e.c,e.d,e.e,e.f))}function ji(e,t,n,r){function o(u){return u.length?u.pop()+" ":""}function i(u,l,f,d,h,m){if(u!==f||l!==d){var p=h.push("translate(",null,t,null,n);m.push({i:p-4,x:Le(u,f)},{i:p-2,x:Le(l,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function s(u,l,f,d){u!==l?(u-l>180?l+=360:l-u>180&&(u+=360),d.push({i:f.push(o(f)+"rotate(",null,r)-2,x:Le(u,l)})):l&&f.push(o(f)+"rotate("+l+r)}function a(u,l,f,d){u!==l?d.push({i:f.push(o(f)+"skewX(",null,r)-2,x:Le(u,l)}):l&&f.push(o(f)+"skewX("+l+r)}function c(u,l,f,d,h,m){if(u!==f||l!==d){var p=h.push(o(h)+"scale(",null,",",null,")");m.push({i:p-4,x:Le(u,f)},{i:p-2,x:Le(l,d)})}else(f!==1||d!==1)&&h.push(o(h)+"scale("+f+","+d+")")}return function(u,l){var f=[],d=[];return u=e(u),l=e(l),i(u.translateX,u.translateY,l.translateX,l.translateY,f,d),s(u.rotate,l.rotate,f,d),a(u.skewX,l.skewX,f,d),c(u.scaleX,u.scaleY,l.scaleX,l.scaleY,f,d),u=l=null,function(h){for(var m=-1,p=d.length,v;++m<p;)f[(v=d[m]).i]=v.x(h);return f.join("")}}}var qc=ji(Wc,"px, ","px)","deg)"),Gc=ji(Uc,", ",")",")"),Kc=1e-12;function bo(e){return((e=Math.exp(e))+1/e)/2}function Zc(e){return((e=Math.exp(e))-1/e)/2}function Jc(e){return((e=Math.exp(2*e))-1)/(e+1)}const vn=function e(t,n,r){function o(i,s){var a=i[0],c=i[1],u=i[2],l=s[0],f=s[1],d=s[2],h=l-a,m=f-c,p=h*h+m*m,v,w;if(p<Kc)w=Math.log(d/u)/t,v=function(M){return[a+M*h,c+M*m,u*Math.exp(t*M*w)]};else{var E=Math.sqrt(p),g=(d*d-u*u+r*p)/(2*u*n*E),y=(d*d-u*u-r*p)/(2*d*n*E),_=Math.log(Math.sqrt(g*g+1)-g),C=Math.log(Math.sqrt(y*y+1)-y);w=(C-_)/t,v=function(M){var N=M*w,T=bo(_),O=u/(n*E)*(T*Jc(t*N+_)-Zc(_));return[a+O*h,c+O*m,u*T/bo(t*N+_)]}}return v.duration=w*1e3*t/Math.SQRT2,v}return o.rho=function(i){var s=Math.max(.001,+i),a=s*s,c=a*a;return e(s,a,c)},o}(Math.SQRT2,2,4),Qc=({visible:e,onClose:t,params:n,callback:r})=>{if(!e)return null;const[o,i]=b.useState(),[s,a]=Ci.useMessage(),[c,u]=b.useState("main"),l=b.useRef(null),f=async d=>{try{const h=await ot.get(`/get-component-module-content/${d.component_id}?script_name=${c}`);console.log(h),i(h.data)}catch(h){s.error(`${h.response.data.detail}`)}};return b.useEffect(()=>{f(n)},[JSON.stringify(n),c]),x.jsxs(x.Fragment,{children:[a,x.jsxs(Ec,{extra:x.jsx(ht,{justify:"flex-end",gap:"small",children:x.jsx(se,{color:"cyan",variant:"solid",onClick:()=>{l.current.setValue(o==null?void 0:o.content)},children:"保存"})}),title:"查看文件",open:e,onClose:t,width:"50%",children:[x.jsx("ul",{children:x.jsxs("li",{children:["path:",o==null?void 0:o.path]})}),x.jsx("hr",{}),x.jsx(Or,{onChange:d=>{u(d)},items:[{label:"main",key:"main"},{label:"input_parse",key:"input_parse"},{label:"output_parse",key:"output_parse"}]}),x.jsx(Sc,{value:o==null?void 0:o.content,editorRef:l,defaultLanguage:"python"})]})]})},el=({parseData:e,columns:t,importData:n})=>x.jsx(Fr,{size:"small",bordered:!0,pagination:!1,footer:()=>x.jsxs("div",{style:{textAlign:"right"},children:["一共",e.length,"条记录   ",x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:n,children:"确认"})]}),columns:t,dataSource:e}),or=({component_type:e,component_id:t,component_name:n,inputForm:r,operatePipeline:o,name:i,callback:s})=>{const[a]=ve.useForm();console.log("-->ImportFile渲染");const{messageApi:c,project:u}=st(),[l,f]=b.useState([]);ac(g=>g.global.setting);const[d,h]=b.useState(),m=b.useRef(null);b.useEffect(()=>{if(r){let y=r.map(_=>Array.isArray(_.name)?_.name[1]:_.name).map(_=>({title:_,dataIndex:_,key:_,render:C=>x.jsx("span",{children:C})}));y=[{title:"样本名称",dataIndex:"sample_name",key:"sample_name",render:_=>x.jsx("span",{children:_})},...y,{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(_,C)=>x.jsx(ht,{gap:"small",children:x.jsx(se,{size:"small",danger:!0,onClick:()=>{p(C.sample_name)},children:"删除"})})}],console.log(y),m.current=y,h(y)}},[r]);const p=g=>{f(y=>y.filter(_=>_.sample_name!==g))},v=g=>{const{content:y,sample_name:_}=g;return l?l.map(C=>{const{sample_name:M,...N}=C;return{...g,project:u,component_id:t,content:JSON.stringify(N),sample_name:M}}):[{...g,project:u,component_id:t,content:JSON.stringify(y),sample_name:_}]},w=async()=>{const g=await a.validateFields();if(g.length==0){c.error("没有数据添加!");return}if(r&&r.length==0){c.error("该组件没有配置inputForm!");return}const y=v(g);try{const _=await ot.post("/import-data",y);c.success("导入成功"),s&&s()}catch(_){c.error(_.response.data.detail)}},E=async()=>{const g=await a.validateFields();if(r&&r.length==0){c.error("该组件没有配置inputForm!");return}const y=await ot.post("/parse-import-data",{content:JSON.stringify(g.content)});console.log(y),f(y.data)};return b.useEffect(()=>{const g=y=>{var O;const _=((O=y.clipboardData)==null?void 0:O.getData("Text"))||"";if(!_)return;const C=_.includes("	")?"	":",",N=_.split(/\r?\n/).filter(R=>R.trim()!=="").map(R=>R.split(C).map(P=>P.trim()));console.log(N);const T=N.map(R=>{const P={};return m.current.forEach((j,S)=>{R.length<=S?P[j.dataIndex]="unknown":P[j.dataIndex]=R[S]}),P});f(T),c.success("粘贴成功！")};return document.addEventListener("paste",g),()=>{document.removeEventListener("paste",g)}},[]),x.jsx(x.Fragment,{children:x.jsx(Ri,{title:`${n}(${t})`,extra:x.jsxs(ht,{gap:"small",children:[x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{o.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"编辑inputForm"}),x.jsx(se,{size:"small",color:"cyan",variant:"solid",disabled:!l,onClick:()=>f([]),children:"清空"}),x.jsx(se,{size:"small",color:"cyan",variant:"solid",disabled:!r,onClick:E,children:"解析"})]}),children:x.jsxs(ve,{form:a,children:[r?x.jsx(x.Fragment,{children:x.jsx(Cc,{formJson:r,dataMap:{}})}):x.jsx(x.Fragment,{children:x.jsx(Mi,{description:"该组件没有配置inputForm!",children:x.jsx(se,{color:"cyan",variant:"solid",onClick:()=>{o.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"配置inputForm"})})}),x.jsx(el,{parseData:l,columns:d,importData:w}),x.jsx(Ni,{ghost:!0,items:[{key:"1",label:"更多",children:x.jsx(x.Fragment,{children:x.jsx(ve.Item,{noStyle:!0,shouldUpdate:!0,children:()=>x.jsx(zr,{children:x.jsx("pre",{children:JSON.stringify(v(a.getFieldsValue()),null,2)})})})})}]})]})})})},tl=({visible:e,onClose:t,params:n,callback:r})=>e?x.jsx(x.Fragment,{children:x.jsx(It,{open:e,onClose:t,width:"80%",onCancel:t,title:"导入数据",footer:null,children:x.jsx(rl,{params:n,type:"inputFile",callback:t})})}):null,nl=({params:e,type:t,callback:n})=>{if(!e)return x.jsx(x.Fragment,{children:"无数据"});if(e.component_type=="software"){if(e[t]&&Array.isArray(e[t])&&e[t].length>0)return e[t].map((r,o)=>b.createElement(or,{...r,operatePipeline:e.operatePipeline,key:o,callback:n}))}else{if(e.component_type=="pipeline")return x.jsx(or,{...e});if(e.component_type=="file")return x.jsx(or,{...e})}},rl=b.memo(nl),ol=({visible:e,onClose:t,params:n,callback:r})=>{if(!e)return null;const[o,i]=b.useState([]),[s,a]=b.useState(!1),[c]=ve.useForm(),[u,l]=b.useState(n[0].dataKey),[f,d]=b.useState(null),h=async y=>{a(!0);const _=await ot.post("/list-bio-database",y);i(_.data),a(!1)},m=async()=>({...await c.validateFields(),type:u}),p=async()=>{const y=await m();f?await ot.post("/update-bio-database",{...y,database_id:f.database_id}):await ot.post("/add-bio-database",y),v(),d(void 0),c.resetFields()},v=()=>{h({type:u})};b.useEffect(()=>{h({type:u})},[n]);const w=y=>{l(y),h({type:y})},E=async y=>{await ot.delete(`/delete-bio-database/${y.id}`),v()},g=y=>{c.setFieldsValue(y),d(y)};return x.jsxs(It,{title:"数据库操作",open:e,onCancel:t,width:"50%",footer:null,children:[x.jsx(Or,{tabBarExtraContent:x.jsxs(x.Fragment,{children:[x.jsx(se,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:v,children:" 刷新"}),x.jsxs(se,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{d(void 0),p()},children:[" ",f?"更新":"添加"]})]}),activeKey:u,onChange:w,items:n.map(y=>({key:y.name,label:y.label,children:x.jsx("div",{})}))}),x.jsxs(ve,{form:c,style:{maxWidth:600},labelCol:{span:3},children:[x.jsx(ve.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:x.jsx(bt,{})}),x.jsx(ve.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:x.jsx(bt,{})}),x.jsx(ve.Item,{name:"db_index",label:"索引",children:x.jsx(bt,{})})]}),x.jsx(Fr,{dataSource:o,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(y,_)=>x.jsxs(ht,{gap:"small",children:[x.jsx(cc,{title:"确定删除吗？",onConfirm:()=>{E(_)},children:x.jsx(se,{size:"small",type:"primary",danger:!0,children:"删除"})}),x.jsx(se,{size:"small",type:"primary",onClick:()=>{g(_)},children:"编辑"})]})}],loading:s,pagination:!1})]})},il=({visible:e,onClose:t,params:n})=>x.jsx(It,{footer:null,title:"参数",width:"50%",open:e,onCancel:t,children:x.jsx(zr,{children:x.jsx("pre",{children:JSON.stringify(n,null,2)})})});bt.TextArea;const sl=({visible:e,onClose:t,params:n})=>{var f;if(!e)return null;const[r]=ve.useForm(),{callback:o}=n,{messageApi:i}=st(),{project:s,projectObj:a}=st(),c=d=>{const h=d.metadata;return delete d.metadata,{...d,sample_id:n.sample_id,project:s,analysis_result_id:n.analysis_result_id,metadata:JSON.stringify(h)}},u=async()=>{const d=await Nc(n.sample_id);r.setFieldsValue(d.data)};b.useEffect(()=>{n.sample_id&&u()},[n==null?void 0:n.sample_id]);const l=async()=>{const d=await r.validateFields(),h=c(d);h.sample_id?(await Ac(h),i.success("更新成功")):(await Dc(h),i.success("添加成功")),o==null||o(),t()};return x.jsxs(It,{onOk:l,open:e,onClose:t,onCancel:t,title:`${n.sample_id?"编辑":"添加"}metadata`,children:[JSON.stringify(a),x.jsxs(ve,{form:r,children:[x.jsx(ve.Item,{label:"样本名称",name:"sample_name",children:x.jsx(bt,{})}),(a==null?void 0:a.metadata_form)&&Array.isArray(a==null?void 0:a.metadata_form)&&((f=a==null?void 0:a.metadata_form)==null?void 0:f.map(d=>x.jsx(ve.Item,{label:d.label,name:["metadata",d.name],children:x.jsx(bt,{})},d.name))),x.jsx(Ni,{ghost:!0,items:[{key:"1",label:"更多",children:x.jsx(x.Fragment,{children:x.jsx(ve.Item,{noStyle:!0,shouldUpdate:!0,children:()=>x.jsx(zr,{children:x.jsx("pre",{children:JSON.stringify(c(r.getFieldsValue()),null,2)})})})})}]})]})]})};function ae(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=ae(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var _r="http://www.w3.org/1999/xhtml";const So={svg:"http://www.w3.org/2000/svg",xhtml:_r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $n(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),So.hasOwnProperty(t)?{space:So[t],local:e}:e}function al(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===_r&&t.documentElement.namespaceURI===_r?t.createElement(e):t.createElementNS(n,e)}}function cl(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function $i(e){var t=$n(e);return(t.local?cl:al)(t)}function ll(){}function Hr(e){return e==null?ll:function(){return this.querySelector(e)}}function ul(e){typeof e!="function"&&(e=Hr(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=new Array(s),c,u,l=0;l<s;++l)(c=i[l])&&(u=e.call(c,c.__data__,l,i))&&("__data__"in c&&(u.__data__=c.__data__),a[l]=u);return new be(r,this._parents)}function dl(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function fl(){return[]}function Li(e){return e==null?fl:function(){return this.querySelectorAll(e)}}function hl(e){return function(){return dl(e.apply(this,arguments))}}function gl(e){typeof e=="function"?e=hl(e):e=Li(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var s=t[i],a=s.length,c,u=0;u<a;++u)(c=s[u])&&(r.push(e.call(c,c.__data__,u,s)),o.push(c));return new be(r,o)}function zi(e){return function(){return this.matches(e)}}function Oi(e){return function(t){return t.matches(e)}}var pl=Array.prototype.find;function ml(e){return function(){return pl.call(this.children,e)}}function yl(){return this.firstElementChild}function xl(e){return this.select(e==null?yl:ml(typeof e=="function"?e:Oi(e)))}var vl=Array.prototype.filter;function wl(){return Array.from(this.children)}function bl(e){return function(){return vl.call(this.children,e)}}function Sl(e){return this.selectAll(e==null?wl:bl(typeof e=="function"?e:Oi(e)))}function _l(e){typeof e!="function"&&(e=zi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],c,u=0;u<s;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new be(r,this._parents)}function Fi(e){return new Array(e.length)}function El(){return new be(this._enter||this._groups.map(Fi),this._parents)}function Mn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Mn.prototype={constructor:Mn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Cl(e){return function(){return e}}function Ml(e,t,n,r,o,i){for(var s=0,a,c=t.length,u=i.length;s<u;++s)(a=t[s])?(a.__data__=i[s],r[s]=a):n[s]=new Mn(e,i[s]);for(;s<c;++s)(a=t[s])&&(o[s]=a)}function Nl(e,t,n,r,o,i,s){var a,c,u=new Map,l=t.length,f=i.length,d=new Array(l),h;for(a=0;a<l;++a)(c=t[a])&&(d[a]=h=s.call(c,c.__data__,a,t)+"",u.has(h)?o[a]=c:u.set(h,c));for(a=0;a<f;++a)h=s.call(e,i[a],a,i)+"",(c=u.get(h))?(r[a]=c,c.__data__=i[a],u.delete(h)):n[a]=new Mn(e,i[a]);for(a=0;a<l;++a)(c=t[a])&&u.get(d[a])===c&&(o[a]=c)}function Al(e){return e.__data__}function Dl(e,t){if(!arguments.length)return Array.from(this,Al);var n=t?Nl:Ml,r=this._parents,o=this._groups;typeof e!="function"&&(e=Cl(e));for(var i=o.length,s=new Array(i),a=new Array(i),c=new Array(i),u=0;u<i;++u){var l=r[u],f=o[u],d=f.length,h=Il(e.call(l,l&&l.__data__,u,r)),m=h.length,p=a[u]=new Array(m),v=s[u]=new Array(m),w=c[u]=new Array(d);n(l,f,p,v,w,h,t);for(var E=0,g=0,y,_;E<m;++E)if(y=p[E]){for(E>=g&&(g=E+1);!(_=v[g])&&++g<m;);y._next=_||null}}return s=new be(s,r),s._enter=a,s._exit=c,s}function Il(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function kl(){return new be(this._exit||this._groups.map(Fi),this._parents)}function Rl(e,t,n){var r=this.enter(),o=this,i=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?i.remove():n(i),r&&o?r.merge(o).order():o}function Tl(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,i=r.length,s=Math.min(o,i),a=new Array(o),c=0;c<s;++c)for(var u=n[c],l=r[c],f=u.length,d=a[c]=new Array(f),h,m=0;m<f;++m)(h=u[m]||l[m])&&(d[m]=h);for(;c<o;++c)a[c]=n[c];return new be(a,this._parents)}function Pl(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function jl(e){e||(e=$l);function t(f,d){return f&&d?e(f.__data__,d.__data__):!f-!d}for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var s=n[i],a=s.length,c=o[i]=new Array(a),u,l=0;l<a;++l)(u=s[l])&&(c[l]=u);c.sort(t)}return new be(o,this._parents).order()}function $l(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ll(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function zl(){return Array.from(this)}function Ol(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function Fl(){let e=0;for(const t of this)++e;return e}function Bl(){return!this.node()}function Hl(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],i=0,s=o.length,a;i<s;++i)(a=o[i])&&e.call(a,a.__data__,i,o);return this}function Vl(e){return function(){this.removeAttribute(e)}}function Xl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Yl(e,t){return function(){this.setAttribute(e,t)}}function Wl(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ul(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function ql(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Gl(e,t){var n=$n(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Xl:Vl:typeof t=="function"?n.local?ql:Ul:n.local?Wl:Yl)(n,t))}function Bi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Kl(e){return function(){this.style.removeProperty(e)}}function Zl(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Jl(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Ql(e,t,n){return arguments.length>1?this.each((t==null?Kl:typeof t=="function"?Jl:Zl)(e,t,n??"")):Et(this.node(),e)}function Et(e,t){return e.style.getPropertyValue(t)||Bi(e).getComputedStyle(e,null).getPropertyValue(t)}function eu(e){return function(){delete this[e]}}function tu(e,t){return function(){this[e]=t}}function nu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function ru(e,t){return arguments.length>1?this.each((t==null?eu:typeof t=="function"?nu:tu)(e,t)):this.node()[e]}function Hi(e){return e.trim().split(/^|\s+/)}function Vr(e){return e.classList||new Vi(e)}function Vi(e){this._node=e,this._names=Hi(e.getAttribute("class")||"")}Vi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Xi(e,t){for(var n=Vr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Yi(e,t){for(var n=Vr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function ou(e){return function(){Xi(this,e)}}function iu(e){return function(){Yi(this,e)}}function su(e,t){return function(){(t.apply(this,arguments)?Xi:Yi)(this,e)}}function au(e,t){var n=Hi(e+"");if(arguments.length<2){for(var r=Vr(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?su:t?ou:iu)(n,t))}function cu(){this.textContent=""}function lu(e){return function(){this.textContent=e}}function uu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function du(e){return arguments.length?this.each(e==null?cu:(typeof e=="function"?uu:lu)(e)):this.node().textContent}function fu(){this.innerHTML=""}function hu(e){return function(){this.innerHTML=e}}function gu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function pu(e){return arguments.length?this.each(e==null?fu:(typeof e=="function"?gu:hu)(e)):this.node().innerHTML}function mu(){this.nextSibling&&this.parentNode.appendChild(this)}function yu(){return this.each(mu)}function xu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vu(){return this.each(xu)}function wu(e){var t=typeof e=="function"?e:$i(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function bu(){return null}function Su(e,t){var n=typeof e=="function"?e:$i(e),r=t==null?bu:typeof t=="function"?t:Hr(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function _u(){var e=this.parentNode;e&&e.removeChild(this)}function Eu(){return this.each(_u)}function Cu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Mu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Nu(e){return this.select(e?Mu:Cu)}function Au(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Du(e){return function(t){e.call(this,t,this.__data__)}}function Iu(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function ku(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,i;n<o;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++r]=i;++r?t.length=r:delete this.__on}}}function Ru(e,t,n){return function(){var r=this.__on,o,i=Du(t);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),o.value=t;return}}this.addEventListener(e.type,i,n),o={type:e.type,name:e.name,value:t,listener:i,options:n},r?r.push(o):this.__on=[o]}}function Tu(e,t,n){var r=Iu(e+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,l;c<u;++c)for(o=0,l=a[c];o<i;++o)if((s=r[o]).type===l.type&&s.name===l.name)return l.value}return}for(a=t?Ru:ku,o=0;o<i;++o)this.each(a(r[o],t,n));return this}function Wi(e,t,n){var r=Bi(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Pu(e,t){return function(){return Wi(this,e,t)}}function ju(e,t){return function(){return Wi(this,e,t.apply(this,arguments))}}function $u(e,t){return this.each((typeof t=="function"?ju:Pu)(e,t))}function*Lu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var Ui=[null];function be(e,t){this._groups=e,this._parents=t}function Jt(){return new be([[document.documentElement]],Ui)}function zu(){return this}be.prototype=Jt.prototype={constructor:be,select:ul,selectAll:gl,selectChild:xl,selectChildren:Sl,filter:_l,data:Dl,enter:El,exit:kl,join:Rl,merge:Tl,selection:zu,order:Pl,sort:jl,call:Ll,nodes:zl,node:Ol,size:Fl,empty:Bl,each:Hl,attr:Gl,style:Ql,property:ru,classed:au,text:du,html:pu,raise:yu,lower:vu,append:wu,insert:Su,remove:Eu,clone:Nu,datum:Au,on:Tu,dispatch:$u,[Symbol.iterator]:Lu};function we(e){return typeof e=="string"?new be([[document.querySelector(e)]],[document.documentElement]):new be([[e]],Ui)}function Ou(e){let t;for(;t=e.sourceEvent;)e=t;return e}function De(e,t){if(e=Ou(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Fu={passive:!1},Vt={capture:!0,passive:!1};function ir(e){e.stopImmediatePropagation()}function St(e){e.preventDefault(),e.stopImmediatePropagation()}function qi(e){var t=e.document.documentElement,n=we(e).on("dragstart.drag",St,Vt);"onselectstart"in t?n.on("selectstart.drag",St,Vt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Gi(e,t){var n=e.document.documentElement,r=we(e).on("dragstart.drag",null);t&&(r.on("click.drag",St,Vt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const dn=e=>()=>e;function Er(e,{sourceEvent:t,subject:n,target:r,identifier:o,active:i,x:s,y:a,dx:c,dy:u,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:l}})}Er.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Bu(e){return!e.ctrlKey&&!e.button}function Hu(){return this.parentNode}function Vu(e,t){return t??{x:e.x,y:e.y}}function Xu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ki(){var e=Bu,t=Hu,n=Vu,r=Xu,o={},i=Br("start","drag","end"),s=0,a,c,u,l,f=0;function d(y){y.on("mousedown.drag",h).filter(r).on("touchstart.drag",v).on("touchmove.drag",w,Fu).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(y,_){if(!(l||!e.call(this,y,_))){var C=g(this,t.call(this,y,_),y,_,"mouse");C&&(we(y.view).on("mousemove.drag",m,Vt).on("mouseup.drag",p,Vt),qi(y.view),ir(y),u=!1,a=y.clientX,c=y.clientY,C("start",y))}}function m(y){if(St(y),!u){var _=y.clientX-a,C=y.clientY-c;u=_*_+C*C>f}o.mouse("drag",y)}function p(y){we(y.view).on("mousemove.drag mouseup.drag",null),Gi(y.view,u),St(y),o.mouse("end",y)}function v(y,_){if(e.call(this,y,_)){var C=y.changedTouches,M=t.call(this,y,_),N=C.length,T,O;for(T=0;T<N;++T)(O=g(this,M,y,_,C[T].identifier,C[T]))&&(ir(y),O("start",y,C[T]))}}function w(y){var _=y.changedTouches,C=_.length,M,N;for(M=0;M<C;++M)(N=o[_[M].identifier])&&(St(y),N("drag",y,_[M]))}function E(y){var _=y.changedTouches,C=_.length,M,N;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),M=0;M<C;++M)(N=o[_[M].identifier])&&(ir(y),N("end",y,_[M]))}function g(y,_,C,M,N,T){var O=i.copy(),R=De(T||C,_),P,j,S;if((S=n.call(y,new Er("beforestart",{sourceEvent:C,target:d,identifier:N,active:s,x:R[0],y:R[1],dx:0,dy:0,dispatch:O}),M))!=null)return P=S.x-R[0]||0,j=S.y-R[1]||0,function k(A,D,$){var I=R,L;switch(A){case"start":o[N]=k,L=s++;break;case"end":delete o[N],--s;case"drag":R=De($||D,_),L=s;break}O.call(A,y,new Er(A,{sourceEvent:D,subject:S,target:d,identifier:N,active:L,x:R[0]+P,y:R[1]+j,dx:R[0]-I[0],dy:R[1]-I[1],dispatch:O}),M)}}return d.filter=function(y){return arguments.length?(e=typeof y=="function"?y:dn(!!y),d):e},d.container=function(y){return arguments.length?(t=typeof y=="function"?y:dn(y),d):t},d.subject=function(y){return arguments.length?(n=typeof y=="function"?y:dn(y),d):n},d.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:dn(!!y),d):r},d.on=function(){var y=i.on.apply(i,arguments);return y===i?d:y},d.clickDistance=function(y){return arguments.length?(f=(y=+y)*y,d):Math.sqrt(f)},d}var Yu=Br("start","end","cancel","interrupt"),Wu=[],Zi=0,_o=1,Cr=2,wn=3,Eo=4,Mr=5,bn=6;function Ln(e,t,n,r,o,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;Uu(e,n,{name:t,index:r,group:o,on:Yu,tween:Wu,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Zi})}function Xr(e,t){var n=Re(e,t);if(n.state>Zi)throw new Error("too late; already scheduled");return n}function Be(e,t){var n=Re(e,t);if(n.state>wn)throw new Error("too late; already running");return n}function Re(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Uu(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=jc(i,0,n.time);function i(u){n.state=_o,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var l,f,d,h;if(n.state!==_o)return c();for(l in r)if(h=r[l],h.name===n.name){if(h.state===wn)return vo(s);h.state===Eo?(h.state=bn,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete r[l]):+l<t&&(h.state=bn,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete r[l])}if(vo(function(){n.state===wn&&(n.state=Eo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Cr,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Cr){for(n.state=wn,o=new Array(d=n.tween.length),l=0,f=-1;l<d;++l)(h=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(o[++f]=h);o.length=f+1}}function a(u){for(var l=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=Mr,1),f=-1,d=o.length;++f<d;)o[f].call(e,l);n.state===Mr&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=bn,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function Sn(e,t){var n=e.__transition,r,o,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){i=!1;continue}o=r.state>Cr&&r.state<Mr,r.state=bn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}i&&delete e.__transition}}function qu(e){return this.each(function(){Sn(this,e)})}function Gu(e,t){var n,r;return function(){var o=Be(this,e),i=o.tween;if(i!==n){r=n=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function Ku(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var i=Be(this,e),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:t,value:n},c=0,u=o.length;c<u;++c)if(o[c].name===t){o[c]=a;break}c===u&&o.push(a)}i.tween=o}}function Zu(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Re(this.node(),n).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===e)return s.value;return null}return this.each((t==null?Gu:Ku)(n,e,t))}function Yr(e,t,n){var r=e._id;return e.each(function(){var o=Be(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return Re(o,r).value[t]}}function Ji(e,t){var n;return(typeof t=="number"?Le:t instanceof Cn?En:(n=Cn(t))?(t=n,En):Ti)(e,t)}function Ju(e){return function(){this.removeAttribute(e)}}function Qu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ed(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,n)}}function td(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,n)}}function nd(e,t,n){var r,o,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=a+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a)))}}function rd(e,t,n){var r,o,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=a+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a)))}}function od(e,t){var n=$n(e),r=n==="transform"?Gc:Ji;return this.attrTween(e,typeof t=="function"?(n.local?rd:nd)(n,r,Yr(this,"attr."+e,t)):t==null?(n.local?Qu:Ju)(n):(n.local?td:ed)(n,r,t))}function id(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function sd(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ad(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&sd(e,i)),n}return o._value=t,o}function cd(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&id(e,i)),n}return o._value=t,o}function ld(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=$n(e);return this.tween(n,(r.local?ad:cd)(r,t))}function ud(e,t){return function(){Xr(this,e).delay=+t.apply(this,arguments)}}function dd(e,t){return t=+t,function(){Xr(this,e).delay=t}}function fd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ud:dd)(t,e)):Re(this.node(),t).delay}function hd(e,t){return function(){Be(this,e).duration=+t.apply(this,arguments)}}function gd(e,t){return t=+t,function(){Be(this,e).duration=t}}function pd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hd:gd)(t,e)):Re(this.node(),t).duration}function md(e,t){if(typeof t!="function")throw new Error;return function(){Be(this,e).ease=t}}function yd(e){var t=this._id;return arguments.length?this.each(md(t,e)):Re(this.node(),t).ease}function xd(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Be(this,e).ease=n}}function vd(e){if(typeof e!="function")throw new Error;return this.each(xd(this._id,e))}function wd(e){typeof e!="function"&&(e=zi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],c,u=0;u<s;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new qe(r,this._parents,this._name,this._id)}function bd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var c=t[a],u=n[a],l=c.length,f=s[a]=new Array(l),d,h=0;h<l;++h)(d=c[h]||u[h])&&(f[h]=d);for(;a<r;++a)s[a]=t[a];return new qe(s,this._parents,this._name,this._id)}function Sd(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function _d(e,t,n){var r,o,i=Sd(t)?Xr:Be;return function(){var s=i(this,e),a=s.on;a!==r&&(o=(r=a).copy()).on(t,n),s.on=o}}function Ed(e,t){var n=this._id;return arguments.length<2?Re(this.node(),n).on.on(e):this.each(_d(n,e,t))}function Cd(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Md(){return this.on("end.remove",Cd(this._id))}function Nd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Hr(e));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],c=a.length,u=i[s]=new Array(c),l,f,d=0;d<c;++d)(l=a[d])&&(f=e.call(l,l.__data__,d,a))&&("__data__"in l&&(f.__data__=l.__data__),u[d]=f,Ln(u[d],t,n,d,u,Re(l,n)));return new qe(i,this._parents,t,n)}function Ad(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Li(e));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var c=r[a],u=c.length,l,f=0;f<u;++f)if(l=c[f]){for(var d=e.call(l,l.__data__,f,c),h,m=Re(l,n),p=0,v=d.length;p<v;++p)(h=d[p])&&Ln(h,t,n,p,d,m);i.push(d),s.push(l)}return new qe(i,s,t,n)}var Dd=Jt.prototype.constructor;function Id(){return new Dd(this._groups,this._parents)}function kd(e,t){var n,r,o;return function(){var i=Et(this,e),s=(this.style.removeProperty(e),Et(this,e));return i===s?null:i===n&&s===r?o:o=t(n=i,r=s)}}function Qi(e){return function(){this.style.removeProperty(e)}}function Rd(e,t,n){var r,o=n+"",i;return function(){var s=Et(this,e);return s===o?null:s===r?i:i=t(r=s,n)}}function Td(e,t,n){var r,o,i;return function(){var s=Et(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),Et(this,e))),s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a))}}function Pd(e,t){var n,r,o,i="style."+t,s="end."+i,a;return function(){var c=Be(this,e),u=c.on,l=c.value[i]==null?a||(a=Qi(t)):void 0;(u!==n||o!==l)&&(r=(n=u).copy()).on(s,o=l),c.on=r}}function jd(e,t,n){var r=(e+="")=="transform"?qc:Ji;return t==null?this.styleTween(e,kd(e,r)).on("end.style."+e,Qi(e)):typeof t=="function"?this.styleTween(e,Td(e,r,Yr(this,"style."+e,t))).each(Pd(this._id,e)):this.styleTween(e,Rd(e,r,t),n).on("end.style."+e,null)}function $d(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Ld(e,t,n){var r,o;function i(){var s=t.apply(this,arguments);return s!==o&&(r=(o=s)&&$d(e,s,n)),r}return i._value=t,i}function zd(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Ld(e,t,n??""))}function Od(e){return function(){this.textContent=e}}function Fd(e){return function(){var t=e(this);this.textContent=t??""}}function Bd(e){return this.tween("text",typeof e=="function"?Fd(Yr(this,"text",e)):Od(e==null?"":e+""))}function Hd(e){return function(t){this.textContent=e.call(this,t)}}function Vd(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Hd(o)),t}return r._value=e,r}function Xd(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Vd(e))}function Yd(){for(var e=this._name,t=this._id,n=es(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,c,u=0;u<a;++u)if(c=s[u]){var l=Re(c,t);Ln(c,e,n,u,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new qe(r,this._parents,e,n)}function Wd(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(i,s){var a={value:s},c={value:function(){--o===0&&i()}};n.each(function(){var u=Be(this,r),l=u.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),u.on=t}),o===0&&i()})}var Ud=0;function qe(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function es(){return++Ud}var Ye=Jt.prototype;qe.prototype={constructor:qe,select:Nd,selectAll:Ad,selectChild:Ye.selectChild,selectChildren:Ye.selectChildren,filter:wd,merge:bd,selection:Id,transition:Yd,call:Ye.call,nodes:Ye.nodes,node:Ye.node,size:Ye.size,empty:Ye.empty,each:Ye.each,on:Ed,attr:od,attrTween:ld,style:jd,styleTween:zd,text:Bd,textTween:Xd,remove:Md,tween:Zu,delay:fd,duration:pd,ease:yd,easeVarying:vd,end:Wd,[Symbol.iterator]:Ye[Symbol.iterator]};function qd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Gd={time:null,delay:0,duration:250,ease:qd};function Kd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Zd(e){var t,n;e instanceof qe?(t=e._id,e=e._name):(t=es(),(n=Gd).time=$c(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,c,u=0;u<a;++u)(c=s[u])&&Ln(c,e,t,u,s,n||Kd(c,t));return new qe(r,this._parents,e,t)}Jt.prototype.interrupt=qu;Jt.prototype.transition=Zd;const fn=e=>()=>e;function Jd(e,{sourceEvent:t,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function We(e,t,n){this.k=e,this.x=t,this.y=n}We.prototype={constructor:We,scale:function(e){return e===1?this:new We(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new We(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zn=new We(1,0,0);ts.prototype=We.prototype;function ts(e){for(;!e.__zoom;)if(!(e=e.parentNode))return zn;return e.__zoom}function sr(e){e.stopImmediatePropagation()}function $t(e){e.preventDefault(),e.stopImmediatePropagation()}function Qd(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function ef(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Co(){return this.__zoom||zn}function tf(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function nf(){return navigator.maxTouchPoints||"ontouchstart"in this}function rf(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function ns(){var e=Qd,t=ef,n=rf,r=tf,o=nf,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=vn,u=Br("start","zoom","end"),l,f,d,h=500,m=150,p=0,v=10;function w(S){S.property("__zoom",Co).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",O).filter(o).on("touchstart.zoom",R).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",j).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(S,k,A,D){var $=S.selection?S.selection():S;$.property("__zoom",Co),S!==$?_(S,k,A,D):$.interrupt().each(function(){C(this,arguments).event(D).start().zoom(null,typeof k=="function"?k.apply(this,arguments):k).end()})},w.scaleBy=function(S,k,A,D){w.scaleTo(S,function(){var $=this.__zoom.k,I=typeof k=="function"?k.apply(this,arguments):k;return $*I},A,D)},w.scaleTo=function(S,k,A,D){w.transform(S,function(){var $=t.apply(this,arguments),I=this.__zoom,L=A==null?y($):typeof A=="function"?A.apply(this,arguments):A,z=I.invert(L),F=typeof k=="function"?k.apply(this,arguments):k;return n(g(E(I,F),L,z),$,s)},A,D)},w.translateBy=function(S,k,A,D){w.transform(S,function(){return n(this.__zoom.translate(typeof k=="function"?k.apply(this,arguments):k,typeof A=="function"?A.apply(this,arguments):A),t.apply(this,arguments),s)},null,D)},w.translateTo=function(S,k,A,D,$){w.transform(S,function(){var I=t.apply(this,arguments),L=this.__zoom,z=D==null?y(I):typeof D=="function"?D.apply(this,arguments):D;return n(zn.translate(z[0],z[1]).scale(L.k).translate(typeof k=="function"?-k.apply(this,arguments):-k,typeof A=="function"?-A.apply(this,arguments):-A),I,s)},D,$)};function E(S,k){return k=Math.max(i[0],Math.min(i[1],k)),k===S.k?S:new We(k,S.x,S.y)}function g(S,k,A){var D=k[0]-A[0]*S.k,$=k[1]-A[1]*S.k;return D===S.x&&$===S.y?S:new We(S.k,D,$)}function y(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function _(S,k,A,D){S.on("start.zoom",function(){C(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(D).end()}).tween("zoom",function(){var $=this,I=arguments,L=C($,I).event(D),z=t.apply($,I),F=A==null?y(z):typeof A=="function"?A.apply($,I):A,V=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),B=$.__zoom,W=typeof k=="function"?k.apply($,I):k,X=c(B.invert(F).concat(V/B.k),W.invert(F).concat(V/W.k));return function(U){if(U===1)U=W;else{var H=X(U),q=V/H[2];U=new We(q,F[0]-H[0]*q,F[1]-H[1]*q)}L.zoom(null,U)}})}function C(S,k,A){return!A&&S.__zooming||new M(S,k)}function M(S,k){this.that=S,this.args=k,this.active=0,this.sourceEvent=null,this.extent=t.apply(S,k),this.taps=0}M.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,k){return this.mouse&&S!=="mouse"&&(this.mouse[1]=k.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=k.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=k.invert(this.touch1[0])),this.that.__zoom=k,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var k=we(this.that).datum();u.call(S,this.that,new Jd(S,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:u}),k)}};function N(S,...k){if(!e.apply(this,arguments))return;var A=C(this,k).event(S),D=this.__zoom,$=Math.max(i[0],Math.min(i[1],D.k*Math.pow(2,r.apply(this,arguments)))),I=De(S);if(A.wheel)(A.mouse[0][0]!==I[0]||A.mouse[0][1]!==I[1])&&(A.mouse[1]=D.invert(A.mouse[0]=I)),clearTimeout(A.wheel);else{if(D.k===$)return;A.mouse=[I,D.invert(I)],Sn(this),A.start()}$t(S),A.wheel=setTimeout(L,m),A.zoom("mouse",n(g(E(D,$),A.mouse[0],A.mouse[1]),A.extent,s));function L(){A.wheel=null,A.end()}}function T(S,...k){if(d||!e.apply(this,arguments))return;var A=S.currentTarget,D=C(this,k,!0).event(S),$=we(S.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",V,!0),I=De(S,A),L=S.clientX,z=S.clientY;qi(S.view),sr(S),D.mouse=[I,this.__zoom.invert(I)],Sn(this),D.start();function F(B){if($t(B),!D.moved){var W=B.clientX-L,X=B.clientY-z;D.moved=W*W+X*X>p}D.event(B).zoom("mouse",n(g(D.that.__zoom,D.mouse[0]=De(B,A),D.mouse[1]),D.extent,s))}function V(B){$.on("mousemove.zoom mouseup.zoom",null),Gi(B.view,D.moved),$t(B),D.event(B).end()}}function O(S,...k){if(e.apply(this,arguments)){var A=this.__zoom,D=De(S.changedTouches?S.changedTouches[0]:S,this),$=A.invert(D),I=A.k*(S.shiftKey?.5:2),L=n(g(E(A,I),D,$),t.apply(this,k),s);$t(S),a>0?we(this).transition().duration(a).call(_,L,D,S):we(this).call(w.transform,L,D,S)}}function R(S,...k){if(e.apply(this,arguments)){var A=S.touches,D=A.length,$=C(this,k,S.changedTouches.length===D).event(S),I,L,z,F;for(sr(S),L=0;L<D;++L)z=A[L],F=De(z,this),F=[F,this.__zoom.invert(F),z.identifier],$.touch0?!$.touch1&&$.touch0[2]!==F[2]&&($.touch1=F,$.taps=0):($.touch0=F,I=!0,$.taps=1+!!l);l&&(l=clearTimeout(l)),I&&($.taps<2&&(f=F[0],l=setTimeout(function(){l=null},h)),Sn(this),$.start())}}function P(S,...k){if(this.__zooming){var A=C(this,k).event(S),D=S.changedTouches,$=D.length,I,L,z,F;for($t(S),I=0;I<$;++I)L=D[I],z=De(L,this),A.touch0&&A.touch0[2]===L.identifier?A.touch0[0]=z:A.touch1&&A.touch1[2]===L.identifier&&(A.touch1[0]=z);if(L=A.that.__zoom,A.touch1){var V=A.touch0[0],B=A.touch0[1],W=A.touch1[0],X=A.touch1[1],U=(U=W[0]-V[0])*U+(U=W[1]-V[1])*U,H=(H=X[0]-B[0])*H+(H=X[1]-B[1])*H;L=E(L,Math.sqrt(U/H)),z=[(V[0]+W[0])/2,(V[1]+W[1])/2],F=[(B[0]+X[0])/2,(B[1]+X[1])/2]}else if(A.touch0)z=A.touch0[0],F=A.touch0[1];else return;A.zoom("touch",n(g(L,z,F),A.extent,s))}}function j(S,...k){if(this.__zooming){var A=C(this,k).event(S),D=S.changedTouches,$=D.length,I,L;for(sr(S),d&&clearTimeout(d),d=setTimeout(function(){d=null},h),I=0;I<$;++I)L=D[I],A.touch0&&A.touch0[2]===L.identifier?delete A.touch0:A.touch1&&A.touch1[2]===L.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(L=De(L,this),Math.hypot(f[0]-L[0],f[1]-L[1])<v)){var z=we(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return w.wheelDelta=function(S){return arguments.length?(r=typeof S=="function"?S:fn(+S),w):r},w.filter=function(S){return arguments.length?(e=typeof S=="function"?S:fn(!!S),w):e},w.touchable=function(S){return arguments.length?(o=typeof S=="function"?S:fn(!!S),w):o},w.extent=function(S){return arguments.length?(t=typeof S=="function"?S:fn([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),w):t},w.scaleExtent=function(S){return arguments.length?(i[0]=+S[0],i[1]=+S[1],w):[i[0],i[1]]},w.translateExtent=function(S){return arguments.length?(s[0][0]=+S[0][0],s[1][0]=+S[1][0],s[0][1]=+S[0][1],s[1][1]=+S[1][1],w):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},w.constrain=function(S){return arguments.length?(n=S,w):n},w.duration=function(S){return arguments.length?(a=+S,w):a},w.interpolate=function(S){return arguments.length?(c=S,w):c},w.on=function(){var S=u.on.apply(u,arguments);return S===u?w:S},w.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,w):Math.sqrt(p)},w.tapDistance=function(S){return arguments.length?(v=+S,w):v},w}const Oe={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Xt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],rs=["Enter"," ","Escape"],os={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Ct;(function(e){e.Strict="strict",e.Loose="loose"})(Ct||(Ct={}));var ft;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(ft||(ft={}));var Yt;(function(e){e.Partial="partial",e.Full="full"})(Yt||(Yt={}));const is={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var rt;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(rt||(rt={}));var Nn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Nn||(Nn={}));var K;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(K||(K={}));const Mo={[K.Left]:K.Right,[K.Right]:K.Left,[K.Top]:K.Bottom,[K.Bottom]:K.Top};function ss(e){return e===null?null:e?"valid":"invalid"}const as=e=>"id"in e&&"source"in e&&"target"in e,of=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Wr=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Qt=(e,t=[0,0])=>{const{width:n,height:r}=Ge(e),o=e.origin??t,i=n*o[0],s=r*o[1];return{x:e.position.x-i,y:e.position.y-s}},sf=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,o)=>{const i=typeof o=="string";let s=!t.nodeLookup&&!i?o:void 0;t.nodeLookup&&(s=i?t.nodeLookup.get(o):Wr(o)?o:t.nodeLookup.get(o.id));const a=s?An(s,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return On(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Fn(n)},en=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(r=>{if(t.filter===void 0||t.filter(r)){const o=An(r);n=On(n,o)}}),Fn(n)},Ur=(e,t,[n,r,o]=[0,0,1],i=!1,s=!1)=>{const a={...tn(t,[n,r,o]),width:t.width/o,height:t.height/o},c=[];for(const u of e.values()){const{measured:l,selectable:f=!0,hidden:d=!1}=u;if(s&&!f||d)continue;const h=l.width??u.width??u.initialWidth??null,m=l.height??u.height??u.initialHeight??null,p=Wt(a,Nt(u)),v=(h??0)*(m??0),w=i&&p>0;(!u.internals.handleBounds||w||p>=v||u.dragging)&&c.push(u)}return c},af=(e,t)=>{const n=new Set;return e.forEach(r=>{n.add(r.id)}),t.filter(r=>n.has(r.source)||n.has(r.target))};function cf(e,t){const n=new Map,r=t!=null&&t.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!o.hidden)&&(!r||r.has(o.id))&&n.set(o.id,o)}),n}async function lf({nodes:e,width:t,height:n,panZoom:r,minZoom:o,maxZoom:i},s){if(e.size===0)return Promise.resolve(!0);const a=cf(e,s),c=en(a),u=qr(c,t,n,(s==null?void 0:s.minZoom)??o,(s==null?void 0:s.maxZoom)??i,(s==null?void 0:s.padding)??.1);return await r.setViewport(u,{duration:s==null?void 0:s.duration,ease:s==null?void 0:s.ease,interpolate:s==null?void 0:s.interpolate}),Promise.resolve(!0)}function cs({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:o,onError:i}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},l=s.origin??r;let f=s.extent||o;if(s.extent==="parent"&&!s.expandParent)if(!a)i==null||i("005",Oe.error005());else{const h=a.measured.width,m=a.measured.height;h&&m&&(f=[[c,u],[c+h,u+m]])}else a&&At(s.extent)&&(f=[[s.extent[0][0]+c,s.extent[0][1]+u],[s.extent[1][0]+c,s.extent[1][1]+u]]);const d=At(f)?gt(t,f,s.measured):t;return(s.measured.width===void 0||s.measured.height===void 0)&&(i==null||i("015",Oe.error015())),{position:{x:d.x-c+(s.measured.width??0)*l[0],y:d.y-u+(s.measured.height??0)*l[1]},positionAbsolute:d}}async function uf({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:r,onBeforeDelete:o}){const i=new Set(e.map(d=>d.id)),s=[];for(const d of n){if(d.deletable===!1)continue;const h=i.has(d.id),m=!h&&d.parentId&&s.find(p=>p.id===d.parentId);(h||m)&&s.push(d)}const a=new Set(t.map(d=>d.id)),c=r.filter(d=>d.deletable!==!1),l=af(s,c);for(const d of c)a.has(d.id)&&!l.find(m=>m.id===d.id)&&l.push(d);if(!o)return{edges:l,nodes:s};const f=await o({nodes:s,edges:l});return typeof f=="boolean"?f?{edges:l,nodes:s}:{edges:[],nodes:[]}:f}const Mt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),gt=(e={x:0,y:0},t,n)=>({x:Mt(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Mt(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function ls(e,t,n){const{width:r,height:o}=Ge(n),{x:i,y:s}=n.internals.positionAbsolute;return gt(e,[[i,s],[i+r,s+o]],t)}const No=(e,t,n)=>e<t?Mt(Math.abs(e-t),1,t)/t:e>n?-Mt(Math.abs(e-n),1,t)/t:0,us=(e,t,n=15,r=40)=>{const o=No(e.x,r,t.width-r)*n,i=No(e.y,r,t.height-r)*n;return[o,i]},On=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Nr=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),Fn=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),Nt=(e,t=[0,0])=>{var o,i;const{x:n,y:r}=Wr(e)?e.internals.positionAbsolute:Qt(e,t);return{x:n,y:r,width:((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},An=(e,t=[0,0])=>{var o,i;const{x:n,y:r}=Wr(e)?e.internals.positionAbsolute:Qt(e,t);return{x:n,y:r,x2:n+(((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0),y2:r+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},ds=(e,t)=>Fn(On(Nr(e),Nr(t))),Wt=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},Ao=e=>Ie(e.width)&&Ie(e.height)&&Ie(e.x)&&Ie(e.y),Ie=e=>!isNaN(e)&&isFinite(e),df=(e,t)=>{},Bn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),tn=({x:e,y:t},[n,r,o],i=!1,s=[1,1])=>{const a={x:(e-n)/o,y:(t-r)/o};return i?Bn(a,s):a},Dn=({x:e,y:t},[n,r,o])=>({x:e*o+n,y:t*o+r});function xt(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function ff(e,t,n){if(typeof e=="string"||typeof e=="number"){const r=xt(e,n),o=xt(e,t);return{top:r,right:o,bottom:r,left:o,x:o*2,y:r*2}}if(typeof e=="object"){const r=xt(e.top??e.y??0,n),o=xt(e.bottom??e.y??0,n),i=xt(e.left??e.x??0,t),s=xt(e.right??e.x??0,t);return{top:r,right:s,bottom:o,left:i,x:i+s,y:r+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function hf(e,t,n,r,o,i){const{x:s,y:a}=Dn(e,[t,n,r]),{x:c,y:u}=Dn({x:e.x+e.width,y:e.y+e.height},[t,n,r]),l=o-c,f=i-u;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(l),bottom:Math.floor(f)}}const qr=(e,t,n,r,o,i)=>{const s=ff(i,t,n),a=(t-s.x)/e.width,c=(n-s.y)/e.height,u=Math.min(a,c),l=Mt(u,r,o),f=e.x+e.width/2,d=e.y+e.height/2,h=t/2-f*l,m=n/2-d*l,p=hf(e,h,m,l,t,n),v={left:Math.min(p.left-s.left,0),top:Math.min(p.top-s.top,0),right:Math.min(p.right-s.right,0),bottom:Math.min(p.bottom-s.bottom,0)};return{x:h-v.left+v.right,y:m-v.top+v.bottom,zoom:l}},In=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function At(e){return e!==void 0&&e!=="parent"}function Ge(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function fs(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function hs(e,t={width:0,height:0},n,r,o){const i={...e},s=r.get(n);if(s){const a=s.origin||o;i.x+=s.internals.positionAbsolute.x-(t.width??0)*a[0],i.y+=s.internals.positionAbsolute.y-(t.height??0)*a[1]}return i}function Do(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function gf(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function pf(e){return{...os,...e||{}}}function Ot(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:r,containerBounds:o}){const{x:i,y:s}=ze(e),a=tn({x:i-((o==null?void 0:o.left)??0),y:s-((o==null?void 0:o.top)??0)},r),{x:c,y:u}=n?Bn(a,t):a;return{xSnapped:c,ySnapped:u,...a}}const Gr=e=>({width:e.offsetWidth,height:e.offsetHeight}),gs=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},mf=["INPUT","SELECT","TEXTAREA"];function ps(e){var r,o;const t=((o=(r=e.composedPath)==null?void 0:r.call(e))==null?void 0:o[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:mf.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const ms=e=>"clientX"in e,ze=(e,t)=>{var i,s;const n=ms(e),r=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,o=n?e.clientY:(s=e.touches)==null?void 0:s[0].clientY;return{x:r-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},Io=(e,t,n,r,o)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:e,nodeId:o,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...Gr(s)}})};function ys({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:o,sourceControlY:i,targetControlX:s,targetControlY:a}){const c=e*.125+o*.375+s*.375+n*.125,u=t*.125+i*.375+a*.375+r*.125,l=Math.abs(c-e),f=Math.abs(u-t);return[c,u,l,f]}function hn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function ko({pos:e,x1:t,y1:n,x2:r,y2:o,c:i}){switch(e){case K.Left:return[t-hn(t-r,i),n];case K.Right:return[t+hn(r-t,i),n];case K.Top:return[t,n-hn(n-o,i)];case K.Bottom:return[t,n+hn(o-n,i)]}}function xs({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top,curvature:s=.25}){const[a,c]=ko({pos:n,x1:e,y1:t,x2:r,y2:o,c:s}),[u,l]=ko({pos:i,x1:r,y1:o,x2:e,y2:t,c:s}),[f,d,h,m]=ys({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:a,sourceControlY:c,targetControlX:u,targetControlY:l});return[`M${e},${t} C${a},${c} ${u},${l} ${r},${o}`,f,d,h,m]}function vs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const o=Math.abs(n-e)/2,i=n<e?n+o:n-o,s=Math.abs(r-t)/2,a=r<t?r+s:r-s;return[i,a,o,s]}function yf({sourceNode:e,targetNode:t,selected:n=!1,zIndex:r,elevateOnSelect:o=!1}){if(r!==void 0)return r;const i=o&&n?1e3:0,s=Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0);return i+s}function xf({sourceNode:e,targetNode:t,width:n,height:r,transform:o}){const i=On(An(e),An(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const s={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:r/o[2]};return Wt(s,Fn(i))>0}const vf=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`xy-edge__${e}${t||""}-${n}${r||""}`,wf=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),ws=(e,t)=>{if(!e.source||!e.target)return t;let n;return as(e)?n={...e}:n={...e,id:vf(e)},wf(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function bs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[o,i,s,a]=vs({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,o,i,s,a]}const Ro={[K.Left]:{x:-1,y:0},[K.Right]:{x:1,y:0},[K.Top]:{x:0,y:-1},[K.Bottom]:{x:0,y:1}},bf=({source:e,sourcePosition:t=K.Bottom,target:n})=>t===K.Left||t===K.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},To=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Sf({source:e,sourcePosition:t=K.Bottom,target:n,targetPosition:r=K.Top,center:o,offset:i,stepPosition:s}){const a=Ro[t],c=Ro[r],u={x:e.x+a.x*i,y:e.y+a.y*i},l={x:n.x+c.x*i,y:n.y+c.y*i},f=bf({source:u,sourcePosition:t,target:l}),d=f.x!==0?"x":"y",h=f[d];let m=[],p,v;const w={x:0,y:0},E={x:0,y:0},[,,g,y]=vs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[d]*c[d]===-1){d==="x"?(p=o.x??u.x+(l.x-u.x)*s,v=o.y??(u.y+l.y)/2):(p=o.x??(u.x+l.x)/2,v=o.y??u.y+(l.y-u.y)*s);const C=[{x:p,y:u.y},{x:p,y:l.y}],M=[{x:u.x,y:v},{x:l.x,y:v}];a[d]===h?m=d==="x"?C:M:m=d==="x"?M:C}else{const C=[{x:u.x,y:l.y}],M=[{x:l.x,y:u.y}];if(d==="x"?m=a.x===h?M:C:m=a.y===h?C:M,t===r){const P=Math.abs(e[d]-n[d]);if(P<=i){const j=Math.min(i-1,i-P);a[d]===h?w[d]=(u[d]>e[d]?-1:1)*j:E[d]=(l[d]>n[d]?-1:1)*j}}if(t!==r){const P=d==="x"?"y":"x",j=a[d]===c[P],S=u[P]>l[P],k=u[P]<l[P];(a[d]===1&&(!j&&S||j&&k)||a[d]!==1&&(!j&&k||j&&S))&&(m=d==="x"?C:M)}const N={x:u.x+w.x,y:u.y+w.y},T={x:l.x+E.x,y:l.y+E.y},O=Math.max(Math.abs(N.x-m[0].x),Math.abs(T.x-m[0].x)),R=Math.max(Math.abs(N.y-m[0].y),Math.abs(T.y-m[0].y));O>=R?(p=(N.x+T.x)/2,v=m[0].y):(p=m[0].x,v=(N.y+T.y)/2)}return[[e,{x:u.x+w.x,y:u.y+w.y},...m,{x:l.x+E.x,y:l.y+E.y},n],p,v,g,y]}function _f(e,t,n,r){const o=Math.min(To(e,t)/2,To(t,n)/2,r),{x:i,y:s}=t;if(e.x===i&&i===n.x||e.y===s&&s===n.y)return`L${i} ${s}`;if(e.y===s){const u=e.x<n.x?-1:1,l=e.y<n.y?1:-1;return`L ${i+o*u},${s}Q ${i},${s} ${i},${s+o*l}`}const a=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${i},${s+o*c}Q ${i},${s} ${i+o*a},${s}`}function Ar({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top,borderRadius:s=5,centerX:a,centerY:c,offset:u=20,stepPosition:l=.5}){const[f,d,h,m,p]=Sf({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:o},targetPosition:i,center:{x:a,y:c},offset:u,stepPosition:l});return[f.reduce((w,E,g)=>{let y="";return g>0&&g<f.length-1?y=_f(f[g-1],E,f[g+1],s):y=`${g===0?"M":"L"}${E.x} ${E.y}`,w+=y,w},""),d,h,m,p]}function Po(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Ef(e){var f;const{sourceNode:t,targetNode:n}=e;if(!Po(t)||!Po(n))return null;const r=t.internals.handleBounds||jo(t.handles),o=n.internals.handleBounds||jo(n.handles),i=$o((r==null?void 0:r.source)??[],e.sourceHandle),s=$o(e.connectionMode===Ct.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),e.targetHandle);if(!i||!s)return(f=e.onError)==null||f.call(e,"008",Oe.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(i==null?void 0:i.position)||K.Bottom,c=(s==null?void 0:s.position)||K.Top,u=Ut(t,i,a),l=Ut(n,s,c);return{sourceX:u.x,sourceY:u.y,targetX:l.x,targetY:l.y,sourcePosition:a,targetPosition:c}}function jo(e){if(!e)return null;const t=[],n=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&n.push(r);return{source:t,target:n}}function Ut(e,t,n=K.Left,r=!1){const o=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??Ge(e);if(r)return{x:o+s/2,y:i+a/2};switch((t==null?void 0:t.position)??n){case K.Top:return{x:o+s/2,y:i};case K.Right:return{x:o+s,y:i+a/2};case K.Bottom:return{x:o+s/2,y:i+a};case K.Left:return{x:o,y:i+a/2}}}function $o(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Dr(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`:""}function Cf(e,{id:t,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:o}){const i=new Set;return e.reduce((s,a)=>([a.markerStart||r,a.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const u=Dr(c,t);i.has(u)||(s.push({id:u,color:c.color||n,...c}),i.add(u))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Kr={nodeOrigin:[0,0],nodeExtent:Xt,elevateNodesOnSelect:!0,defaults:{}},Mf={...Kr,checkEquality:!0};function Zr(e,t){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}function Nf(e,t,n){const r=Zr(Kr,n);for(const o of e.values())if(o.parentId)Jr(o,e,t,r);else{const i=Qt(o,r.nodeOrigin),s=At(o.extent)?o.extent:r.nodeExtent,a=gt(i,s,Ge(o));o.internals.positionAbsolute=a}}function Ir(e,t,n,r){var c,u;const o=Zr(Mf,r);let i=e.length>0;const s=new Map(t),a=o!=null&&o.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let f=s.get(l.id);if(o.checkEquality&&l===(f==null?void 0:f.internals.userNode))t.set(l.id,f);else{const d=Qt(l,o.nodeOrigin),h=At(l.extent)?l.extent:o.nodeExtent,m=gt(d,h,Ge(l));f={...o.defaults,...l,measured:{width:(c=l.measured)==null?void 0:c.width,height:(u=l.measured)==null?void 0:u.height},internals:{positionAbsolute:m,handleBounds:l.measured?f==null?void 0:f.internals.handleBounds:void 0,z:Ss(l,a),userNode:l}},t.set(l.id,f)}(f.measured===void 0||f.measured.width===void 0||f.measured.height===void 0)&&!f.hidden&&(i=!1),l.parentId&&Jr(f,t,n,r)}return i}function Af(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Jr(e,t,n,r){const{elevateNodesOnSelect:o,nodeOrigin:i,nodeExtent:s}=Zr(Kr,r),a=e.parentId,c=t.get(a);if(!c){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Af(e,n);const u=o?1e3:0,{x:l,y:f,z:d}=Df(e,c,i,s,u),{positionAbsolute:h}=e.internals,m=l!==h.x||f!==h.y;(m||d!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:m?{x:l,y:f}:h,z:d}})}function Ss(e,t){return(Ie(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function Df(e,t,n,r,o){const{x:i,y:s}=t.internals.positionAbsolute,a=Ge(e),c=Qt(e,n),u=At(e.extent)?gt(c,e.extent,a):c;let l=gt({x:i+u.x,y:s+u.y},r,a);e.extent==="parent"&&(l=ls(l,a,t));const f=Ss(e,o),d=t.internals.z??0;return{x:l.x,y:l.y,z:d>=f?d+1:f}}function Qr(e,t,n,r=[0,0]){var s;const o=[],i=new Map;for(const a of e){const c=t.get(a.parentId);if(!c)continue;const u=((s=i.get(a.parentId))==null?void 0:s.expandedRect)??Nt(c),l=ds(u,a.rect);i.set(a.parentId,{expandedRect:l,parent:c})}return i.size>0&&i.forEach(({expandedRect:a,parent:c},u)=>{var g;const l=c.internals.positionAbsolute,f=Ge(c),d=c.origin??r,h=a.x<l.x?Math.round(Math.abs(l.x-a.x)):0,m=a.y<l.y?Math.round(Math.abs(l.y-a.y)):0,p=Math.max(f.width,Math.round(a.width)),v=Math.max(f.height,Math.round(a.height)),w=(p-f.width)*d[0],E=(v-f.height)*d[1];(h>0||m>0||w||E)&&(o.push({id:u,type:"position",position:{x:c.position.x-h+w,y:c.position.y-m+E}}),(g=n.get(u))==null||g.forEach(y=>{e.some(_=>_.id===y.id)||o.push({id:y.id,type:"position",position:{x:y.position.x+h,y:y.position.y+m}})})),(f.width<a.width||f.height<a.height||h||m)&&o.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:p+(h?d[0]*h-w:0),height:v+(m?d[1]*m-E:0)}})}),o}function If(e,t,n,r,o,i){const s=r==null?void 0:r.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const c=[],u=window.getComputedStyle(s),{m22:l}=new window.DOMMatrixReadOnly(u.transform),f=[];for(const d of e.values()){const h=t.get(d.id);if(!h)continue;if(h.hidden){t.set(h.id,{...h,internals:{...h.internals,handleBounds:void 0}}),a=!0;continue}const m=Gr(d.nodeElement),p=h.measured.width!==m.width||h.measured.height!==m.height;if(!!(m.width&&m.height&&(p||!h.internals.handleBounds||d.force))){const w=d.nodeElement.getBoundingClientRect(),E=At(h.extent)?h.extent:i;let{positionAbsolute:g}=h.internals;h.parentId&&h.extent==="parent"?g=ls(g,m,t.get(h.parentId)):E&&(g=gt(g,E,m));const y={...h,measured:m,internals:{...h.internals,positionAbsolute:g,handleBounds:{source:Io("source",d.nodeElement,w,l,h.id),target:Io("target",d.nodeElement,w,l,h.id)}}};t.set(h.id,y),h.parentId&&Jr(y,t,n,{nodeOrigin:o}),a=!0,p&&(c.push({id:h.id,type:"dimensions",dimensions:m}),h.expandParent&&h.parentId&&f.push({id:h.id,parentId:h.parentId,rect:Nt(y,o)}))}}if(f.length>0){const d=Qr(f,t,n,o);c.push(...d)}return{changes:c,updatedInternals:a}}async function kf({delta:e,panZoom:t,transform:n,translateExtent:r,width:o,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[o,i]],r),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function Lo(e,t,n,r,o,i){let s=o;const a=r.get(s)||new Map;r.set(s,a.set(n,t)),s=`${o}-${e}`;const c=r.get(s)||new Map;if(r.set(s,c.set(n,t)),i){s=`${o}-${e}-${i}`;const u=r.get(s)||new Map;r.set(s,u.set(n,t))}}function _s(e,t,n){e.clear(),t.clear();for(const r of n){const{source:o,target:i,sourceHandle:s=null,targetHandle:a=null}=r,c={edgeId:r.id,source:o,target:i,sourceHandle:s,targetHandle:a},u=`${o}-${s}--${i}-${a}`,l=`${i}-${a}--${o}-${s}`;Lo("source",c,l,e,o,s),Lo("target",c,u,e,i,a),t.set(r.id,r)}}function Es(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Es(n,t):!1}function zo(e,t,n){var o;let r=e;do{if((o=r==null?void 0:r.matches)!=null&&o.call(r,t))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function Rf(e,t,n,r){const o=new Map;for(const[i,s]of e)if((s.selected||s.id===r)&&(!s.parentId||!Es(s,e))&&(s.draggable||t&&typeof s.draggable>"u")){const a=e.get(i);a&&o.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return o}function ar({nodeId:e,dragItems:t,nodeLookup:n,dragging:r=!0}){var s,a,c;const o=[];for(const[u,l]of t){const f=(s=n.get(u))==null?void 0:s.internals.userNode;f&&o.push({...f,position:l.position,dragging:r})}if(!e)return[o[0],o];const i=(a=n.get(e))==null?void 0:a.internals.userNode;return[i?{...i,position:((c=t.get(e))==null?void 0:c.position)||i.position,dragging:r}:o[0],o]}function Tf({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:r,onDragStop:o}){let i={x:null,y:null},s=0,a=new Map,c=!1,u={x:0,y:0},l=null,f=!1,d=null,h=!1,m=!1;function p({noDragClassName:w,handleSelector:E,domNode:g,isSelectable:y,nodeId:_,nodeClickDistance:C=0}){d=we(g);function M({x:R,y:P},j){const{nodeLookup:S,nodeExtent:k,snapGrid:A,snapToGrid:D,nodeOrigin:$,onNodeDrag:I,onSelectionDrag:L,onError:z,updateNodePositions:F}=t();i={x:R,y:P};let V=!1,B={x:0,y:0,x2:0,y2:0};if(a.size>1&&k){const W=en(a);B=Nr(W)}for(const[W,X]of a){if(!S.has(W))continue;let U={x:R-X.distance.x,y:P-X.distance.y};D&&(U=Bn(U,A));let H=[[k[0][0],k[0][1]],[k[1][0],k[1][1]]];if(a.size>1&&k&&!X.extent){const{positionAbsolute:Q}=X.internals,G=Q.x-B.x+k[0][0],J=Q.x+X.measured.width-B.x2+k[1][0],Z=Q.y-B.y+k[0][1],te=Q.y+X.measured.height-B.y2+k[1][1];H=[[G,Z],[J,te]]}const{position:q,positionAbsolute:Y}=cs({nodeId:W,nextPosition:U,nodeLookup:S,nodeExtent:H,nodeOrigin:$,onError:z});V=V||X.position.x!==q.x||X.position.y!==q.y,X.position=q,X.internals.positionAbsolute=Y}if(m=m||V,!!V&&(F(a,!0),j&&(r||I||!_&&L))){const[W,X]=ar({nodeId:_,dragItems:a,nodeLookup:S});r==null||r(j,a,W,X),I==null||I(j,W,X),_||L==null||L(j,X)}}async function N(){if(!l)return;const{transform:R,panBy:P,autoPanSpeed:j,autoPanOnNodeDrag:S}=t();if(!S){c=!1,cancelAnimationFrame(s);return}const[k,A]=us(u,l,j);(k!==0||A!==0)&&(i.x=(i.x??0)-k/R[2],i.y=(i.y??0)-A/R[2],await P({x:k,y:A})&&M(i,null)),s=requestAnimationFrame(N)}function T(R){var V;const{nodeLookup:P,multiSelectionActive:j,nodesDraggable:S,transform:k,snapGrid:A,snapToGrid:D,selectNodesOnDrag:$,onNodeDragStart:I,onSelectionDragStart:L,unselectNodesAndEdges:z}=t();f=!0,(!$||!y)&&!j&&_&&((V=P.get(_))!=null&&V.selected||z()),y&&$&&_&&(e==null||e(_));const F=Ot(R.sourceEvent,{transform:k,snapGrid:A,snapToGrid:D,containerBounds:l});if(i=F,a=Rf(P,S,F,_),a.size>0&&(n||I||!_&&L)){const[B,W]=ar({nodeId:_,dragItems:a,nodeLookup:P});n==null||n(R.sourceEvent,a,B,W),I==null||I(R.sourceEvent,B,W),_||L==null||L(R.sourceEvent,W)}}const O=Ki().clickDistance(C).on("start",R=>{const{domNode:P,nodeDragThreshold:j,transform:S,snapGrid:k,snapToGrid:A}=t();l=(P==null?void 0:P.getBoundingClientRect())||null,h=!1,m=!1,j===0&&T(R),i=Ot(R.sourceEvent,{transform:S,snapGrid:k,snapToGrid:A,containerBounds:l}),u=ze(R.sourceEvent,l)}).on("drag",R=>{const{autoPanOnNodeDrag:P,transform:j,snapGrid:S,snapToGrid:k,nodeDragThreshold:A,nodeLookup:D}=t(),$=Ot(R.sourceEvent,{transform:j,snapGrid:S,snapToGrid:k,containerBounds:l});if((R.sourceEvent.type==="touchmove"&&R.sourceEvent.touches.length>1||_&&!D.has(_))&&(h=!0),!h){if(!c&&P&&f&&(c=!0,N()),!f){const I=$.xSnapped-(i.x??0),L=$.ySnapped-(i.y??0);Math.sqrt(I*I+L*L)>A&&T(R)}(i.x!==$.xSnapped||i.y!==$.ySnapped)&&a&&f&&(u=ze(R.sourceEvent,l),M($,R.sourceEvent))}}).on("end",R=>{if(!(!f||h)&&(c=!1,f=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:P,updateNodePositions:j,onNodeDragStop:S,onSelectionDragStop:k}=t();if(m&&(j(a,!1),m=!1),o||S||!_&&k){const[A,D]=ar({nodeId:_,dragItems:a,nodeLookup:P,dragging:!1});o==null||o(R.sourceEvent,a,A,D),S==null||S(R.sourceEvent,A,D),_||k==null||k(R.sourceEvent,D)}}}).filter(R=>{const P=R.target;return!R.button&&(!w||!zo(P,`.${w}`,g))&&(!E||zo(P,E,g))});d.call(O)}function v(){d==null||d.on(".drag",null)}return{update:p,destroy:v}}function Pf(e,t,n){const r=[],o={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())Wt(o,Nt(i))>0&&r.push(i);return r}const jf=250;function $f(e,t,n,r){var a,c;let o=[],i=1/0;const s=Pf(e,n,t+jf);for(const u of s){const l=[...((a=u.internals.handleBounds)==null?void 0:a.source)??[],...((c=u.internals.handleBounds)==null?void 0:c.target)??[]];for(const f of l){if(r.nodeId===f.nodeId&&r.type===f.type&&r.id===f.id)continue;const{x:d,y:h}=Ut(u,f,f.position,!0),m=Math.sqrt(Math.pow(d-e.x,2)+Math.pow(h-e.y,2));m>t||(m<i?(o=[{...f,x:d,y:h}],i=m):m===i&&o.push({...f,x:d,y:h}))}}if(!o.length)return null;if(o.length>1){const u=r.type==="source"?"target":"source";return o.find(l=>l.type===u)??o[0]}return o[0]}function Cs(e,t,n,r,o,i=!1){var u,l,f;const s=r.get(e);if(!s)return null;const a=o==="strict"?(u=s.internals.handleBounds)==null?void 0:u[t]:[...((l=s.internals.handleBounds)==null?void 0:l.source)??[],...((f=s.internals.handleBounds)==null?void 0:f.target)??[]],c=(n?a==null?void 0:a.find(d=>d.id===n):a==null?void 0:a[0])??null;return c&&i?{...c,...Ut(s,c,c.position,!0)}:c}function Ms(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Lf(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Ns=()=>!0;function zf(e,{connectionMode:t,connectionRadius:n,handleId:r,nodeId:o,edgeUpdaterType:i,isTarget:s,domNode:a,nodeLookup:c,lib:u,autoPanOnConnect:l,flowId:f,panBy:d,cancelConnection:h,onConnectStart:m,onConnect:p,onConnectEnd:v,isValidConnection:w=Ns,onReconnectEnd:E,updateConnection:g,getTransform:y,getFromHandle:_,autoPanSpeed:C,dragThreshold:M=1}){const N=gs(e.target);let T=0,O;const{x:R,y:P}=ze(e),j=N==null?void 0:N.elementFromPoint(R,P),S=Ms(i,j),k=a==null?void 0:a.getBoundingClientRect();let A=!1;if(!k||!S)return;const D=Cs(o,S,r,c,t);if(!D)return;let $=ze(e,k),I=!1,L=null,z=!1,F=null;function V(){if(!l||!k)return;const[Q,G]=us($,k,C);d({x:Q,y:G}),T=requestAnimationFrame(V)}const B={...D,nodeId:o,type:S,position:D.position},W=c.get(o);let U={inProgress:!0,isValid:null,from:Ut(W,B,K.Left,!0),fromHandle:B,fromPosition:B.position,fromNode:W,to:$,toHandle:null,toPosition:Mo[B.position],toNode:null};function H(){A=!0,g(U),m==null||m(e,{nodeId:o,handleId:r,handleType:S})}M===0&&H();function q(Q){if(!A){const{x:te,y:re}=ze(Q),Se=te-R,He=re-P;if(!(Se*Se+He*He>M*M))return;H()}if(!_()||!B){Y(Q);return}const G=y();$=ze(Q,k),O=$f(tn($,G,!1,[1,1]),n,c,B),I||(V(),I=!0);const J=As(Q,{handle:O,connectionMode:t,fromNodeId:o,fromHandleId:r,fromType:s?"target":"source",isValidConnection:w,doc:N,lib:u,flowId:f,nodeLookup:c});F=J.handleDomNode,L=J.connection,z=Lf(!!O,J.isValid);const Z={...U,isValid:z,to:J.toHandle&&z?Dn({x:J.toHandle.x,y:J.toHandle.y},G):$,toHandle:J.toHandle,toPosition:z&&J.toHandle?J.toHandle.position:Mo[B.position],toNode:J.toHandle?c.get(J.toHandle.nodeId):null};z&&O&&U.toHandle&&Z.toHandle&&U.toHandle.type===Z.toHandle.type&&U.toHandle.nodeId===Z.toHandle.nodeId&&U.toHandle.id===Z.toHandle.id&&U.to.x===Z.to.x&&U.to.y===Z.to.y||(g(Z),U=Z)}function Y(Q){if(A){(O||F)&&L&&z&&(p==null||p(L));const{inProgress:G,...J}=U,Z={...J,toPosition:U.toHandle?U.toPosition:null};v==null||v(Q,Z),i&&(E==null||E(Q,Z))}h(),cancelAnimationFrame(T),I=!1,z=!1,L=null,F=null,N.removeEventListener("mousemove",q),N.removeEventListener("mouseup",Y),N.removeEventListener("touchmove",q),N.removeEventListener("touchend",Y)}N.addEventListener("mousemove",q),N.addEventListener("mouseup",Y),N.addEventListener("touchmove",q),N.addEventListener("touchend",Y)}function As(e,{handle:t,connectionMode:n,fromNodeId:r,fromHandleId:o,fromType:i,doc:s,lib:a,flowId:c,isValidConnection:u=Ns,nodeLookup:l}){const f=i==="target",d=t?s.querySelector(`.${a}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:h,y:m}=ze(e),p=s.elementFromPoint(h,m),v=p!=null&&p.classList.contains(`${a}-flow__handle`)?p:d,w={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const E=Ms(void 0,v),g=v.getAttribute("data-nodeid"),y=v.getAttribute("data-handleid"),_=v.classList.contains("connectable"),C=v.classList.contains("connectableend");if(!g||!E)return w;const M={source:f?g:r,sourceHandle:f?y:o,target:f?r:g,targetHandle:f?o:y};w.connection=M;const T=_&&C&&(n===Ct.Strict?f&&E==="source"||!f&&E==="target":g!==r||y!==o);w.isValid=T&&u(M),w.toHandle=Cs(g,E,y,l,n,!0)}return w}const kr={onPointerDown:zf,isValid:As};function Of({domNode:e,panZoom:t,getTransform:n,getViewScale:r}){const o=we(e);function i({translateExtent:a,width:c,height:u,zoomStep:l=10,pannable:f=!0,zoomable:d=!0,inversePan:h=!1}){const m=g=>{const y=n();if(g.sourceEvent.type!=="wheel"||!t)return;const _=-g.sourceEvent.deltaY*(g.sourceEvent.deltaMode===1?.05:g.sourceEvent.deltaMode?1:.002)*l,C=y[2]*Math.pow(2,_);t.scaleTo(C)};let p=[0,0];const v=g=>{(g.sourceEvent.type==="mousedown"||g.sourceEvent.type==="touchstart")&&(p=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY])},w=g=>{const y=n();if(g.sourceEvent.type!=="mousemove"&&g.sourceEvent.type!=="touchmove"||!t)return;const _=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY],C=[_[0]-p[0],_[1]-p[1]];p=_;const M=r()*Math.max(y[2],Math.log(y[2]))*(h?-1:1),N={x:y[0]-C[0]*M,y:y[1]-C[1]*M},T=[[0,0],[c,u]];t.setViewportConstrained({x:N.x,y:N.y,zoom:y[2]},T,a)},E=ns().on("start",v).on("zoom",f?w:null).on("zoom.wheel",d?m:null);o.call(E,{})}function s(){o.on("zoom",null)}return{update:i,destroy:s,pointer:De}}const Ff=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,Hn=e=>({x:e.x,y:e.y,zoom:e.k}),cr=({x:e,y:t,zoom:n})=>zn.translate(e,t).scale(n),vt=(e,t)=>e.target.closest(`.${t}`),Ds=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Bf=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,lr=(e,t=0,n=Bf,r=()=>{})=>{const o=typeof t=="number"&&t>0;return o||r(),o?e.transition().duration(t).ease(n).on("end",r):e},Is=e=>{const t=e.ctrlKey&&In()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Hf({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:i,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:u}){return l=>{if(vt(l,t))return!1;l.preventDefault(),l.stopImmediatePropagation();const f=n.property("__zoom").k||1;if(l.ctrlKey&&s){const v=De(l),w=Is(l),E=f*Math.pow(2,w);r.scaleTo(n,E,v,l);return}const d=l.deltaMode===1?20:1;let h=o===ft.Vertical?0:l.deltaX*d,m=o===ft.Horizontal?0:l.deltaY*d;!In()&&l.shiftKey&&o!==ft.Vertical&&(h=l.deltaY*d,m=0),r.translateBy(n,-(h/f)*i,-(m/f)*i,{internal:!0});const p=Hn(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,a==null||a(l,p)),e.isPanScrolling&&(c==null||c(l,p),e.panScrollTimeout=setTimeout(()=>{u==null||u(l,p),e.isPanScrolling=!1},150))}}function Vf({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(r,o){const i=r.type==="wheel",s=!t&&i&&!r.ctrlKey,a=vt(r,e);if(r.ctrlKey&&i&&a&&r.preventDefault(),s||a)return null;r.preventDefault(),n.call(this,r,o)}}function Xf({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return r=>{var i,s,a;if((i=r.sourceEvent)!=null&&i.internal)return;const o=Hn(r.transform);e.mouseButton=((s=r.sourceEvent)==null?void 0:s.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=o,((a=r.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(r.sourceEvent,o))}}function Yf({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:r,onPanZoom:o}){return i=>{var s,a;e.usedRightMouseButton=!!(n&&Ds(t,e.mouseButton??0)),(s=i.sourceEvent)!=null&&s.sync||r([i.transform.x,i.transform.y,i.transform.k]),o&&!((a=i.sourceEvent)!=null&&a.internal)&&(o==null||o(i.sourceEvent,Hn(i.transform)))}}function Wf({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:i}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,i&&Ds(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&i(s.sourceEvent),e.usedRightMouseButton=!1,r(!1),o&&Ff(e.prevViewport,s.transform))){const c=Hn(s.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o==null||o(s.sourceEvent,c)},n?150:0)}}}function Uf({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:i,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:u}){return l=>{var m;const f=e||t,d=n&&l.ctrlKey;if(l.button===1&&l.type==="mousedown"&&(vt(l,`${u}-flow__node`)||vt(l,`${u}-flow__edge`)))return!0;if(!r&&!f&&!o&&!i&&!n||s||vt(l,a)&&l.type==="wheel"||vt(l,c)&&(l.type!=="wheel"||o&&l.type==="wheel"&&!e)||!n&&l.ctrlKey&&l.type==="wheel")return!1;if(!n&&l.type==="touchstart"&&((m=l.touches)==null?void 0:m.length)>1)return l.preventDefault(),!1;if(!f&&!o&&!d&&l.type==="wheel"||!r&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(r)&&!r.includes(l.button)&&l.type==="mousedown")return!1;const h=Array.isArray(r)&&r.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||l.type==="wheel")&&h}}function qf({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:r,translateExtent:o,viewport:i,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:u}){const l={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=e.getBoundingClientRect(),d=ns().clickDistance(!Ie(r)||r<0?0:r).scaleExtent([t,n]).translateExtent(o),h=we(e).call(d);g({x:i.x,y:i.y,zoom:Mt(i.zoom,t,n)},[[0,0],[f.width,f.height]],o);const m=h.on("wheel.zoom"),p=h.on("dblclick.zoom");d.wheelDelta(Is);function v(P,j){return h?new Promise(S=>{d==null||d.interpolate((j==null?void 0:j.interpolate)==="linear"?zt:vn).transform(lr(h,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>S(!0)),P)}):Promise.resolve(!1)}function w({noWheelClassName:P,noPanClassName:j,onPaneContextMenu:S,userSelectionActive:k,panOnScroll:A,panOnDrag:D,panOnScrollMode:$,panOnScrollSpeed:I,preventScrolling:L,zoomOnPinch:z,zoomOnScroll:F,zoomOnDoubleClick:V,zoomActivationKeyPressed:B,lib:W,onTransformChange:X}){k&&!l.isZoomingOrPanning&&E();const H=A&&!B&&!k?Hf({zoomPanValues:l,noWheelClassName:P,d3Selection:h,d3Zoom:d,panOnScrollMode:$,panOnScrollSpeed:I,zoomOnPinch:z,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):Vf({noWheelClassName:P,preventScrolling:L,d3ZoomHandler:m});if(h.on("wheel.zoom",H,{passive:!1}),!k){const Y=Xf({zoomPanValues:l,onDraggingChange:u,onPanZoomStart:a});d.on("start",Y);const Q=Yf({zoomPanValues:l,panOnDrag:D,onPaneContextMenu:!!S,onPanZoom:s,onTransformChange:X});d.on("zoom",Q);const G=Wf({zoomPanValues:l,panOnDrag:D,panOnScroll:A,onPaneContextMenu:S,onPanZoomEnd:c,onDraggingChange:u});d.on("end",G)}const q=Uf({zoomActivationKeyPressed:B,panOnDrag:D,zoomOnScroll:F,panOnScroll:A,zoomOnDoubleClick:V,zoomOnPinch:z,userSelectionActive:k,noPanClassName:j,noWheelClassName:P,lib:W});d.filter(q),V?h.on("dblclick.zoom",p):h.on("dblclick.zoom",null)}function E(){d.on("zoom",null)}async function g(P,j,S){const k=cr(P),A=d==null?void 0:d.constrain()(k,j,S);return A&&await v(A),new Promise(D=>D(A))}async function y(P,j){const S=cr(P);return await v(S,j),new Promise(k=>k(S))}function _(P){if(h){const j=cr(P),S=h.property("__zoom");(S.k!==P.zoom||S.x!==P.x||S.y!==P.y)&&(d==null||d.transform(h,j,null,{sync:!0}))}}function C(){const P=h?ts(h.node()):{x:0,y:0,k:1};return{x:P.x,y:P.y,zoom:P.k}}function M(P,j){return h?new Promise(S=>{d==null||d.interpolate((j==null?void 0:j.interpolate)==="linear"?zt:vn).scaleTo(lr(h,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>S(!0)),P)}):Promise.resolve(!1)}function N(P,j){return h?new Promise(S=>{d==null||d.interpolate((j==null?void 0:j.interpolate)==="linear"?zt:vn).scaleBy(lr(h,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>S(!0)),P)}):Promise.resolve(!1)}function T(P){d==null||d.scaleExtent(P)}function O(P){d==null||d.translateExtent(P)}function R(P){const j=!Ie(P)||P<0?0:P;d==null||d.clickDistance(j)}return{update:w,destroy:E,setViewport:y,setViewportConstrained:g,getViewport:C,scaleTo:M,scaleBy:N,setScaleExtent:T,setTranslateExtent:O,syncViewport:_,setClickDistance:R}}var Dt;(function(e){e.Line="line",e.Handle="handle"})(Dt||(Dt={}));function Gf({width:e,prevWidth:t,height:n,prevHeight:r,affectsX:o,affectsY:i}){const s=e-t,a=n-r,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&o&&(c[0]=c[0]*-1),a&&i&&(c[1]=c[1]*-1),c}function Kf(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),r=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:r,affectsY:o}}function et(e,t){return Math.max(0,t-e)}function tt(e,t){return Math.max(0,e-t)}function gn(e,t,n){return Math.max(0,t-e,e-n)}function Oo(e,t){return e?!t:t}function Zf(e,t,n,r,o,i,s,a){let{affectsX:c,affectsY:u}=t;const{isHorizontal:l,isVertical:f}=t,d=l&&f,{xSnapped:h,ySnapped:m}=n,{minWidth:p,maxWidth:v,minHeight:w,maxHeight:E}=r,{x:g,y,width:_,height:C,aspectRatio:M}=e;let N=Math.floor(l?h-e.pointerX:0),T=Math.floor(f?m-e.pointerY:0);const O=_+(c?-N:N),R=C+(u?-T:T),P=-i[0]*_,j=-i[1]*C;let S=gn(O,p,v),k=gn(R,w,E);if(s){let $=0,I=0;c&&N<0?$=et(g+N+P,s[0][0]):!c&&N>0&&($=tt(g+O+P,s[1][0])),u&&T<0?I=et(y+T+j,s[0][1]):!u&&T>0&&(I=tt(y+R+j,s[1][1])),S=Math.max(S,$),k=Math.max(k,I)}if(a){let $=0,I=0;c&&N>0?$=tt(g+N,a[0][0]):!c&&N<0&&($=et(g+O,a[1][0])),u&&T>0?I=tt(y+T,a[0][1]):!u&&T<0&&(I=et(y+R,a[1][1])),S=Math.max(S,$),k=Math.max(k,I)}if(o){if(l){const $=gn(O/M,w,E)*M;if(S=Math.max(S,$),s){let I=0;!c&&!u||c&&!u&&d?I=tt(y+j+O/M,s[1][1])*M:I=et(y+j+(c?N:-N)/M,s[0][1])*M,S=Math.max(S,I)}if(a){let I=0;!c&&!u||c&&!u&&d?I=et(y+O/M,a[1][1])*M:I=tt(y+(c?N:-N)/M,a[0][1])*M,S=Math.max(S,I)}}if(f){const $=gn(R*M,p,v)/M;if(k=Math.max(k,$),s){let I=0;!c&&!u||u&&!c&&d?I=tt(g+R*M+P,s[1][0])/M:I=et(g+(u?T:-T)*M+P,s[0][0])/M,k=Math.max(k,I)}if(a){let I=0;!c&&!u||u&&!c&&d?I=et(g+R*M,a[1][0])/M:I=tt(g+(u?T:-T)*M,a[0][0])/M,k=Math.max(k,I)}}}T=T+(T<0?k:-k),N=N+(N<0?S:-S),o&&(d?O>R*M?T=(Oo(c,u)?-N:N)/M:N=(Oo(c,u)?-T:T)*M:l?(T=N/M,u=c):(N=T*M,c=u));const A=c?g+N:g,D=u?y+T:y;return{width:_+(c?-N:N),height:C+(u?-T:T),x:i[0]*N*(c?-1:1)+A,y:i[1]*T*(u?-1:1)+D}}const ks={width:0,height:0,x:0,y:0},Jf={...ks,pointerX:0,pointerY:0,aspectRatio:1};function Qf(e){return[[0,0],[e.measured.width,e.measured.height]]}function eh(e,t,n){const r=t.position.x+e.position.x,o=t.position.y+e.position.y,i=e.measured.width??0,s=e.measured.height??0,a=n[0]*i,c=n[1]*s;return[[r-a,o-c],[r+i-a,o+s-c]]}function th({domNode:e,nodeId:t,getStoreItems:n,onChange:r,onEnd:o}){const i=we(e);function s({controlPosition:c,boundaries:u,keepAspectRatio:l,resizeDirection:f,onResizeStart:d,onResize:h,onResizeEnd:m,shouldResize:p}){let v={...ks},w={...Jf};const E=Kf(c);let g,y=null,_=[],C,M,N;const T=Ki().on("start",O=>{const{nodeLookup:R,transform:P,snapGrid:j,snapToGrid:S,nodeOrigin:k,paneDomNode:A}=n();if(g=R.get(t),!g)return;y=(A==null?void 0:A.getBoundingClientRect())??null;const{xSnapped:D,ySnapped:$}=Ot(O.sourceEvent,{transform:P,snapGrid:j,snapToGrid:S,containerBounds:y});v={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},w={...v,pointerX:D,pointerY:$,aspectRatio:v.width/v.height},C=void 0,g.parentId&&(g.extent==="parent"||g.expandParent)&&(C=R.get(g.parentId),M=C&&g.extent==="parent"?Qf(C):void 0),_=[],N=void 0;for(const[I,L]of R)if(L.parentId===t&&(_.push({id:I,position:{...L.position},extent:L.extent}),L.extent==="parent"||L.expandParent)){const z=eh(L,g,L.origin??k);N?N=[[Math.min(z[0][0],N[0][0]),Math.min(z[0][1],N[0][1])],[Math.max(z[1][0],N[1][0]),Math.max(z[1][1],N[1][1])]]:N=z}d==null||d(O,{...v})}).on("drag",O=>{const{transform:R,snapGrid:P,snapToGrid:j,nodeOrigin:S}=n(),k=Ot(O.sourceEvent,{transform:R,snapGrid:P,snapToGrid:j,containerBounds:y}),A=[];if(!g)return;const{x:D,y:$,width:I,height:L}=v,z={},F=g.origin??S,{width:V,height:B,x:W,y:X}=Zf(w,E,k,u,l,F,M,N),U=V!==I,H=B!==L,q=W!==D&&U,Y=X!==$&&H;if(!q&&!Y&&!U&&!H)return;if((q||Y||F[0]===1||F[1]===1)&&(z.x=q?W:v.x,z.y=Y?X:v.y,v.x=z.x,v.y=z.y,_.length>0)){const Z=W-D,te=X-$;for(const re of _)re.position={x:re.position.x-Z+F[0]*(V-I),y:re.position.y-te+F[1]*(B-L)},A.push(re)}if((U||H)&&(z.width=U&&(!f||f==="horizontal")?V:v.width,z.height=H&&(!f||f==="vertical")?B:v.height,v.width=z.width,v.height=z.height),C&&g.expandParent){const Z=F[0]*(z.width??0);z.x&&z.x<Z&&(v.x=Z,w.x=w.x-(z.x-Z));const te=F[1]*(z.height??0);z.y&&z.y<te&&(v.y=te,w.y=w.y-(z.y-te))}const Q=Gf({width:v.width,prevWidth:I,height:v.height,prevHeight:L,affectsX:E.affectsX,affectsY:E.affectsY}),G={...v,direction:Q};(p==null?void 0:p(O,G))!==!1&&(h==null||h(O,G),r(z,A))}).on("end",O=>{m==null||m(O,{...v}),o==null||o({...v})});i.call(T)}function a(){i.on(".drag",null)}return{update:s,destroy:a}}var ur={exports:{}},dr={},fr={exports:{}},hr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fo;function nh(){if(Fo)return hr;Fo=1;var e=Ai();function t(f,d){return f===d&&(f!==0||1/f===1/d)||f!==f&&d!==d}var n=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,i=e.useLayoutEffect,s=e.useDebugValue;function a(f,d){var h=d(),m=r({inst:{value:h,getSnapshot:d}}),p=m[0].inst,v=m[1];return i(function(){p.value=h,p.getSnapshot=d,c(p)&&v({inst:p})},[f,h,d]),o(function(){return c(p)&&v({inst:p}),f(function(){c(p)&&v({inst:p})})},[f]),s(h),h}function c(f){var d=f.getSnapshot;f=f.value;try{var h=d();return!n(f,h)}catch{return!0}}function u(f,d){return d()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return hr.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,hr}var Bo;function rh(){return Bo||(Bo=1,fr.exports=nh()),fr.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ho;function oh(){if(Ho)return dr;Ho=1;var e=Ai(),t=rh();function n(u,l){return u===l&&(u!==0||1/u===1/l)||u!==u&&l!==l}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,i=e.useRef,s=e.useEffect,a=e.useMemo,c=e.useDebugValue;return dr.useSyncExternalStoreWithSelector=function(u,l,f,d,h){var m=i(null);if(m.current===null){var p={hasValue:!1,value:null};m.current=p}else p=m.current;m=a(function(){function w(C){if(!E){if(E=!0,g=C,C=d(C),h!==void 0&&p.hasValue){var M=p.value;if(h(M,C))return y=M}return y=C}if(M=y,r(g,C))return M;var N=d(C);return h!==void 0&&h(M,N)?(g=C,M):(g=C,y=N)}var E=!1,g,y,_=f===void 0?null:f;return[function(){return w(l())},_===null?void 0:function(){return w(_())}]},[l,f,d,h]);var v=o(u,m[0],m[1]);return s(function(){p.hasValue=!0,p.value=v},[v]),c(v),v},dr}var Vo;function ih(){return Vo||(Vo=1,ur.exports=oh()),ur.exports}var sh=ih();const ah=lc(sh),ch={},Xo=e=>{let t;const n=new Set,r=(l,f)=>{const d=typeof l=="function"?l(t):l;if(!Object.is(d,t)){const h=t;t=f??(typeof d!="object"||d===null)?d:Object.assign({},t,d),n.forEach(m=>m(t,h))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>u,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{(ch?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=t=e(r,o,c);return c},lh=e=>e?Xo(e):Xo,{useDebugValue:uh}=fe,{useSyncExternalStoreWithSelector:dh}=ah,fh=e=>e;function Rs(e,t=fh,n){const r=dh(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return uh(r),r}const Yo=(e,t)=>{const n=lh(e),r=(o,i=t)=>Rs(n,o,i);return Object.assign(r,n),r},hh=(e,t)=>e?Yo(e,t):Yo;function ie(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const Vn=b.createContext(null),gh=Vn.Provider,Ts=Oe.error001();function ee(e,t){const n=b.useContext(Vn);if(n===null)throw new Error(Ts);return Rs(n,e,t)}function oe(){const e=b.useContext(Vn);if(e===null)throw new Error(Ts);return b.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Wo={display:"none"},ph={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ps="react-flow__node-desc",js="react-flow__edge-desc",mh="react-flow__aria-live",yh=e=>e.ariaLiveMessage,xh=e=>e.ariaLabelConfig;function vh({rfId:e}){const t=ee(yh);return x.jsx("div",{id:`${mh}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:ph,children:t})}function wh({rfId:e,disableKeyboardA11y:t}){const n=ee(xh);return x.jsxs(x.Fragment,{children:[x.jsx("div",{id:`${Ps}-${e}`,style:Wo,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),x.jsx("div",{id:`${js}-${e}`,style:Wo,children:n["edge.a11yDescription.default"]}),!t&&x.jsx(vh,{rfId:e})]})}const Xn=b.forwardRef(({position:e="top-left",children:t,className:n,style:r,...o},i)=>{const s=`${e}`.split("-");return x.jsx("div",{className:ae(["react-flow__panel",n,...s]),style:r,ref:i,...o,children:t})});Xn.displayName="Panel";function bh({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:x.jsx(Xn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:x.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Sh=e=>{const t=[],n=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&n.push(r);return{selectedNodes:t,selectedEdges:n}},pn=e=>e.id;function _h(e,t){return ie(e.selectedNodes.map(pn),t.selectedNodes.map(pn))&&ie(e.selectedEdges.map(pn),t.selectedEdges.map(pn))}function Eh({onSelectionChange:e}){const t=oe(),{selectedNodes:n,selectedEdges:r}=ee(Sh,_h);return b.useEffect(()=>{const o={nodes:n,edges:r};e==null||e(o),t.getState().onSelectionChangeHandlers.forEach(i=>i(o))},[n,r,e]),null}const Ch=e=>!!e.onSelectionChangeHandlers;function Mh({onSelectionChange:e}){const t=ee(Ch);return e||t?x.jsx(Eh,{onSelectionChange:e}):null}const $s=[0,0],Nh={x:0,y:0,zoom:1},Ah=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],Uo=[...Ah,"rfId"],Dh=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),qo={translateExtent:Xt,nodeOrigin:$s,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function Ih(e){const{setNodes:t,setEdges:n,setMinZoom:r,setMaxZoom:o,setTranslateExtent:i,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c,setPaneClickDistance:u}=ee(Dh,ie),l=oe();b.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{f.current=qo,a()}),[]);const f=b.useRef(qo);return b.useEffect(()=>{for(const d of Uo){const h=e[d],m=f.current[d];h!==m&&(typeof e[d]>"u"||(d==="nodes"?t(h):d==="edges"?n(h):d==="minZoom"?r(h):d==="maxZoom"?o(h):d==="translateExtent"?i(h):d==="nodeExtent"?s(h):d==="paneClickDistance"?u(h):d==="ariaLabelConfig"?l.setState({ariaLabelConfig:pf(h)}):d==="fitView"?l.setState({fitViewQueued:h}):d==="fitViewOptions"?l.setState({fitViewOptions:h}):l.setState({[d]:h})))}f.current=e},Uo.map(d=>e[d])),null}function Go(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function kh(e){var r;const[t,n]=b.useState(e==="system"?null:e);return b.useEffect(()=>{if(e!=="system"){n(e);return}const o=Go(),i=()=>n(o!=null&&o.matches?"dark":"light");return i(),o==null||o.addEventListener("change",i),()=>{o==null||o.removeEventListener("change",i)}},[e]),t!==null?t:(r=Go())!=null&&r.matches?"dark":"light"}const Ko=typeof document<"u"?document:null;function qt(e=null,t={target:Ko,actInsideInputWithModifier:!0}){const[n,r]=b.useState(!1),o=b.useRef(!1),i=b.useRef(new Set([])),[s,a]=b.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=u.reduce((f,d)=>f.concat(...d),[]);return[u,l]}return[[],[]]},[e]);return b.useEffect(()=>{const c=(t==null?void 0:t.target)??Ko,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const l=h=>{var v,w;if(o.current=h.ctrlKey||h.metaKey||h.shiftKey||h.altKey,(!o.current||o.current&&!u)&&ps(h))return!1;const p=Jo(h.code,a);if(i.current.add(h[p]),Zo(s,i.current,!1)){const E=((w=(v=h.composedPath)==null?void 0:v.call(h))==null?void 0:w[0])||h.target,g=(E==null?void 0:E.nodeName)==="BUTTON"||(E==null?void 0:E.nodeName)==="A";t.preventDefault!==!1&&(o.current||!g)&&h.preventDefault(),r(!0)}},f=h=>{const m=Jo(h.code,a);Zo(s,i.current,!0)?(r(!1),i.current.clear()):i.current.delete(h[m]),h.key==="Meta"&&i.current.clear(),o.current=!1},d=()=>{i.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",f),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",f),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,r]),n}function Zo(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function Jo(e,t){return t.includes(e)?"code":"key"}const Rh=()=>{const e=oe();return b.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[r,o,i],panZoom:s}=e.getState();return s?(await s.setViewport({x:t.x??r,y:t.y??o,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},setCenter:async(t,n,r)=>e.getState().setCenter(t,n,r),fitBounds:async(t,n)=>{const{width:r,height:o,minZoom:i,maxZoom:s,panZoom:a}=e.getState(),c=qr(t,r,o,i,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:r,snapGrid:o,snapToGrid:i,domNode:s}=e.getState();if(!s)return t;const{x:a,y:c}=s.getBoundingClientRect(),u={x:t.x-a,y:t.y-c},l=n.snapGrid??o,f=n.snapToGrid??i;return tn(u,r,f,l)},flowToScreenPosition:t=>{const{transform:n,domNode:r}=e.getState();if(!r)return t;const{x:o,y:i}=r.getBoundingClientRect(),s=Dn(t,n);return{x:s.x+o,y:s.y+i}}}),[])};function Ls(e,t){const n=[],r=new Map,o=[];for(const i of e)if(i.type==="add"){o.push(i);continue}else if(i.type==="remove"||i.type==="replace")r.set(i.id,[i]);else{const s=r.get(i.id);s?s.push(i):r.set(i.id,[i])}for(const i of t){const s=r.get(i.id);if(!s){n.push(i);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...i};for(const c of s)Th(c,a);n.push(a)}return o.length&&o.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function Th(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function zs(e,t){return Ls(e,t)}function Os(e,t){return Ls(e,t)}function dt(e,t){return{id:e,type:"select",selected:t}}function wt(e,t=new Set,n=!1){const r=[];for(const[o,i]of e){const s=t.has(o);!(i.selected===void 0&&!s)&&i.selected!==s&&(n&&(i.selected=s),r.push(dt(i.id,s)))}return r}function Qo({items:e=[],lookup:t}){var o;const n=[],r=new Map(e.map(i=>[i.id,i]));for(const[i,s]of e.entries()){const a=t.get(s.id),c=((o=a==null?void 0:a.internals)==null?void 0:o.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:i})}for(const[i]of t)r.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function ei(e){return{id:e.id,type:"remove"}}const ti=e=>of(e),Ph=e=>as(e);function Fs(e){return b.forwardRef(e)}const jh=typeof window<"u"?b.useLayoutEffect:b.useEffect;function ni(e){const[t,n]=b.useState(BigInt(0)),[r]=b.useState(()=>$h(()=>n(o=>o+BigInt(1))));return jh(()=>{const o=r.get();o.length&&(e(o),r.reset())},[t]),r}function $h(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Bs=b.createContext(null);function Lh({children:e}){const t=oe(),n=b.useCallback(a=>{const{nodes:c=[],setNodes:u,hasDefaultNodes:l,onNodesChange:f,nodeLookup:d,fitViewQueued:h}=t.getState();let m=c;for(const v of a)m=typeof v=="function"?v(m):v;const p=Qo({items:m,lookup:d});l&&u(m),p.length>0?f==null||f(p):h&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:w,setNodes:E}=t.getState();v&&E(w)})},[]),r=ni(n),o=b.useCallback(a=>{const{edges:c=[],setEdges:u,hasDefaultEdges:l,onEdgesChange:f,edgeLookup:d}=t.getState();let h=c;for(const m of a)h=typeof m=="function"?m(h):m;l?u(h):f&&f(Qo({items:h,lookup:d}))},[]),i=ni(o),s=b.useMemo(()=>({nodeQueue:r,edgeQueue:i}),[]);return x.jsx(Bs.Provider,{value:s,children:e})}function zh(){const e=b.useContext(Bs);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Oh=e=>!!e.panZoom;function eo(){const e=Rh(),t=oe(),n=zh(),r=ee(Oh),o=b.useMemo(()=>{const i=f=>t.getState().nodeLookup.get(f),s=f=>{n.nodeQueue.push(f)},a=f=>{n.edgeQueue.push(f)},c=f=>{var w,E;const{nodeLookup:d,nodeOrigin:h}=t.getState(),m=ti(f)?f:d.get(f.id),p=m.parentId?hs(m.position,m.measured,m.parentId,d,h):m.position,v={...m,position:p,width:((w=m.measured)==null?void 0:w.width)??m.width,height:((E=m.measured)==null?void 0:E.height)??m.height};return Nt(v)},u=(f,d,h={replace:!1})=>{s(m=>m.map(p=>{if(p.id===f){const v=typeof d=="function"?d(p):d;return h.replace&&ti(v)?v:{...p,...v}}return p}))},l=(f,d,h={replace:!1})=>{a(m=>m.map(p=>{if(p.id===f){const v=typeof d=="function"?d(p):d;return h.replace&&Ph(v)?v:{...p,...v}}return p}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>{var d;return(d=i(f))==null?void 0:d.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(d=>({...d}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:s,setEdges:a,addNodes:f=>{const d=Array.isArray(f)?f:[f];n.nodeQueue.push(h=>[...h,...d])},addEdges:f=>{const d=Array.isArray(f)?f:[f];n.edgeQueue.push(h=>[...h,...d])},toObject:()=>{const{nodes:f=[],edges:d=[],transform:h}=t.getState(),[m,p,v]=h;return{nodes:f.map(w=>({...w})),edges:d.map(w=>({...w})),viewport:{x:m,y:p,zoom:v}}},deleteElements:async({nodes:f=[],edges:d=[]})=>{const{nodes:h,edges:m,onNodesDelete:p,onEdgesDelete:v,triggerNodeChanges:w,triggerEdgeChanges:E,onDelete:g,onBeforeDelete:y}=t.getState(),{nodes:_,edges:C}=await uf({nodesToRemove:f,edgesToRemove:d,nodes:h,edges:m,onBeforeDelete:y}),M=C.length>0,N=_.length>0;if(M){const T=C.map(ei);v==null||v(C),E(T)}if(N){const T=_.map(ei);p==null||p(_),w(T)}return(N||M)&&(g==null||g({nodes:_,edges:C})),{deletedNodes:_,deletedEdges:C}},getIntersectingNodes:(f,d=!0,h)=>{const m=Ao(f),p=m?f:c(f),v=h!==void 0;return p?(h||t.getState().nodes).filter(w=>{const E=t.getState().nodeLookup.get(w.id);if(E&&!m&&(w.id===f.id||!E.internals.positionAbsolute))return!1;const g=Nt(v?w:E),y=Wt(g,p);return d&&y>0||y>=g.width*g.height||y>=p.width*p.height}):[]},isNodeIntersecting:(f,d,h=!0)=>{const p=Ao(f)?f:c(f);if(!p)return!1;const v=Wt(p,d);return h&&v>0||v>=p.width*p.height},updateNode:u,updateNodeData:(f,d,h={replace:!1})=>{u(f,m=>{const p=typeof d=="function"?d(m):d;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},updateEdge:l,updateEdgeData:(f,d,h={replace:!1})=>{l(f,m=>{const p=typeof d=="function"?d(m):d;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},getNodesBounds:f=>{const{nodeLookup:d,nodeOrigin:h}=t.getState();return sf(f,{nodeLookup:d,nodeOrigin:h})},getHandleConnections:({type:f,id:d,nodeId:h})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${h}-${f}${d?`-${d}`:""}`))==null?void 0:m.values())??[])},getNodeConnections:({type:f,handleId:d,nodeId:h})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${h}${f?d?`-${f}-${d}`:`-${f}`:""}`))==null?void 0:m.values())??[])},fitView:async f=>{const d=t.getState().fitViewResolver??gf();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:d}),n.nodeQueue.push(h=>[...h]),d.promise}}},[]);return b.useMemo(()=>({...o,...e,viewportInitialized:r}),[r])}const ri=e=>e.selected,Fh=typeof window<"u"?window:void 0;function Bh({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=oe(),{deleteElements:r}=eo(),o=qt(e,{actInsideInputWithModifier:!1}),i=qt(t,{target:Fh});b.useEffect(()=>{if(o){const{edges:s,nodes:a}=n.getState();r({nodes:a.filter(ri),edges:s.filter(ri)}),n.setState({nodesSelectionActive:!1})}},[o]),b.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function Hh(e){const t=oe();b.useEffect(()=>{const n=()=>{var o,i;if(!e.current)return!1;const r=Gr(e.current);(r.height===0||r.width===0)&&((i=(o=t.getState()).onError)==null||i.call(o,"004",Oe.error004())),t.setState({width:r.width||500,height:r.height||500})};if(e.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(e.current),()=>{window.removeEventListener("resize",n),r&&e.current&&r.unobserve(e.current)}}},[])}const Yn={position:"absolute",width:"100%",height:"100%",top:0,left:0},Vh=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function Xh({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:i=ft.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:u,minZoom:l,maxZoom:f,zoomActivationKeyCode:d,preventScrolling:h=!0,children:m,noWheelClassName:p,noPanClassName:v,onViewportChange:w,isControlledViewport:E,paneClickDistance:g}){const y=oe(),_=b.useRef(null),{userSelectionActive:C,lib:M}=ee(Vh,ie),N=qt(d),T=b.useRef();Hh(_);const O=b.useCallback(R=>{w==null||w({x:R[0],y:R[1],zoom:R[2]}),E||y.setState({transform:R})},[w,E]);return b.useEffect(()=>{if(_.current){T.current=qf({domNode:_.current,minZoom:l,maxZoom:f,translateExtent:u,viewport:c,paneClickDistance:g,onDraggingChange:S=>y.setState({paneDragging:S}),onPanZoomStart:(S,k)=>{const{onViewportChangeStart:A,onMoveStart:D}=y.getState();D==null||D(S,k),A==null||A(k)},onPanZoom:(S,k)=>{const{onViewportChange:A,onMove:D}=y.getState();D==null||D(S,k),A==null||A(k)},onPanZoomEnd:(S,k)=>{const{onViewportChangeEnd:A,onMoveEnd:D}=y.getState();D==null||D(S,k),A==null||A(k)}});const{x:R,y:P,zoom:j}=T.current.getViewport();return y.setState({panZoom:T.current,transform:[R,P,j],domNode:_.current.closest(".react-flow")}),()=>{var S;(S=T.current)==null||S.destroy()}}},[]),b.useEffect(()=>{var R;(R=T.current)==null||R.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:i,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:N,preventScrolling:h,noPanClassName:v,userSelectionActive:C,noWheelClassName:p,lib:M,onTransformChange:O})},[e,t,n,r,o,i,s,a,N,h,v,C,p,M,O]),x.jsx("div",{className:"react-flow__renderer",ref:_,style:Yn,children:m})}const Yh=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Wh(){const{userSelectionActive:e,userSelectionRect:t}=ee(Yh,ie);return e&&t?x.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const gr=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Uh=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function qh({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Yt.Full,panOnDrag:r,selectionOnDrag:o,onSelectionStart:i,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:c,onPaneScroll:u,onPaneMouseEnter:l,onPaneMouseMove:f,onPaneMouseLeave:d,children:h}){const m=oe(),{userSelectionActive:p,elementsSelectable:v,dragging:w,connectionInProgress:E}=ee(Uh,ie),g=v&&(e||p),y=b.useRef(null),_=b.useRef(),C=b.useRef(new Set),M=b.useRef(new Set),N=b.useRef(!1),T=b.useRef(!1),O=D=>{if(N.current||E){N.current=!1;return}a==null||a(D),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},R=D=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){D.preventDefault();return}c==null||c(D)},P=u?D=>u(D):void 0,j=D=>{var F,V;const{resetSelectedElements:$,domNode:I}=m.getState();if(_.current=I==null?void 0:I.getBoundingClientRect(),!v||!e||D.button!==0||D.target!==y.current||!_.current)return;(V=(F=D.target)==null?void 0:F.setPointerCapture)==null||V.call(F,D.pointerId),T.current=!0,N.current=!1;const{x:L,y:z}=ze(D.nativeEvent,_.current);$(),m.setState({userSelectionRect:{width:0,height:0,startX:L,startY:z,x:L,y:z}}),i==null||i(D)},S=D=>{const{userSelectionRect:$,transform:I,nodeLookup:L,edgeLookup:z,connectionLookup:F,triggerNodeChanges:V,triggerEdgeChanges:B,defaultEdgeOptions:W}=m.getState();if(!_.current||!$)return;N.current=!0;const{x:X,y:U}=ze(D.nativeEvent,_.current),{startX:H,startY:q}=$,Y={startX:H,startY:q,x:X<H?X:H,y:U<q?U:q,width:Math.abs(X-H),height:Math.abs(U-q)},Q=C.current,G=M.current;C.current=new Set(Ur(L,Y,I,n===Yt.Partial,!0).map(Z=>Z.id)),M.current=new Set;const J=(W==null?void 0:W.selectable)??!0;for(const Z of C.current){const te=F.get(Z);if(te)for(const{edgeId:re}of te.values()){const Se=z.get(re);Se&&(Se.selectable??J)&&M.current.add(re)}}if(!Do(Q,C.current)){const Z=wt(L,C.current,!0);V(Z)}if(!Do(G,M.current)){const Z=wt(z,M.current);B(Z)}m.setState({userSelectionRect:Y,userSelectionActive:!0,nodesSelectionActive:!1})},k=D=>{var I,L;if(D.button!==0||!T.current)return;(L=(I=D.target)==null?void 0:I.releasePointerCapture)==null||L.call(I,D.pointerId);const{userSelectionRect:$}=m.getState();!p&&$&&D.target===y.current&&(O==null||O(D)),m.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:C.current.size>0}),s==null||s(D),(t||o)&&(N.current=!1),T.current=!1},A=r===!0||Array.isArray(r)&&r.includes(0);return x.jsxs("div",{className:ae(["react-flow__pane",{draggable:A,dragging:w,selection:e}]),onClick:g?void 0:gr(O,y),onContextMenu:gr(R,y),onWheel:gr(P,y),onPointerEnter:g?void 0:l,onPointerDown:g?j:f,onPointerMove:g?S:f,onPointerUp:g?k:void 0,onPointerLeave:d,ref:y,style:Yn,children:[h,x.jsx(Wh,{})]})}function Rr({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:i,multiSelectionActive:s,nodeLookup:a,onError:c}=t.getState(),u=a.get(e);if(!u){c==null||c("012",Oe.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&s)&&(i({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var l;return(l=r==null?void 0:r.current)==null?void 0:l.blur()})):o([e])}function Hs({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:i,nodeClickDistance:s}){const a=oe(),[c,u]=b.useState(!1),l=b.useRef();return b.useEffect(()=>{l.current=Tf({getStoreItems:()=>a.getState(),onNodeMouseDown:f=>{Rr({id:f,store:a,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),b.useEffect(()=>{var f,d;if(t)(f=l.current)==null||f.destroy();else if(e.current)return(d=l.current)==null||d.update({noDragClassName:n,handleSelector:r,domNode:e.current,isSelectable:i,nodeId:o,nodeClickDistance:s}),()=>{var h;(h=l.current)==null||h.destroy()}},[n,r,t,i,e,o]),c}const Gh=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Vs(){const e=oe();return b.useCallback(n=>{const{nodeExtent:r,snapToGrid:o,snapGrid:i,nodesDraggable:s,onError:a,updateNodePositions:c,nodeLookup:u,nodeOrigin:l}=e.getState(),f=new Map,d=Gh(s),h=o?i[0]:5,m=o?i[1]:5,p=n.direction.x*h*n.factor,v=n.direction.y*m*n.factor;for(const[,w]of u){if(!d(w))continue;let E={x:w.internals.positionAbsolute.x+p,y:w.internals.positionAbsolute.y+v};o&&(E=Bn(E,i));const{position:g,positionAbsolute:y}=cs({nodeId:w.id,nextPosition:E,nodeLookup:u,nodeExtent:r,nodeOrigin:l,onError:a});w.position=g,w.internals.positionAbsolute=y,f.set(w.id,w)}c(f)},[])}const to=b.createContext(null),Kh=to.Provider;to.Consumer;const Xs=()=>b.useContext(to),Zh=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Jh=(e,t,n)=>r=>{const{connectionClickStartHandle:o,connectionMode:i,connection:s}=r,{fromHandle:a,toHandle:c,isValid:u}=s,l=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:l,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===n,isPossibleEndHandle:i===Ct.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!o,valid:l&&u}};function Qh({type:e="source",position:t=K.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:i=!0,id:s,onConnect:a,children:c,className:u,onMouseDown:l,onTouchStart:f,...d},h){var k,A;const m=s||null,p=e==="target",v=oe(),w=Xs(),{connectOnClick:E,noPanClassName:g,rfId:y}=ee(Zh,ie),{connectingFrom:_,connectingTo:C,clickConnecting:M,isPossibleEndHandle:N,connectionInProcess:T,clickConnectionInProcess:O,valid:R}=ee(Jh(w,m,e),ie);w||(A=(k=v.getState()).onError)==null||A.call(k,"010",Oe.error010());const P=D=>{const{defaultEdgeOptions:$,onConnect:I,hasDefaultEdges:L}=v.getState(),z={...$,...D};if(L){const{edges:F,setEdges:V}=v.getState();V(ws(z,F))}I==null||I(z),a==null||a(z)},j=D=>{if(!w)return;const $=ms(D.nativeEvent);if(o&&($&&D.button===0||!$)){const I=v.getState();kr.onPointerDown(D.nativeEvent,{autoPanOnConnect:I.autoPanOnConnect,connectionMode:I.connectionMode,connectionRadius:I.connectionRadius,domNode:I.domNode,nodeLookup:I.nodeLookup,lib:I.lib,isTarget:p,handleId:m,nodeId:w,flowId:I.rfId,panBy:I.panBy,cancelConnection:I.cancelConnection,onConnectStart:I.onConnectStart,onConnectEnd:I.onConnectEnd,updateConnection:I.updateConnection,onConnect:P,isValidConnection:n||I.isValidConnection,getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,autoPanSpeed:I.autoPanSpeed,dragThreshold:I.connectionDragThreshold})}$?l==null||l(D):f==null||f(D)},S=D=>{const{onClickConnectStart:$,onClickConnectEnd:I,connectionClickStartHandle:L,connectionMode:z,isValidConnection:F,lib:V,rfId:B,nodeLookup:W,connection:X}=v.getState();if(!w||!L&&!o)return;if(!L){$==null||$(D.nativeEvent,{nodeId:w,handleId:m,handleType:e}),v.setState({connectionClickStartHandle:{nodeId:w,type:e,id:m}});return}const U=gs(D.target),H=n||F,{connection:q,isValid:Y}=kr.isValid(D.nativeEvent,{handle:{nodeId:w,id:m,type:e},connectionMode:z,fromNodeId:L.nodeId,fromHandleId:L.id||null,fromType:L.type,isValidConnection:H,flowId:B,doc:U,lib:V,nodeLookup:W});Y&&q&&P(q);const Q=structuredClone(X);delete Q.inProgress,Q.toPosition=Q.toHandle?Q.toHandle.position:null,I==null||I(D,Q),v.setState({connectionClickStartHandle:null})};return x.jsx("div",{"data-handleid":m,"data-nodeid":w,"data-handlepos":t,"data-id":`${y}-${w}-${m}-${e}`,className:ae(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",g,u,{source:!p,target:p,connectable:r,connectablestart:o,connectableend:i,clickconnecting:M,connectingfrom:_,connectingto:C,valid:R,connectionindicator:r&&(!T||N)&&(T||O?i:o)}]),onMouseDown:j,onTouchStart:j,onClick:E?S:void 0,ref:h,...d,children:c})}const Ue=b.memo(Fs(Qh));function eg({data:e,isConnectable:t,sourcePosition:n=K.Bottom}){return x.jsxs(x.Fragment,{children:[e==null?void 0:e.label,x.jsx(Ue,{type:"source",position:n,isConnectable:t})]})}function tg({data:e,isConnectable:t,targetPosition:n=K.Top,sourcePosition:r=K.Bottom}){return x.jsxs(x.Fragment,{children:[x.jsx(Ue,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,x.jsx(Ue,{type:"source",position:r,isConnectable:t})]})}function ng(){return null}function rg({data:e,isConnectable:t,targetPosition:n=K.Top}){return x.jsxs(x.Fragment,{children:[x.jsx(Ue,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const kn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},oi={input:eg,default:tg,output:rg,group:ng};function og(e){var t,n,r,o;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((r=e.style)==null?void 0:r.width),height:e.height??((o=e.style)==null?void 0:o.height)}}const ig=e=>{const{width:t,height:n,x:r,y:o}=en(e.nodeLookup,{filter:i=>!!i.selected});return{width:Ie(t)?t:null,height:Ie(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${o}px)`}};function sg({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=oe(),{width:o,height:i,transformString:s,userSelectionActive:a}=ee(ig,ie),c=Vs(),u=b.useRef(null);if(b.useEffect(()=>{var d;n||(d=u.current)==null||d.focus({preventScroll:!0})},[n]),Hs({nodeRef:u}),a||!o||!i)return null;const l=e?d=>{const h=r.getState().nodes.filter(m=>m.selected);e(d,h)}:void 0,f=d=>{Object.prototype.hasOwnProperty.call(kn,d.key)&&(d.preventDefault(),c({direction:kn[d.key],factor:d.shiftKey?4:1}))};return x.jsx("div",{className:ae(["react-flow__nodesselection","react-flow__container",t]),style:{transform:s},children:x.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:n?void 0:-1,onKeyDown:n?void 0:f,style:{width:o,height:i}})})}const ii=typeof window<"u"?window:void 0,ag=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Ys({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:u,selectionOnDrag:l,selectionMode:f,onSelectionStart:d,onSelectionEnd:h,multiSelectionKeyCode:m,panActivationKeyCode:p,zoomActivationKeyCode:v,elementsSelectable:w,zoomOnScroll:E,zoomOnPinch:g,panOnScroll:y,panOnScrollSpeed:_,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:N,defaultViewport:T,translateExtent:O,minZoom:R,maxZoom:P,preventScrolling:j,onSelectionContextMenu:S,noWheelClassName:k,noPanClassName:A,disableKeyboardA11y:D,onViewportChange:$,isControlledViewport:I}){const{nodesSelectionActive:L,userSelectionActive:z}=ee(ag),F=qt(u,{target:ii}),V=qt(p,{target:ii}),B=V||N,W=V||y,X=l&&B!==!0,U=F||z||X;return Bh({deleteKeyCode:c,multiSelectionKeyCode:m}),x.jsx(Xh,{onPaneContextMenu:i,elementsSelectable:w,zoomOnScroll:E,zoomOnPinch:g,panOnScroll:W,panOnScrollSpeed:_,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:!F&&B,defaultViewport:T,translateExtent:O,minZoom:R,maxZoom:P,zoomActivationKeyCode:v,preventScrolling:j,noWheelClassName:k,noPanClassName:A,onViewportChange:$,isControlledViewport:I,paneClickDistance:a,children:x.jsxs(qh,{onSelectionStart:d,onSelectionEnd:h,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,panOnDrag:B,isSelecting:!!U,selectionMode:f,selectionKeyPressed:F,selectionOnDrag:X,children:[e,L&&x.jsx(sg,{onSelectionContextMenu:S,noPanClassName:A,disableKeyboardA11y:D})]})})}Ys.displayName="FlowRenderer";const cg=b.memo(Ys),lg=e=>t=>e?Ur(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function ug(e){return ee(b.useCallback(lg(e),[e]),ie)}const dg=e=>e.updateNodeInternals;function fg(){const e=ee(dg),[t]=b.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(o=>{const i=o.target.getAttribute("data-id");r.set(i,{id:i,nodeElement:o.target,force:!0})}),e(r)}));return b.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function hg({node:e,nodeType:t,hasDimensions:n,resizeObserver:r}){const o=oe(),i=b.useRef(null),s=b.useRef(null),a=b.useRef(e.sourcePosition),c=b.useRef(e.targetPosition),u=b.useRef(t),l=n&&!!e.internals.handleBounds;return b.useEffect(()=>{i.current&&!e.hidden&&(!l||s.current!==i.current)&&(s.current&&(r==null||r.unobserve(s.current)),r==null||r.observe(i.current),s.current=i.current)},[l,e.hidden]),b.useEffect(()=>()=>{s.current&&(r==null||r.unobserve(s.current),s.current=null)},[]),b.useEffect(()=>{if(i.current){const f=u.current!==t,d=a.current!==e.sourcePosition,h=c.current!==e.targetPosition;(f||d||h)&&(u.current=t,a.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function gg({id:e,onClick:t,onMouseEnter:n,onMouseMove:r,onMouseLeave:o,onContextMenu:i,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:u,nodesFocusable:l,resizeObserver:f,noDragClassName:d,noPanClassName:h,disableKeyboardA11y:m,rfId:p,nodeTypes:v,nodeClickDistance:w,onError:E}){const{node:g,internals:y,isParent:_}=ee(H=>{const q=H.nodeLookup.get(e),Y=H.parentLookup.has(e);return{node:q,internals:q.internals,isParent:Y}},ie);let C=g.type||"default",M=(v==null?void 0:v[C])||oi[C];M===void 0&&(E==null||E("003",Oe.error003(C)),C="default",M=(v==null?void 0:v.default)||oi.default);const N=!!(g.draggable||a&&typeof g.draggable>"u"),T=!!(g.selectable||c&&typeof g.selectable>"u"),O=!!(g.connectable||u&&typeof g.connectable>"u"),R=!!(g.focusable||l&&typeof g.focusable>"u"),P=oe(),j=fs(g),S=hg({node:g,nodeType:C,hasDimensions:j,resizeObserver:f}),k=Hs({nodeRef:S,disabled:g.hidden||!N,noDragClassName:d,handleSelector:g.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:w}),A=Vs();if(g.hidden)return null;const D=Ge(g),$=og(g),I=T||N||t||n||r||o,L=n?H=>n(H,{...y.userNode}):void 0,z=r?H=>r(H,{...y.userNode}):void 0,F=o?H=>o(H,{...y.userNode}):void 0,V=i?H=>i(H,{...y.userNode}):void 0,B=s?H=>s(H,{...y.userNode}):void 0,W=H=>{const{selectNodesOnDrag:q,nodeDragThreshold:Y}=P.getState();T&&(!q||!N||Y>0)&&Rr({id:e,store:P,nodeRef:S}),t&&t(H,{...y.userNode})},X=H=>{if(!(ps(H.nativeEvent)||m)){if(rs.includes(H.key)&&T){const q=H.key==="Escape";Rr({id:e,store:P,unselect:q,nodeRef:S})}else if(N&&g.selected&&Object.prototype.hasOwnProperty.call(kn,H.key)){H.preventDefault();const{ariaLabelConfig:q}=P.getState();P.setState({ariaLiveMessage:q["node.a11yDescription.ariaLiveMessage"]({direction:H.key.replace("Arrow","").toLowerCase(),x:~~y.positionAbsolute.x,y:~~y.positionAbsolute.y})}),A({direction:kn[H.key],factor:H.shiftKey?4:1})}}},U=()=>{var Z;if(m||!((Z=S.current)!=null&&Z.matches(":focus-visible")))return;const{transform:H,width:q,height:Y,autoPanOnNodeFocus:Q,setCenter:G}=P.getState();if(!Q)return;Ur(new Map([[e,g]]),{x:0,y:0,width:q,height:Y},H,!0).length>0||G(g.position.x+D.width/2,g.position.y+D.height/2,{zoom:H[2]})};return x.jsx("div",{className:ae(["react-flow__node",`react-flow__node-${C}`,{[h]:N},g.className,{selected:g.selected,selectable:T,parent:_,draggable:N,dragging:k}]),ref:S,style:{zIndex:y.z,transform:`translate(${y.positionAbsolute.x}px,${y.positionAbsolute.y}px)`,pointerEvents:I?"all":"none",visibility:j?"visible":"hidden",...g.style,...$},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:L,onMouseMove:z,onMouseLeave:F,onContextMenu:V,onClick:W,onDoubleClick:B,onKeyDown:R?X:void 0,tabIndex:R?0:void 0,onFocus:R?U:void 0,role:g.ariaRole??(R?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${Ps}-${p}`,"aria-label":g.ariaLabel,...g.domAttributes,children:x.jsx(Kh,{value:e,children:x.jsx(M,{id:e,data:g.data,type:C,positionAbsoluteX:y.positionAbsolute.x,positionAbsoluteY:y.positionAbsolute.y,selected:g.selected??!1,selectable:T,draggable:N,deletable:g.deletable??!0,isConnectable:O,sourcePosition:g.sourcePosition,targetPosition:g.targetPosition,dragging:k,dragHandle:g.dragHandle,zIndex:y.z,parentId:g.parentId,...D})})})}const pg=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Ws(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,onError:i}=ee(pg,ie),s=ug(e.onlyRenderVisibleElements),a=fg();return x.jsx("div",{className:"react-flow__nodes",style:Yn,children:s.map(c=>x.jsx(gg,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:i},c))})}Ws.displayName="NodeRenderer";const mg=b.memo(Ws);function yg(e){return ee(b.useCallback(n=>{if(!e)return n.edges.map(o=>o.id);const r=[];if(n.width&&n.height)for(const o of n.edges){const i=n.nodeLookup.get(o.source),s=n.nodeLookup.get(o.target);i&&s&&xf({sourceNode:i,targetNode:s,width:n.width,height:n.height,transform:n.transform})&&r.push(o.id)}return r},[e]),ie)}const xg=({color:e="none",strokeWidth:t=1})=>x.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),vg=({color:e="none",strokeWidth:t=1})=>x.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),si={[Nn.Arrow]:xg,[Nn.ArrowClosed]:vg};function wg(e){const t=oe();return b.useMemo(()=>{var o,i;return Object.prototype.hasOwnProperty.call(si,e)?si[e]:((i=(o=t.getState()).onError)==null||i.call(o,"009",Oe.error009(e)),null)},[e])}const bg=({id:e,type:t,color:n,width:r=12.5,height:o=12.5,markerUnits:i="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=wg(t);return c?x.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0",children:x.jsx(c,{color:n,strokeWidth:s})}):null},Us=({defaultColor:e,rfId:t})=>{const n=ee(i=>i.edges),r=ee(i=>i.defaultEdgeOptions),o=b.useMemo(()=>Cf(n,{id:t,defaultColor:e,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,t,e]);return o.length?x.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:x.jsx("defs",{children:o.map(i=>x.jsx(bg,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};Us.displayName="MarkerDefinitions";var Sg=b.memo(Us);function qs({x:e,y:t,label:n,labelStyle:r,labelShowBg:o=!0,labelBgStyle:i,labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:u,...l}){const[f,d]=b.useState({x:1,y:0,width:0,height:0}),h=ae(["react-flow__edge-textwrapper",u]),m=b.useRef(null);return b.useEffect(()=>{if(m.current){const p=m.current.getBBox();d({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?x.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:h,visibility:f.width?"visible":"hidden",...l,children:[o&&x.jsx("rect",{width:f.width+2*s[0],x:-s[0],y:-s[1],height:f.height+2*s[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),x.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]}):null}qs.displayName="EdgeText";const _g=b.memo(qs);function Wn({path:e,labelX:t,labelY:n,label:r,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c,interactionWidth:u=20,...l}){return x.jsxs(x.Fragment,{children:[x.jsx("path",{...l,d:e,fill:"none",className:ae(["react-flow__edge-path",l.className])}),u&&x.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}),r&&Ie(t)&&Ie(n)?x.jsx(_g,{x:t,y:n,label:r,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c}):null]})}function ai({pos:e,x1:t,y1:n,x2:r,y2:o}){return e===K.Left||e===K.Right?[.5*(t+r),n]:[t,.5*(n+o)]}function Gs({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top}){const[s,a]=ai({pos:n,x1:e,y1:t,x2:r,y2:o}),[c,u]=ai({pos:i,x1:r,y1:o,x2:e,y2:t}),[l,f,d,h]=ys({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:u});return[`M${e},${t} C${s},${a} ${c},${u} ${r},${o}`,l,f,d,h]}function Ks(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,sourcePosition:s,targetPosition:a,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:v,interactionWidth:w})=>{const[E,g,y]=Gs({sourceX:n,sourceY:r,sourcePosition:s,targetX:o,targetY:i,targetPosition:a}),_=e.isInternal?void 0:t;return x.jsx(Wn,{id:_,path:E,labelX:g,labelY:y,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:v,interactionWidth:w})})}const Eg=Ks({isInternal:!1}),Zs=Ks({isInternal:!0});Eg.displayName="SimpleBezierEdge";Zs.displayName="SimpleBezierEdgeInternal";function Js(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,sourcePosition:h=K.Bottom,targetPosition:m=K.Top,markerEnd:p,markerStart:v,pathOptions:w,interactionWidth:E})=>{const[g,y,_]=Ar({sourceX:n,sourceY:r,sourcePosition:h,targetX:o,targetY:i,targetPosition:m,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset,stepPosition:w==null?void 0:w.stepPosition}),C=e.isInternal?void 0:t;return x.jsx(Wn,{id:C,path:g,labelX:y,labelY:_,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,markerEnd:p,markerStart:v,interactionWidth:E})})}const Qs=Js({isInternal:!1}),ea=Js({isInternal:!0});Qs.displayName="SmoothStepEdge";ea.displayName="SmoothStepEdgeInternal";function ta(e){return b.memo(({id:t,...n})=>{var o;const r=e.isInternal?void 0:t;return x.jsx(Qs,{...n,id:r,pathOptions:b.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const Cg=ta({isInternal:!1}),na=ta({isInternal:!0});Cg.displayName="StepEdge";na.displayName="StepEdgeInternal";function ra(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,markerEnd:h,markerStart:m,interactionWidth:p})=>{const[v,w,E]=bs({sourceX:n,sourceY:r,targetX:o,targetY:i}),g=e.isInternal?void 0:t;return x.jsx(Wn,{id:g,path:v,labelX:w,labelY:E,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,markerEnd:h,markerStart:m,interactionWidth:p})})}const Mg=ra({isInternal:!1}),oa=ra({isInternal:!0});Mg.displayName="StraightEdge";oa.displayName="StraightEdgeInternal";function ia(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,sourcePosition:s=K.Bottom,targetPosition:a=K.Top,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:v,pathOptions:w,interactionWidth:E})=>{const[g,y,_]=xs({sourceX:n,sourceY:r,sourcePosition:s,targetX:o,targetY:i,targetPosition:a,curvature:w==null?void 0:w.curvature}),C=e.isInternal?void 0:t;return x.jsx(Wn,{id:C,path:g,labelX:y,labelY:_,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:v,interactionWidth:E})})}const Ng=ia({isInternal:!1}),sa=ia({isInternal:!0});Ng.displayName="BezierEdge";sa.displayName="BezierEdgeInternal";const ci={default:sa,straight:oa,step:na,smoothstep:ea,simplebezier:Zs},li={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Ag=(e,t,n)=>n===K.Left?e-t:n===K.Right?e+t:e,Dg=(e,t,n)=>n===K.Top?e-t:n===K.Bottom?e+t:e,ui="react-flow__edgeupdater";function di({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:i,onMouseOut:s,type:a}){return x.jsx("circle",{onMouseDown:o,onMouseEnter:i,onMouseOut:s,className:ae([ui,`${ui}-${a}`]),cx:Ag(t,r,e),cy:Dg(n,r,e),r,stroke:"transparent",fill:"transparent"})}function Ig({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:r,sourceY:o,targetX:i,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:u,onReconnectStart:l,onReconnectEnd:f,setReconnecting:d,setUpdateHover:h}){const m=oe(),p=(y,_)=>{if(y.button!==0)return;const{autoPanOnConnect:C,domNode:M,isValidConnection:N,connectionMode:T,connectionRadius:O,lib:R,onConnectStart:P,onConnectEnd:j,cancelConnection:S,nodeLookup:k,rfId:A,panBy:D,updateConnection:$}=m.getState(),I=_.type==="target",L=(V,B)=>{d(!1),f==null||f(V,n,_.type,B)},z=V=>u==null?void 0:u(n,V),F=(V,B)=>{d(!0),l==null||l(y,n,_.type),P==null||P(V,B)};kr.onPointerDown(y.nativeEvent,{autoPanOnConnect:C,connectionMode:T,connectionRadius:O,domNode:M,handleId:_.id,nodeId:_.nodeId,nodeLookup:k,isTarget:I,edgeUpdaterType:_.type,lib:R,flowId:A,cancelConnection:S,panBy:D,isValidConnection:N,onConnect:z,onConnectStart:F,onConnectEnd:j,onReconnectEnd:L,updateConnection:$,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold})},v=y=>p(y,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),w=y=>p(y,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),E=()=>h(!0),g=()=>h(!1);return x.jsxs(x.Fragment,{children:[(e===!0||e==="source")&&x.jsx(di,{position:a,centerX:r,centerY:o,radius:t,onMouseDown:v,onMouseEnter:E,onMouseOut:g,type:"source"}),(e===!0||e==="target")&&x.jsx(di,{position:c,centerX:i,centerY:s,radius:t,onMouseDown:w,onMouseEnter:E,onMouseOut:g,type:"target"})]})}function kg({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:r,onClick:o,onDoubleClick:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,reconnectRadius:l,onReconnect:f,onReconnectStart:d,onReconnectEnd:h,rfId:m,edgeTypes:p,noPanClassName:v,onError:w,disableKeyboardA11y:E}){let g=ee(G=>G.edgeLookup.get(e));const y=ee(G=>G.defaultEdgeOptions);g=y?{...y,...g}:g;let _=g.type||"default",C=(p==null?void 0:p[_])||ci[_];C===void 0&&(w==null||w("011",Oe.error011(_)),_="default",C=(p==null?void 0:p.default)||ci.default);const M=!!(g.focusable||t&&typeof g.focusable>"u"),N=typeof f<"u"&&(g.reconnectable||n&&typeof g.reconnectable>"u"),T=!!(g.selectable||r&&typeof g.selectable>"u"),O=b.useRef(null),[R,P]=b.useState(!1),[j,S]=b.useState(!1),k=oe(),{zIndex:A,sourceX:D,sourceY:$,targetX:I,targetY:L,sourcePosition:z,targetPosition:F}=ee(b.useCallback(G=>{const J=G.nodeLookup.get(g.source),Z=G.nodeLookup.get(g.target);if(!J||!Z)return{zIndex:g.zIndex,...li};const te=Ef({id:e,sourceNode:J,targetNode:Z,sourceHandle:g.sourceHandle||null,targetHandle:g.targetHandle||null,connectionMode:G.connectionMode,onError:w});return{zIndex:yf({selected:g.selected,zIndex:g.zIndex,sourceNode:J,targetNode:Z,elevateOnSelect:G.elevateEdgesOnSelect}),...te||li}},[g.source,g.target,g.sourceHandle,g.targetHandle,g.selected,g.zIndex]),ie),V=b.useMemo(()=>g.markerStart?`url('#${Dr(g.markerStart,m)}')`:void 0,[g.markerStart,m]),B=b.useMemo(()=>g.markerEnd?`url('#${Dr(g.markerEnd,m)}')`:void 0,[g.markerEnd,m]);if(g.hidden||D===null||$===null||I===null||L===null)return null;const W=G=>{var re;const{addSelectedEdges:J,unselectNodesAndEdges:Z,multiSelectionActive:te}=k.getState();T&&(k.setState({nodesSelectionActive:!1}),g.selected&&te?(Z({nodes:[],edges:[g]}),(re=O.current)==null||re.blur()):J([e])),o&&o(G,g)},X=i?G=>{i(G,{...g})}:void 0,U=s?G=>{s(G,{...g})}:void 0,H=a?G=>{a(G,{...g})}:void 0,q=c?G=>{c(G,{...g})}:void 0,Y=u?G=>{u(G,{...g})}:void 0,Q=G=>{var J;if(!E&&rs.includes(G.key)&&T){const{unselectNodesAndEdges:Z,addSelectedEdges:te}=k.getState();G.key==="Escape"?((J=O.current)==null||J.blur(),Z({edges:[g]})):te([e])}};return x.jsx("svg",{style:{zIndex:A},children:x.jsxs("g",{className:ae(["react-flow__edge",`react-flow__edge-${_}`,g.className,v,{selected:g.selected,animated:g.animated,inactive:!T&&!o,updating:R,selectable:T}]),onClick:W,onDoubleClick:X,onContextMenu:U,onMouseEnter:H,onMouseMove:q,onMouseLeave:Y,onKeyDown:M?Q:void 0,tabIndex:M?0:void 0,role:g.ariaRole??(M?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":g.ariaLabel===null?void 0:g.ariaLabel||`Edge from ${g.source} to ${g.target}`,"aria-describedby":M?`${js}-${m}`:void 0,ref:O,...g.domAttributes,children:[!j&&x.jsx(C,{id:e,source:g.source,target:g.target,type:g.type,selected:g.selected,animated:g.animated,selectable:T,deletable:g.deletable??!0,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,sourceX:D,sourceY:$,targetX:I,targetY:L,sourcePosition:z,targetPosition:F,data:g.data,style:g.style,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerStart:V,markerEnd:B,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth}),N&&x.jsx(Ig,{edge:g,isReconnectable:N,reconnectRadius:l,onReconnect:f,onReconnectStart:d,onReconnectEnd:h,sourceX:D,sourceY:$,targetX:I,targetY:L,sourcePosition:z,targetPosition:F,setUpdateHover:P,setReconnecting:S})]})})}const Rg=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function aa({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:r,noPanClassName:o,onReconnect:i,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:u,onEdgeClick:l,reconnectRadius:f,onEdgeDoubleClick:d,onReconnectStart:h,onReconnectEnd:m,disableKeyboardA11y:p}){const{edgesFocusable:v,edgesReconnectable:w,elementsSelectable:E,onError:g}=ee(Rg,ie),y=yg(t);return x.jsxs("div",{className:"react-flow__edges",children:[x.jsx(Sg,{defaultColor:e,rfId:n}),y.map(_=>x.jsx(kg,{id:_,edgesFocusable:v,edgesReconnectable:w,elementsSelectable:E,noPanClassName:o,onReconnect:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,onClick:l,reconnectRadius:f,onDoubleClick:d,onReconnectStart:h,onReconnectEnd:m,rfId:n,onError:g,edgeTypes:r,disableKeyboardA11y:p},_))]})}aa.displayName="EdgeRenderer";const Tg=b.memo(aa),Pg=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function jg({children:e}){const t=ee(Pg);return x.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function $g(e){const t=eo(),n=b.useRef(!1);b.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Lg=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function zg(e){const t=ee(Lg),n=oe();return b.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Og(e){return e.connection.inProgress?{...e.connection,to:tn(e.connection.to,e.transform)}:{...e.connection}}function Fg(e){return Og}function Bg(e){const t=Fg();return ee(t,ie)}const Hg=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Vg({containerStyle:e,style:t,type:n,component:r}){const{nodesConnectable:o,width:i,height:s,isValid:a,inProgress:c}=ee(Hg,ie);return!(i&&o&&c)?null:x.jsx("svg",{style:e,width:i,height:s,className:"react-flow__connectionline react-flow__container",children:x.jsx("g",{className:ae(["react-flow__connection",ss(a)]),children:x.jsx(ca,{style:t,type:n,CustomComponent:r,isValid:a})})})}const ca=({style:e,type:t=rt.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:o,from:i,fromNode:s,fromHandle:a,fromPosition:c,to:u,toNode:l,toHandle:f,toPosition:d}=Bg();if(!o)return;if(n)return x.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:s,fromHandle:a,fromX:i.x,fromY:i.y,toX:u.x,toY:u.y,fromPosition:c,toPosition:d,connectionStatus:ss(r),toNode:l,toHandle:f});let h="";const m={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:u.x,targetY:u.y,targetPosition:d};switch(t){case rt.Bezier:[h]=xs(m);break;case rt.SimpleBezier:[h]=Gs(m);break;case rt.Step:[h]=Ar({...m,borderRadius:0});break;case rt.SmoothStep:[h]=Ar(m);break;default:[h]=bs(m)}return x.jsx("path",{d:h,fill:"none",className:"react-flow__connection-path",style:e})};ca.displayName="ConnectionLine";const Xg={};function fi(e=Xg){b.useRef(e),oe(),b.useEffect(()=>{},[e])}function Yg(){oe(),b.useRef(!1),b.useEffect(()=>{},[])}function la({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:i,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:l,onSelectionContextMenu:f,onSelectionStart:d,onSelectionEnd:h,connectionLineType:m,connectionLineStyle:p,connectionLineComponent:v,connectionLineContainerStyle:w,selectionKeyCode:E,selectionOnDrag:g,selectionMode:y,multiSelectionKeyCode:_,panActivationKeyCode:C,zoomActivationKeyCode:M,deleteKeyCode:N,onlyRenderVisibleElements:T,elementsSelectable:O,defaultViewport:R,translateExtent:P,minZoom:j,maxZoom:S,preventScrolling:k,defaultMarkerColor:A,zoomOnScroll:D,zoomOnPinch:$,panOnScroll:I,panOnScrollSpeed:L,panOnScrollMode:z,zoomOnDoubleClick:F,panOnDrag:V,onPaneClick:B,onPaneMouseEnter:W,onPaneMouseMove:X,onPaneMouseLeave:U,onPaneScroll:H,onPaneContextMenu:q,paneClickDistance:Y,nodeClickDistance:Q,onEdgeContextMenu:G,onEdgeMouseEnter:J,onEdgeMouseMove:Z,onEdgeMouseLeave:te,reconnectRadius:re,onReconnect:Se,onReconnectStart:He,onReconnectEnd:Ke,noDragClassName:xe,noWheelClassName:Ve,noPanClassName:Te,disableKeyboardA11y:Ze,nodeExtent:pt,rfId:mt,viewport:Je,onViewportChange:_e}){return fi(e),fi(t),Yg(),$g(n),zg(Je),x.jsx(cg,{onPaneClick:B,onPaneMouseEnter:W,onPaneMouseMove:X,onPaneMouseLeave:U,onPaneContextMenu:q,onPaneScroll:H,paneClickDistance:Y,deleteKeyCode:N,selectionKeyCode:E,selectionOnDrag:g,selectionMode:y,onSelectionStart:d,onSelectionEnd:h,multiSelectionKeyCode:_,panActivationKeyCode:C,zoomActivationKeyCode:M,elementsSelectable:O,zoomOnScroll:D,zoomOnPinch:$,zoomOnDoubleClick:F,panOnScroll:I,panOnScrollSpeed:L,panOnScrollMode:z,panOnDrag:V,defaultViewport:R,translateExtent:P,minZoom:j,maxZoom:S,onSelectionContextMenu:f,preventScrolling:k,noDragClassName:xe,noWheelClassName:Ve,noPanClassName:Te,disableKeyboardA11y:Ze,onViewportChange:_e,isControlledViewport:!!Je,children:x.jsxs(jg,{children:[x.jsx(Tg,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:s,onReconnect:Se,onReconnectStart:He,onReconnectEnd:Ke,onlyRenderVisibleElements:T,onEdgeContextMenu:G,onEdgeMouseEnter:J,onEdgeMouseMove:Z,onEdgeMouseLeave:te,reconnectRadius:re,defaultMarkerColor:A,noPanClassName:Te,disableKeyboardA11y:Ze,rfId:mt}),x.jsx(Vg,{style:p,type:m,component:v,containerStyle:w}),x.jsx("div",{className:"react-flow__edgelabel-renderer"}),x.jsx(mg,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:l,nodeClickDistance:Q,onlyRenderVisibleElements:T,noPanClassName:Te,noDragClassName:xe,disableKeyboardA11y:Ze,nodeExtent:pt,rfId:mt}),x.jsx("div",{className:"react-flow__viewport-portal"})]})})}la.displayName="GraphView";const Wg=b.memo(la),hi=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c=.5,maxZoom:u=2,nodeOrigin:l,nodeExtent:f}={})=>{const d=new Map,h=new Map,m=new Map,p=new Map,v=r??t??[],w=n??e??[],E=l??[0,0],g=f??Xt;_s(m,p,v);const y=Ir(w,d,h,{nodeOrigin:E,nodeExtent:g,elevateNodesOnSelect:!1});let _=[0,0,1];if(s&&o&&i){const C=en(d,{filter:O=>!!((O.width||O.initialWidth)&&(O.height||O.initialHeight))}),{x:M,y:N,zoom:T}=qr(C,o,i,c,u,(a==null?void 0:a.padding)??.1);_=[M,N,T]}return{rfId:"1",width:0,height:0,transform:_,nodes:w,nodesInitialized:y,nodeLookup:d,parentLookup:h,edges:v,edgeLookup:p,connectionLookup:m,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:u,translateExtent:Xt,nodeExtent:g,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Ct.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:E,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:a,fitViewResolver:null,connection:{...is},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:df,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:os}},Ug=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:l,nodeExtent:f})=>hh((d,h)=>{async function m(){const{nodeLookup:p,panZoom:v,fitViewOptions:w,fitViewResolver:E,width:g,height:y,minZoom:_,maxZoom:C}=h();v&&(await lf({nodes:p,width:g,height:y,panZoom:v,minZoom:_,maxZoom:C},w),E==null||E.resolve(!0),d({fitViewResolver:null}))}return{...hi({nodes:e,edges:t,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:l,nodeExtent:f,defaultNodes:n,defaultEdges:r}),setNodes:p=>{const{nodeLookup:v,parentLookup:w,nodeOrigin:E,elevateNodesOnSelect:g,fitViewQueued:y}=h(),_=Ir(p,v,w,{nodeOrigin:E,nodeExtent:f,elevateNodesOnSelect:g,checkEquality:!0});y&&_?(m(),d({nodes:p,nodesInitialized:_,fitViewQueued:!1,fitViewOptions:void 0})):d({nodes:p,nodesInitialized:_})},setEdges:p=>{const{connectionLookup:v,edgeLookup:w}=h();_s(v,w,p),d({edges:p})},setDefaultNodesAndEdges:(p,v)=>{if(p){const{setNodes:w}=h();w(p),d({hasDefaultNodes:!0})}if(v){const{setEdges:w}=h();w(v),d({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:v,nodeLookup:w,parentLookup:E,domNode:g,nodeOrigin:y,nodeExtent:_,debug:C,fitViewQueued:M}=h(),{changes:N,updatedInternals:T}=If(p,w,E,g,y,_);T&&(Nf(w,E,{nodeOrigin:y,nodeExtent:_}),M?(m(),d({fitViewQueued:!1,fitViewOptions:void 0})):d({}),(N==null?void 0:N.length)>0&&(C&&console.log("React Flow: trigger node changes",N),v==null||v(N)))},updateNodePositions:(p,v=!1)=>{const w=[],E=[],{nodeLookup:g,triggerNodeChanges:y}=h();for(const[_,C]of p){const M=g.get(_),N=!!(M!=null&&M.expandParent&&(M!=null&&M.parentId)&&(C!=null&&C.position)),T={id:_,type:"position",position:N?{x:Math.max(0,C.position.x),y:Math.max(0,C.position.y)}:C.position,dragging:v};N&&M.parentId&&w.push({id:_,parentId:M.parentId,rect:{...C.internals.positionAbsolute,width:C.measured.width??0,height:C.measured.height??0}}),E.push(T)}if(w.length>0){const{parentLookup:_,nodeOrigin:C}=h(),M=Qr(w,g,_,C);E.push(...M)}y(E)},triggerNodeChanges:p=>{const{onNodesChange:v,setNodes:w,nodes:E,hasDefaultNodes:g,debug:y}=h();if(p!=null&&p.length){if(g){const _=zs(p,E);w(_)}y&&console.log("React Flow: trigger node changes",p),v==null||v(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:v,setEdges:w,edges:E,hasDefaultEdges:g,debug:y}=h();if(p!=null&&p.length){if(g){const _=Os(p,E);w(_)}y&&console.log("React Flow: trigger edge changes",p),v==null||v(p)}},addSelectedNodes:p=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:E,triggerNodeChanges:g,triggerEdgeChanges:y}=h();if(v){const _=p.map(C=>dt(C,!0));g(_);return}g(wt(E,new Set([...p]),!0)),y(wt(w))},addSelectedEdges:p=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:E,triggerNodeChanges:g,triggerEdgeChanges:y}=h();if(v){const _=p.map(C=>dt(C,!0));y(_);return}y(wt(w,new Set([...p]))),g(wt(E,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:v}={})=>{const{edges:w,nodes:E,nodeLookup:g,triggerNodeChanges:y,triggerEdgeChanges:_}=h(),C=p||E,M=v||w,N=C.map(O=>{const R=g.get(O.id);return R&&(R.selected=!1),dt(O.id,!1)}),T=M.map(O=>dt(O.id,!1));y(N),_(T)},setMinZoom:p=>{const{panZoom:v,maxZoom:w}=h();v==null||v.setScaleExtent([p,w]),d({minZoom:p})},setMaxZoom:p=>{const{panZoom:v,minZoom:w}=h();v==null||v.setScaleExtent([w,p]),d({maxZoom:p})},setTranslateExtent:p=>{var v;(v=h().panZoom)==null||v.setTranslateExtent(p),d({translateExtent:p})},setPaneClickDistance:p=>{var v;(v=h().panZoom)==null||v.setClickDistance(p)},resetSelectedElements:()=>{const{edges:p,nodes:v,triggerNodeChanges:w,triggerEdgeChanges:E,elementsSelectable:g}=h();if(!g)return;const y=v.reduce((C,M)=>M.selected?[...C,dt(M.id,!1)]:C,[]),_=p.reduce((C,M)=>M.selected?[...C,dt(M.id,!1)]:C,[]);w(y),E(_)},setNodeExtent:p=>{const{nodes:v,nodeLookup:w,parentLookup:E,nodeOrigin:g,elevateNodesOnSelect:y,nodeExtent:_}=h();p[0][0]===_[0][0]&&p[0][1]===_[0][1]&&p[1][0]===_[1][0]&&p[1][1]===_[1][1]||(Ir(v,w,E,{nodeOrigin:g,nodeExtent:p,elevateNodesOnSelect:y,checkEquality:!1}),d({nodeExtent:p}))},panBy:p=>{const{transform:v,width:w,height:E,panZoom:g,translateExtent:y}=h();return kf({delta:p,panZoom:g,transform:v,translateExtent:y,width:w,height:E})},setCenter:async(p,v,w)=>{const{width:E,height:g,maxZoom:y,panZoom:_}=h();if(!_)return Promise.resolve(!1);const C=typeof(w==null?void 0:w.zoom)<"u"?w.zoom:y;return await _.setViewport({x:E/2-p*C,y:g/2-v*C,zoom:C},{duration:w==null?void 0:w.duration,ease:w==null?void 0:w.ease,interpolate:w==null?void 0:w.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{d({connection:{...is}})},updateConnection:p=>{d({connection:p})},reset:()=>d({...hi()})}},Object.is);function qg({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:r,initialWidth:o,initialHeight:i,initialMinZoom:s,initialMaxZoom:a,initialFitViewOptions:c,fitView:u,nodeOrigin:l,nodeExtent:f,children:d}){const[h]=b.useState(()=>Ug({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:u,minZoom:s,maxZoom:a,fitViewOptions:c,nodeOrigin:l,nodeExtent:f}));return x.jsx(gh,{value:h,children:x.jsx(Lh,{children:d})})}function Gg({children:e,nodes:t,edges:n,defaultNodes:r,defaultEdges:o,width:i,height:s,fitView:a,fitViewOptions:c,minZoom:u,maxZoom:l,nodeOrigin:f,nodeExtent:d}){return b.useContext(Vn)?x.jsx(x.Fragment,{children:e}):x.jsx(qg,{initialNodes:t,initialEdges:n,defaultNodes:r,defaultEdges:o,initialWidth:i,initialHeight:s,fitView:a,initialFitViewOptions:c,initialMinZoom:u,initialMaxZoom:l,nodeOrigin:f,nodeExtent:d,children:e})}const Kg={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Zg({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:i,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:u,onMove:l,onMoveStart:f,onMoveEnd:d,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:v,onClickConnectEnd:w,onNodeMouseEnter:E,onNodeMouseMove:g,onNodeMouseLeave:y,onNodeContextMenu:_,onNodeDoubleClick:C,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:T,onNodesDelete:O,onEdgesDelete:R,onDelete:P,onSelectionChange:j,onSelectionDragStart:S,onSelectionDrag:k,onSelectionDragStop:A,onSelectionContextMenu:D,onSelectionStart:$,onSelectionEnd:I,onBeforeDelete:L,connectionMode:z,connectionLineType:F=rt.Bezier,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:W,deleteKeyCode:X="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:H=!1,selectionMode:q=Yt.Full,panActivationKeyCode:Y="Space",multiSelectionKeyCode:Q=In()?"Meta":"Control",zoomActivationKeyCode:G=In()?"Meta":"Control",snapToGrid:J,snapGrid:Z,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:re,nodesDraggable:Se,autoPanOnNodeFocus:He,nodesConnectable:Ke,nodesFocusable:xe,nodeOrigin:Ve=$s,edgesFocusable:Te,edgesReconnectable:Ze,elementsSelectable:pt=!0,defaultViewport:mt=Nh,minZoom:Je=.5,maxZoom:_e=2,translateExtent:Xe=Xt,preventScrolling:at=!0,nodeExtent:yt,defaultMarkerColor:Pe="#b1b1b7",zoomOnScroll:sn=!0,zoomOnPinch:Kn=!0,panOnScroll:Zn=!1,panOnScrollSpeed:Pt=.5,panOnScrollMode:an=ft.Free,zoomOnDoubleClick:Jn=!0,panOnDrag:cn=!0,onPaneClick:Qn,onPaneMouseEnter:er,onPaneMouseMove:tr,onPaneMouseLeave:ue,onPaneScroll:he,onPaneContextMenu:ge,paneClickDistance:Ne=0,nodeClickDistance:me=0,children:pe,onReconnect:Ee,onReconnectStart:Qe,onReconnectEnd:ce,onEdgeContextMenu:je,onEdgeDoubleClick:Ce,onEdgeMouseEnter:Ae,onEdgeMouseMove:ct,onEdgeMouseLeave:lt,reconnectRadius:$e=10,onNodesChange:ut,onEdgesChange:jt,noDragClassName:Ta="nodrag",noWheelClassName:Pa="nowheel",noPanClassName:fo="nopan",fitView:ho,fitViewOptions:go,connectOnClick:ja,attributionPosition:$a,proOptions:La,defaultEdgeOptions:za,elevateNodesOnSelect:Oa,elevateEdgesOnSelect:Fa,disableKeyboardA11y:po=!1,autoPanOnConnect:Ba,autoPanOnNodeDrag:Ha,autoPanSpeed:Va,connectionRadius:Xa,isValidConnection:Ya,onError:Wa,style:Ua,id:mo,nodeDragThreshold:qa,connectionDragThreshold:Ga,viewport:Ka,onViewportChange:Za,width:Ja,height:Qa,colorMode:ec="light",debug:tc,onScroll:ln,ariaLabelConfig:nc,...rc},oc){const nr=mo||"1",ic=kh(ec),sc=b.useCallback(yo=>{yo.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),ln==null||ln(yo)},[ln]);return x.jsx("div",{"data-testid":"rf__wrapper",...rc,onScroll:sc,style:{...Ua,...Kg},ref:oc,className:ae(["react-flow",o,ic]),id:mo,role:"application",children:x.jsxs(Gg,{nodes:e,edges:t,width:Ja,height:Qa,fitView:ho,fitViewOptions:go,minZoom:Je,maxZoom:_e,nodeOrigin:Ve,nodeExtent:yt,children:[x.jsx(Wg,{onInit:u,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:E,onNodeMouseMove:g,onNodeMouseLeave:y,onNodeContextMenu:_,onNodeDoubleClick:C,nodeTypes:i,edgeTypes:s,connectionLineType:F,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:W,selectionKeyCode:U,selectionOnDrag:H,selectionMode:q,deleteKeyCode:X,multiSelectionKeyCode:Q,panActivationKeyCode:Y,zoomActivationKeyCode:G,onlyRenderVisibleElements:te,defaultViewport:mt,translateExtent:Xe,minZoom:Je,maxZoom:_e,preventScrolling:at,zoomOnScroll:sn,zoomOnPinch:Kn,zoomOnDoubleClick:Jn,panOnScroll:Zn,panOnScrollSpeed:Pt,panOnScrollMode:an,panOnDrag:cn,onPaneClick:Qn,onPaneMouseEnter:er,onPaneMouseMove:tr,onPaneMouseLeave:ue,onPaneScroll:he,onPaneContextMenu:ge,paneClickDistance:Ne,nodeClickDistance:me,onSelectionContextMenu:D,onSelectionStart:$,onSelectionEnd:I,onReconnect:Ee,onReconnectStart:Qe,onReconnectEnd:ce,onEdgeContextMenu:je,onEdgeDoubleClick:Ce,onEdgeMouseEnter:Ae,onEdgeMouseMove:ct,onEdgeMouseLeave:lt,reconnectRadius:$e,defaultMarkerColor:Pe,noDragClassName:Ta,noWheelClassName:Pa,noPanClassName:fo,rfId:nr,disableKeyboardA11y:po,nodeExtent:yt,viewport:Ka,onViewportChange:Za}),x.jsx(Ih,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:v,onClickConnectEnd:w,nodesDraggable:Se,autoPanOnNodeFocus:He,nodesConnectable:Ke,nodesFocusable:xe,edgesFocusable:Te,edgesReconnectable:Ze,elementsSelectable:pt,elevateNodesOnSelect:Oa,elevateEdgesOnSelect:Fa,minZoom:Je,maxZoom:_e,nodeExtent:yt,onNodesChange:ut,onEdgesChange:jt,snapToGrid:J,snapGrid:Z,connectionMode:z,translateExtent:Xe,connectOnClick:ja,defaultEdgeOptions:za,fitView:ho,fitViewOptions:go,onNodesDelete:O,onEdgesDelete:R,onDelete:P,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:T,onSelectionDrag:k,onSelectionDragStart:S,onSelectionDragStop:A,onMove:l,onMoveStart:f,onMoveEnd:d,noPanClassName:fo,nodeOrigin:Ve,rfId:nr,autoPanOnConnect:Ba,autoPanOnNodeDrag:Ha,autoPanSpeed:Va,onError:Wa,connectionRadius:Xa,isValidConnection:Ya,selectNodesOnDrag:re,nodeDragThreshold:qa,connectionDragThreshold:Ga,onBeforeDelete:L,paneClickDistance:Ne,debug:tc,ariaLabelConfig:nc}),x.jsx(Mh,{onSelectionChange:j}),pe,x.jsx(bh,{proOptions:La,position:$a}),x.jsx(wh,{rfId:nr,disableKeyboardA11y:po})]})})}var Jg=Fs(Zg);function Qg({dimensions:e,lineWidth:t,variant:n,className:r}){return x.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:ae(["react-flow__background-pattern",n,r])})}function ep({radius:e,className:t}){return x.jsx("circle",{cx:e,cy:e,r:e,className:ae(["react-flow__background-pattern","dots",t])})}var it;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(it||(it={}));const tp={[it.Dots]:1,[it.Lines]:1,[it.Cross]:6},np=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ua({id:e,variant:t=it.Dots,gap:n=20,size:r,lineWidth:o=1,offset:i=0,color:s,bgColor:a,style:c,className:u,patternClassName:l}){const f=b.useRef(null),{transform:d,patternId:h}=ee(np,ie),m=r||tp[t],p=t===it.Dots,v=t===it.Cross,w=Array.isArray(n)?n:[n,n],E=[w[0]*d[2]||1,w[1]*d[2]||1],g=m*d[2],y=Array.isArray(i)?i:[i,i],_=v?[g,g]:E,C=[y[0]*d[2]||1+_[0]/2,y[1]*d[2]||1+_[1]/2],M=`${h}${e||""}`;return x.jsxs("svg",{className:ae(["react-flow__background",u]),style:{...c,...Yn,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:f,"data-testid":"rf__background",children:[x.jsx("pattern",{id:M,x:d[0]%E[0],y:d[1]%E[1],width:E[0],height:E[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`,children:p?x.jsx(ep,{radius:g/2,className:l}):x.jsx(Qg,{dimensions:_,lineWidth:o,variant:t,className:l})}),x.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${M})`})]})}ua.displayName="Background";const rp=b.memo(ua);function op(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:x.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function ip(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:x.jsx("path",{d:"M0 0h32v4.2H0z"})})}function sp(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:x.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function ap(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:x.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function cp(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:x.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function mn({children:e,className:t,...n}){return x.jsx("button",{type:"button",className:ae(["react-flow__controls-button",t]),...n,children:e})}const lp=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function da({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:i,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:u,children:l,position:f="bottom-left",orientation:d="vertical","aria-label":h}){const m=oe(),{isInteractive:p,minZoomReached:v,maxZoomReached:w,ariaLabelConfig:E}=ee(lp,ie),{zoomIn:g,zoomOut:y,fitView:_}=eo(),C=()=>{g(),i==null||i()},M=()=>{y(),s==null||s()},N=()=>{_(o),a==null||a()},T=()=>{m.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),c==null||c(!p)},O=d==="horizontal"?"horizontal":"vertical";return x.jsxs(Xn,{className:ae(["react-flow__controls",O,u]),position:f,style:e,"data-testid":"rf__controls","aria-label":h??E["controls.ariaLabel"],children:[t&&x.jsxs(x.Fragment,{children:[x.jsx(mn,{onClick:C,className:"react-flow__controls-zoomin",title:E["controls.zoomIn.ariaLabel"],"aria-label":E["controls.zoomIn.ariaLabel"],disabled:w,children:x.jsx(op,{})}),x.jsx(mn,{onClick:M,className:"react-flow__controls-zoomout",title:E["controls.zoomOut.ariaLabel"],"aria-label":E["controls.zoomOut.ariaLabel"],disabled:v,children:x.jsx(ip,{})})]}),n&&x.jsx(mn,{className:"react-flow__controls-fitview",onClick:N,title:E["controls.fitView.ariaLabel"],"aria-label":E["controls.fitView.ariaLabel"],children:x.jsx(sp,{})}),r&&x.jsx(mn,{className:"react-flow__controls-interactive",onClick:T,title:E["controls.interactive.ariaLabel"],"aria-label":E["controls.interactive.ariaLabel"],children:p?x.jsx(cp,{}):x.jsx(ap,{})}),l]})}da.displayName="Controls";const up=b.memo(da);function dp({id:e,x:t,y:n,width:r,height:o,style:i,color:s,strokeColor:a,strokeWidth:c,className:u,borderRadius:l,shapeRendering:f,selected:d,onClick:h}){const{background:m,backgroundColor:p}=i||{},v=s||m||p;return x.jsx("rect",{className:ae(["react-flow__minimap-node",{selected:d},u]),x:t,y:n,rx:l,ry:l,width:r,height:o,style:{fill:v,stroke:a,strokeWidth:c},shapeRendering:f,onClick:h?w=>h(w,e):void 0})}const fp=b.memo(dp),hp=e=>e.nodes.map(t=>t.id),pr=e=>e instanceof Function?e:()=>e;function gp({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:i=fp,onClick:s}){const a=ee(hp,ie),c=pr(t),u=pr(e),l=pr(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return x.jsx(x.Fragment,{children:a.map(d=>x.jsx(mp,{id:d,nodeColorFunc:c,nodeStrokeColorFunc:u,nodeClassNameFunc:l,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:i,onClick:s,shapeRendering:f},d))})}function pp({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:i,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:u,x:l,y:f,width:d,height:h}=ee(m=>{const{internals:p}=m.nodeLookup.get(e),v=p.userNode,{x:w,y:E}=p.positionAbsolute,{width:g,height:y}=Ge(v);return{node:v,x:w,y:E,width:g,height:y}},ie);return!u||u.hidden||!fs(u)?null:x.jsx(a,{x:l,y:f,width:d,height:h,style:u.style,selected:!!u.selected,className:r(u),color:t(u),borderRadius:o,strokeColor:n(u),strokeWidth:i,shapeRendering:s,onClick:c,id:u.id})}const mp=b.memo(pp);var yp=b.memo(gp);const xp=200,vp=150,wp=e=>!e.hidden,bp=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ds(en(e.nodeLookup,{filter:wp}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Sp="react-flow__minimap-desc";function fa({style:e,className:t,nodeStrokeColor:n,nodeColor:r,nodeClassName:o="",nodeBorderRadius:i=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:u,maskStrokeColor:l,maskStrokeWidth:f,position:d="bottom-right",onClick:h,onNodeClick:m,pannable:p=!1,zoomable:v=!1,ariaLabel:w,inversePan:E,zoomStep:g=10,offsetScale:y=5}){const _=oe(),C=b.useRef(null),{boundingRect:M,viewBB:N,rfId:T,panZoom:O,translateExtent:R,flowWidth:P,flowHeight:j,ariaLabelConfig:S}=ee(bp,ie),k=(e==null?void 0:e.width)??xp,A=(e==null?void 0:e.height)??vp,D=M.width/k,$=M.height/A,I=Math.max(D,$),L=I*k,z=I*A,F=y*I,V=M.x-(L-M.width)/2-F,B=M.y-(z-M.height)/2-F,W=L+F*2,X=z+F*2,U=`${Sp}-${T}`,H=b.useRef(0),q=b.useRef();H.current=I,b.useEffect(()=>{if(C.current&&O)return q.current=Of({domNode:C.current,panZoom:O,getTransform:()=>_.getState().transform,getViewScale:()=>H.current}),()=>{var J;(J=q.current)==null||J.destroy()}},[O]),b.useEffect(()=>{var J;(J=q.current)==null||J.update({translateExtent:R,width:P,height:j,inversePan:E,pannable:p,zoomStep:g,zoomable:v})},[p,v,E,g,R,P,j]);const Y=h?J=>{var re;const[Z,te]=((re=q.current)==null?void 0:re.pointer(J))||[0,0];h(J,{x:Z,y:te})}:void 0,Q=m?b.useCallback((J,Z)=>{const te=_.getState().nodeLookup.get(Z).internals.userNode;m(J,te)},[]):void 0,G=w??S["minimap.ariaLabel"];return x.jsx(Xn,{position:d,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*I:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="number"?s:void 0},className:ae(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:x.jsxs("svg",{width:k,height:A,viewBox:`${V} ${B} ${W} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":U,ref:C,onClick:Y,children:[G&&x.jsx("title",{id:U,children:G}),x.jsx(yp,{onClick:Q,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:o,nodeStrokeWidth:s,nodeComponent:a}),x.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-F},${B-F}h${W+F*2}v${X+F*2}h${-W-F*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}fa.displayName="MiniMap";const _p=b.memo(fa),Ep=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Cp={[Dt.Line]:"right",[Dt.Handle]:"bottom-right"};function Mp({nodeId:e,position:t,variant:n=Dt.Handle,className:r,style:o=void 0,children:i,color:s,minWidth:a=10,minHeight:c=10,maxWidth:u=Number.MAX_VALUE,maxHeight:l=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:d,autoScale:h=!0,shouldResize:m,onResizeStart:p,onResize:v,onResizeEnd:w}){const E=Xs(),g=typeof e=="string"?e:E,y=oe(),_=b.useRef(null),C=n===Dt.Handle,M=ee(b.useCallback(Ep(C&&h),[C,h]),ie),N=b.useRef(null),T=t??Cp[n];b.useEffect(()=>{if(!(!_.current||!g))return N.current||(N.current=th({domNode:_.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:R,transform:P,snapGrid:j,snapToGrid:S,nodeOrigin:k,domNode:A}=y.getState();return{nodeLookup:R,transform:P,snapGrid:j,snapToGrid:S,nodeOrigin:k,paneDomNode:A}},onChange:(R,P)=>{const{triggerNodeChanges:j,nodeLookup:S,parentLookup:k,nodeOrigin:A}=y.getState(),D=[],$={x:R.x,y:R.y},I=S.get(g);if(I&&I.expandParent&&I.parentId){const L=I.origin??A,z=R.width??I.measured.width??0,F=R.height??I.measured.height??0,V={id:I.id,parentId:I.parentId,rect:{width:z,height:F,...hs({x:R.x??I.position.x,y:R.y??I.position.y},{width:z,height:F},I.parentId,S,L)}},B=Qr([V],S,k,A);D.push(...B),$.x=R.x?Math.max(L[0]*z,R.x):void 0,$.y=R.y?Math.max(L[1]*F,R.y):void 0}if($.x!==void 0&&$.y!==void 0){const L={id:g,type:"position",position:{...$}};D.push(L)}if(R.width!==void 0&&R.height!==void 0){const z={id:g,type:"dimensions",resizing:!0,setAttributes:d?d==="horizontal"?"width":"height":!0,dimensions:{width:R.width,height:R.height}};D.push(z)}for(const L of P){const z={...L,type:"position"};D.push(z)}j(D)},onEnd:({width:R,height:P})=>{const j={id:g,type:"dimensions",resizing:!1,dimensions:{width:R,height:P}};y.getState().triggerNodeChanges([j])}})),N.current.update({controlPosition:T,boundaries:{minWidth:a,minHeight:c,maxWidth:u,maxHeight:l},keepAspectRatio:f,resizeDirection:d,onResizeStart:p,onResize:v,onResizeEnd:w,shouldResize:m}),()=>{var R;(R=N.current)==null||R.destroy()}},[T,a,c,u,l,f,p,v,w,m]);const O=T.split("-");return x.jsx("div",{className:ae(["react-flow__resize-control","nodrag",...O,n,r]),ref:_,style:{...o,scale:M,...s&&{[C?"backgroundColor":"borderColor"]:s}},children:i})}b.memo(Mp);const mr={width:10,height:10,bottom:-5};b.memo(({data:e,isConnectable:t})=>x.jsx(x.Fragment,{children:x.jsxs("div",{style:{padding:25},children:[x.jsx("div",{children:"Node"}),x.jsx(Ue,{type:"source",id:"red",position:K.Bottom,style:{...mr,left:"15%",background:"red"},onConnect:n=>console.log("handle onConnect",n),isConnectable:t}),x.jsx(Ue,{type:"source",position:K.Bottom,id:"blue",style:{...mr,left:"50%",background:"blue"},isConnectable:t}),x.jsx(Ue,{type:"target",position:K.Bottom,id:"orange",style:{...mr,left:"85%",background:"orange"},isConnectable:t})]})}));const Np={custom:Dp};function Ap({initialNodes:e,initialEdges:t,component:n}){const{messageApi:r}=st(),[o,i]=b.useState(e),[s,a]=b.useState(t);b.useEffect(()=>{i(e)},[e]);const c=b.useCallback(d=>i(h=>zs(d,h)),[]),u=b.useCallback(d=>a(h=>Os(d,h)),[]),l=b.useCallback(d=>a(h=>ws(d,h)),[]),f=async()=>{const d=o.map(p=>({component_id:p.id,position:p.position})),h={position:JSON.stringify(d),edges:JSON.stringify(s),component_id:n.component_id},m=await yc(h);console.log(m),r.success("保存成功")};return x.jsx(Ri,{title:"流程图",extra:x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:f,children:"保存"}),bodyStyle:{padding:0},children:x.jsx("div",{style:{height:"40vh"},children:x.jsxs(Jg,{nodes:o,edges:s,nodeTypes:Np,onNodesChange:c,onEdgesChange:u,onConnect:l,fitView:!0,children:[x.jsx(up,{}),x.jsx(_p,{}),x.jsx(rp,{gap:12,size:1})]})})})}function Dp({data:e}){const t=e.inputs||[],n=e.outputs||[];return x.jsxs("div",{style:{background:e.color||"#1976d2",color:"white",padding:10,borderRadius:12,minWidth:150,position:"relative"},children:[x.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:e.label}),t.map((r,o)=>x.jsx(xo,{content:x.jsx("div",{children:r.component_name}),children:x.jsx(Ue,{type:"target",position:K.Left,id:r.component_id,style:{top:30+o*20,background:"#555"}},r.component_id)})),n.map((r,o)=>x.jsx(xo,{content:x.jsx("div",{children:r.component_name}),children:x.jsx(Ue,{type:"source",position:K.Right,id:r.component_id,style:{top:30+o*20,background:"#888"}},r.component_id)}))]})}function Ip(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const Un=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function kt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function no(e){return"nodeType"in e}function ye(e){var t,n;return e?kt(e)?e:no(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function ro(e){const{Document:t}=ye(e);return e instanceof t}function nn(e){return kt(e)?!1:e instanceof ye(e).HTMLElement}function ha(e){return e instanceof ye(e).SVGElement}function Rt(e){return e?kt(e)?e.document:no(e)?ro(e)?e:nn(e)||ha(e)?e.ownerDocument:document:document:document}const Fe=Un?b.useLayoutEffect:b.useEffect;function oo(e){const t=b.useRef(e);return Fe(()=>{t.current=e}),b.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function kp(){const e=b.useRef(null),t=b.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=b.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Gt(e,t){t===void 0&&(t=[e]);const n=b.useRef(e);return Fe(()=>{n.current!==e&&(n.current=e)},t),n}function rn(e,t){const n=b.useRef();return b.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Rn(e){const t=oo(e),n=b.useRef(null),r=b.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function Tr(e){const t=b.useRef();return b.useEffect(()=>{t.current=e},[e]),t.current}let yr={};function on(e,t){return b.useMemo(()=>{if(t)return t;const n=yr[e]==null?0:yr[e]+1;return yr[e]=n,e+"-"+n},[e,t])}function ga(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((i,s)=>{const a=Object.entries(s);for(const[c,u]of a){const l=i[c];l!=null&&(i[c]=l+e*u)}return i},{...t})}}const _t=ga(1),Tn=ga(-1);function Rp(e){return"clientX"in e&&"clientY"in e}function io(e){if(!e)return!1;const{KeyboardEvent:t}=ye(e.target);return t&&e instanceof t}function Tp(e){if(!e)return!1;const{TouchEvent:t}=ye(e.target);return t&&e instanceof t}function Pr(e){if(Tp(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Rp(e)?{x:e.clientX,y:e.clientY}:null}const Kt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Kt.Translate.toString(e),Kt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),gi="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Pp(e){return e.matches(gi)?e:e.querySelector(gi)}const jp={display:"none"};function $p(e){let{id:t,value:n}=e;return fe.createElement("div",{id:t,style:jp},n)}function Lp(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return fe.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function zp(){const[e,t]=b.useState("");return{announce:b.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const pa=b.createContext(null);function Op(e){const t=b.useContext(pa);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Fp(){const[e]=b.useState(()=>new Set),t=b.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[b.useCallback(r=>{let{type:o,event:i}=r;e.forEach(s=>{var a;return(a=s[o])==null?void 0:a.call(s,i)})},[e]),t]}const Bp={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Hp={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Vp(e){let{announcements:t=Hp,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=Bp}=e;const{announce:i,announcement:s}=zp(),a=on("DndLiveRegion"),[c,u]=b.useState(!1);if(b.useEffect(()=>{u(!0)},[]),Op(b.useMemo(()=>({onDragStart(f){let{active:d}=f;i(t.onDragStart({active:d}))},onDragMove(f){let{active:d,over:h}=f;t.onDragMove&&i(t.onDragMove({active:d,over:h}))},onDragOver(f){let{active:d,over:h}=f;i(t.onDragOver({active:d,over:h}))},onDragEnd(f){let{active:d,over:h}=f;i(t.onDragEnd({active:d,over:h}))},onDragCancel(f){let{active:d,over:h}=f;i(t.onDragCancel({active:d,over:h}))}}),[i,t])),!c)return null;const l=fe.createElement(fe.Fragment,null,fe.createElement($p,{id:r,value:o.draggable}),fe.createElement(Lp,{id:a,announcement:s}));return n?Lt.createPortal(l,n):l}var le;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(le||(le={}));function Pn(){}function Xp(e,t){return b.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Yp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const ke=Object.freeze({x:0,y:0});function Wp(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Up(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function qp(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),s=o-r,a=i-n;if(r<o&&n<i){const c=t.width*t.height,u=e.width*e.height,l=s*a,f=l/(c+u-l);return Number(f.toFixed(4))}return 0}const Gp=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const i of r){const{id:s}=i,a=n.get(s);if(a){const c=qp(a,t);c>0&&o.push({id:s,data:{droppableContainer:i,value:c}})}}return o.sort(Wp)};function Kp(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function ma(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ke}function Zp(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o.reduce((s,a)=>({...s,top:s.top+e*a.y,bottom:s.bottom+e*a.y,left:s.left+e*a.x,right:s.right+e*a.x}),{...n})}}const Jp=Zp(1);function Qp(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function em(e,t,n){const r=Qp(t);if(!r)return e;const{scaleX:o,scaleY:i,x:s,y:a}=r,c=e.left-s-(1-o)*parseFloat(n),u=e.top-a-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),l=o?e.width/o:e.width,f=i?e.height/i:e.height;return{width:l,height:f,top:u,right:c+l,bottom:u+f,left:c}}const tm={ignoreTransform:!1};function Tt(e,t){t===void 0&&(t=tm);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:l}=ye(e).getComputedStyle(e);u&&(n=em(n,u,l))}const{top:r,left:o,width:i,height:s,bottom:a,right:c}=n;return{top:r,left:o,width:i,height:s,bottom:a,right:c}}function pi(e){return Tt(e,{ignoreTransform:!0})}function nm(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function rm(e,t){return t===void 0&&(t=ye(e).getComputedStyle(e)),t.position==="fixed"}function om(e,t){t===void 0&&(t=ye(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const i=t[o];return typeof i=="string"?n.test(i):!1})}function so(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(ro(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!nn(o)||ha(o)||n.includes(o))return n;const i=ye(e).getComputedStyle(o);return o!==e&&om(o,i)&&n.push(o),rm(o,i)?n:r(o.parentNode)}return e?r(e):n}function ya(e){const[t]=so(e,1);return t??null}function xr(e){return!Un||!e?null:kt(e)?e:no(e)?ro(e)||e===Rt(e).scrollingElement?window:nn(e)?e:null:null}function xa(e){return kt(e)?e.scrollX:e.scrollLeft}function va(e){return kt(e)?e.scrollY:e.scrollTop}function jr(e){return{x:xa(e),y:va(e)}}var de;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(de||(de={}));function wa(e){return!Un||!e?!1:e===document.scrollingElement}function ba(e){const t={x:0,y:0},n=wa(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,s=e.scrollTop>=r.y,a=e.scrollLeft>=r.x;return{isTop:o,isLeft:i,isBottom:s,isRight:a,maxScroll:r,minScroll:t}}const im={x:.2,y:.2};function sm(e,t,n,r,o){let{top:i,left:s,right:a,bottom:c}=n;r===void 0&&(r=10),o===void 0&&(o=im);const{isTop:u,isBottom:l,isLeft:f,isRight:d}=ba(e),h={x:0,y:0},m={x:0,y:0},p={height:t.height*o.y,width:t.width*o.x};return!u&&i<=t.top+p.height?(h.y=de.Backward,m.y=r*Math.abs((t.top+p.height-i)/p.height)):!l&&c>=t.bottom-p.height&&(h.y=de.Forward,m.y=r*Math.abs((t.bottom-p.height-c)/p.height)),!d&&a>=t.right-p.width?(h.x=de.Forward,m.x=r*Math.abs((t.right-p.width-a)/p.width)):!f&&s<=t.left+p.width&&(h.x=de.Backward,m.x=r*Math.abs((t.left+p.width-s)/p.width)),{direction:h,speed:m}}function am(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:s}=window;return{top:0,left:0,right:i,bottom:s,width:i,height:s}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Sa(e){return e.reduce((t,n)=>_t(t,jr(n)),ke)}function cm(e){return e.reduce((t,n)=>t+xa(n),0)}function lm(e){return e.reduce((t,n)=>t+va(n),0)}function um(e,t){if(t===void 0&&(t=Tt),!e)return;const{top:n,left:r,bottom:o,right:i}=t(e);ya(e)&&(o<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const dm=[["x",["left","right"],cm],["y",["top","bottom"],lm]];class ao{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=so(n),o=Sa(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,s,a]of dm)for(const c of s)Object.defineProperty(this,c,{get:()=>{const u=a(r),l=o[i]-u;return this.rect[c]+l},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ft{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function fm(e){const{EventTarget:t}=ye(e);return e instanceof t?e:Rt(e)}function vr(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var Me;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Me||(Me={}));function mi(e){e.preventDefault()}function hm(e){e.stopPropagation()}var ne;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ne||(ne={}));const _a={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},gm=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class Ea{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ft(Rt(n)),this.windowListeners=new Ft(ye(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Me.Resize,this.handleCancel),this.windowListeners.add(Me.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Me.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&um(r),n(ke)}handleKeyDown(t){if(io(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:i=_a,coordinateGetter:s=gm,scrollBehavior:a="smooth"}=o,{code:c}=t;if(i.end.includes(c)){this.handleEnd(t);return}if(i.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:u}=r.current,l=u?{x:u.left,y:u.top}:ke;this.referenceCoordinates||(this.referenceCoordinates=l);const f=s(t,{active:n,context:r.current,currentCoordinates:l});if(f){const d=Tn(f,l),h={x:0,y:0},{scrollableAncestors:m}=r.current;for(const p of m){const v=t.code,{isTop:w,isRight:E,isLeft:g,isBottom:y,maxScroll:_,minScroll:C}=ba(p),M=am(p),N={x:Math.min(v===ne.Right?M.right-M.width/2:M.right,Math.max(v===ne.Right?M.left:M.left+M.width/2,f.x)),y:Math.min(v===ne.Down?M.bottom-M.height/2:M.bottom,Math.max(v===ne.Down?M.top:M.top+M.height/2,f.y))},T=v===ne.Right&&!E||v===ne.Left&&!g,O=v===ne.Down&&!y||v===ne.Up&&!w;if(T&&N.x!==f.x){const R=p.scrollLeft+d.x,P=v===ne.Right&&R<=_.x||v===ne.Left&&R>=C.x;if(P&&!d.y){p.scrollTo({left:R,behavior:a});return}P?h.x=p.scrollLeft-R:h.x=v===ne.Right?p.scrollLeft-_.x:p.scrollLeft-C.x,h.x&&p.scrollBy({left:-h.x,behavior:a});break}else if(O&&N.y!==f.y){const R=p.scrollTop+d.y,P=v===ne.Down&&R<=_.y||v===ne.Up&&R>=C.y;if(P&&!d.x){p.scrollTo({top:R,behavior:a});return}P?h.y=p.scrollTop-R:h.y=v===ne.Down?p.scrollTop-_.y:p.scrollTop-C.y,h.y&&p.scrollBy({top:-h.y,behavior:a});break}}this.handleMove(t,_t(Tn(f,this.referenceCoordinates),h))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ea.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=_a,onActivation:o}=t,{active:i}=n;const{code:s}=e.nativeEvent;if(r.start.includes(s)){const a=i.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function yi(e){return!!(e&&"distance"in e)}function xi(e){return!!(e&&"delay"in e)}class co{constructor(t,n,r){var o;r===void 0&&(r=fm(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:s}=i;this.props=t,this.events=n,this.document=Rt(s),this.documentListeners=new Ft(this.document),this.listeners=new Ft(r),this.windowListeners=new Ft(ye(s)),this.initialCoordinates=(o=Pr(i))!=null?o:ke,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Me.Resize,this.handleCancel),this.windowListeners.add(Me.DragStart,mi),this.windowListeners.add(Me.VisibilityChange,this.handleCancel),this.windowListeners.add(Me.ContextMenu,mi),this.documentListeners.add(Me.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(xi(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(yi(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Me.Click,hm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Me.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:i}=this,{onMove:s,options:{activationConstraint:a}}=i;if(!o)return;const c=(n=Pr(t))!=null?n:ke,u=Tn(o,c);if(!r&&a){if(yi(a)){if(a.tolerance!=null&&vr(u,a.tolerance))return this.handleCancel();if(vr(u,a.distance))return this.handleStart()}if(xi(a)&&vr(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}t.cancelable&&t.preventDefault(),s(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const pm={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class lo extends co{constructor(t){const{event:n}=t,r=Rt(n.target);super(t,pm,r)}}lo.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const mm={move:{name:"mousemove"},end:{name:"mouseup"}};var $r;(function(e){e[e.RightClick=2]="RightClick"})($r||($r={}));class ym extends co{constructor(t){super(t,mm,Rt(t.event.target))}}ym.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===$r.RightClick?!1:(r==null||r({event:n}),!0)}}];const wr={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class xm extends co{constructor(t){super(t,wr)}static setup(){return window.addEventListener(wr.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(wr.move.name,t)};function t(){}}}xm.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var Bt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Bt||(Bt={}));var jn;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(jn||(jn={}));function vm(e){let{acceleration:t,activator:n=Bt.Pointer,canScroll:r,draggingRect:o,enabled:i,interval:s=5,order:a=jn.TreeOrder,pointerCoordinates:c,scrollableAncestors:u,scrollableAncestorRects:l,delta:f,threshold:d}=e;const h=bm({delta:f,disabled:!i}),[m,p]=kp(),v=b.useRef({x:0,y:0}),w=b.useRef({x:0,y:0}),E=b.useMemo(()=>{switch(n){case Bt.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Bt.DraggableRect:return o}},[n,o,c]),g=b.useRef(null),y=b.useCallback(()=>{const C=g.current;if(!C)return;const M=v.current.x*w.current.x,N=v.current.y*w.current.y;C.scrollBy(M,N)},[]),_=b.useMemo(()=>a===jn.TreeOrder?[...u].reverse():u,[a,u]);b.useEffect(()=>{if(!i||!u.length||!E){p();return}for(const C of _){if((r==null?void 0:r(C))===!1)continue;const M=u.indexOf(C),N=l[M];if(!N)continue;const{direction:T,speed:O}=sm(C,N,E,t,d);for(const R of["x","y"])h[R][T[R]]||(O[R]=0,T[R]=0);if(O.x>0||O.y>0){p(),g.current=C,m(y,s),v.current=O,w.current=T;return}}v.current={x:0,y:0},w.current={x:0,y:0},p()},[t,y,r,p,i,s,JSON.stringify(E),JSON.stringify(h),m,u,_,l,JSON.stringify(d)])}const wm={x:{[de.Backward]:!1,[de.Forward]:!1},y:{[de.Backward]:!1,[de.Forward]:!1}};function bm(e){let{delta:t,disabled:n}=e;const r=Tr(t);return rn(o=>{if(n||!r||!o)return wm;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[de.Backward]:o.x[de.Backward]||i.x===-1,[de.Forward]:o.x[de.Forward]||i.x===1},y:{[de.Backward]:o.y[de.Backward]||i.y===-1,[de.Forward]:o.y[de.Forward]||i.y===1}}},[n,t,r])}function Sm(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return rn(o=>{var i;return t==null?null:(i=r??o)!=null?i:null},[r,t])}function _m(e,t){return b.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,i=o.activators.map(s=>({eventName:s.eventName,handler:t(s.handler,r)}));return[...n,...i]},[]),[e,t])}var Zt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Zt||(Zt={}));var Lr;(function(e){e.Optimized="optimized"})(Lr||(Lr={}));const vi=new Map;function Em(e,t){let{dragging:n,dependencies:r,config:o}=t;const[i,s]=b.useState(null),{frequency:a,measure:c,strategy:u}=o,l=b.useRef(e),f=v(),d=Gt(f),h=b.useCallback(function(w){w===void 0&&(w=[]),!d.current&&s(E=>E===null?w:E.concat(w.filter(g=>!E.includes(g))))},[d]),m=b.useRef(null),p=rn(w=>{if(f&&!n)return vi;if(!w||w===vi||l.current!==e||i!=null){const E=new Map;for(let g of e){if(!g)continue;if(i&&i.length>0&&!i.includes(g.id)&&g.rect.current){E.set(g.id,g.rect.current);continue}const y=g.node.current,_=y?new ao(c(y),y):null;g.rect.current=_,_&&E.set(g.id,_)}return E}return w},[e,i,n,f,c]);return b.useEffect(()=>{l.current=e},[e]),b.useEffect(()=>{f||h()},[n,f]),b.useEffect(()=>{i&&i.length>0&&s(null)},[JSON.stringify(i)]),b.useEffect(()=>{f||typeof a!="number"||m.current!==null||(m.current=setTimeout(()=>{h(),m.current=null},a))},[a,f,h,...r]),{droppableRects:p,measureDroppableContainers:h,measuringScheduled:i!=null};function v(){switch(u){case Zt.Always:return!1;case Zt.BeforeDragging:return n;default:return!n}}}function Ca(e,t){return rn(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Cm(e,t){return Ca(e,t)}function Mm(e){let{callback:t,disabled:n}=e;const r=oo(t),o=b.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return b.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function qn(e){let{callback:t,disabled:n}=e;const r=oo(t),o=b.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return b.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function Nm(e){return new ao(Tt(e),e)}function wi(e,t,n){t===void 0&&(t=Nm);const[r,o]=b.useState(null);function i(){o(c=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=c??n)!=null?u:null}const l=t(e);return JSON.stringify(c)===JSON.stringify(l)?c:l})}const s=Mm({callback(c){if(e)for(const u of c){const{type:l,target:f}=u;if(l==="childList"&&f instanceof HTMLElement&&f.contains(e)){i();break}}}}),a=qn({callback:i});return Fe(()=>{i(),e?(a==null||a.observe(e),s==null||s.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),s==null||s.disconnect())},[e]),r}function Am(e){const t=Ca(e);return ma(e,t)}const bi=[];function Dm(e){const t=b.useRef(e),n=rn(r=>e?r&&r!==bi&&e&&t.current&&e.parentNode===t.current.parentNode?r:so(e):bi,[e]);return b.useEffect(()=>{t.current=e},[e]),n}function Im(e){const[t,n]=b.useState(null),r=b.useRef(e),o=b.useCallback(i=>{const s=xr(i.target);s&&n(a=>a?(a.set(s,jr(s)),new Map(a)):null)},[]);return b.useEffect(()=>{const i=r.current;if(e!==i){s(i);const a=e.map(c=>{const u=xr(c);return u?(u.addEventListener("scroll",o,{passive:!0}),[u,jr(u)]):null}).filter(c=>c!=null);n(a.length?new Map(a):null),r.current=e}return()=>{s(e),s(i)};function s(a){a.forEach(c=>{const u=xr(c);u==null||u.removeEventListener("scroll",o)})}},[o,e]),b.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,s)=>_t(i,s),ke):Sa(e):ke,[e,t])}function Si(e,t){t===void 0&&(t=[]);const n=b.useRef(null);return b.useEffect(()=>{n.current=null},t),b.useEffect(()=>{const r=e!==ke;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Tn(e,n.current):ke}function km(e){b.useEffect(()=>{if(!Un)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Rm(e,t){return b.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:i}=r;return n[o]=s=>{i(s,t)},n},{}),[e,t])}function Ma(e){return b.useMemo(()=>e?nm(e):null,[e])}const _i=[];function Tm(e,t){t===void 0&&(t=Tt);const[n]=e,r=Ma(n?ye(n):null),[o,i]=b.useState(_i);function s(){i(()=>e.length?e.map(c=>wa(c)?r:new ao(t(c),c)):_i)}const a=qn({callback:s});return Fe(()=>{a==null||a.disconnect(),s(),e.forEach(c=>a==null?void 0:a.observe(c))},[e]),o}function Pm(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return nn(t)?t:e}function jm(e){let{measure:t}=e;const[n,r]=b.useState(null),o=b.useCallback(u=>{for(const{target:l}of u)if(nn(l)){r(f=>{const d=t(l);return f?{...f,width:d.width,height:d.height}:d});break}},[t]),i=qn({callback:o}),s=b.useCallback(u=>{const l=Pm(u);i==null||i.disconnect(),l&&(i==null||i.observe(l)),r(l?t(l):null)},[t,i]),[a,c]=Rn(s);return b.useMemo(()=>({nodeRef:a,rect:n,setRef:c}),[n,a,c])}const $m=[{sensor:lo,options:{}},{sensor:Ea,options:{}}],Lm={current:{}},_n={draggable:{measure:pi},droppable:{measure:pi,strategy:Zt.WhileDragging,frequency:Lr.Optimized},dragOverlay:{measure:Tt}};class Ht extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const zm={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ht,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Pn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:_n,measureDroppableContainers:Pn,windowRect:null,measuringScheduled:!1},Om={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Pn,draggableNodes:new Map,over:null,measureDroppableContainers:Pn},Gn=b.createContext(Om),Na=b.createContext(zm);function Fm(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ht}}}function Bm(e,t){switch(t.type){case le.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case le.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case le.DragEnd:case le.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case le.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new Ht(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case le.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const s=new Ht(e.droppable.containers);return s.set(n,{...i,disabled:o}),{...e,droppable:{...e.droppable,containers:s}}}case le.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new Ht(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function Hm(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=b.useContext(Gn),i=Tr(r),s=Tr(n==null?void 0:n.id);return b.useEffect(()=>{if(!t&&!r&&i&&s!=null){if(!io(i)||document.activeElement===i.target)return;const a=o.get(s);if(!a)return;const{activatorNode:c,node:u}=a;if(!c.current&&!u.current)return;requestAnimationFrame(()=>{for(const l of[c.current,u.current]){if(!l)continue;const f=Pp(l);if(f){f.focus();break}}})}},[r,t,o,s,i]),null}function Vm(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,i)=>i({transform:o,...r}),n):n}function Xm(e){return b.useMemo(()=>({draggable:{..._n.draggable,...e==null?void 0:e.draggable},droppable:{..._n.droppable,...e==null?void 0:e.droppable},dragOverlay:{..._n.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Ym(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const i=b.useRef(!1),{x:s,y:a}=typeof o=="boolean"?{x:o,y:o}:o;Fe(()=>{if(!s&&!a||!t){i.current=!1;return}if(i.current||!r)return;const u=t==null?void 0:t.node.current;if(!u||u.isConnected===!1)return;const l=n(u),f=ma(l,r);if(s||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const d=ya(u);d&&d.scrollBy({top:f.y,left:f.x})}},[t,s,a,r,n])}const Aa=b.createContext({...ke,scaleX:1,scaleY:1});var nt;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(nt||(nt={}));const Wm=b.memo(function(t){var n,r,o,i;let{id:s,accessibility:a,autoScroll:c=!0,children:u,sensors:l=$m,collisionDetection:f=Gp,measuring:d,modifiers:h,...m}=t;const p=b.useReducer(Bm,void 0,Fm),[v,w]=p,[E,g]=Fp(),[y,_]=b.useState(nt.Uninitialized),C=y===nt.Initialized,{draggable:{active:M,nodes:N,translate:T},droppable:{containers:O}}=v,R=M!=null?N.get(M):null,P=b.useRef({initial:null,translated:null}),j=b.useMemo(()=>{var ue;return M!=null?{id:M,data:(ue=R==null?void 0:R.data)!=null?ue:Lm,rect:P}:null},[M,R]),S=b.useRef(null),[k,A]=b.useState(null),[D,$]=b.useState(null),I=Gt(m,Object.values(m)),L=on("DndDescribedBy",s),z=b.useMemo(()=>O.getEnabled(),[O]),F=Xm(d),{droppableRects:V,measureDroppableContainers:B,measuringScheduled:W}=Em(z,{dragging:C,dependencies:[T.x,T.y],config:F.droppable}),X=Sm(N,M),U=b.useMemo(()=>D?Pr(D):null,[D]),H=tr(),q=Cm(X,F.draggable.measure);Ym({activeNode:M!=null?N.get(M):null,config:H.layoutShiftCompensation,initialRect:q,measure:F.draggable.measure});const Y=wi(X,F.draggable.measure,q),Q=wi(X?X.parentElement:null),G=b.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=O.getNodeFor((n=G.current.over)==null?void 0:n.id),Z=jm({measure:F.dragOverlay.measure}),te=(r=Z.nodeRef.current)!=null?r:X,re=C?(o=Z.rect)!=null?o:Y:null,Se=!!(Z.nodeRef.current&&Z.rect),He=Am(Se?null:Y),Ke=Ma(te?ye(te):null),xe=Dm(C?J??X:null),Ve=Tm(xe),Te=Vm(h,{transform:{x:T.x-He.x,y:T.y-He.y,scaleX:1,scaleY:1},activatorEvent:D,active:j,activeNodeRect:Y,containerNodeRect:Q,draggingNodeRect:re,over:G.current.over,overlayNodeRect:Z.rect,scrollableAncestors:xe,scrollableAncestorRects:Ve,windowRect:Ke}),Ze=U?_t(U,T):null,pt=Im(xe),mt=Si(pt),Je=Si(pt,[Y]),_e=_t(Te,mt),Xe=re?Jp(re,Te):null,at=j&&Xe?f({active:j,collisionRect:Xe,droppableRects:V,droppableContainers:z,pointerCoordinates:Ze}):null,yt=Up(at,"id"),[Pe,sn]=b.useState(null),Kn=Se?Te:_t(Te,Je),Zn=Kp(Kn,(i=Pe==null?void 0:Pe.rect)!=null?i:null,Y),Pt=b.useRef(null),an=b.useCallback((ue,he)=>{let{sensor:ge,options:Ne}=he;if(S.current==null)return;const me=N.get(S.current);if(!me)return;const pe=ue.nativeEvent,Ee=new ge({active:S.current,activeNode:me,event:pe,options:Ne,context:G,onAbort(ce){if(!N.get(ce))return;const{onDragAbort:Ce}=I.current,Ae={id:ce};Ce==null||Ce(Ae),E({type:"onDragAbort",event:Ae})},onPending(ce,je,Ce,Ae){if(!N.get(ce))return;const{onDragPending:lt}=I.current,$e={id:ce,constraint:je,initialCoordinates:Ce,offset:Ae};lt==null||lt($e),E({type:"onDragPending",event:$e})},onStart(ce){const je=S.current;if(je==null)return;const Ce=N.get(je);if(!Ce)return;const{onDragStart:Ae}=I.current,ct={activatorEvent:pe,active:{id:je,data:Ce.data,rect:P}};Lt.unstable_batchedUpdates(()=>{Ae==null||Ae(ct),_(nt.Initializing),w({type:le.DragStart,initialCoordinates:ce,active:je}),E({type:"onDragStart",event:ct}),A(Pt.current),$(pe)})},onMove(ce){w({type:le.DragMove,coordinates:ce})},onEnd:Qe(le.DragEnd),onCancel:Qe(le.DragCancel)});Pt.current=Ee;function Qe(ce){return async function(){const{active:Ce,collisions:Ae,over:ct,scrollAdjustedTranslate:lt}=G.current;let $e=null;if(Ce&&lt){const{cancelDrop:ut}=I.current;$e={activatorEvent:pe,active:Ce,collisions:Ae,delta:lt,over:ct},ce===le.DragEnd&&typeof ut=="function"&&await Promise.resolve(ut($e))&&(ce=le.DragCancel)}S.current=null,Lt.unstable_batchedUpdates(()=>{w({type:ce}),_(nt.Uninitialized),sn(null),A(null),$(null),Pt.current=null;const ut=ce===le.DragEnd?"onDragEnd":"onDragCancel";if($e){const jt=I.current[ut];jt==null||jt($e),E({type:ut,event:$e})}})}}},[N]),Jn=b.useCallback((ue,he)=>(ge,Ne)=>{const me=ge.nativeEvent,pe=N.get(Ne);if(S.current!==null||!pe||me.dndKit||me.defaultPrevented)return;const Ee={active:pe};ue(ge,he.options,Ee)===!0&&(me.dndKit={capturedBy:he.sensor},S.current=Ne,an(ge,he))},[N,an]),cn=_m(l,Jn);km(l),Fe(()=>{Y&&y===nt.Initializing&&_(nt.Initialized)},[Y,y]),b.useEffect(()=>{const{onDragMove:ue}=I.current,{active:he,activatorEvent:ge,collisions:Ne,over:me}=G.current;if(!he||!ge)return;const pe={active:he,activatorEvent:ge,collisions:Ne,delta:{x:_e.x,y:_e.y},over:me};Lt.unstable_batchedUpdates(()=>{ue==null||ue(pe),E({type:"onDragMove",event:pe})})},[_e.x,_e.y]),b.useEffect(()=>{const{active:ue,activatorEvent:he,collisions:ge,droppableContainers:Ne,scrollAdjustedTranslate:me}=G.current;if(!ue||S.current==null||!he||!me)return;const{onDragOver:pe}=I.current,Ee=Ne.get(yt),Qe=Ee&&Ee.rect.current?{id:Ee.id,rect:Ee.rect.current,data:Ee.data,disabled:Ee.disabled}:null,ce={active:ue,activatorEvent:he,collisions:ge,delta:{x:me.x,y:me.y},over:Qe};Lt.unstable_batchedUpdates(()=>{sn(Qe),pe==null||pe(ce),E({type:"onDragOver",event:ce})})},[yt]),Fe(()=>{G.current={activatorEvent:D,active:j,activeNode:X,collisionRect:Xe,collisions:at,droppableRects:V,draggableNodes:N,draggingNode:te,draggingNodeRect:re,droppableContainers:O,over:Pe,scrollableAncestors:xe,scrollAdjustedTranslate:_e},P.current={initial:re,translated:Xe}},[j,X,at,Xe,N,te,re,V,O,Pe,xe,_e]),vm({...H,delta:T,draggingRect:Xe,pointerCoordinates:Ze,scrollableAncestors:xe,scrollableAncestorRects:Ve});const Qn=b.useMemo(()=>({active:j,activeNode:X,activeNodeRect:Y,activatorEvent:D,collisions:at,containerNodeRect:Q,dragOverlay:Z,draggableNodes:N,droppableContainers:O,droppableRects:V,over:Pe,measureDroppableContainers:B,scrollableAncestors:xe,scrollableAncestorRects:Ve,measuringConfiguration:F,measuringScheduled:W,windowRect:Ke}),[j,X,Y,D,at,Q,Z,N,O,V,Pe,B,xe,Ve,F,W,Ke]),er=b.useMemo(()=>({activatorEvent:D,activators:cn,active:j,activeNodeRect:Y,ariaDescribedById:{draggable:L},dispatch:w,draggableNodes:N,over:Pe,measureDroppableContainers:B}),[D,cn,j,Y,w,L,N,Pe,B]);return fe.createElement(pa.Provider,{value:g},fe.createElement(Gn.Provider,{value:er},fe.createElement(Na.Provider,{value:Qn},fe.createElement(Aa.Provider,{value:Zn},u)),fe.createElement(Hm,{disabled:(a==null?void 0:a.restoreFocus)===!1})),fe.createElement(Vp,{...a,hiddenTextDescribedById:L}));function tr(){const ue=(k==null?void 0:k.autoScrollEnabled)===!1,he=typeof c=="object"?c.enabled===!1:c===!1,ge=C&&!ue&&!he;return typeof c=="object"?{...c,enabled:ge}:{enabled:ge}}}),Um=b.createContext(null),Ei="button",qm="Draggable";function Gm(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const i=on(qm),{activators:s,activatorEvent:a,active:c,activeNodeRect:u,ariaDescribedById:l,draggableNodes:f,over:d}=b.useContext(Gn),{role:h=Ei,roleDescription:m="draggable",tabIndex:p=0}=o??{},v=(c==null?void 0:c.id)===t,w=b.useContext(v?Aa:Um),[E,g]=Rn(),[y,_]=Rn(),C=Rm(s,t),M=Gt(n);Fe(()=>(f.set(t,{id:t,key:i,node:E,activatorNode:y,data:M}),()=>{const T=f.get(t);T&&T.key===i&&f.delete(t)}),[f,t]);const N=b.useMemo(()=>({role:h,tabIndex:p,"aria-disabled":r,"aria-pressed":v&&h===Ei?!0:void 0,"aria-roledescription":m,"aria-describedby":l.draggable}),[r,h,p,v,m,l.draggable]);return{active:c,activatorEvent:a,activeNodeRect:u,attributes:N,isDragging:v,listeners:r?void 0:C,node:E,over:d,setNodeRef:g,setActivatorNodeRef:_,transform:w}}function Km(){return b.useContext(Na)}const Zm="Droppable",Jm={timeout:25};function Qm(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const i=on(Zm),{active:s,dispatch:a,over:c,measureDroppableContainers:u}=b.useContext(Gn),l=b.useRef({disabled:n}),f=b.useRef(!1),d=b.useRef(null),h=b.useRef(null),{disabled:m,updateMeasurementsFor:p,timeout:v}={...Jm,...o},w=Gt(p??r),E=b.useCallback(()=>{if(!f.current){f.current=!0;return}h.current!=null&&clearTimeout(h.current),h.current=setTimeout(()=>{u(Array.isArray(w.current)?w.current:[w.current]),h.current=null},v)},[v]),g=qn({callback:E,disabled:m||!s}),y=b.useCallback((N,T)=>{g&&(T&&(g.unobserve(T),f.current=!1),N&&g.observe(N))},[g]),[_,C]=Rn(y),M=Gt(t);return b.useEffect(()=>{!g||!_.current||(g.disconnect(),f.current=!1,g.observe(_.current))},[_,g]),b.useEffect(()=>(a({type:le.RegisterDroppable,element:{id:r,key:i,disabled:n,node:_,rect:d,data:M}}),()=>a({type:le.UnregisterDroppable,key:i,id:r})),[r]),b.useEffect(()=>{n!==l.current.disabled&&(a({type:le.SetDroppableDisabled,id:r,key:i,disabled:n}),l.current.disabled=n)},[r,i,n,a]),{active:s,rect:d,isOver:(c==null?void 0:c.id)===r,node:_,over:c,setNodeRef:C}}const ey=e=>{let{transform:t}=e;return{...t,x:0}};function uo(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function ty(e,t){return e.reduce((n,r,o)=>{const i=t.get(r);return i&&(n[o]=i),n},Array(e.length))}function yn(e){return e!==null&&e>=0}function ny(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ry(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Da=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const i=uo(t,r,n),s=t[o],a=i[o];return!a||!s?null:{x:a.left-s.left,y:a.top-s.top,scaleX:a.width/s.width,scaleY:a.height/s.height}},xn={scaleX:1,scaleY:1},oy=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:i,overIndex:s}=e;const a=(t=i[n])!=null?t:r;if(!a)return null;if(o===n){const u=i[s];return u?{x:0,y:n<s?u.top+u.height-(a.top+a.height):u.top-a.top,...xn}:null}const c=iy(i,o,n);return o>n&&o<=s?{x:0,y:-a.height-c,...xn}:o<n&&o>=s?{x:0,y:a.height+c,...xn}:{x:0,y:0,...xn}};function iy(e,t,n){const r=e[t],o=e[t-1],i=e[t+1];return r?n<t?o?r.top-(o.top+o.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Ia="Sortable",ka=fe.createContext({activeIndex:-1,containerId:Ia,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Da,disabled:{draggable:!1,droppable:!1}});function sy(e){let{children:t,id:n,items:r,strategy:o=Da,disabled:i=!1}=e;const{active:s,dragOverlay:a,droppableRects:c,over:u,measureDroppableContainers:l}=Km(),f=on(Ia,n),d=a.rect!==null,h=b.useMemo(()=>r.map(C=>typeof C=="object"&&"id"in C?C.id:C),[r]),m=s!=null,p=s?h.indexOf(s.id):-1,v=u?h.indexOf(u.id):-1,w=b.useRef(h),E=!ny(h,w.current),g=v!==-1&&p===-1||E,y=ry(i);Fe(()=>{E&&m&&l(h)},[E,h,m,l]),b.useEffect(()=>{w.current=h},[h]);const _=b.useMemo(()=>({activeIndex:p,containerId:f,disabled:y,disableTransforms:g,items:h,overIndex:v,useDragOverlay:d,sortedRects:ty(h,c),strategy:o}),[p,f,y.draggable,y.droppable,g,h,v,c,d,o]);return fe.createElement(ka.Provider,{value:_},t)}const ay=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return uo(n,r,o).indexOf(t)},cy=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:i,newIndex:s,previousItems:a,previousContainerId:c,transition:u}=e;return!u||!r||a!==i&&o===s?!1:n?!0:s!==o&&t===c},ly={duration:200,easing:"ease"},Ra="transform",uy=Kt.Transition.toString({property:Ra,duration:0,easing:"linear"}),dy={roleDescription:"sortable"};function fy(e){let{disabled:t,index:n,node:r,rect:o}=e;const[i,s]=b.useState(null),a=b.useRef(n);return Fe(()=>{if(!t&&n!==a.current&&r.current){const c=o.current;if(c){const u=Tt(r.current,{ignoreTransform:!0}),l={x:c.left-u.left,y:c.top-u.top,scaleX:c.width/u.width,scaleY:c.height/u.height};(l.x||l.y)&&s(l)}}n!==a.current&&(a.current=n)},[t,n,r,o]),b.useEffect(()=>{i&&s(null)},[i]),i}function hy(e){let{animateLayoutChanges:t=cy,attributes:n,disabled:r,data:o,getNewIndex:i=ay,id:s,strategy:a,resizeObserverConfig:c,transition:u=ly}=e;const{items:l,containerId:f,activeIndex:d,disabled:h,disableTransforms:m,sortedRects:p,overIndex:v,useDragOverlay:w,strategy:E}=b.useContext(ka),g=gy(r,h),y=l.indexOf(s),_=b.useMemo(()=>({sortable:{containerId:f,index:y,items:l},...o}),[f,o,y,l]),C=b.useMemo(()=>l.slice(l.indexOf(s)),[l,s]),{rect:M,node:N,isOver:T,setNodeRef:O}=Qm({id:s,data:_,disabled:g.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...c}}),{active:R,activatorEvent:P,activeNodeRect:j,attributes:S,setNodeRef:k,listeners:A,isDragging:D,over:$,setActivatorNodeRef:I,transform:L}=Gm({id:s,data:_,attributes:{...dy,...n},disabled:g.draggable}),z=Ip(O,k),F=!!R,V=F&&!m&&yn(d)&&yn(v),B=!w&&D,W=B&&V?L:null,U=V?W??(a??E)({rects:p,activeNodeRect:j,activeIndex:d,overIndex:v,index:y}):null,H=yn(d)&&yn(v)?i({id:s,items:l,activeIndex:d,overIndex:v}):y,q=R==null?void 0:R.id,Y=b.useRef({activeId:q,items:l,newIndex:H,containerId:f}),Q=l!==Y.current.items,G=t({active:R,containerId:f,isDragging:D,isSorting:F,id:s,index:y,items:l,newIndex:Y.current.newIndex,previousItems:Y.current.items,previousContainerId:Y.current.containerId,transition:u,wasDragging:Y.current.activeId!=null}),J=fy({disabled:!G,index:y,node:N,rect:M});return b.useEffect(()=>{F&&Y.current.newIndex!==H&&(Y.current.newIndex=H),f!==Y.current.containerId&&(Y.current.containerId=f),l!==Y.current.items&&(Y.current.items=l)},[F,H,f,l]),b.useEffect(()=>{if(q===Y.current.activeId)return;if(q!=null&&Y.current.activeId==null){Y.current.activeId=q;return}const te=setTimeout(()=>{Y.current.activeId=q},50);return()=>clearTimeout(te)},[q]),{active:R,activeIndex:d,attributes:S,data:_,rect:M,index:y,newIndex:H,items:l,isOver:T,isSorting:F,isDragging:D,listeners:A,node:N,overIndex:v,over:$,setNodeRef:z,setActivatorNodeRef:I,setDroppableNodeRef:O,setDraggableNodeRef:k,transform:J??U,transition:Z()};function Z(){if(J||Q&&Y.current.newIndex===y)return uy;if(!(B&&!io(P)||!u)&&(F||G))return Kt.Transition.toString({...u,property:Ra})}}function gy(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}ne.Down,ne.Right,ne.Up,ne.Left;const py=[{title:"component_name",dataIndex:"component_name",render:(e,t)=>x.jsx(Di,{placement:"right",title:x.jsx(x.Fragment,{children:x.jsxs("ul",{children:[x.jsxs("li",{children:["component_id: ",t.component_id]}),x.jsxs("li",{children:["relation_id: ",t.relation_id]})]})}),children:t.component_name})}],my=e=>{const{attributes:t,listeners:n,setNodeRef:r,transform:o,transition:i,isDragging:s}=hy({id:e["data-row-key"]}),a={...e.style,transform:Kt.Translate.toString(o),transition:i,cursor:"move",...s?{position:"relative",zIndex:9999}:{}};return x.jsx("tr",{...e,ref:r,style:a,...t,...n})},yy=({data:e,callback:t})=>{const[n,r]=b.useState(e),{messageApi:o}=st(),i=Yp(Xp(lo,{activationConstraint:{distance:1}})),s=async()=>{const c=n.map((u,l)=>({order_index:l,relation_id:u.relation_id}));await xc(c),o.success("保存成功"),t&&t()},a=({active:c,over:u})=>{c.id!==(u==null?void 0:u.id)&&r(l=>{const f=l.findIndex(h=>h.key===c.id),d=l.findIndex(h=>h.key===(u==null?void 0:u.id));return uo(l,f,d)})};return x.jsx(Wm,{sensors:i,modifiers:[ey],onDragEnd:a,children:x.jsx(sy,{items:n.map(c=>c.key),strategy:oy,children:x.jsx(Fr,{pagination:!1,size:"small",components:{body:{row:my}},rowKey:"key",columns:py,dataSource:n,footer:()=>x.jsx(ht,{justify:"end",children:x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:s,children:"保存"})})})})})},xy=({visible:e,onClose:t,params:n,callback:r})=>e?x.jsx(It,{footer:null,open:e,onCancel:t,title:"更新排序",children:x.jsx(yy,{data:n.software.map(o=>({...o,key:o.component_id})),callback:r})}):null,vy=({visible:e,onClose:t,params:n,callback:r})=>e?x.jsx(It,{title:"说明",width:"50%",onCancel:t,onClose:t,open:e,footer:!1,children:x.jsx(Lc,{data:n})}):null,Uy=({})=>{console.log("Pipeline");const{component_type:e,component_id:t}=uc(),[n,r]=b.useState(),o=dc(),[i,s]=b.useState(!0),[a,c]=Ci.useMessage(),u={inputFile:b.useRef(null),outputFile:b.useRef(null)},{modal:l,openModal:f,closeModal:d}=fc(),{modals:h,openModals:m,closeModals:p}=hc(["modalD","metadataModal","bindSample"]),v=async()=>{let g=`/get-pipeline-v2/${t}?component_type=${e}`;e=="script"&&(g=`/get-component-parent/${t}?component_type=${e}`);let _=(await ot.get(g)).data;"content"in _&&(_={...JSON.parse(_.content),..._}),r(_),console.log(_)},E={deletePipelineRelation:async g=>{try{const y=await bc(g);a.success("删除成功!"),v()}catch(y){console.log(y),a.error(`删除失败!${y.response.data.detail}`)}},openModal:f,openModals:m};return b.useEffect(()=>{v()},[]),x.jsxs("div",{style:{maxWidth:"1500px",margin:"0 auto"},children:[c,x.jsxs(ht,{style:{marginBottom:"1rem"},justify:"space-between",align:"center",gap:"small",children:[x.jsx("div",{children:n?x.jsxs(x.Fragment,{children:[x.jsxs("h2",{style:{margin:0},children:[n==null?void 0:n.component_name,x.jsx(Di,{title:n==null?void 0:n.namespace,children:x.jsxs("span",{style:{margin:"0",color:"rgba(0, 0, 0, 0.45)",fontSize:"1rem"},children:[" ",n==null?void 0:n.namespace_name]})})]}),!1,n.tags&&Array.isArray(n.tags)&&n.tags.map((g,y)=>x.jsx(zc,{style:{marginTop:"0.5rem"},color:mc[y],children:g},y))]}):x.jsx(gc,{active:!0})}),x.jsxs(ht,{gap:"small",wrap:!0,children:[e=="pipeline"&&x.jsx(x.Fragment,{children:x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f("sortSoftware",{software:n.software})},children:"更新排序"})}),x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{E.openModal("modalG",n)},children:"查看依赖"}),x.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m("metadataModal",{...n,operatePipeline:E})},children:"metadata"}),x.jsxs(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f("modalC",{data:n,structure:{component_type:e}})},children:["更新",e]}),x.jsx(se,{size:"small",color:"primary",variant:"solid",onClick:v,children:"刷新"}),x.jsx(se,{size:"small",color:"primary",variant:"solid",onClick:()=>o(`/${e}-card`),children:"返回"})]})]}),x.jsx(by,{component_type:e||"",component:n,tableRef:u,operatePipeline:E}),x.jsx(Qc,{visible:l.key=="modalB"&&l.visible,onClose:d,callback:v,params:l.params}),x.jsx(vc,{callback:v,visible:l.key=="modalA"&&l.visible,onClose:d,params:{...l.params,namespace:n==null?void 0:n.namespace}}),x.jsx(wc,{callback:v,visible:l.key=="modalC"&&l.visible,onClose:d,params:l.params}),x.jsx(tl,{visible:h.modalD.visible,params:h.modalD.params,onClose:()=>p("modalD")}),x.jsx(ol,{visible:l.key=="modalE"&&l.visible,onClose:d,params:l.params}),x.jsx(il,{visible:l.key=="modalF"&&l.visible,onClose:d,params:l.params}),x.jsx(Mc,{visible:l.key=="modalG"&&l.visible,onClose:d,callback:v,params:l.params}),x.jsx(_c,{visible:l.key=="modalH"&&l.visible,onClose:d,value:l.params}),x.jsx(Ic,{visible:h.metadataModal.visible,onClose:()=>p("metadataModal"),params:h.metadataModal.params}),x.jsx(sl,{visible:l.key=="metadataForm"&&l.visible,onClose:d,params:l.params}),x.jsx(kc,{visible:h.bindSample.visible,onClose:()=>p("bindSample"),operatePipeline:E,params:h.bindSample.params}),x.jsx(Rc,{visible:l.key=="openFile"&&l.visible,onClose:d,params:l.params}),x.jsx(xy,{visible:l.key=="sortSoftware"&&l.visible,onClose:d,params:l.params,callback:v}),x.jsx(vy,{visible:l.key=="descriptionModal"&&l.visible,onClose:d,params:l.params,callback:v})]})},wy=({component_type:e,operatePipeline:t,component:n,...r})=>{if(!e||!n)return null;const i={pipeline:Cy,software:Sy,file:_y,script:Ey,module:"module-card"}[e];return i?x.jsx(i,{operatePipeline:t,component:n,...r}):null},by=fe.memo(wy,(e,t)=>JSON.stringify(e)===JSON.stringify(t)),Sy=({operatePipeline:e,component:t,...n})=>x.jsx(x.Fragment,{children:x.jsx(ki,{...t,operatePipeline:e})}),_y=({operatePipeline:e,component:t,...n})=>{const{project:r}=st();return x.jsx(x.Fragment,{children:x.jsx(Ii,{...t,analysisMethod:[t],operatePipeline:e,project:r})})},Ey=({operatePipeline:e,component:t,...n})=>{const{project:r}=st();return x.jsx(x.Fragment,{children:x.jsx(Ii,{script:t.script,analysisMethod:t.parent||[],operatePipeline:e,project:r})})},Cy=({operatePipeline:e,component:t,...n})=>{const[r,o]=b.useState([]),{project:i}=st(),s=u=>{const l=u.software;return l?l.map((f,d)=>({key:f.component_id,label:f.component_name||f.component_id,children:x.jsx(ki,{...n,...f,hiddenUpstreamAnalysis:!0,pipeline:{component_id:u.component_id},operatePipeline:e})})):[]},a=u=>{const l=u.software;if(!l)return[];const d=(JSON.parse(u.position)||[]).reduce((m,p)=>(m[p.component_id]=p.position,m),{});return l.map((m,p)=>{const v=m.component_name,w=(m.inputFile||[]).map(g=>g),E=(m.outputFile||[]).map(g=>g);return{id:m.component_id,type:"custom",position:d[m.component_id]||{x:p*300,y:100},data:{label:v,color:"#"+((1<<24)*Math.random()|0).toString(16),inputs:w,outputs:E}}})||[]},c=u=>JSON.parse(u.edges)||[];return b.useEffect(()=>{t&&o(s(t))},[JSON.stringify(t)]),console.log("--->PipelineComponent渲染"),x.jsxs(x.Fragment,{children:[x.jsx(Ap,{initialEdges:c(t),initialNodes:a(t),component:t}),x.jsx("div",{style:{marginTop:"1rem"}}),x.jsx(pc,{...t,project:i,operatePipeline:e,inputAnalysisMethod:t.inputFile}),t&&Array.isArray(t==null?void 0:t.software)?x.jsx(Or,{destroyInactiveTabPane:!0,items:r}):x.jsxs(Mi,{children:[x.jsx(se,{style:{marginRight:"0.5rem"},color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalC",{data:void 0,structure:{component_type:"software",relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"新增软件"}),x.jsx(se,{color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"添加软件"})]})]})};export{Uy as default};

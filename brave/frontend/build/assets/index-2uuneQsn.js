import{j as e,r as j,f as w,d as k,p as S,B as y,P as T,g as f,I as v,F as m,a as g,M as _,i as z,c as P}from"./index-B1qN1Q03.js";import{u as M}from"./usePagination-Dv1iJWie.js";import{S as E,F as $}from"./Table-hZz0WDRz.js";import{T as A}from"./index-Bt44_A0u.js";import{P as B}from"./index-Duih0CrQ.js";import"./addEventListener-DomEhDYp.js";import"./Dropdown-BbOf2_FP.js";const N=n=>{let t=[{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id"},{title:"entity_name",dataIndex:"entity_name",key:"entity_name"}];switch(n){case"taxonomy":t=[...t,{title:"rank",dataIndex:"rank",key:"rank"},{title:"division_name",dataIndex:"division_name",key:"division_name"}];break}return t},O=()=>e.jsx(e.Fragment,{}),D={taxonomy:O},R=({type:n})=>{const t=D[n]||(()=>e.jsx("div",{}));return e.jsx(t,{})},Q=({params:n,rowSelection:t})=>{const[i,d]=j.useState("taxonomy"),{data:a,pageNumber:x,totalPage:l,loading:r,reload:c,pageSize:u,setPageNumber:o,search:C}=M({url:`/entity/page/${i}`,params:n||{}});w();const{messageApi:J}=k(),{modal:h,openModal:p,closeModal:I}=S(),F=[...N(i),{title:"操作",key:"action",fixed:"right",width:200,render:(s,b)=>e.jsxs(E,{size:"middle",children:[e.jsx(y,{size:"small",color:"cyan",variant:"solid",onClick:()=>{p("modalA",{entityType:i,entityId:b.entity_id})},children:"更新"}),e.jsx(T,{title:"确认删除?",onConfirm:()=>{},children:e.jsx(y,{size:"small",danger:!0,variant:"solid",children:"删除"})})]})}];return e.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[e.jsxs(f,{justify:"flex-end",gap:"small",children:[e.jsx(y,{size:"small",color:"cyan",variant:"solid",onClick:()=>{p("modalA",{entityType:i})},children:"新增"}),e.jsx(y,{size:"small",color:"cyan",variant:"solid",onClick:c,children:"刷新"})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:" "}),e.jsx(A,{size:"small",onChange:s=>{d(s)},items:[{key:"taxonomy",label:"Microbiota"},{key:"study",label:"Study"},{key:"disease",label:"Psychiatric Disorder"}]}),e.jsx($,{title:()=>e.jsx(v.Search,{size:"small",placeholder:"搜索...",allowClear:!0,enterButton:!0,onSearch:s=>{C(s)},style:{width:300}}),rowKey:s=>s.id,size:"small",bordered:!0,rowSelection:t,pagination:!1,loading:r,columns:F,dataSource:a,footer:()=>e.jsx(e.Fragment,{children:l!=0&&e.jsxs(f,{style:{marginTop:"1rem"},align:"center",children:["一共",l,"条数据  ",e.jsx(B,{size:"small",current:x,pageSize:u,total:l,onChange:s=>o(s),showSizeChanger:!1})]})})}),e.jsx(V,{callback:c,visible:h.key=="modalA"&&h.visible,params:h.params,onClose:I})]})},V=({visible:n,params:t,onClose:i,callback:d})=>{const[a]=m.useForm(),{messageApi:x}=k(),[l,r]=j.useState(!1);j.useEffect(()=>{n&&(t!=null&&t.entityId)?c():a.resetFields()},[n]);const c=async()=>{r(!0);const o=await g.get(`/entity/get/${t.entityType}/${t.entityId}`);a.setFieldsValue(o.data),r(!1)},u=async()=>{const o=await a.validateFields();t!=null&&t.entityId?await g.put(`/entity/update/${t.entityType}/${t.entityId}`,o):await g.post(`/entity/add/${t.entityType}`,o),i(),d&&d(),x.success("操作成功!")};return e.jsx(_,{loading:l,title:t!=null&&t.entityId?"编辑实体":"创建实体",onOk:u,width:"50%",open:n,onClose:i,onCancel:i,children:e.jsxs(m,{form:a,children:[e.jsx(m.Item,{name:"entity_name",label:"实体名称",children:e.jsx(v,{})}),e.jsx(R,{type:t==null?void 0:t.entityType}),e.jsx(z,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(m.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(P,{children:e.jsx("pre",{children:JSON.stringify(a.getFieldsValue(),null,2)})})})})}]})]})})};export{Q as default};

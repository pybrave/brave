import{r as o,u as Q,Z,as as G,b as J,at as U,c as N,j as e,R as V,C as M,E as Y,S as X,F as B,B as R,x as O,a as I,a0 as ee}from"./main-B2jPVJuc.js";import{d as se}from"./index-CFkosLO7.js";import te from"./index-CwSQOIN4.js";import{u as ae}from"./useStickyTop-CUcu_dat.js";import{C as b}from"./index-01a6DBbv.js";import{T as oe}from"./Table-D1zuQkUf.js";import"./index-D5lQbqN-.js";import"./index-ROS2ditM.js";import"./index-umuRLg26.js";import"./UpOutlined-BLGU6aq-.js";import"./DeleteOutlined-7aDqphvw.js";import"./index-D94Q12AR.js";import"./index-bd5EV77p.js";import"./Dropdown-DxVuU2Kw.js";import"./index-Bi5GN48q.js";import"./index-CVH_8gwK.js";import"./study-page-BuxTE7mG.js";import"./usePagination-BFzen1kl.js";import"./index-IGtn9UM1.js";import"./RedoOutlined-B2jLc-U5.js";import"./index-CjBmKVj7.js";import"./index-Dusr40e4.js";import"./index-ClcbhDbg.js";import"./callSuper--xQhnHMR.js";import"./index-JnpnusFw.js";import"./addEventListener-BtkycpkD.js";const _e=()=>{const[h,i]=o.useState(!1),{project:r,projectObj:a}=Q(s=>s.user),[m,v]=o.useState(),[j,x]=o.useState(),C=Z(),g=new URLSearchParams(C.search),t=g.get("key"),n=g.get("project"),d=G(),{modal:l,openModal:k,closeModal:K}=J(),[E,z]=o.useState(t),T=async()=>{const s=await I.get(`/project/find-by-project-id/${r}`);d(U({projectObj:s.data}))};o.useEffect(()=>{n&&n!=r&&d(U({project:n}))},[n]),o.useRef(null),N();const S=(s,c)=>{const{pathname:p,search:w,hash:f}=window.location,u=new URLSearchParams(w||"");u.set(s,c);const P=f.startsWith("#/");let y="";if(P){const[q,H=""]=f.replace(/^#/,"").split("?"),D=new URLSearchParams(H);D.set(s,c),y=`#${q}?${D.toString()}`}else y=`${p}?${u.toString()}`;window.history.pushState({},"",y)},[L,_]=o.useState("analysis_result"),{ref:W,top:$,isSticky:A}=ae(576),F=async()=>{var c,p,w,f,u,P,y;i(!0);let s=await I.post("/list-analysis-tree",{is_report:!0,project:r});v(s.data),!t&&s.data.length>0&&(c=s.data[0])!=null&&c.children&&((p=s.data[0])==null?void 0:p.children.length)>0&&(x((w=s.data[0])==null?void 0:w.children[0]),z((u=(f=s.data[0])==null?void 0:f.children[0])==null?void 0:u.key),S("project",r),S("key",(y=(P=s.data[0])==null?void 0:P.children[0])==null?void 0:y.key)),i(!1)};return o.useEffect(()=>{F()},[r]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"1rem auto"},children:[e.jsx("div",{}),e.jsxs(V,{gutter:[A?16:0,16],children:[e.jsxs(M,{lg:20,sm:20,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("div",{style:{flex:1,display:L==="analysis_result"?"block":"none",height:"100%"},children:E?e.jsx(e.Fragment,{children:e.jsx(se,{overflowY:"auto",openPanel:_,cancalReportCallback:()=>{F()},analysis_id:E})}):e.jsx(e.Fragment,{children:e.jsx(b,{size:"small",variant:"borderless",children:e.jsx(Y,{})})})}),L=="note"&&e.jsx("div",{children:e.jsx(b,{style:{flex:1,display:"flex",flexDirection:"column",height:" 100%",boxShadow:"none"},styles:{body:{flex:1,display:"flex",flexDirection:"column",height:" 100%",padding:0,overflowY:"auto"}},variant:"borderless",size:"small",extra:e.jsxs(B,{gap:"small",children:[e.jsx(R,{size:"small",color:"primary",variant:"solid",onClick:()=>{_("analysis_result")},children:"Back"}),e.jsx(R,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k("projectForm",{project_id:r})},children:"Edit"}),e.jsx(R,{size:"small",color:"cyan",variant:"solid",onClick:()=>{T()},children:"Refresh"})]}),children:a!=null&&a.description?e.jsx(te,{data:a==null?void 0:a.description}):e.jsx(X,{active:!0})})})]}),e.jsx(M,{lg:4,sm:4,xs:24,ref:W,style:A?{overflowY:"hidden",position:"sticky",top:`${$}px`,alignSelf:"flex-start",height:`calc(100vh - ${$}px - 1rem )`}:{},children:e.jsx(b,{loading:h,title:a==null?void 0:a.project_name,size:"small",style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(B,{gap:"small",children:e.jsx(R,{size:"small",color:"cyan",variant:"solid",onClick:F,children:"Refresh"})}),children:Array.isArray(m)&&m.length!=0?e.jsx(e.Fragment,{children:e.jsx(re,{onSelect:s=>{var c,p;((c=s.node)==null?void 0:c.type)=="analysis"?(x(s.node),z(s.node.key),S("project",r),S("key",s.node.key)):((p=s.node)==null?void 0:p.type)=="components"&&console.log(s.node)},defaultSelectKey:E,treeData:m})}):e.jsx(e.Fragment,{children:e.jsx(Y,{})})})})]}),e.jsx(O,{research:!0,params:l.params,visible:l.key=="projectForm"&&l.visible,onClose:K})]})},re=({treeData:h,defaultSelectKey:i,onSelect:r})=>{const[a,m]=o.useState(i),[v,j]=o.useState([]),x=(t,n,d=[])=>{for(const l of n){if(l.key===t)return d;if(l.children){const k=x(t,l.children,[...d,l.key]);if(k.length)return k}}return[]};o.useEffect(()=>{if(i){const t=x(i,h);j(t),m(i)}},[i,h]);const C=(t,n)=>{if(t.length>0){r(n),m(t[0]);const d=x(t[0],h);j(d)}},g=t=>{j(t)};return e.jsx(e.Fragment,{children:e.jsx(oe,{selectedKeys:[a],showLine:!0,expandedKeys:v,onExpand:g,autoExpandParent:!0,switcherIcon:e.jsx(ee,{}),onSelect:C,treeData:h})})};export{_e as default};

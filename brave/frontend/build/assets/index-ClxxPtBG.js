import{a as g,r as c,f as U,d as M,p as R,j as e,g as z,B as k,P as L,F as s,M as q,I as C,T as N,S as O,i as $,c as A}from"./index-D_hCWDFH.js";import{M as K}from"./index-BFzvO-9V.js";import{T as W,C as H}from"./index-EMrVFJYW.js";import{F as Q,S as X}from"./Table-Q3xM4cQ-.js";import{P as Y}from"./index-BhPrE-Dp.js";const ge=async t=>await g.post("/page-pipeline-components",t),Z=async t=>await g.post("/list-pipeline-components",t),xe=async t=>await g.delete(`/delete-pipeline-relation/${t}`),je=async t=>await g.delete(`/delete-component/${t}`),he=async t=>await g.post("/save-component-relation-order",t),ye=async t=>await g.post("/save-pipeline-components-edges",t),ee={script_type:"nextflow",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/nextflow:25.06.0",databases:[{name:"metaphlan_database",dataKey:"metaphlan_database",label:"metaphlan_database",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}],upstreamFormJson:[{name:"stat_q",data:[{label:"0.2",value:.2},{label:"0",value:0}],initialValue:.2,label:" Quantile value for the robust average(--stat_q)",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}]},te={name:"丰度矩阵",script_type:"python",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/datascience-notebook:x86_64-ubuntu-22.04",sampleGroupJSON:!0,saveAnalysisMethod:"metaphlan_sam_abundance_matrix",moduleName:"abundance_matrix",formJson:[{name:"group_field",label:"分组列",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"},{name:"metaphlan_sam_abundance",label:"丰度文件",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupSelectSampleButton",group:"group_field"}],tableDesc:""},ne={name:"raw_reads",label:"下机原始reads",mode:"multiple",type:"GroupSelectSampleButton",group:"group_field",rules:[{required:!0,message:"该字段不能为空!"}],dir:"metaphlan",fileFormat:{profile:"*/*_profile.txt"},inputForm:[{name:["content","fastq1"],initialValue:"/data/wangyang/NGS_TEST/*_1.fastq.gz",label:"fastq1",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]},{name:["content","fastq2"],initialValue:"/data/wangyang/NGS_TEST/*_2.fastq.gz",label:"fastq2",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]}]},ae=async t=>await g.post("/container/page",t),se=({pageApi:t,params:n,map:a,initialPageSize:p=12})=>{const[l,o]=c.useState([]),[i,m]=c.useState(1),[f,w]=c.useState(0),[h,F]=c.useState(!1),[v]=c.useState(p),I=async P=>{F(!0);try{const b=await t({...n,page_number:P,page_size:v}),{items:x,total:r,...u}=b.data;a?(b.data=x.map(a),o(b.data)):o(b.data.items),w(r)}catch(b){console.error("Error fetching data:",b)}finally{F(!1)}},y=()=>{I(i)};return c.useEffect(()=>{I(i)},[i]),{data:l,pageNumber:i,totalPage:f,loading:h,setPageNumber:m,pageSize:v,reload:y}},B=({params:t,rowSelection:n})=>{const{data:a,pageNumber:p,totalPage:l,loading:o,reload:i,pageSize:m,setPageNumber:f}=se({pageApi:ae,params:t||{}});U();const{messageApi:w}=M(),{modal:h,openModal:F,closeModal:v}=R(),I=[{title:"namespace",dataIndex:"namespace_name",key:"namespace_name"},{title:"container_id",dataIndex:"container_id",key:"container_id"},{title:"名称",dataIndex:"name",key:"name"},{title:"镜像",dataIndex:"image",key:"image"},{title:"操作",key:"action",fixed:"right",width:200,render:(y,P)=>e.jsxs(X,{size:"middle",children:[e.jsx(k,{size:"small",color:"cyan",variant:"solid",onClick:()=>{F("modalA",P.container_id)},children:"更新"}),e.jsx(L,{title:"确认删除?",onConfirm:()=>{},children:e.jsx(k,{size:"small",danger:!0,variant:"solid",children:"删除"})})]})}];return e.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[e.jsxs(z,{justify:"flex-end",gap:"small",children:[e.jsx(k,{size:"small",color:"cyan",variant:"solid",onClick:()=>{F("modalA")},children:"新增"}),e.jsx(k,{size:"small",color:"cyan",variant:"solid",onClick:i,children:"刷新"})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:" "}),e.jsx(Q,{rowKey:y=>y.id,size:"small",rowSelection:n,pagination:!1,loading:o,columns:I,dataSource:a}),l!=0&&e.jsxs(z,{style:{marginTop:"1rem"},align:"center",children:["一共",l,"条数据  ",e.jsx(Y,{current:p,pageSize:m,total:l,onChange:y=>f(y),showSizeChanger:!1})]}),e.jsx(oe,{callback:i,visible:h.key=="modalA"&&h.visible,params:h.params,onClose:v})]})},oe=({visible:t,params:n,onClose:a,callback:p})=>{const[l]=s.useForm(),{messageApi:o}=M();c.useEffect(()=>{t&&n&&i()},[t]);const i=async()=>{const f=await g.get(`/container/find-by-id/${n}`);l.setFieldsValue(f.data)},m=async()=>{const f=await l.validateFields();console.log(f),n&&(f.container_id=n),await g.post("/container/add-or-update-container",f),a(),p&&p(),o.success("操作成功!")};return e.jsx(q,{title:n?"编辑容器":"创建容器",onOk:m,width:"50%",open:t,onClose:a,onCancel:a,children:e.jsxs(s,{form:l,children:[e.jsx(s.Item,{name:"namespace",label:"namespace",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(G,{})}),e.jsx(s.Item,{name:"name",label:"名称",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(C,{})}),e.jsx(s.Item,{name:"image",label:"镜像",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(C,{})}),e.jsx(s.Item,{name:"description",label:"描述",children:e.jsx(N,{})}),e.jsx(s.Item,{name:"envionment",label:"环境变量",children:e.jsx(N,{})}),e.jsx(s.Item,{name:"command",label:"命令",children:e.jsx(N,{})}),e.jsx(s.Item,{name:"labels",label:"标签",children:e.jsx(N,{})}),e.jsx(s.Item,{name:"port",label:"端口",children:e.jsx(C,{})}),e.jsx(s.Item,{name:"change_uid",label:"修改用户",children:e.jsx(O,{options:[{label:"是",value:!0},{label:"否",value:!1}]})}),e.jsx($,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(l.getFieldsValue(),null,2)})})})})}]})]})})},_e=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),be=({visible:t,onClose:n,params:a,callback:p})=>{if(!t)return null;const{data:l,pipelineStructure:o,namespace:i}=a,[m]=s.useForm(),[f,w]=c.useState(),[h,F]=c.useState(),[v,I]=c.useState([]),[y,P]=c.useState(!1),b={pipeline_software:J,software_input_file:J,software_output_file:J,file_script:J},x=({relation_type:S,data:d,form:_})=>{const j=b[S]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(d)]}));return e.jsx(j,{data:d,form:_,components:v})},r=async S=>{const d=await Z({component_type:S,namespace:i}),_=d.data.map(j=>(JSON.parse(j.content),o.relation_type=="pipeline_software"?{label:`${j.component_name}(${j.component_id})`,value:j.component_id}:o.relation_type=="file_script"?{label:`${j.component_name}(${j.component_id})`,value:j.component_id}:{label:`${j.component_name}(${j.component_id})`,value:j.component_id}));console.log(_),I(_),console.log(d)},u=async S=>{const _=(await g.post(`/find-pipeline-relation/${S}`)).data;F(_),m.setFieldsValue(_)};c.useEffect(()=>{t&&(o.relation_type=="pipeline_software"?r("software"):o.relation_type=="software_input_file"||o.relation_type=="software_output_file"?r("file"):o.relation_type=="file_script"&&r("script"),l?u(l.relation_id):m.resetFields())},[t]);const T=S=>{const d={...S,...o};return l&&(d.relation_id=h.relation_id),d},D=async()=>{P(!0);const S=await m.validateFields(),d=T(S);typeof d.content!="string"&&(d.content=JSON.stringify(d.content)),console.log(d);const _=await g.post("/save-pipeline-relation",d);console.log(_),P(!1),p&&p(),n()};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:y,title:`${l?"更新":"新增"}流程(${o==null?void 0:o.relation_type})`,okText:l?"更新":"新增",onOk:D,open:t,footer:(S,{OkBtn:d,CancelBtn:_})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx(d,{})]}),onClose:()=>n(),onCancel:()=>n(),children:e.jsxs(s,{form:m,children:[h&&e.jsx(e.Fragment,{}),e.jsx(x,{...o,data:f,form:m}),e.jsx($,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(T(m.getFieldsValue()),null,2)})})})})}]})]})})})},Se=({visible:t,onClose:n,params:a,callback:p})=>{if(!t)return null;const{data:l,structure:o}=a,[i]=s.useForm(),[m,f]=c.useState(),[w,h]=c.useState(!1),F={pipeline:ce,software:le,file:re,script:ie},v=({component_type:x,data:r,form:u})=>{const T=F[x]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(r)]}));return e.jsx(T,{data:r,form:u,structure:o})},I=async x=>{const u=(await g.post("/find-pipeline",{component_id:x})).data;u.tags&&(u.tags=JSON.parse(u.tags)),f(u),console.log(u),o.component_type=="pipeline"&&(u.content=JSON.parse(u.content)),i.setFieldsValue(u)};c.useEffect(()=>{t&&(l?I(l.component_id):i.resetFields())},[t]);const y=x=>{const r={...x,...o};return l&&(r.component_id=m.component_id),r},P=x=>{const r=y(x);return typeof r.content=="string"&&(r.content=JSON.parse(r.content)),r},b=async()=>{h(!0);const x=await i.validateFields(),r=y(x);typeof r.content!="string"&&(r.content=JSON.stringify(r.content)),typeof r.tags!="string"&&(r.tags=JSON.stringify(r.tags)),console.log(r);const u=await g.post("/save-pipeline",r);console.log(u),h(!1),p&&p(),n()};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:w,title:`${l?"更新":"新增"}流程(${o==null?void 0:o.component_type})`,okText:l?"更新":"新增",onOk:b,open:t,width:"60%",onClose:()=>n(),onCancel:()=>n(),children:e.jsxs(s,{form:i,children:[e.jsx(W,{items:[{label:"组件信息",key:"1",children:e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"component_name",label:"组件名称",children:e.jsx(C,{})}),e.jsx(s.Item,{name:"namespace",label:"namespace",children:e.jsx(G,{disabled:l==null?void 0:l.componemt_id})}),e.jsx(s.Item,{name:"tags",label:"tags",children:e.jsx(O,{mode:"tags",style:{width:"100%"}})}),e.jsx(v,{...o,data:m,form:i})]})},{label:"组件描述",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{name:"description",label:"组件名称",children:e.jsx(E,{templete:""})})})}]}),e.jsx($,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(P(i.getFieldsValue()),null,2)})})})})}]})]})})})},J=({data:t,form:n,components:a})=>e.jsx(e.Fragment,{children:e.jsx(s.Item,{name:"component_id",label:"组件",children:e.jsx(O,{showSearch:!0,options:a})})}),le=({data:t,form:n})=>{const[a,p]=c.useState();return c.useEffect(()=>{t!=null&&t.componemt_id||p(JSON.stringify(ee,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"container_id",label:"容器",children:e.jsx(V,{data:t})}),e.jsx(s.Item,{name:"content",label:"content",children:e.jsx(E,{templete:a})})]})},ie=({data:t,form:n})=>{const[a,p]=c.useState();return c.useEffect(()=>{t!=null&&t.componemt_id||p(JSON.stringify(te,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"container_id",label:"容器",children:e.jsx(V,{data:t})}),e.jsx(s.Item,{name:"content",label:"content",children:e.jsx(E,{templete:a})})]})},re=({data:t,form:n,structure:a})=>{const[p,l]=c.useState();return c.useEffect(()=>{t!=null&&t.componemt_id||l(JSON.stringify(ne,null,2))},[]),e.jsxs(e.Fragment,{children:[(a==null?void 0:a.files)&&e.jsx(H,{style:{maxHeight:"20rem",overflow:"auto",marginBottom:"1rem"},children:e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(a==null?void 0:a.files,null,2)})})}),e.jsx(s.Item,{name:"content",label:"content",children:e.jsx(E,{templete:p})})]})},V=({value:t,onChange:n,data:a})=>{const{modal:p,openModal:l,closeModal:o}=R(),[i,m]=c.useState(a==null?void 0:a.container);return e.jsxs(e.Fragment,{children:[e.jsx(C,{value:i==null?void 0:i.name,style:{cursor:"pointer"},onClick:()=>l("modalA")}),e.jsx(q,{footer:!1,width:"50%",title:"选择容器",open:p.visible&&p.key=="modalA",onClose:o,onCancel:o,children:e.jsx(B,{rowSelection:{type:"radio",onChange:(f,w)=>{w.length>0&&(m(w[0]),n(w[0].container_id),o())}}})})]})},E=({value:t,onChange:n,templete:a})=>{const p=c.useRef(null);return c.useEffect(()=>{a&&n(a)},[]),e.jsx(e.Fragment,{children:e.jsx(K,{value:t,onChange:n,editorRef:p,defaultLanguage:"json"})})},ce=({data:t,form:n})=>e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:["content","name"],label:"name",children:e.jsx(C,{})}),e.jsx(s.Item,{name:["content","script_type"],label:"脚本类型",children:e.jsx(O,{options:[{label:"python",value:"python"},{label:"nextflow",value:"nextflow"},{label:"shell",value:"shell"},{label:"R",value:"R"}]})}),e.jsx(s.Item,{name:["content","image"],label:"镜像",children:e.jsx(C,{})}),e.jsx(s.Item,{name:["content","img"],label:"img",children:e.jsx(C,{})}),e.jsx(s.Item,{name:["content","category"],label:"category",children:e.jsx(C,{})}),e.jsx(s.Item,{name:["content","description"],label:"description",children:e.jsx(N,{})})]}),G=({value:t,onChange:n,disabled:a})=>{const[p,l]=c.useState([]),o=async()=>{const m=(await g.get("/list-namespace")).data;l(m)};return c.useEffect(()=>{o()},[]),e.jsx(e.Fragment,{children:e.jsx(z,{justify:"space-between",children:e.jsx(O,{disabled:a,value:t,onChange:n,options:p.map(i=>({label:i.name,value:i.namespace_id}))})})})};export{be as C,he as a,Se as b,je as c,xe as d,_e as i,ge as p,ye as s,se as u};

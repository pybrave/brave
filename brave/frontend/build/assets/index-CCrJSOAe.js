import{r as o,z as se,_ as te,I as oe,u as F,c as ae,k as ne,b as re,j as e,F as g,B,R as M,C as b,P as q,a1 as le,a as _,s as ie,t as L,l as W,E as Q,S as ce,M as de,y as pe}from"./main-CoRdKxM6.js";import{C as k,M as X}from"./index-mKsixq-F.js";import{c as Y}from"./utils-D2B0dIuM.js";import{b as he,p as me}from"./index-DC2UGVbx.js";import{u as ge}from"./usePagination-P-dGKUc-.js";import{D as ue}from"./index-B0codAn8.js";import{S as G,P as xe}from"./index-Cww7bxT4.js";import{L as U}from"./index-BFM7er4q.js";import{R as D}from"./RedoOutlined-CtyAtPBD.js";import{T as J}from"./index-BHj1h2oY.js";import{S as ye}from"./index-Dm3E-_FQ.js";import{R as fe}from"./DownloadOutlined-DnjYLYJT.js";import"./index-CIQpBAFN.js";import"./Table-C-94KlQV.js";import"./addEventListener-BYJT43cw.js";import"./Dropdown-MRVofdb8.js";import"./index-U82OZ9hL.js";import"./UpOutlined-CjGJavdL.js";import"./DeleteOutlined-LAT7OMWc.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},be=function(i,n){return o.createElement(se,te({},i,{ref:n,icon:je}))},ve=o.forwardRef(be);const Fe=({params:h,map:i})=>{const{Search:n}=oe,{baseURL:A}=F(t=>t.user),H=ae(),{messageApi:K}=ne(),{modal:r,openModal:u,closeModal:v}=re(),[C,N]=o.useState("all"),{component_type:x}=h,S=t=>(i&&(t=i(t)),t.tags&&(t.tags=JSON.parse(t.tags)),{id:t.id,component_id:t.component_id,name:t.name,category:t.category,img:t.img,tags:t.tags,component_type:t.component_type,order:t.order_index,path:`/component/${x}/${t.component_id}`,namespace:t.namespace,namespace_name:t.namespace_name}),{data:y,pageNumber:O,totalPage:w,loading:c,reload:m,pageSize:R,setPageNumber:T,search:E}=ge({pageApi:me,params:{category:C,...h},map:S,initialPageSize:12}),[V,f]=o.useState([]),[z,P]=o.useState(!1),I=async()=>{P(!0);const t=await _.get("/component/get-all-category");f(["all",...t.data]),P(!1)};return o.useEffect(()=>{I()},[]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"1rem auto"},children:[e.jsx(k,{size:"small",children:e.jsxs(g,{justify:"space-between",gap:"small",children:[e.jsx(n,{size:"small",placeholder:"Search Components",allowClear:!0,enterButton:!0,onSearch:t=>{E(t)},style:{width:400}}),e.jsxs(g,{gap:"small",children:[e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:()=>{u("installComponents",{component_type:x})},children:"Intsall Components "}),e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:()=>{u("modalA",{data:void 0,structure:{component_type:x}})},children:"Create Components "}),e.jsx(B,{size:"small",color:"primary",variant:"solid",onClick:m,children:"Refresh"})]})]})}),e.jsxs(M,{style:{marginTop:"1rem"},gutter:16,children:[e.jsx(b,{lg:21,sm:21,xs:24,children:e.jsxs(k,{size:"small",children:[e.jsx(G,{spinning:c,children:Array.isArray(y)&&y.length!=0?e.jsx(M,{gutter:16,style:{position:"relative"},children:y.map((t,j)=>e.jsx(b,{lg:6,sm:4,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsxs(k,{hoverable:!0,size:"small",className:"custom-card",style:{height:"100%",border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease"},bodyStyle:{padding:"12px 16px"},cover:e.jsx("div",{style:{height:"15rem"},children:e.jsx("img",{style:{height:"100%",width:"100%",objectFit:"cover"},alt:t.label,src:`${A}${t.img}`})}),onClick:()=>H(`${t.path}`),children:[e.jsx(X,{title:e.jsxs(g,{gap:"small",children:[e.jsx("span",{children:t.name}),e.jsx(q,{title:"Copy component ?",onConfirm:async l=>{l.stopPropagation(),await _.post(`/copy-component/${t.component_id}`),ie.success("Component copied!"),m()},children:e.jsx(le,{onClick:l=>{l.stopPropagation()}})})]}),description:t==null?void 0:t.description,style:{marginBottom:"1rem"}}),t.tags&&Array.isArray(t.tags)&&t.tags.map((l,$)=>e.jsx(L,{title:l,children:e.jsx(W,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:Y[$],children:l})},$)),e.jsx("div",{onClick:l=>{l.stopPropagation(),u("modalG",t)},style:{position:"absolute",right:10,bottom:10,fontSize:15,color:"rgba(0,0,0,0.45)",cursor:"pointer"},children:e.jsx(ve,{})})]})},j))}):e.jsx(Q,{})}),w!=0&&e.jsxs(g,{style:{marginTop:"1rem"},align:"center",children:["A total of ",w,"records Â ",e.jsx(xe,{current:O,pageSize:R,total:w,onChange:t=>T(t),showSizeChanger:!1})]})]})}),e.jsx(b,{lg:3,sm:3,xs:24,children:e.jsx(k,{extra:e.jsx(D,{style:{cursor:"pointer"},onClick:()=>I()}),size:"small",loading:z,title:e.jsx("span",{style:{fontWeight:600},children:"Category"}),bordered:!1,style:{borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",height:"100%"},bodyStyle:{padding:"0.75rem"},children:z?e.jsx(ce,{active:!0,paragraph:{rows:5}}):e.jsx(U,{dataSource:V,split:!1,renderItem:t=>e.jsx(U.Item,{style:{padding:"6px 0",border:"none"},children:e.jsx(B,{block:!0,type:C===t?"primary":"default",onClick:()=>N(t),style:{textAlign:"left",borderRadius:"8px",transition:"all 0.2s"},className:"hover:shadow-md",children:t})})})})})]}),e.jsx(he,{callback:m,visible:r.key=="modalA"&&r.visible,onClose:v,params:r.params}),e.jsx(ue,{visible:r.key=="modalG"&&r.visible,onClose:v,callback:m,params:r.params}),e.jsx(Ce,{visible:r.key=="installComponents"&&r.visible,onClose:v,callback:m,params:r.params})]})},Ce=({visible:h,onClose:i,params:n,callback:A})=>{const[H,K]=o.useState([]),[r,u]=o.useState([]),[v,C]=o.useState(!1),[N,x]=o.useState(!1),[S,y]=o.useState(),{baseURL:O}=F(s=>s.user),w=pe(),[c,m]=o.useState("github"),{githubToken:R,storeRepos:T}=F(s=>s.user),[E,V]=o.useState([]),[f,z]=o.useState("all"),[P,I]=o.useState();o.useEffect(()=>{h&&(n!=null&&n.component_type)&&t()},[h,n==null?void 0:n.component_type,c]);const t=async()=>{try{C(!0);let d=(await _.get(`/component-store/list-stores?address=${c}`)).data;if(c=="github"&&(d=[...JSON.parse(T||"[]").filter(p=>p.address==c),...d]),K(d),d.length>0){const a=d[0];y(a.store_name),j(a.store_name,void 0,a==null?void 0:a.store_path),I(a==null?void 0:a.store_path)}else u([]);C(!1)}catch{}},j=async(s,d=void 0,a=void 0)=>{x(!0);try{const p=await _.post("/component-store/list-components",{store_name:s,component_type:n==null?void 0:n.component_type,address:c,remote_force:d,token:R,store_path:a||P}),Z=p.data.map(ee=>ee.category);V(["all",...Array.from(new Set(Z))]),u(p.data)}catch{}x(!1)},l=o.useMemo(()=>f=="all"?r:r.filter(s=>s.category==f),[r,f]),$=s=>s.startsWith("http")?s:`${O}${s}`;return e.jsx(de,{footer:null,title:e.jsxs(g,{gap:"small",children:[e.jsxs("span",{children:["Install Components"," "]}),e.jsx(D,{style:{cursor:"pointer"},onClick:()=>{c=="github"?j(S,!0):j(S)}})]}),width:"90%",open:h,onClose:i,onCancel:i,children:e.jsxs(G,{spinning:v,children:[e.jsx(J,{size:"small",tabBarExtraContent:e.jsxs(g,{gap:"small",children:[e.jsx(ye,{value:c,options:[{label:"Github",value:"github"},{label:"Local",value:"local"}],onChange:s=>{m(s)}}),e.jsx(D,{style:{cursor:"pointer"},onClick:()=>t()})]}),activeKey:S,onChange:s=>{y(s),j(s)},items:H.map(s=>({key:s.store_name,label:e.jsx(L,{title:s.store_path,children:s.name?s.name:s.store_name})}))}),e.jsx(G,{spinning:N,children:e.jsxs(M,{children:[e.jsx(b,{lg:21,sm:21,xs:24,children:Array.isArray(l)&&l.length!=0?e.jsx(M,{gutter:16,style:{position:"relative"},children:l.map((s,d)=>e.jsx(b,{lg:4,sm:4,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsx(q,{okButtonProps:{color:`${s.installed?"red":"blue"}`,variant:"solid"},okText:s.installed?"Reinstall":"Install",title:s.installed?`Reinstall ${s.component_name} ?`:`Install ${s.component_name} ?`,onConfirm:async()=>{await _.post("/install-components",{path:s.file_path,force:!0,address:s.address,branch:s.branch,token:R},{timeout:6e4}),w.success(s.installed?"Reinstall success!":"Install success!"),A&&A(),i&&i()},children:e.jsxs(k,{size:"small",hoverable:!0,className:"custom-card",title:e.jsx(L,{title:s==null?void 0:s.component_id,children:s.component_name}),style:{height:"100%",border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease"},cover:e.jsx("div",{style:{height:"15rem"},children:e.jsx("img",{style:{height:"100%",width:"100%",objectFit:"cover"},alt:s.label,src:$(s.img)})}),children:[e.jsx(X,{title:e.jsxs(g,{justify:"space-between",align:"center",children:[e.jsx(W,{color:s.installed?"#108ee9":"#f5222d",children:s.installed?"Installed":"Not I nstalled"}),e.jsx(fe,{style:{cursor:"pointer"}})]}),description:s==null?void 0:s.description,style:{marginBottom:"1rem"}}),s.tags&&Array.isArray(s.tags)&&s.tags.map((a,p)=>e.jsx(L,{title:a,children:e.jsx(W,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:Y[p],children:a})},p))]})})},d))}):e.jsx(Q,{})}),e.jsx(b,{lg:3,sm:3,xs:24,children:e.jsx(J,{activeKey:f,onChange:s=>z(s),tabBarStyle:{marginBottom:0},type:"card",size:"small",tabPosition:"right",items:E.map(s=>({key:s,label:s}))})})]})})]})})};export{Fe as default};

import{u as T,j as e,f as K,aD as P,r as i,d as B,aE as R,p as D,o as p,g as $,P as I,B as r,a as N}from"./index-DnaNKChN.js";import{M as O}from"./index-Cr0FOZlH.js";import{F as J,f as V}from"./index-Buri71aO.js";import{r as q,w as G}from"./index-2JzBd74d.js";import{T as H}from"./index-Be9gn9ci.js";import{T as h}from"./index-BUDxPiHu.js";import"./index-BSb3-Okj.js";import"./Table-DYq57zsl.js";import"./addEventListener-DMPBqcWf.js";import"./index-FpYd8_0n.js";import"./index-B2UOh69g.js";import"./index-BWL6OvQA.js";import"./index-DKgKR1m5.js";import"./index-CbFOAilW.js";import"./index-YbpS1a5y.js";const de=()=>{const{analysisId:d}=T();if(!d)return e.jsx("div",{children:"404"});const g=K(),w=P(),{location:x}=w.state||{},y=i.useRef(null),[t,E]=i.useState(null),{messageApi:u}=B(),[F,C]=i.useState(""),[a,j]=i.useState(null),{eventSourceRef:l,status:Q,reconnect:U}=R(),[k,S]=i.useState("pipeline_script"),[b,z]=i.useState({}),[A,v]=i.useState(!1);i.useEffect(()=>{var s;if(l){const n=o=>{const m=JSON.parse(o.data);d==m.analysis_id&&(m.event=="analysis_complete"||m.event=="analysis_failed")&&c()};return(s=l.current)==null||s.addEventListener("message",n),()=>{var o;console.log("removeEventListener"),(o=l.current)==null||o.removeEventListener("message",n)}}},[l.current]);const L=async s=>(await q(s)).data,f=async()=>{a&&(await G(a,y.current.getValue()),u.success("保存成功"))},c=async()=>{const n=(await V(d)).data;E(n),j(n.pipeline_script),z({pipeline_script:n.pipeline_script,script_config_file:n.script_config_file})};i.useEffect(()=>{a&&_(a)},[a]);const _=async(s,n=!1)=>{s&&L(s).then(o=>{C(o.data),n&&u.success(`脚本加载成功: ${s}`)})};i.useEffect(()=>{const s=n=>{(n.ctrlKey||n.metaKey)&&n.key==="s"&&(n.preventDefault(),typeof f=="function"&&f())};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[]);const{openModal:M}=D();return i.useEffect(()=>{c()},[]),e.jsxs("div",{children:[e.jsx(H,{size:"small",activeKey:k,onChange:s=>{S(s),j(b[s]),v(s==="params_path")},tabBarExtraContent:e.jsxs($,{gap:"small",align:"center",children:[e.jsx(h,{color:"cyan",children:t==null?void 0:t.container_name}),e.jsx(h,{color:"cyan",children:t==null?void 0:t.analysis_status}),e.jsx(h,{color:"cyan",children:t==null?void 0:t.analysis_name}),e.jsx(I,{title:"是否生成脚本",onConfirm:async()=>{await N.post(`/analysis/convert-ipynb/${t.analysis_id}`),u.success("是否生成脚本成功!")},children:e.jsx(r,{size:"small",color:"cyan",variant:"solid",children:"生成脚本"})}),e.jsx(r,{size:"small",color:"cyan",variant:"solid",onClick:()=>{window.open(`http://10.110.1.11:8888/jupyter/notebooks/${t.jupyter_notebook_path}`,"_blank")},children:"jupyter"}),e.jsx(p,{title:e.jsx(e.Fragment,{children:a}),children:e.jsx(r,{size:"small",color:"cyan",variant:"solid",onClick:f,children:"保存"})}),e.jsx(p,{title:e.jsx(e.Fragment,{children:a}),children:e.jsx(r,{size:"small",color:"cyan",variant:"solid",onClick:()=>{_(a,!0)},children:"刷新脚本"})}),e.jsx(r,{size:"small",color:"cyan",variant:"solid",onClick:c,children:"刷新"}),x&&e.jsx(r,{size:"small",color:"cyan",variant:"solid",onClick:()=>{g(x)},children:"返回"})]}),items:[{key:"pipeline_script",label:e.jsx(p,{title:e.jsx(e.Fragment,{children:e.jsx("ul",{children:e.jsx("li",{children:t==null?void 0:t.pipeline_script})})}),children:"脚本"})},{key:"script_config_file",label:e.jsx(p,{title:e.jsx(e.Fragment,{children:e.jsx("ul",{children:e.jsx("li",{children:t==null?void 0:t.script_config_file})})}),children:"脚本配置"})}]}),e.jsx(O,{format:A,value:F,editorRef:y,defaultLanguage:"python",height:"50vh"}),e.jsx(J,{callback:c,analysis:t,operatePipeline:{openModal:M}})]})};export{de as default};

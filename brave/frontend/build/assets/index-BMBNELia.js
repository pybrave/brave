import{r as t,u as Z,Z as G,aQ as J,b as N,aR as B,c as V,j as e,R as X,C as M,E as T,S as O,F as I,B as P,x as ee,a as K,a0 as se}from"./main-CoRdKxM6.js";import{d as te}from"./index-3Hfn-eC3.js";import ae from"./index-Cl14Vxoo.js";import{C as b}from"./index-mKsixq-F.js";import{T as oe}from"./Table-C-94KlQV.js";import"./index-DeUYg7UX.js";import"./index-LdYoExsQ.js";import"./index-U82OZ9hL.js";import"./UpOutlined-CjGJavdL.js";import"./index-Dm3E-_FQ.js";import"./index-BHj1h2oY.js";import"./Dropdown-MRVofdb8.js";import"./index-DD8IFb_f.js";import"./index-BZOaq6gR.js";import"./study-page-D9BlhB0m.js";import"./usePagination-P-dGKUc-.js";import"./index-Cww7bxT4.js";import"./RedoOutlined-CtyAtPBD.js";import"./index-BdK9PNzv.js";import"./callSuper-tBPAaQ6e.js";import"./index-BlGESwK1.js";import"./addEventListener-BYJT43cw.js";import"./DownloadOutlined-DnjYLYJT.js";const ze=()=>{const[p,r]=t.useState(!1),{project:n,projectObj:o}=Z(s=>s.user),[m,v]=t.useState(),[g,x]=t.useState(),E=G(),j=new URLSearchParams(E.search),a=j.get("key"),i=j.get("project"),d=J(),{modal:l,openModal:k,closeModal:Y}=N(),[C,_]=t.useState(a),H=async()=>{const s=await K.get(`/project/find-by-project-id/${n}`);d(B({projectObj:s.data}))};t.useEffect(()=>{i&&i!=n&&d(B({project:i}))},[i]),t.useRef(null),V();const w=(s,c)=>{const{pathname:h,search:S,hash:u}=window.location,f=new URLSearchParams(S||"");f.set(s,c);const R=u.startsWith("#/");let y="";if(R){const[W,q=""]=u.replace(/^#/,"").split("?"),U=new URLSearchParams(q);U.set(s,c),y=`#${W}?${U.toString()}`}else y=`${h}?${f.toString()}`;window.history.pushState({},"",y)},F=t.useRef(null),[$,Q]=t.useState(null),[A,D]=t.useState("analysis_result"),z=()=>{if(F.current){const s=F.current.getBoundingClientRect().top;Q(s)}};t.useEffect(()=>(z(),window.addEventListener("resize",z),()=>{window.removeEventListener("resize",z)}),[]);const L=async()=>{var c,h,S,u,f,R,y;r(!0);let s=await K.post("/list-analysis-tree",{is_report:!0,project:n});v(s.data),!a&&s.data.length>0&&(c=s.data[0])!=null&&c.children&&((h=s.data[0])==null?void 0:h.children.length)>0&&(x((S=s.data[0])==null?void 0:S.children[0]),_((f=(u=s.data[0])==null?void 0:u.children[0])==null?void 0:f.key),w("project",n),w("key",(y=(R=s.data[0])==null?void 0:R.children[0])==null?void 0:y.key)),r(!1)};return t.useEffect(()=>{L()},[n]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"0 auto"},children:[e.jsxs(X,{ref:F,style:{overflowY:"hidden",marginTop:"1rem",position:"sticky",top:`${$}px`,alignSelf:"flex-start",height:`calc(100vh - ${$}px - 1rem )`},gutter:[16,16],children:[e.jsxs(M,{lg:20,sm:20,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("div",{style:{flex:1,display:A==="analysis_result"?"block":"none",height:"100%"},children:C?e.jsx(e.Fragment,{children:e.jsx(te,{openPanel:D,cancalReportCallback:()=>{L()},analysis_id:C})}):e.jsx(e.Fragment,{children:e.jsx(b,{size:"small",variant:"borderless",children:e.jsx(T,{})})})}),A=="note"&&e.jsx("div",{children:e.jsx(b,{style:{flex:1,display:"flex",flexDirection:"column",height:" 100%",boxShadow:"none"},styles:{body:{flex:1,display:"flex",flexDirection:"column",height:" 100%",padding:0,overflowY:"auto"}},variant:"borderless",size:"small",extra:e.jsxs(I,{gap:"small",children:[e.jsx(P,{size:"small",color:"primary",variant:"solid",onClick:()=>{D("analysis_result")},children:"Back"}),e.jsx(P,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k("projectForm",{project_id:n})},children:"Edit"}),e.jsx(P,{size:"small",color:"cyan",variant:"solid",onClick:()=>{H()},children:"Refresh"})]}),children:o!=null&&o.description?e.jsx(ae,{data:o==null?void 0:o.description}):e.jsx(O,{active:!0})})})]}),e.jsx(M,{lg:4,sm:4,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(b,{loading:p,title:o==null?void 0:o.project_name,size:"small",style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(I,{gap:"small",children:e.jsx(P,{size:"small",color:"cyan",variant:"solid",onClick:L,children:"Refresh"})}),children:Array.isArray(m)&&m.length!=0?e.jsx(e.Fragment,{children:e.jsx(ne,{onSelect:s=>{var c,h;((c=s.node)==null?void 0:c.type)=="analysis"?(x(s.node),_(s.node.key),w("project",n),w("key",s.node.key)):((h=s.node)==null?void 0:h.type)=="components"&&console.log(s.node)},defaultSelectKey:C,treeData:m})}):e.jsx(e.Fragment,{children:e.jsx(T,{})})})})]}),e.jsx(ee,{research:!0,params:l.params,visible:l.key=="projectForm"&&l.visible,onClose:Y})]})},ne=({treeData:p,defaultSelectKey:r,onSelect:n})=>{const[o,m]=t.useState(r),[v,g]=t.useState([]),x=(a,i,d=[])=>{for(const l of i){if(l.key===a)return d;if(l.children){const k=x(a,l.children,[...d,l.key]);if(k.length)return k}}return[]};t.useEffect(()=>{if(r){const a=x(r,p);g(a),m(r)}},[r,p]);const E=(a,i)=>{if(a.length>0){n(i),m(a[0]);const d=x(a[0],p);g(d)}},j=a=>{g(a)};return e.jsx(e.Fragment,{children:e.jsx(oe,{selectedKeys:[o],showLine:!0,expandedKeys:v,onExpand:j,autoExpandParent:!0,switcherIcon:e.jsx(se,{}),onSelect:E,treeData:p})})};export{ze as default};

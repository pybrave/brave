import{r as o,u as Q,Z,aS as G,b as J,aT as U,c as N,j as e,R as V,C as M,E as T,S as X,F as Y,B as R,x as O,a as B,a0 as ee}from"./main-BwXC3IR-.js";import{d as se}from"./index-gdPfdXVC.js";import te from"./index-CAfjAvfF.js";import{u as ae}from"./useStickyTop-sgg3o42b.js";import{C as b}from"./index--JnjVdx_.js";import{T as oe}from"./Table-iOXYhvzQ.js";import"./index-DMfVbt3c.js";import"./index-CBMb1kgU.js";import"./index-CotDIsNu.js";import"./UpOutlined-BKYGFLNT.js";import"./index-8j16o04L.js";import"./index-Ds-Cm03P.js";import"./Dropdown-CtfTgCmR.js";import"./index-DxWRZDVa.js";import"./index-CZtBSYBQ.js";import"./study-page-C1kz4qO_.js";import"./usePagination-DDagBvBR.js";import"./index-49RMhiY3.js";import"./RedoOutlined-E9lihzWT.js";import"./index-cs3Gd2d7.js";import"./callSuper-C57L85fm.js";import"./index-BPZgQyLF.js";import"./addEventListener-VtdiWBGV.js";import"./DownloadOutlined-CPXLD1k8.js";const ze=()=>{const[h,n]=o.useState(!1),{project:r,projectObj:a}=Q(s=>s.user),[m,v]=o.useState(),[j,x]=o.useState(),C=Z(),g=new URLSearchParams(C.search),t=g.get("key"),i=g.get("project"),d=G(),{modal:l,openModal:k,closeModal:I}=J(),[E,z]=o.useState(t),K=async()=>{const s=await B.get(`/project/find-by-project-id/${r}`);d(U({projectObj:s.data}))};o.useEffect(()=>{i&&i!=r&&d(U({project:i}))},[i]),o.useRef(null),N();const S=(s,c)=>{const{pathname:p,search:w,hash:f}=window.location,u=new URLSearchParams(w||"");u.set(s,c);const P=f.startsWith("#/");let y="";if(P){const[q,H=""]=f.replace(/^#/,"").split("?"),D=new URLSearchParams(H);D.set(s,c),y=`#${q}?${D.toString()}`}else y=`${p}?${u.toString()}`;window.history.pushState({},"",y)},[L,_]=o.useState("analysis_result"),{ref:W,top:$,isSticky:A}=ae(576),F=async()=>{var c,p,w,f,u,P,y;n(!0);let s=await B.post("/list-analysis-tree",{is_report:!0,project:r});v(s.data),!t&&s.data.length>0&&(c=s.data[0])!=null&&c.children&&((p=s.data[0])==null?void 0:p.children.length)>0&&(x((w=s.data[0])==null?void 0:w.children[0]),z((u=(f=s.data[0])==null?void 0:f.children[0])==null?void 0:u.key),S("project",r),S("key",(y=(P=s.data[0])==null?void 0:P.children[0])==null?void 0:y.key)),n(!1)};return o.useEffect(()=>{F()},[r]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"1rem auto"},children:[e.jsx("div",{}),e.jsxs(V,{gutter:[A?16:0,16],children:[e.jsxs(M,{lg:20,sm:20,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("div",{style:{flex:1,display:L==="analysis_result"?"block":"none",height:"100%"},children:E?e.jsx(e.Fragment,{children:e.jsx(se,{overflowY:"auto",openPanel:_,cancalReportCallback:()=>{F()},analysis_id:E})}):e.jsx(e.Fragment,{children:e.jsx(b,{size:"small",variant:"borderless",children:e.jsx(T,{})})})}),L=="note"&&e.jsx("div",{children:e.jsx(b,{style:{flex:1,display:"flex",flexDirection:"column",height:" 100%",boxShadow:"none"},styles:{body:{flex:1,display:"flex",flexDirection:"column",height:" 100%",padding:0,overflowY:"auto"}},variant:"borderless",size:"small",extra:e.jsxs(Y,{gap:"small",children:[e.jsx(R,{size:"small",color:"primary",variant:"solid",onClick:()=>{_("analysis_result")},children:"Back"}),e.jsx(R,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k("projectForm",{project_id:r})},children:"Edit"}),e.jsx(R,{size:"small",color:"cyan",variant:"solid",onClick:()=>{K()},children:"Refresh"})]}),children:a!=null&&a.description?e.jsx(te,{data:a==null?void 0:a.description}):e.jsx(X,{active:!0})})})]}),e.jsx(M,{lg:4,sm:4,xs:24,ref:W,style:A?{overflowY:"hidden",position:"sticky",top:`${$}px`,alignSelf:"flex-start",height:`calc(100vh - ${$}px - 1rem )`}:{},children:e.jsx(b,{loading:h,title:a==null?void 0:a.project_name,size:"small",style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(Y,{gap:"small",children:e.jsx(R,{size:"small",color:"cyan",variant:"solid",onClick:F,children:"Refresh"})}),children:Array.isArray(m)&&m.length!=0?e.jsx(e.Fragment,{children:e.jsx(re,{onSelect:s=>{var c,p;((c=s.node)==null?void 0:c.type)=="analysis"?(x(s.node),z(s.node.key),S("project",r),S("key",s.node.key)):((p=s.node)==null?void 0:p.type)=="components"&&console.log(s.node)},defaultSelectKey:E,treeData:m})}):e.jsx(e.Fragment,{children:e.jsx(T,{})})})})]}),e.jsx(O,{research:!0,params:l.params,visible:l.key=="projectForm"&&l.visible,onClose:I})]})},re=({treeData:h,defaultSelectKey:n,onSelect:r})=>{const[a,m]=o.useState(n),[v,j]=o.useState([]),x=(t,i,d=[])=>{for(const l of i){if(l.key===t)return d;if(l.children){const k=x(t,l.children,[...d,l.key]);if(k.length)return k}}return[]};o.useEffect(()=>{if(n){const t=x(n,h);j(t),m(n)}},[n,h]);const C=(t,i)=>{if(t.length>0){r(i),m(t[0]);const d=x(t[0],h);j(d)}},g=t=>{j(t)};return e.jsx(e.Fragment,{children:e.jsx(oe,{selectedKeys:[a],showLine:!0,expandedKeys:v,onExpand:g,autoExpandParent:!0,switcherIcon:e.jsx(ee,{}),onSelect:C,treeData:h})})};export{ze as default};

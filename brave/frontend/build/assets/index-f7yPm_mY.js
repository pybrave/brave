import{r as l,z as Oe,_ as Ie,a3 as J,a4 as oe,Y as D,a0 as Fe,a5 as Pe,a6 as Re,a7 as $e,a8 as Z,a9 as Ee,aa as ee,ab as ze,j as t,I as le,i as X,B as x,a as V,k as ae,b as ie,F as R,P as K,f as ce,u as Be,M as Te,$ as Ae,t as y,l as de}from"./main-BwXC3IR-.js";import{b as me,c as ue,s as Ne,L as E,r as Me,f as Le}from"./index-gdPfdXVC.js";import{C as z}from"./index--JnjVdx_.js";import{a as De,R as Xe,b as Ke,S as He,F as pe}from"./Table-iOXYhvzQ.js";import{L}from"./index-uUHnTTZD.js";import{R as Ue}from"./DownloadOutlined-CPXLD1k8.js";import{P as We,S as fe}from"./index-49RMhiY3.js";import{b as Je}from"./index-CaTpPA5T.js";import{A as Ve}from"./index-C4BvvLXY.js";import qe from"./index-CAfjAvfF.js";import{T as q}from"./index-Ds-Cm03P.js";import{B as he}from"./index-G5d2OwBp.js";var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},Ge=function(n,r){return l.createElement(Oe,Ie({},n,{ref:r,icon:Ye}))},te=l.forwardRef(Ge);const B=e=>{let{children:n}=e;const{getPrefixCls:r}=l.useContext(J),s=r("breadcrumb");return l.createElement("li",{className:`${s}-separator`,"aria-hidden":"true"},n===""?n:n||"/")};B.__ANT_BREADCRUMB_SEPARATOR=!0;var Qe=function(e,n){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&n.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)n.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]]);return r};function Ze(e,n){if(e.title===void 0||e.title===null)return null;const r=Object.keys(n).join("|");return typeof e.title=="object"?e.title:String(e.title).replace(new RegExp(`:(${r})`,"g"),(s,o)=>n[o]||s)}function ge(e,n,r,s){if(r==null)return null;const{className:o,onClick:i}=n,u=Qe(n,["className","onClick"]),d=Object.assign(Object.assign({},oe(u,{data:!0,aria:!0})),{onClick:i});return s!==void 0?l.createElement("a",Object.assign({},d,{className:D(`${e}-link`,o),href:s}),r):l.createElement("span",Object.assign({},d,{className:D(`${e}-link`,o)}),r)}function et(e,n){return(s,o,i,u,d)=>{if(n)return n(s,o,i,u);const a=Ze(s,o);return ge(e,s,a,d)}}var H=function(e,n){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&n.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)n.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]]);return r};const xe=e=>{const{prefixCls:n,separator:r="/",children:s,menu:o,overlay:i,dropdownProps:u,href:d}=e,c=(g=>{if(o||i){const p=Object.assign({},u);if(o){const m=o||{},{items:b}=m,h=H(m,["items"]);p.menu=Object.assign(Object.assign({},h),{items:b==null?void 0:b.map((j,C)=>{var{key:S,title:f,label:v,path:_}=j,k=H(j,["key","title","label","path"]);let I=v??f;return _&&(I=l.createElement("a",{href:`${d}${_}`},I)),Object.assign(Object.assign({},k),{key:S??C,label:I})})})}else i&&(p.overlay=i);return l.createElement(De,Object.assign({placement:"bottom"},p),l.createElement("span",{className:`${n}-overlay-link`},g,l.createElement(Fe,null)))}return g})(s);return c!=null?l.createElement(l.Fragment,null,l.createElement("li",null,c),r&&l.createElement(B,null,r)):null},je=e=>{const{prefixCls:n,children:r,href:s}=e,o=H(e,["prefixCls","children","href"]),{getPrefixCls:i}=l.useContext(J),u=i("breadcrumb",n);return l.createElement(xe,Object.assign({},o,{prefixCls:u}),ge(u,o,r,s))};je.__ANT_BREADCRUMB_ITEM=!0;const tt=e=>{const{componentCls:n,iconCls:r,calc:s}=e;return{[n]:Object.assign(Object.assign({},$e(e)),{color:e.itemColor,fontSize:e.fontSize,[r]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},a:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${Z(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:s(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},Ee(e)),"li:last-child":{color:e.lastItemColor},[`${n}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${n}-link`]:{[`
          > ${r} + span,
          > ${r} + a
        `]:{marginInlineStart:e.marginXXS}},[`${n}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${Z(e.paddingXXS)}`,marginInline:s(e.marginXXS).mul(-1).equal(),[`> ${r}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},rt=e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS}),nt=Pe("Breadcrumb",e=>{const n=Re(e,{});return tt(n)},rt);var re=function(e,n){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&n.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)n.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]]);return r};function st(e){const{breadcrumbName:n,children:r}=e,s=re(e,["breadcrumbName","children"]),o=Object.assign({title:n},s);return r&&(o.menu={items:r.map(i=>{var{breadcrumbName:u}=i,d=re(i,["breadcrumbName"]);return Object.assign(Object.assign({},d),{title:u})})}),o}function ot(e,n){return l.useMemo(()=>e||(n?n.map(st):null),[e,n])}var lt=function(e,n){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&n.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)n.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]]);return r};const at=(e,n)=>{if(n===void 0)return n;let r=(n||"").replace(/^\//,"");return Object.keys(e).forEach(s=>{r=r.replace(`:${s}`,e[s])}),r},P=e=>{const{prefixCls:n,separator:r="/",style:s,className:o,rootClassName:i,routes:u,items:d,children:a,itemRender:c,params:g={}}=e,p=lt(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:m,direction:b,breadcrumb:h}=l.useContext(J);let j;const C=m("breadcrumb",n),[S,f,v]=nt(C),_=ot(d,u),k=et(C,c);if(_&&_.length>0){const O=[],F=d||u;j=_.map((w,$)=>{const{path:ye,key:T,type:_e,menu:Y,overlay:G,onClick:Ce,className:ve,separator:Se,dropdownProps:we}=w,A=at(g,ye);A!==void 0&&O.push(A);const Q=T??$;if(_e==="separator")return l.createElement(B,{key:Q},Se);const N={},ke=$===_.length-1;Y?N.menu=Y:G&&(N.overlay=G);let{href:M}=w;return O.length&&A!==void 0&&(M=`#/${O.join("/")}`),l.createElement(xe,Object.assign({key:Q},N,oe(w,{data:!0,aria:!0}),{className:ve,dropdownProps:we,href:M,separator:ke?"":r,onClick:Ce,prefixCls:C}),k(w,g,F,O,M))})}else if(a){const O=ee(a).length;j=ee(a).map((F,w)=>{if(!F)return F;const $=w===O-1;return ze(F,{separator:$?"":r,key:w})})}const I=D(C,h==null?void 0:h.className,{[`${C}-rtl`]:b==="rtl"},o,i,f,v),be=Object.assign(Object.assign({},h==null?void 0:h.style),s);return S(l.createElement("nav",Object.assign({className:I,style:be},p),l.createElement("ol",null,j)))};P.Item=je;P.Separator=B;const{Search:it}=le,{Text:ne}=X,ct=({path:e,onSelectFile:n})=>{const[r,s]=l.useState([]),[o,i]=l.useState(e),[u,d]=l.useState(""),[a,c]=l.useState(1),[g,p]=l.useState(0),m=10,b=async(f=o,v=u,_=a)=>{const k=await V.get("/file-operation/list-dir-v2",{params:{path:f,keyword:v,page:_,limit:m}});s(k.data.items),p(k.data.total),i(f),c(_)};l.useEffect(()=>{b(e)},[e]);const h=f=>{b(`${o}/${f}`,"",1)},j=f=>{b(o,f,1)},C=f=>{n({path:o+"/"+f.name,file:f.name})},S=o.split("/").filter(Boolean);return t.jsxs(z,{title:"文件浏览器",extra:t.jsxs(He,{children:[t.jsx(x,{icon:t.jsx(te,{}),onClick:()=>b(e),size:"small",children:"重置"}),t.jsx(x,{icon:t.jsx(te,{}),onClick:()=>b(o),size:"small",children:"刷新"})]}),children:[t.jsxs(P,{style:{marginBottom:"1rem"},children:[t.jsx(P.Item,{children:t.jsx("a",{onClick:()=>b("/"),children:"根目录"})}),S.map((f,v)=>t.jsx(P.Item,{children:t.jsx("a",{onClick:()=>{const _="/"+S.slice(0,v+1).join("/");b(_)},children:f})},v))]}),t.jsx(it,{placeholder:"搜索文件名",enterButton:"搜索",value:u,onChange:f=>d(f.target.value),onSearch:j,style:{marginBottom:16}}),t.jsx(L,{size:"small",bordered:!0,dataSource:r,locale:{emptyText:"暂无文件"},renderItem:f=>t.jsx(L.Item,{actions:f.is_dir?[t.jsx(x,{size:"small",onClick:()=>h(f.name),children:"进入"})]:[t.jsx(x,{type:"link",size:"small",icon:t.jsx(Ue,{}),href:`/brave-api/file-operation/download?path=${encodeURIComponent(o+"/"+f.name)}`,target:"_blank",children:"下载"}),t.jsx(x,{type:"link",size:"small",onClick:()=>C(f),children:"选择"})],children:t.jsx(L.Item.Meta,{avatar:f.is_dir?t.jsx(Xe,{}):t.jsx(Ke,{}),title:t.jsx(ne,{strong:!0,style:{cursor:f.is_dir?"pointer":"default"},onClick:()=>f.is_dir&&h(f.name),children:f.name}),description:!f.is_dir&&t.jsxs(ne,{type:"secondary",children:[(f.size/1024).toFixed(1)," KB"]})})})}),t.jsx(We,{style:{marginTop:"1rem",textAlign:"center"},current:a,total:g,pageSize:m,onChange:f=>b(o,u,f),showSizeChanger:!1})]})},dt=(e,n)=>V.post(`/fast-api/parse-analysis-result/${e}?save=${n}`),mt=l.memo(({analysis_id:e,callback:n})=>{const[r,s]=l.useState(),[o,i]=l.useState(!1),{messageApi:u}=ae(),{modal:d,openModal:a,closeModal:c}=ie(),g=async(p=!1)=>{i(!0);try{const m=await dt(e,p);s(m.data),i(!1),n&&p&&n()}catch(m){i(!1),u.error(m.response.data.detail)}};return l.useEffect(()=>{g(!1)},[e]),t.jsxs(t.Fragment,{children:[t.jsxs(R,{gap:"small",justify:"flex-end",align:"center",children:[(r==null?void 0:r.file_format_list)&&t.jsx(t.Fragment,{children:r==null?void 0:r.file_format_list.map(p=>t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>a("modalA",{params:{component_id:p.component_id},title:p.name}),children:p.name}))}),t.jsx(K,{title:"确定解析吗？",onConfirm:()=>{g(!0),u.success("解析成功")},children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",children:"解析"})}),t.jsx(x,{size:"small",color:"primary",variant:"solid",onClick:()=>g(!1),children:"刷新"})]}),t.jsx(fe,{spinning:o,children:r&&t.jsx(t.Fragment,{children:r!=null&&r.error?t.jsx(X,{children:t.jsx("pre",{children:r==null?void 0:r.error})}):t.jsxs(t.Fragment,{children:[t.jsx(pe,{size:"small",pagination:!1,rowKey:"component_id",columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"目录",dataIndex:"dir",key:"dir"},{title:"文件组件ID",dataIndex:"component_id",key:"component_id"},{title:"文件格式",dataIndex:"fileFormat",key:"fileFormat",render:(p,m)=>t.jsx("div",{style:{overflowWrap:"break-word",wordBreak:"break-all"},children:JSON.stringify(m.fileFormat)})},{title:"操作",dataIndex:"component_id",key:"component_id",render:(p,m)=>t.jsx(t.Fragment,{children:t.jsx(x,{color:"cyan",variant:"solid",size:"small",onClick:()=>{a("modalC",{data:{component_id:m.component_id},structure:{component_type:"file",files:r==null?void 0:r.file_dict[m.dir]}})},children:"编辑"})})}],dataSource:r==null?void 0:r.file_format_list}),t.jsx(z,{style:{maxHeight:"20rem",overflow:"auto"},children:t.jsx(X,{children:t.jsx("pre",{children:JSON.stringify(r,null,2)})})})]})})}),t.jsx(Je,{callback:g,visible:d.key=="modalC"&&d.visible,onClose:c,params:d.params}),t.jsx(Ve,{visible:d.key=="modalA"&&d.visible,params:d.params,onClose:c,analysis:r})]})});var U=function(){return U=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},U.apply(this,arguments)},ut=l.forwardRef(function(e,n){return ce.createElement(he,U({},e,{chartType:"Bar",ref:n}))}),W=function(){return W=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},W.apply(this,arguments)},pt=l.forwardRef(function(e,n){return ce.createElement(he,W({},e,{chartType:"Column",ref:n}))});const ft=({visible:e,onClose:n,params:r})=>{const[s,o]=l.useState(),[i,u]=l.useState([]),[d,a]=l.useState(),[c,g]=l.useState(),{baseURL:p}=Be(h=>h.user);l.useEffect(()=>{if(e)if(r!=null&&r.fileType&&r.fileType==="collected")m(r.content);else{const h=Object.entries(r.content).map(([j,C])=>({key:C,label:j}));if(u(h),h.length>0){const j=h[0].key;a(j),m(j)}}},[e]);const m=async h=>{g(!0);const j=await me(h);o(j.data),g(!1)},b=h=>{const j=`${p}/brave-api/file-operation/download?path=${h}`;window.open(j,"_blank")};return e?t.jsxs(Te,{width:"80vw",open:e,onCancel:n,title:"打开文件",footer:!1,children:[t.jsx(q,{tabBarExtraContent:t.jsxs(R,{gap:"small",align:"center",children:[t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{b(d)},children:"Download"}),t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m(d)},children:"Refresh"})]}),items:i,onChange:h=>{m(h),a(h)}}),t.jsx(fe,{spinning:c,children:t.jsx(ue,{...s})}),(r==null?void 0:r.description)&&t.jsx(qe,{data:r.description})]}):null},se=({file_path:e})=>{l.useEffect(()=>{e&&s(e)},[e]);const[n,r]=l.useState([]),s=async(o,i=!1)=>{const u=await me(o);r(u.data)};return t.jsx(t.Fragment,{children:t.jsx(z,{title:t.jsxs(de,{color:"blue",children:["文件: ",e]}),extra:t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{s(e)},children:"刷新日志"}),bodyStyle:{padding:0},children:t.jsx(ue,{...n})})})},ht=({output_dir:e,...n})=>(JSON.stringify(n),t.jsx(ct,{path:e})),gt=({data:e})=>{const n={data:e,xField:"task",yField:"realtime",colorField:"process",group:{padding:0},label:{text:r=>r.label,textBaseline:"bottom"}};return t.jsx(t.Fragment,{children:t.jsx(pt,{...n})})},xt=({data:e})=>{const n=Array.from(new Set(e.map(i=>i.process))),[r,s]=l.useState(n[0]),o=e.filter(i=>i.process===r);return t.jsxs("div",{children:[t.jsx("div",{style:{marginBottom:16},children:n.map(i=>t.jsx(x,{size:"small",type:i===r?"primary":"default",onClick:()=>s(i),style:{marginRight:8},children:i},i))}),t.jsx(gt,{data:o})]})},jt=({data:e})=>{const n={data:e,xField:"process",yField:"count",colorField:"status",stack:!0,sort:{reverse:!0,by:"y"},style:{maxWidth:50}};return t.jsx(ut,{...n})},bt=({data:e})=>{const{modal:n,openModal:r,closeModal:s}=ie(),o=[{title:"process",dataIndex:"process",key:"process",ellipsis:!0},{title:"tag",dataIndex:"tag",key:"tag",ellipsis:!0},{title:"name",dataIndex:"name",key:"name",ellipsis:!0,render:(a,c)=>t.jsx(y,{title:t.jsx(t.Fragment,{children:t.jsx("ul",{children:t.jsxs("li",{children:[" ",c.workdir," "]})})}),children:a})},{title:"container",dataIndex:"container",key:"container",ellipsis:!0},{title:"status",dataIndex:"status",key:"status",ellipsis:!0},{title:"realtime",dataIndex:"realtime",key:"realtime",ellipsis:!0},{title:"cpus",dataIndex:"cpus",key:"cpus",ellipsis:!0,render:(a,c)=>t.jsx(y,{title:t.jsx(t.Fragment,{children:c["%cpu"]}),children:a})},{title:"memory",dataIndex:"memory",key:"memory",ellipsis:!0,width:100,render:(a,c)=>t.jsx(y,{title:t.jsx(t.Fragment,{children:c["%mem"]}),children:a})},{title:"操作",key:"action",fixed:"right",ellipsis:!0,width:200,render:(a,c)=>t.jsx(R,{gap:"small",children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{r("openFile",{content:{".command.sh":`${c.workdir}/.command.sh`,".command.trace":`${c.workdir}/.command.trace`,".command.run":`${c.workdir}/.command.run`,".command.out":`${c.workdir}/.command.out`,".command.err":`${c.workdir}/.command.err`,".command.begin":`${c.workdir}/.command.begin`}})},children:"查看"})})}],[i,u]=l.useState(""),d=l.useMemo(()=>i?e.filter(a=>Object.values(a).some(c=>String(c).toLowerCase().includes(i.toLowerCase()))):e,[e,i]);return t.jsxs(t.Fragment,{children:[t.jsx(pe,{title:()=>t.jsx(le.Search,{size:"small",placeholder:"搜索任务...",allowClear:!0,enterButton:!0,value:i,onChange:a=>u(a.target.value),style:{width:300}}),scroll:{x:"max-content",y:55*5},size:"small",bordered:!0,footer:()=>`A total of ${d.length} records`,columns:o,dataSource:d,rowKey:a=>a.task_id}),t.jsx(ft,{visible:n.key=="openFile"&&n.visible,onClose:s,params:n.params})]})},yt=({analysis_id:e})=>{const[n,r]=l.useState(),[s,o]=l.useState(!1);function i(d){const a=d.match(/(\d+)m/),c=d.match(/(\d+)s/),g=a?parseInt(a[1]):0,p=c?parseInt(c[1]):0;return g*60+p}const u=async()=>{o(!0);const d=await V.get(`/analysis/analysis-progress/${e}`),a={};d.data.forEach(p=>{const m=`${p.process}-${p.status}`;a[m]||(a[m]={process:p.process,status:p.status,count:0}),a[m].count+=1});const c=Object.values(a),g=d.data.map(p=>({process:p.process,task:p.task_id,realtime:i(p.realtime),label:p.realtime}));r({table:d.data,statusData:c,timeData:g}),o(!1)};return l.useEffect(()=>{u()},[]),t.jsxs("div",{children:[t.jsx(R,{justify:"flex-end",gap:"small",children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:u,children:"刷新"})}),n&&t.jsx(q,{defaultActiveKey:"0",onChange:()=>{window.dispatchEvent(new Event("resize"))},items:[{key:"0",label:"任务表格",children:t.jsx(bt,{data:(n==null?void 0:n.table)||[]})},{key:"1",label:"任务状态",children:t.jsx(jt,{data:(n==null?void 0:n.statusData)||[]})},{key:"2",label:"运行时间",children:t.jsx(xt,{data:(n==null?void 0:n.timeData)||[]})}]})]})},_t={output_dir:ht,workflow_log_file:E,executor_log_file:E,trace_file:E,command_log_path:E,params_path:se,command_path:se,result_parse:mt,analysis_progress:yt},Ct=({analysis:e,file:n,fileKey:r})=>{const s=_t[r];return s?t.jsx(s,{...e,file_path:n,file:n,fileKey:r}):t.jsx(t.Fragment,{children:"no component"})},vt=l.memo(({analysis:e,callback:n})=>{const[r,s]=l.useState("command_log_path"),{messageApi:o}=ae(),{eventSourceRef:i,status:u,reconnect:d}=Ae(),a=l.useRef(r);if(!e)return null;const c={workflow_log_file:e.workflow_log_file,executor_log_file:e.executor_log_file,trace_file:e.trace_file,params_path:e.params_path,command_path:e.command_path,command_log_path:e.command_log_path},g=async()=>{await Me(e==null?void 0:e.analysis_id,"job"),o.success("运行成功"),n&&n()},p=[{key:"command_log_path",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.command_log_path})}),children:"Run Log"})},{key:"trace_file",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.trace_file})}),children:"Progress"})},{key:"workflow_log_file",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.workflow_log_file})}),children:"Workflow Log"})},{key:"executor_log_file",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.executor_log_file})}),children:"Executor Log"})},{key:"params_path",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.params_path})}),children:"Parameters"})},{key:"command_path",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.command_path})}),children:"Command"})},{key:"output_dir",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Output File"})},{key:"analysis_progress",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Analysis Visualization"})},{key:"result_parse",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Result Parsing"})}];return t.jsx(t.Fragment,{children:t.jsx(q,{tabBarExtraContent:t.jsxs(R,{gap:"small",align:"center",children:[t.jsx(de,{color:"cyan",children:e==null?void 0:e.job_status}),t.jsx(y,{title:t.jsx(t.Fragment,{children:c[r]})}),e.job_status=="running"?t.jsx(t.Fragment,{children:t.jsx(K,{title:"Stop the job?",onConfirm:async()=>{await Ne(e.analysis_id,"job"),o.success("Stopped successfully")},children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",children:"Stop"})})}):t.jsx(t.Fragment,{children:t.jsx(K,{title:"Run the job?",onConfirm:g,children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",children:e.analysis_status=="created"?"Run":"Re-Run"})})})]}),activeKey:r,onChange:m=>{s(m),a.current=m},size:"small",items:p.map(m=>({key:m.key,label:m.label,children:t.jsx(Ct,{file:c[m.key],fileKey:m.key,analysis:e})}))})})}),Tt=l.forwardRef(({visible:e,params:n,onClose:r,callback:s},o)=>{console.log("loading PipelineInfo...");const i=async()=>{a(),s&&s()},{analysis_id:u,...d}=n||{},a=async()=>{if(u){const m=(await Le(u)).data;g(m)}},[c,g]=l.useState();return l.useImperativeHandle(o,()=>({relaod:a})),l.useEffect(()=>{e&&a()},[e&&(n==null?void 0:n.analysis_id)]),e?t.jsx(t.Fragment,{children:t.jsx(z,{size:"small",title:`Process Monitoring ${u}`,extra:t.jsx(t.Fragment,{children:t.jsx(x,{size:"small",onClick:r,color:"cyan",variant:"solid",children:"关闭"})}),children:t.jsx(vt,{analysis:c,callback:i,loadAnalysis:a})})}):t.jsx(t.Fragment,{})});export{vt as F,ft as O,Tt as P};

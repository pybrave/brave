import{r as n,z as se,_ as te,I as oe,u as V,c as ae,k as ne,b as re,j as e,R as $,C as j,F as v,P as Y,a1 as le,a as _,s as ie,t as P,l as D,E as q,B as z,S as ce,M as de,y as pe}from"./main-B2jPVJuc.js";import{C as I,M as Q}from"./index-01a6DBbv.js";import{c as X}from"./utils-D2B0dIuM.js";import{b as he,p as me}from"./index-CjBmKVj7.js";import{u as ge}from"./usePagination-BFzen1kl.js";import{D as xe}from"./index-Bdn2tpOa.js";import{u as ue}from"./useStickyTop-CUcu_dat.js";import{S as W,P as ye}from"./index-IGtn9UM1.js";import{L as U}from"./index-CVcxCOCs.js";import{R as G}from"./RedoOutlined-B2jLc-U5.js";import{T as J}from"./index-bd5EV77p.js";import{S as fe}from"./index-D94Q12AR.js";import{R as je}from"./index-umuRLg26.js";import"./index-Dusr40e4.js";import"./Table-D1zuQkUf.js";import"./addEventListener-BtkycpkD.js";import"./Dropdown-DxVuU2Kw.js";import"./UpOutlined-BLGU6aq-.js";import"./DeleteOutlined-7aDqphvw.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},be=function(c,r){return n.createElement(se,te({},c,{ref:r,icon:ve}))},Ce=n.forwardRef(be);const De=({params:p,map:c})=>{const{Search:r}=oe,{baseURL:A}=V(t=>t.user),B=ae(),{messageApi:K}=ne(),{modal:l,openModal:g,closeModal:b}=re(),[C,L]=n.useState("all"),{ref:R,top:x,isSticky:S}=ue(576),{component_type:w}=p,M=t=>(c&&(t=c(t)),t.tags&&(t.tags=JSON.parse(t.tags)),{id:t.id,component_id:t.component_id,name:t.name,category:t.category,img:t.img,tags:t.tags,component_type:t.component_type,order:t.order_index,path:`/component/${w}/${t.component_id}`,namespace:t.namespace,namespace_name:t.namespace_name}),{data:i,pageNumber:H,totalPage:u,loading:N,reload:h,pageSize:O,setPageNumber:y,search:T}=ge({pageApi:me,params:{category:C,...p},map:M,initialPageSize:12}),[E,F]=n.useState([]),[k,m]=n.useState(!1),f=async()=>{m(!0);const t=await _.get("/component/get-all-category");F(["all",...t.data]),m(!1)};return n.useEffect(()=>{f()},[]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"1rem auto"},children:[e.jsxs($,{ref:R,gutter:[S?16:0,16],children:[e.jsx(j,{lg:21,sm:21,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs(I,{size:"small",style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(e.Fragment,{children:e.jsxs(v,{gap:"small",children:[e.jsx(z,{size:"small",color:"cyan",variant:"solid",onClick:()=>{g("installComponents",{component_type:w})},children:"Intsall Components "}),e.jsx(z,{size:"small",color:"cyan",variant:"solid",onClick:()=>{g("modalA",{data:void 0,structure:{component_type:w}})},children:"Create Components "}),e.jsx(z,{size:"small",color:"primary",variant:"solid",onClick:h,children:"Refresh"})]})}),title:e.jsx(e.Fragment,{children:e.jsx(r,{size:"small",placeholder:"Search Components",allowClear:!0,enterButton:!0,onSearch:t=>{T(t)},style:{width:400}})}),children:[e.jsx(W,{spinning:N,children:Array.isArray(i)&&i.length!=0?e.jsx($,{gutter:16,style:{position:"relative"},children:i.map((t,s)=>e.jsx(j,{lg:6,sm:4,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsxs(I,{hoverable:!0,size:"small",className:"custom-card",variant:"borderless",style:{height:"100%",border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease"},bodyStyle:{padding:"12px 16px"},cover:e.jsx("div",{style:{height:"15rem"},children:e.jsx("img",{style:{height:"100%",width:"100%",objectFit:"cover"},alt:t.label,src:`${A}${t.img}`})}),onClick:()=>B(`${t.path}`),children:[e.jsx(Q,{title:e.jsxs(v,{gap:"small",children:[e.jsx("span",{children:t.name}),e.jsx(Y,{title:"Copy component ?",onConfirm:async o=>{o.stopPropagation(),await _.post(`/copy-component/${t.component_id}`),ie.success("Component copied!"),h()},children:e.jsx(le,{onClick:o=>{o.stopPropagation()}})})]}),description:t==null?void 0:t.description,style:{marginBottom:"1rem"}}),t.tags&&Array.isArray(t.tags)&&t.tags.map((o,a)=>e.jsx(P,{title:o,children:e.jsx(D,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:X[a],children:o})},a)),e.jsx("div",{onClick:o=>{o.stopPropagation(),g("modalG",t)},style:{position:"absolute",right:10,bottom:10,fontSize:15,color:"rgba(0,0,0,0.45)",cursor:"pointer"},children:e.jsx(Ce,{})})]})},s))}):e.jsx(q,{})}),u!=0&&e.jsxs(v,{style:{marginTop:"1rem"},align:"center",children:["A total of ",u,"records Â ",e.jsx(ye,{current:H,pageSize:O,total:u,onChange:t=>y(t),showSizeChanger:!1})]})]})}),e.jsx(j,{lg:3,sm:3,xs:24,style:S?{overflow:"hidden",position:"sticky",top:`${x}px`,alignSelf:"flex-start",height:`calc(100vh - ${x}px - 1rem )`}:{},children:e.jsx(I,{style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(G,{style:{cursor:"pointer"},onClick:()=>f()}),size:"small",loading:k,title:e.jsx("span",{style:{fontWeight:600},children:"Category"}),children:k?e.jsx(ce,{active:!0,paragraph:{rows:5}}):e.jsx(U,{dataSource:E,split:!1,renderItem:t=>e.jsx(U.Item,{style:{padding:"6px 0",border:"none"},children:e.jsx(z,{block:!0,type:C===t?"primary":"default",onClick:()=>L(t),style:{textAlign:"left",borderRadius:"8px",transition:"all 0.2s"},className:"hover:shadow-md",children:t})})})})})]}),e.jsx(he,{callback:h,visible:l.key=="modalA"&&l.visible,onClose:b,params:l.params}),e.jsx(xe,{visible:l.key=="modalG"&&l.visible,onClose:b,callback:h,params:l.params}),e.jsx(Se,{visible:l.key=="installComponents"&&l.visible,onClose:b,callback:h,params:l.params})]})},Se=({visible:p,onClose:c,params:r,callback:A})=>{const[B,K]=n.useState([]),[l,g]=n.useState([]),[b,C]=n.useState(!1),[L,R]=n.useState(!1),[x,S]=n.useState(),{baseURL:w}=V(s=>s.user),M=pe(),[i,H]=n.useState("github"),{githubToken:u,storeRepos:N}=V(s=>s.user),[h,O]=n.useState([]),[y,T]=n.useState("all"),[E,F]=n.useState();n.useEffect(()=>{p&&(r!=null&&r.component_type)&&k()},[p,r==null?void 0:r.component_type,i]);const k=async()=>{try{C(!0);let o=(await _.get(`/component-store/list-stores?address=${i}`)).data;if(i=="github"&&(o=[...JSON.parse(N||"[]").filter(d=>d.address==i),...o]),K(o),o.length>0){const a=o[0];S(a.store_name),m(a.store_name,void 0,a==null?void 0:a.store_path),F(a==null?void 0:a.store_path)}else g([]);C(!1)}catch{}},m=async(s,o=void 0,a=void 0)=>{R(!0);try{const d=await _.post("/component-store/list-components",{store_name:s,component_type:r==null?void 0:r.component_type,address:i,remote_force:o,token:u,store_path:a||E}),Z=d.data.map(ee=>ee.category);O(["all",...Array.from(new Set(Z))]),g(d.data)}catch{}R(!1)},f=n.useMemo(()=>y=="all"?l:l.filter(s=>s.category==y),[l,y]),t=s=>s.startsWith("http")?s:`${w}${s}`;return e.jsx(de,{footer:null,title:e.jsxs(v,{gap:"small",children:[e.jsxs("span",{children:["Install Components"," "]}),e.jsx(G,{style:{cursor:"pointer"},onClick:()=>{i=="github"?m(x,!0):m(x)}})]}),width:"90%",open:p,onClose:c,onCancel:c,children:e.jsxs(W,{spinning:b,children:[e.jsx(J,{size:"small",tabBarExtraContent:e.jsxs(v,{gap:"small",children:[e.jsx(fe,{value:i,options:[{label:"Github",value:"github"},{label:"Local",value:"local"}],onChange:s=>{H(s)}}),e.jsx(G,{style:{cursor:"pointer"},onClick:()=>k()})]}),activeKey:x,onChange:s=>{S(s),m(s)},items:B.map(s=>({key:s.store_name,label:e.jsx(P,{title:s.store_path,children:s.name?s.name:s.store_name})}))}),e.jsx(W,{spinning:L,children:e.jsxs($,{children:[e.jsx(j,{lg:21,sm:21,xs:24,children:Array.isArray(f)&&f.length!=0?e.jsx($,{gutter:16,style:{position:"relative"},children:f.map((s,o)=>e.jsx(j,{lg:4,sm:4,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsx(Y,{okButtonProps:{color:`${s.installed?"red":"blue"}`,variant:"solid"},okText:s.installed?"Reinstall":"Install",title:s.installed?`Reinstall ${s.component_name} ?`:`Install ${s.component_name} ?`,onConfirm:async()=>{await _.post("/install-components",{path:s.file_path,force:!0,address:s.address,branch:s.branch,token:u},{timeout:6e4}),M.success(s.installed?"Reinstall success!":"Install success!"),A&&A(),c&&c()},children:e.jsxs(I,{size:"small",hoverable:!0,className:"custom-card",title:e.jsx(P,{title:s==null?void 0:s.component_id,children:s.component_name}),style:{height:"100%",border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease"},cover:e.jsx("div",{style:{height:"15rem"},children:e.jsx("img",{style:{height:"100%",width:"100%",objectFit:"cover"},alt:s.label,src:t(s.img)})}),children:[e.jsx(Q,{title:e.jsxs(v,{justify:"space-between",align:"center",children:[e.jsx(D,{color:s.installed?"#108ee9":"#f5222d",children:s.installed?"Installed":"Not I nstalled"}),e.jsx(je,{style:{cursor:"pointer"}})]}),description:s==null?void 0:s.description,style:{marginBottom:"1rem"}}),s.tags&&Array.isArray(s.tags)&&s.tags.map((a,d)=>e.jsx(P,{title:a,children:e.jsx(D,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:X[d],children:a})},d))]})})},o))}):e.jsx(q,{})}),e.jsx(j,{lg:3,sm:3,xs:24,children:e.jsx(J,{activeKey:y,onChange:s=>T(s),tabBarStyle:{marginBottom:0},type:"card",size:"small",tabPosition:"right",items:h.map(s=>({key:s,label:s}))})})]})})]})})};export{De as default};

import{r as b,x as Ci,j as y,z as ht,B as se,a as ot,F as ve,w as st,A as lc,E as Mi,D as Ni,v as Or,M as pt,I as St,P as uc,G as Ai,g as dc,R as fe,H as xo,J as Lt,K as Di,u as fc,y as hc,L as gc,N as pc,O as mc}from"./index-7AvwSwCy.js";import{U as Ii,A as ki,a as yc}from"./index-BB_tI3ZS.js";import{c as xc}from"./utils-D2B0dIuM.js";import{M as Ri,s as vc,a as wc,C as bc,b as Sc,c as _c,d as Ec}from"./index-QPqVsVq-.js";import{D as Cc}from"./index-DRXOc65y.js";import{T as $n,C as Ti}from"./index-CS88LIE_.js";import{F as Mc}from"./index-BvukfNTE.js";import{F as Fr}from"./Table-BNMDHWhP.js";import{D as Nc}from"./index-D56bD6gD.js";import{f as Ac,u as Dc,a as Ic,M as kc,B as Rc}from"./index-Bc8hBZlu.js";import{r as Tc}from"./index-3BF_qLpI.js";import{M as Pi}from"./index-DBiCLgo6.js";import{S as Pc}from"./index-CsxUT7Dl.js";import{T as jc,i as $c,j as En,k as Cn,d as Br,t as Lc,l as zc}from"./rgb-BPXy-Sdz.js";import{T as Oc}from"./index-CXNer6h3.js";import"./index-C6RIyMkZ.js";import"./index-Bb-FBSon.js";import"./index-C8gVfalV.js";import"./index-4-7uQlQF.js";import"./index-DQ0qF9w_.js";import"./addEventListener-DsndksVL.js";function vo(e,t,n){var r=new jc;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}function Fc(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(i){for(o=0;o<n;++o)r[o]=e[o]*(1-i)+t[o]*i;return r}}function Bc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Hc(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,o=new Array(r),i=new Array(n),s;for(s=0;s<r;++s)o[s]=zt(e[s],t[s]);for(;s<n;++s)i[s]=t[s];return function(a){for(s=0;s<r;++s)i[s]=o[s](a);return i}}function Vc(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Le(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Xc(e,t){var n={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?n[o]=zt(e[o],t[o]):r[o]=t[o];return function(i){for(o in n)r[o]=n[o](i);return r}}var Sr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,or=new RegExp(Sr.source,"g");function Yc(e){return function(){return e}}function Wc(e){return function(t){return e(t)+""}}function ji(e,t){var n=Sr.lastIndex=or.lastIndex=0,r,o,i,s=-1,a=[],c=[];for(e=e+"",t=t+"";(r=Sr.exec(e))&&(o=or.exec(t));)(i=o.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(r=r[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,c.push({i:s,x:Le(r,o)})),n=or.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?c[0]?Wc(c[0].x):Yc(t):(t=c.length,function(u){for(var l=0,f;l<t;++l)a[(f=c[l]).i]=f.x(u);return a.join("")})}function zt(e,t){var n=typeof t,r;return t==null||n==="boolean"?$c(t):(n==="number"?Le:n==="string"?(r=Cn(t))?(t=r,En):ji:t instanceof Cn?En:t instanceof Date?Vc:Bc(t)?Fc:Array.isArray(t)?Hc:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Xc:Le)(e,t)}var wo=180/Math.PI,_r={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function $i(e,t,n,r,o,i){var s,a,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),e*r<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*wo,skewX:Math.atan(c)*wo,scaleX:s,scaleY:a}}var un;function Uc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?_r:$i(t.a,t.b,t.c,t.d,t.e,t.f)}function qc(e){return e==null||(un||(un=document.createElementNS("http://www.w3.org/2000/svg","g")),un.setAttribute("transform",e),!(e=un.transform.baseVal.consolidate()))?_r:(e=e.matrix,$i(e.a,e.b,e.c,e.d,e.e,e.f))}function Li(e,t,n,r){function o(u){return u.length?u.pop()+" ":""}function i(u,l,f,d,h,m){if(u!==f||l!==d){var p=h.push("translate(",null,t,null,n);m.push({i:p-4,x:Le(u,f)},{i:p-2,x:Le(l,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function s(u,l,f,d){u!==l?(u-l>180?l+=360:l-u>180&&(u+=360),d.push({i:f.push(o(f)+"rotate(",null,r)-2,x:Le(u,l)})):l&&f.push(o(f)+"rotate("+l+r)}function a(u,l,f,d){u!==l?d.push({i:f.push(o(f)+"skewX(",null,r)-2,x:Le(u,l)}):l&&f.push(o(f)+"skewX("+l+r)}function c(u,l,f,d,h,m){if(u!==f||l!==d){var p=h.push(o(h)+"scale(",null,",",null,")");m.push({i:p-4,x:Le(u,f)},{i:p-2,x:Le(l,d)})}else(f!==1||d!==1)&&h.push(o(h)+"scale("+f+","+d+")")}return function(u,l){var f=[],d=[];return u=e(u),l=e(l),i(u.translateX,u.translateY,l.translateX,l.translateY,f,d),s(u.rotate,l.rotate,f,d),a(u.skewX,l.skewX,f,d),c(u.scaleX,u.scaleY,l.scaleX,l.scaleY,f,d),u=l=null,function(h){for(var m=-1,p=d.length,x;++m<p;)f[(x=d[m]).i]=x.x(h);return f.join("")}}}var Gc=Li(Uc,"px, ","px)","deg)"),Kc=Li(qc,", ",")",")"),Zc=1e-12;function bo(e){return((e=Math.exp(e))+1/e)/2}function Jc(e){return((e=Math.exp(e))-1/e)/2}function Qc(e){return((e=Math.exp(2*e))-1)/(e+1)}const vn=function e(t,n,r){function o(i,s){var a=i[0],c=i[1],u=i[2],l=s[0],f=s[1],d=s[2],h=l-a,m=f-c,p=h*h+m*m,x,w;if(p<Zc)w=Math.log(d/u)/t,x=function(M){return[a+M*h,c+M*m,u*Math.exp(t*M*w)]};else{var E=Math.sqrt(p),g=(d*d-u*u+r*p)/(2*u*n*E),v=(d*d-u*u-r*p)/(2*d*n*E),_=Math.log(Math.sqrt(g*g+1)-g),C=Math.log(Math.sqrt(v*v+1)-v);w=(C-_)/t,x=function(M){var N=M*w,T=bo(_),O=u/(n*E)*(T*Qc(t*N+_)-Jc(_));return[a+O*h,c+O*m,u*T/bo(t*N+_)]}}return x.duration=w*1e3*t/Math.SQRT2,x}return o.rho=function(i){var s=Math.max(.001,+i),a=s*s,c=a*a;return e(s,a,c)},o}(Math.SQRT2,2,4),el=({visible:e,onClose:t,params:n,callback:r})=>{if(!e)return null;const[o,i]=b.useState(),[s,a]=Ci.useMessage(),[c,u]=b.useState("main"),l=b.useRef(null),f=async d=>{try{const h=await ot.get(`/get-component-module-content/${d.component_id}?script_name=${c}`);console.log(h),i(h.data)}catch(h){s.error(`${h.response.data.detail}`)}};return b.useEffect(()=>{f(n)},[JSON.stringify(n),c]),y.jsxs(y.Fragment,{children:[a,y.jsxs(Cc,{extra:y.jsx(ht,{justify:"flex-end",gap:"small",children:y.jsx(se,{color:"cyan",variant:"solid",onClick:()=>{l.current.setValue(o==null?void 0:o.content)},children:"保存"})}),title:"查看文件",open:e,onClose:t,width:"50%",children:[y.jsx("ul",{children:y.jsxs("li",{children:["path:",o==null?void 0:o.path]})}),y.jsx("hr",{}),y.jsx($n,{onChange:d=>{u(d)},items:[{label:"main",key:"main"},{label:"input_parse",key:"input_parse"},{label:"output_parse",key:"output_parse"}]}),y.jsx(Ri,{value:o==null?void 0:o.content,editorRef:l,defaultLanguage:"python"})]})]})},ir=({component_type:e,component_id:t,component_name:n,inputForm:r,operatePipeline:o,name:i,callback:s})=>{const[a]=ve.useForm();console.log("-->ImportFile渲染");const{messageApi:c,project:u}=st(),[l,f]=b.useState([]);lc(_=>_.global.setting);const[d,h]=b.useState(),[m,p]=b.useState(),x=b.useRef(null);b.useEffect(()=>{if(r){let C=r.map(M=>Array.isArray(M.name)?M.name[1]:M.name).map(M=>({title:M,dataIndex:M,key:M,render:N=>y.jsx("span",{children:N})}));C=[{title:"样本名称",dataIndex:"sample_name",key:"sample_name",render:M=>y.jsx("span",{children:M})},...C],console.log(C),x.current=C,p(C)}},[r]);const w=_=>{const{content:C,sample_name:M}=_;return l?l.map(N=>{const{sample_name:T,...O}=N;return{..._,project:u,component_id:t,content:JSON.stringify(O),sample_name:T}}):[{..._,project:u,component_id:t,content:JSON.stringify(C),sample_name:M}]},E=async()=>{const _=await a.validateFields();if(_.length==0){c.error("没有数据添加!");return}if(r&&r.length==0){c.error("该组件没有配置inputForm!");return}const C=w(_);try{const M=await ot.post("/import-data",C);c.success("导入成功"),s&&s()}catch(M){c.error(M.response.data.detail)}},g=async()=>{const _=await a.validateFields();if(r&&r.length==0){c.error("该组件没有配置inputForm!");return}const C=await ot.post("/parse-import-data",{content:JSON.stringify(_.content)});console.log(C),f(C.data)},v=()=>y.jsx(Fr,{size:"small",bordered:!0,pagination:!1,footer:()=>y.jsxs("div",{style:{textAlign:"right"},children:["一共",l.length,"条记录   ",y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:E,children:"确认"})]}),columns:m,dataSource:l});return b.useEffect(()=>{const _=C=>{var j;const M=((j=C.clipboardData)==null?void 0:j.getData("Text"))||"";if(!M)return;const N=M.includes("	")?"	":",",O=M.split(/\r?\n/).filter(P=>P.trim()!=="").map(P=>P.split(N).map(S=>S.trim()));console.log(O);const R=O.map(P=>{const S={};return x.current.forEach((I,A)=>{P.length<=A?S[I.dataIndex]="unknown":S[I.dataIndex]=P[A]}),S});f(R),c.success("粘贴成功！")};return document.addEventListener("paste",_),()=>{document.removeEventListener("paste",_)}},[]),b.useEffect(()=>{},[]),y.jsx(y.Fragment,{children:y.jsxs(Ti,{title:`${n}(${t})`,extra:y.jsxs(ht,{gap:"small",children:[y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{o.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"编辑inputForm"}),y.jsx(se,{size:"small",color:"cyan",variant:"solid",disabled:!l,onClick:()=>f([]),children:"清空"}),y.jsx(se,{size:"small",color:"cyan",variant:"solid",disabled:!r,onClick:g,children:"解析"})]}),children:[y.jsx("pre",{}),y.jsxs(ve,{form:a,children:[r?y.jsx(y.Fragment,{children:y.jsx(Mc,{formJson:r,dataMap:{}})}):y.jsx(y.Fragment,{children:y.jsx(Mi,{description:"该组件没有配置inputForm!",children:y.jsx(se,{color:"cyan",variant:"solid",onClick:()=>{o.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"配置inputForm"})})}),v(),y.jsx(Ni,{ghost:!0,items:[{key:"1",label:"更多",children:y.jsx(y.Fragment,{children:y.jsx(ve.Item,{noStyle:!0,shouldUpdate:!0,children:()=>y.jsx(Or,{children:y.jsx("pre",{children:JSON.stringify(w(a.getFieldsValue()),null,2)})})})})}]})]})]})})},tl=({visible:e,onClose:t,params:n,callback:r})=>e?y.jsx(y.Fragment,{children:y.jsx(pt,{open:e,onClose:t,width:"80%",onCancel:t,title:"导入数据",footer:null,children:y.jsx(rl,{params:n,type:"inputFile",callback:t})})}):null,nl=({params:e,type:t,callback:n})=>{if(!e)return y.jsx(y.Fragment,{children:"无数据"});if(e.component_type=="software"){if(e[t]&&Array.isArray(e[t])&&e[t].length>0)return e[t].map((r,o)=>b.createElement(ir,{...r,operatePipeline:e.operatePipeline,key:o,callback:n}))}else{if(e.component_type=="pipeline")return y.jsx(ir,{...e});if(e.component_type=="file")return y.jsx(ir,{...e})}},rl=b.memo(nl),ol=({visible:e,onClose:t,params:n,callback:r})=>{if(!e)return null;const[o,i]=b.useState([]),[s,a]=b.useState(!1),[c]=ve.useForm(),[u,l]=b.useState(n[0].dataKey),[f,d]=b.useState(null),h=async v=>{a(!0);const _=await ot.post("/list-bio-database",v);i(_.data),a(!1)},m=async()=>({...await c.validateFields(),type:u}),p=async()=>{const v=await m();f?await ot.post("/update-bio-database",{...v,database_id:f.database_id}):await ot.post("/add-bio-database",v),x(),d(void 0),c.resetFields()},x=()=>{h({type:u})};b.useEffect(()=>{h({type:u})},[n]);const w=v=>{l(v),h({type:v})},E=async v=>{await ot.delete(`/delete-bio-database/${v.id}`),x()},g=v=>{c.setFieldsValue(v),d(v)};return y.jsxs(pt,{title:"数据库操作",open:e,onCancel:t,width:"50%",footer:null,children:[y.jsx($n,{tabBarExtraContent:y.jsxs(y.Fragment,{children:[y.jsx(se,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:x,children:" 刷新"}),y.jsxs(se,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{d(void 0),p()},children:[" ",f?"更新":"添加"]})]}),activeKey:u,onChange:w,items:n.map(v=>({key:v.name,label:v.label,children:y.jsx("div",{})}))}),y.jsxs(ve,{form:c,style:{maxWidth:600},labelCol:{span:3},children:[y.jsx(ve.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:y.jsx(St,{})}),y.jsx(ve.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:y.jsx(St,{})}),y.jsx(ve.Item,{name:"db_index",label:"索引",children:y.jsx(St,{})})]}),y.jsx(Fr,{dataSource:o,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(v,_)=>y.jsxs(ht,{gap:"small",children:[y.jsx(uc,{title:"确定删除吗？",onConfirm:()=>{E(_)},children:y.jsx(se,{size:"small",type:"primary",danger:!0,children:"删除"})}),y.jsx(se,{size:"small",type:"primary",onClick:()=>{g(_)},children:"编辑"})]})}],loading:s,pagination:!1})]})},il=({visible:e,onClose:t,params:n})=>y.jsx(pt,{footer:null,title:"参数",width:"50%",open:e,onCancel:t,children:y.jsx(Or,{children:y.jsx("pre",{children:JSON.stringify(n,null,2)})})});St.TextArea;const sl=({visible:e,onClose:t,params:n})=>{var f;if(!e)return null;const[r]=ve.useForm(),{callback:o}=n,{messageApi:i}=st(),{project:s,projectObj:a}=st(),c=d=>{const h=d.metadata;return delete d.metadata,{...d,sample_id:n.sample_id,project:s,analysis_result_id:n.analysis_result_id,metadata:JSON.stringify(h)}},u=async()=>{const d=await Ac(n.sample_id);r.setFieldsValue(d.data)};b.useEffect(()=>{n.sample_id&&u()},[n==null?void 0:n.sample_id]);const l=async()=>{const d=await r.validateFields(),h=c(d);h.sample_id?(await Dc(h),i.success("更新成功")):(await Ic(h),i.success("添加成功")),o==null||o(),t()};return y.jsxs(pt,{onOk:l,open:e,onClose:t,onCancel:t,title:`${n.sample_id?"编辑":"添加"}metadata`,children:[JSON.stringify(a),y.jsxs(ve,{form:r,children:[y.jsx(ve.Item,{label:"样本名称",name:"sample_name",children:y.jsx(St,{})}),(a==null?void 0:a.metadata_form)&&Array.isArray(a==null?void 0:a.metadata_form)&&((f=a==null?void 0:a.metadata_form)==null?void 0:f.map(d=>y.jsx(ve.Item,{label:d.label,name:["metadata",d.name],children:y.jsx(St,{})},d.name))),y.jsx(Ni,{ghost:!0,items:[{key:"1",label:"更多",children:y.jsx(y.Fragment,{children:y.jsx(ve.Item,{noStyle:!0,shouldUpdate:!0,children:()=>y.jsx(Or,{children:y.jsx("pre",{children:JSON.stringify(c(r.getFieldsValue()),null,2)})})})})}]})]})]})},al=({visible:e,onClose:t,params:n})=>{const[r,o]=b.useState(),[i,s]=b.useState([]),[a,c]=b.useState(),[u,l]=b.useState();b.useEffect(()=>{if(e){const h=Object.entries(n.content).map(([m,p])=>({key:p,label:m}));if(s(h),h.length>0){const m=h[0].key;c(m),f(m)}}},[e]);const f=async h=>{l(!0);const m=await Tc(h);o(m.data),l(!1)},d=h=>{const m=`/brave-api/file-operation/download?path=${h}`;window.open(m,"_blank")};return e?y.jsxs(pt,{width:"80vw",open:e,onCancel:t,title:"打开文件",footer:!1,children:[y.jsx($n,{tabBarExtraContent:y.jsxs(ht,{gap:"small",align:"center",children:[y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{d(a)},children:"下载"}),y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f(a)},children:"刷新"})]}),items:i,onChange:h=>{f(h),c(h)}}),y.jsx(Pc,{spinning:u,children:y.jsx(Ri,{value:r})}),y.jsx(Pi,{data:n.description})]}):null};function ae(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=ae(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Er="http://www.w3.org/1999/xhtml";const So={svg:"http://www.w3.org/2000/svg",xhtml:Er,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ln(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),So.hasOwnProperty(t)?{space:So[t],local:e}:e}function cl(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Er&&t.documentElement.namespaceURI===Er?t.createElement(e):t.createElementNS(n,e)}}function ll(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function zi(e){var t=Ln(e);return(t.local?ll:cl)(t)}function ul(){}function Hr(e){return e==null?ul:function(){return this.querySelector(e)}}function dl(e){typeof e!="function"&&(e=Hr(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=new Array(s),c,u,l=0;l<s;++l)(c=i[l])&&(u=e.call(c,c.__data__,l,i))&&("__data__"in c&&(u.__data__=c.__data__),a[l]=u);return new be(r,this._parents)}function fl(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function hl(){return[]}function Oi(e){return e==null?hl:function(){return this.querySelectorAll(e)}}function gl(e){return function(){return fl(e.apply(this,arguments))}}function pl(e){typeof e=="function"?e=gl(e):e=Oi(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var s=t[i],a=s.length,c,u=0;u<a;++u)(c=s[u])&&(r.push(e.call(c,c.__data__,u,s)),o.push(c));return new be(r,o)}function Fi(e){return function(){return this.matches(e)}}function Bi(e){return function(t){return t.matches(e)}}var ml=Array.prototype.find;function yl(e){return function(){return ml.call(this.children,e)}}function xl(){return this.firstElementChild}function vl(e){return this.select(e==null?xl:yl(typeof e=="function"?e:Bi(e)))}var wl=Array.prototype.filter;function bl(){return Array.from(this.children)}function Sl(e){return function(){return wl.call(this.children,e)}}function _l(e){return this.selectAll(e==null?bl:Sl(typeof e=="function"?e:Bi(e)))}function El(e){typeof e!="function"&&(e=Fi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],c,u=0;u<s;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new be(r,this._parents)}function Hi(e){return new Array(e.length)}function Cl(){return new be(this._enter||this._groups.map(Hi),this._parents)}function Mn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Mn.prototype={constructor:Mn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ml(e){return function(){return e}}function Nl(e,t,n,r,o,i){for(var s=0,a,c=t.length,u=i.length;s<u;++s)(a=t[s])?(a.__data__=i[s],r[s]=a):n[s]=new Mn(e,i[s]);for(;s<c;++s)(a=t[s])&&(o[s]=a)}function Al(e,t,n,r,o,i,s){var a,c,u=new Map,l=t.length,f=i.length,d=new Array(l),h;for(a=0;a<l;++a)(c=t[a])&&(d[a]=h=s.call(c,c.__data__,a,t)+"",u.has(h)?o[a]=c:u.set(h,c));for(a=0;a<f;++a)h=s.call(e,i[a],a,i)+"",(c=u.get(h))?(r[a]=c,c.__data__=i[a],u.delete(h)):n[a]=new Mn(e,i[a]);for(a=0;a<l;++a)(c=t[a])&&u.get(d[a])===c&&(o[a]=c)}function Dl(e){return e.__data__}function Il(e,t){if(!arguments.length)return Array.from(this,Dl);var n=t?Al:Nl,r=this._parents,o=this._groups;typeof e!="function"&&(e=Ml(e));for(var i=o.length,s=new Array(i),a=new Array(i),c=new Array(i),u=0;u<i;++u){var l=r[u],f=o[u],d=f.length,h=kl(e.call(l,l&&l.__data__,u,r)),m=h.length,p=a[u]=new Array(m),x=s[u]=new Array(m),w=c[u]=new Array(d);n(l,f,p,x,w,h,t);for(var E=0,g=0,v,_;E<m;++E)if(v=p[E]){for(E>=g&&(g=E+1);!(_=x[g])&&++g<m;);v._next=_||null}}return s=new be(s,r),s._enter=a,s._exit=c,s}function kl(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Rl(){return new be(this._exit||this._groups.map(Hi),this._parents)}function Tl(e,t,n){var r=this.enter(),o=this,i=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?i.remove():n(i),r&&o?r.merge(o).order():o}function Pl(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,i=r.length,s=Math.min(o,i),a=new Array(o),c=0;c<s;++c)for(var u=n[c],l=r[c],f=u.length,d=a[c]=new Array(f),h,m=0;m<f;++m)(h=u[m]||l[m])&&(d[m]=h);for(;c<o;++c)a[c]=n[c];return new be(a,this._parents)}function jl(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function $l(e){e||(e=Ll);function t(f,d){return f&&d?e(f.__data__,d.__data__):!f-!d}for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var s=n[i],a=s.length,c=o[i]=new Array(a),u,l=0;l<a;++l)(u=s[l])&&(c[l]=u);c.sort(t)}return new be(o,this._parents).order()}function Ll(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function zl(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Ol(){return Array.from(this)}function Fl(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function Bl(){let e=0;for(const t of this)++e;return e}function Hl(){return!this.node()}function Vl(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],i=0,s=o.length,a;i<s;++i)(a=o[i])&&e.call(a,a.__data__,i,o);return this}function Xl(e){return function(){this.removeAttribute(e)}}function Yl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Wl(e,t){return function(){this.setAttribute(e,t)}}function Ul(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function ql(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Gl(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Kl(e,t){var n=Ln(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Yl:Xl:typeof t=="function"?n.local?Gl:ql:n.local?Ul:Wl)(n,t))}function Vi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Zl(e){return function(){this.style.removeProperty(e)}}function Jl(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ql(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function eu(e,t,n){return arguments.length>1?this.each((t==null?Zl:typeof t=="function"?Ql:Jl)(e,t,n??"")):Ct(this.node(),e)}function Ct(e,t){return e.style.getPropertyValue(t)||Vi(e).getComputedStyle(e,null).getPropertyValue(t)}function tu(e){return function(){delete this[e]}}function nu(e,t){return function(){this[e]=t}}function ru(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function ou(e,t){return arguments.length>1?this.each((t==null?tu:typeof t=="function"?ru:nu)(e,t)):this.node()[e]}function Xi(e){return e.trim().split(/^|\s+/)}function Vr(e){return e.classList||new Yi(e)}function Yi(e){this._node=e,this._names=Xi(e.getAttribute("class")||"")}Yi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Wi(e,t){for(var n=Vr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Ui(e,t){for(var n=Vr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function iu(e){return function(){Wi(this,e)}}function su(e){return function(){Ui(this,e)}}function au(e,t){return function(){(t.apply(this,arguments)?Wi:Ui)(this,e)}}function cu(e,t){var n=Xi(e+"");if(arguments.length<2){for(var r=Vr(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?au:t?iu:su)(n,t))}function lu(){this.textContent=""}function uu(e){return function(){this.textContent=e}}function du(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function fu(e){return arguments.length?this.each(e==null?lu:(typeof e=="function"?du:uu)(e)):this.node().textContent}function hu(){this.innerHTML=""}function gu(e){return function(){this.innerHTML=e}}function pu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function mu(e){return arguments.length?this.each(e==null?hu:(typeof e=="function"?pu:gu)(e)):this.node().innerHTML}function yu(){this.nextSibling&&this.parentNode.appendChild(this)}function xu(){return this.each(yu)}function vu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function wu(){return this.each(vu)}function bu(e){var t=typeof e=="function"?e:zi(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Su(){return null}function _u(e,t){var n=typeof e=="function"?e:zi(e),r=t==null?Su:typeof t=="function"?t:Hr(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Eu(){var e=this.parentNode;e&&e.removeChild(this)}function Cu(){return this.each(Eu)}function Mu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Nu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Au(e){return this.select(e?Nu:Mu)}function Du(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Iu(e){return function(t){e.call(this,t,this.__data__)}}function ku(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function Ru(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,i;n<o;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++r]=i;++r?t.length=r:delete this.__on}}}function Tu(e,t,n){return function(){var r=this.__on,o,i=Iu(t);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),o.value=t;return}}this.addEventListener(e.type,i,n),o={type:e.type,name:e.name,value:t,listener:i,options:n},r?r.push(o):this.__on=[o]}}function Pu(e,t,n){var r=ku(e+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,l;c<u;++c)for(o=0,l=a[c];o<i;++o)if((s=r[o]).type===l.type&&s.name===l.name)return l.value}return}for(a=t?Tu:Ru,o=0;o<i;++o)this.each(a(r[o],t,n));return this}function qi(e,t,n){var r=Vi(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function ju(e,t){return function(){return qi(this,e,t)}}function $u(e,t){return function(){return qi(this,e,t.apply(this,arguments))}}function Lu(e,t){return this.each((typeof t=="function"?$u:ju)(e,t))}function*zu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var Gi=[null];function be(e,t){this._groups=e,this._parents=t}function Jt(){return new be([[document.documentElement]],Gi)}function Ou(){return this}be.prototype=Jt.prototype={constructor:be,select:dl,selectAll:pl,selectChild:vl,selectChildren:_l,filter:El,data:Il,enter:Cl,exit:Rl,join:Tl,merge:Pl,selection:Ou,order:jl,sort:$l,call:zl,nodes:Ol,node:Fl,size:Bl,empty:Hl,each:Vl,attr:Kl,style:eu,property:ou,classed:cu,text:fu,html:mu,raise:xu,lower:wu,append:bu,insert:_u,remove:Cu,clone:Au,datum:Du,on:Pu,dispatch:Lu,[Symbol.iterator]:zu};function we(e){return typeof e=="string"?new be([[document.querySelector(e)]],[document.documentElement]):new be([[e]],Gi)}function Fu(e){let t;for(;t=e.sourceEvent;)e=t;return e}function De(e,t){if(e=Fu(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Bu={passive:!1},Vt={capture:!0,passive:!1};function sr(e){e.stopImmediatePropagation()}function _t(e){e.preventDefault(),e.stopImmediatePropagation()}function Ki(e){var t=e.document.documentElement,n=we(e).on("dragstart.drag",_t,Vt);"onselectstart"in t?n.on("selectstart.drag",_t,Vt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Zi(e,t){var n=e.document.documentElement,r=we(e).on("dragstart.drag",null);t&&(r.on("click.drag",_t,Vt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const dn=e=>()=>e;function Cr(e,{sourceEvent:t,subject:n,target:r,identifier:o,active:i,x:s,y:a,dx:c,dy:u,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:l}})}Cr.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Hu(e){return!e.ctrlKey&&!e.button}function Vu(){return this.parentNode}function Xu(e,t){return t??{x:e.x,y:e.y}}function Yu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ji(){var e=Hu,t=Vu,n=Xu,r=Yu,o={},i=Br("start","drag","end"),s=0,a,c,u,l,f=0;function d(v){v.on("mousedown.drag",h).filter(r).on("touchstart.drag",x).on("touchmove.drag",w,Bu).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(v,_){if(!(l||!e.call(this,v,_))){var C=g(this,t.call(this,v,_),v,_,"mouse");C&&(we(v.view).on("mousemove.drag",m,Vt).on("mouseup.drag",p,Vt),Ki(v.view),sr(v),u=!1,a=v.clientX,c=v.clientY,C("start",v))}}function m(v){if(_t(v),!u){var _=v.clientX-a,C=v.clientY-c;u=_*_+C*C>f}o.mouse("drag",v)}function p(v){we(v.view).on("mousemove.drag mouseup.drag",null),Zi(v.view,u),_t(v),o.mouse("end",v)}function x(v,_){if(e.call(this,v,_)){var C=v.changedTouches,M=t.call(this,v,_),N=C.length,T,O;for(T=0;T<N;++T)(O=g(this,M,v,_,C[T].identifier,C[T]))&&(sr(v),O("start",v,C[T]))}}function w(v){var _=v.changedTouches,C=_.length,M,N;for(M=0;M<C;++M)(N=o[_[M].identifier])&&(_t(v),N("drag",v,_[M]))}function E(v){var _=v.changedTouches,C=_.length,M,N;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),M=0;M<C;++M)(N=o[_[M].identifier])&&(sr(v),N("end",v,_[M]))}function g(v,_,C,M,N,T){var O=i.copy(),R=De(T||C,_),j,P,S;if((S=n.call(v,new Cr("beforestart",{sourceEvent:C,target:d,identifier:N,active:s,x:R[0],y:R[1],dx:0,dy:0,dispatch:O}),M))!=null)return j=S.x-R[0]||0,P=S.y-R[1]||0,function I(A,D,$){var k=R,L;switch(A){case"start":o[N]=I,L=s++;break;case"end":delete o[N],--s;case"drag":R=De($||D,_),L=s;break}O.call(A,v,new Cr(A,{sourceEvent:D,subject:S,target:d,identifier:N,active:L,x:R[0]+j,y:R[1]+P,dx:R[0]-k[0],dy:R[1]-k[1],dispatch:O}),M)}}return d.filter=function(v){return arguments.length?(e=typeof v=="function"?v:dn(!!v),d):e},d.container=function(v){return arguments.length?(t=typeof v=="function"?v:dn(v),d):t},d.subject=function(v){return arguments.length?(n=typeof v=="function"?v:dn(v),d):n},d.touchable=function(v){return arguments.length?(r=typeof v=="function"?v:dn(!!v),d):r},d.on=function(){var v=i.on.apply(i,arguments);return v===i?d:v},d.clickDistance=function(v){return arguments.length?(f=(v=+v)*v,d):Math.sqrt(f)},d}var Wu=Br("start","end","cancel","interrupt"),Uu=[],Qi=0,_o=1,Mr=2,wn=3,Eo=4,Nr=5,bn=6;function zn(e,t,n,r,o,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;qu(e,n,{name:t,index:r,group:o,on:Wu,tween:Uu,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Qi})}function Xr(e,t){var n=Re(e,t);if(n.state>Qi)throw new Error("too late; already scheduled");return n}function Be(e,t){var n=Re(e,t);if(n.state>wn)throw new Error("too late; already running");return n}function Re(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function qu(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=Lc(i,0,n.time);function i(u){n.state=_o,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var l,f,d,h;if(n.state!==_o)return c();for(l in r)if(h=r[l],h.name===n.name){if(h.state===wn)return vo(s);h.state===Eo?(h.state=bn,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete r[l]):+l<t&&(h.state=bn,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete r[l])}if(vo(function(){n.state===wn&&(n.state=Eo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Mr,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Mr){for(n.state=wn,o=new Array(d=n.tween.length),l=0,f=-1;l<d;++l)(h=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(o[++f]=h);o.length=f+1}}function a(u){for(var l=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=Nr,1),f=-1,d=o.length;++f<d;)o[f].call(e,l);n.state===Nr&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=bn,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function Sn(e,t){var n=e.__transition,r,o,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){i=!1;continue}o=r.state>Mr&&r.state<Nr,r.state=bn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}i&&delete e.__transition}}function Gu(e){return this.each(function(){Sn(this,e)})}function Ku(e,t){var n,r;return function(){var o=Be(this,e),i=o.tween;if(i!==n){r=n=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function Zu(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var i=Be(this,e),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:t,value:n},c=0,u=o.length;c<u;++c)if(o[c].name===t){o[c]=a;break}c===u&&o.push(a)}i.tween=o}}function Ju(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Re(this.node(),n).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===e)return s.value;return null}return this.each((t==null?Ku:Zu)(n,e,t))}function Yr(e,t,n){var r=e._id;return e.each(function(){var o=Be(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return Re(o,r).value[t]}}function es(e,t){var n;return(typeof t=="number"?Le:t instanceof Cn?En:(n=Cn(t))?(t=n,En):ji)(e,t)}function Qu(e){return function(){this.removeAttribute(e)}}function ed(e){return function(){this.removeAttributeNS(e.space,e.local)}}function td(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,n)}}function nd(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,n)}}function rd(e,t,n){var r,o,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=a+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a)))}}function od(e,t,n){var r,o,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=a+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a)))}}function id(e,t){var n=Ln(e),r=n==="transform"?Kc:es;return this.attrTween(e,typeof t=="function"?(n.local?od:rd)(n,r,Yr(this,"attr."+e,t)):t==null?(n.local?ed:Qu)(n):(n.local?nd:td)(n,r,t))}function sd(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ad(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function cd(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&ad(e,i)),n}return o._value=t,o}function ld(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&sd(e,i)),n}return o._value=t,o}function ud(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=Ln(e);return this.tween(n,(r.local?cd:ld)(r,t))}function dd(e,t){return function(){Xr(this,e).delay=+t.apply(this,arguments)}}function fd(e,t){return t=+t,function(){Xr(this,e).delay=t}}function hd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?dd:fd)(t,e)):Re(this.node(),t).delay}function gd(e,t){return function(){Be(this,e).duration=+t.apply(this,arguments)}}function pd(e,t){return t=+t,function(){Be(this,e).duration=t}}function md(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?gd:pd)(t,e)):Re(this.node(),t).duration}function yd(e,t){if(typeof t!="function")throw new Error;return function(){Be(this,e).ease=t}}function xd(e){var t=this._id;return arguments.length?this.each(yd(t,e)):Re(this.node(),t).ease}function vd(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Be(this,e).ease=n}}function wd(e){if(typeof e!="function")throw new Error;return this.each(vd(this._id,e))}function bd(e){typeof e!="function"&&(e=Fi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],c,u=0;u<s;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new qe(r,this._parents,this._name,this._id)}function Sd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var c=t[a],u=n[a],l=c.length,f=s[a]=new Array(l),d,h=0;h<l;++h)(d=c[h]||u[h])&&(f[h]=d);for(;a<r;++a)s[a]=t[a];return new qe(s,this._parents,this._name,this._id)}function _d(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Ed(e,t,n){var r,o,i=_d(t)?Xr:Be;return function(){var s=i(this,e),a=s.on;a!==r&&(o=(r=a).copy()).on(t,n),s.on=o}}function Cd(e,t){var n=this._id;return arguments.length<2?Re(this.node(),n).on.on(e):this.each(Ed(n,e,t))}function Md(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Nd(){return this.on("end.remove",Md(this._id))}function Ad(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Hr(e));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],c=a.length,u=i[s]=new Array(c),l,f,d=0;d<c;++d)(l=a[d])&&(f=e.call(l,l.__data__,d,a))&&("__data__"in l&&(f.__data__=l.__data__),u[d]=f,zn(u[d],t,n,d,u,Re(l,n)));return new qe(i,this._parents,t,n)}function Dd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Oi(e));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var c=r[a],u=c.length,l,f=0;f<u;++f)if(l=c[f]){for(var d=e.call(l,l.__data__,f,c),h,m=Re(l,n),p=0,x=d.length;p<x;++p)(h=d[p])&&zn(h,t,n,p,d,m);i.push(d),s.push(l)}return new qe(i,s,t,n)}var Id=Jt.prototype.constructor;function kd(){return new Id(this._groups,this._parents)}function Rd(e,t){var n,r,o;return function(){var i=Ct(this,e),s=(this.style.removeProperty(e),Ct(this,e));return i===s?null:i===n&&s===r?o:o=t(n=i,r=s)}}function ts(e){return function(){this.style.removeProperty(e)}}function Td(e,t,n){var r,o=n+"",i;return function(){var s=Ct(this,e);return s===o?null:s===r?i:i=t(r=s,n)}}function Pd(e,t,n){var r,o,i;return function(){var s=Ct(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),Ct(this,e))),s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a))}}function jd(e,t){var n,r,o,i="style."+t,s="end."+i,a;return function(){var c=Be(this,e),u=c.on,l=c.value[i]==null?a||(a=ts(t)):void 0;(u!==n||o!==l)&&(r=(n=u).copy()).on(s,o=l),c.on=r}}function $d(e,t,n){var r=(e+="")=="transform"?Gc:es;return t==null?this.styleTween(e,Rd(e,r)).on("end.style."+e,ts(e)):typeof t=="function"?this.styleTween(e,Pd(e,r,Yr(this,"style."+e,t))).each(jd(this._id,e)):this.styleTween(e,Td(e,r,t),n).on("end.style."+e,null)}function Ld(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function zd(e,t,n){var r,o;function i(){var s=t.apply(this,arguments);return s!==o&&(r=(o=s)&&Ld(e,s,n)),r}return i._value=t,i}function Od(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,zd(e,t,n??""))}function Fd(e){return function(){this.textContent=e}}function Bd(e){return function(){var t=e(this);this.textContent=t??""}}function Hd(e){return this.tween("text",typeof e=="function"?Bd(Yr(this,"text",e)):Fd(e==null?"":e+""))}function Vd(e){return function(t){this.textContent=e.call(this,t)}}function Xd(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Vd(o)),t}return r._value=e,r}function Yd(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Xd(e))}function Wd(){for(var e=this._name,t=this._id,n=ns(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,c,u=0;u<a;++u)if(c=s[u]){var l=Re(c,t);zn(c,e,n,u,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new qe(r,this._parents,e,n)}function Ud(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(i,s){var a={value:s},c={value:function(){--o===0&&i()}};n.each(function(){var u=Be(this,r),l=u.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),u.on=t}),o===0&&i()})}var qd=0;function qe(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function ns(){return++qd}var Ye=Jt.prototype;qe.prototype={constructor:qe,select:Ad,selectAll:Dd,selectChild:Ye.selectChild,selectChildren:Ye.selectChildren,filter:bd,merge:Sd,selection:kd,transition:Wd,call:Ye.call,nodes:Ye.nodes,node:Ye.node,size:Ye.size,empty:Ye.empty,each:Ye.each,on:Cd,attr:id,attrTween:ud,style:$d,styleTween:Od,text:Hd,textTween:Yd,remove:Nd,tween:Ju,delay:hd,duration:md,ease:xd,easeVarying:wd,end:Ud,[Symbol.iterator]:Ye[Symbol.iterator]};function Gd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Kd={time:null,delay:0,duration:250,ease:Gd};function Zd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Jd(e){var t,n;e instanceof qe?(t=e._id,e=e._name):(t=ns(),(n=Kd).time=zc(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,c,u=0;u<a;++u)(c=s[u])&&zn(c,e,t,u,s,n||Zd(c,t));return new qe(r,this._parents,e,t)}Jt.prototype.interrupt=Gu;Jt.prototype.transition=Jd;const fn=e=>()=>e;function Qd(e,{sourceEvent:t,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function We(e,t,n){this.k=e,this.x=t,this.y=n}We.prototype={constructor:We,scale:function(e){return e===1?this:new We(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new We(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var On=new We(1,0,0);rs.prototype=We.prototype;function rs(e){for(;!e.__zoom;)if(!(e=e.parentNode))return On;return e.__zoom}function ar(e){e.stopImmediatePropagation()}function $t(e){e.preventDefault(),e.stopImmediatePropagation()}function ef(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function tf(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Co(){return this.__zoom||On}function nf(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function rf(){return navigator.maxTouchPoints||"ontouchstart"in this}function of(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function os(){var e=ef,t=tf,n=of,r=nf,o=rf,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=vn,u=Br("start","zoom","end"),l,f,d,h=500,m=150,p=0,x=10;function w(S){S.property("__zoom",Co).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",O).filter(o).on("touchstart.zoom",R).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",P).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(S,I,A,D){var $=S.selection?S.selection():S;$.property("__zoom",Co),S!==$?_(S,I,A,D):$.interrupt().each(function(){C(this,arguments).event(D).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},w.scaleBy=function(S,I,A,D){w.scaleTo(S,function(){var $=this.__zoom.k,k=typeof I=="function"?I.apply(this,arguments):I;return $*k},A,D)},w.scaleTo=function(S,I,A,D){w.transform(S,function(){var $=t.apply(this,arguments),k=this.__zoom,L=A==null?v($):typeof A=="function"?A.apply(this,arguments):A,z=k.invert(L),F=typeof I=="function"?I.apply(this,arguments):I;return n(g(E(k,F),L,z),$,s)},A,D)},w.translateBy=function(S,I,A,D){w.transform(S,function(){return n(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof A=="function"?A.apply(this,arguments):A),t.apply(this,arguments),s)},null,D)},w.translateTo=function(S,I,A,D,$){w.transform(S,function(){var k=t.apply(this,arguments),L=this.__zoom,z=D==null?v(k):typeof D=="function"?D.apply(this,arguments):D;return n(On.translate(z[0],z[1]).scale(L.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof A=="function"?-A.apply(this,arguments):-A),k,s)},D,$)};function E(S,I){return I=Math.max(i[0],Math.min(i[1],I)),I===S.k?S:new We(I,S.x,S.y)}function g(S,I,A){var D=I[0]-A[0]*S.k,$=I[1]-A[1]*S.k;return D===S.x&&$===S.y?S:new We(S.k,D,$)}function v(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function _(S,I,A,D){S.on("start.zoom",function(){C(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(D).end()}).tween("zoom",function(){var $=this,k=arguments,L=C($,k).event(D),z=t.apply($,k),F=A==null?v(z):typeof A=="function"?A.apply($,k):A,V=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),B=$.__zoom,W=typeof I=="function"?I.apply($,k):I,X=c(B.invert(F).concat(V/B.k),W.invert(F).concat(V/W.k));return function(U){if(U===1)U=W;else{var H=X(U),q=V/H[2];U=new We(q,F[0]-H[0]*q,F[1]-H[1]*q)}L.zoom(null,U)}})}function C(S,I,A){return!A&&S.__zooming||new M(S,I)}function M(S,I){this.that=S,this.args=I,this.active=0,this.sourceEvent=null,this.extent=t.apply(S,I),this.taps=0}M.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,I){return this.mouse&&S!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var I=we(this.that).datum();u.call(S,this.that,new Qd(S,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:u}),I)}};function N(S,...I){if(!e.apply(this,arguments))return;var A=C(this,I).event(S),D=this.__zoom,$=Math.max(i[0],Math.min(i[1],D.k*Math.pow(2,r.apply(this,arguments)))),k=De(S);if(A.wheel)(A.mouse[0][0]!==k[0]||A.mouse[0][1]!==k[1])&&(A.mouse[1]=D.invert(A.mouse[0]=k)),clearTimeout(A.wheel);else{if(D.k===$)return;A.mouse=[k,D.invert(k)],Sn(this),A.start()}$t(S),A.wheel=setTimeout(L,m),A.zoom("mouse",n(g(E(D,$),A.mouse[0],A.mouse[1]),A.extent,s));function L(){A.wheel=null,A.end()}}function T(S,...I){if(d||!e.apply(this,arguments))return;var A=S.currentTarget,D=C(this,I,!0).event(S),$=we(S.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",V,!0),k=De(S,A),L=S.clientX,z=S.clientY;Ki(S.view),ar(S),D.mouse=[k,this.__zoom.invert(k)],Sn(this),D.start();function F(B){if($t(B),!D.moved){var W=B.clientX-L,X=B.clientY-z;D.moved=W*W+X*X>p}D.event(B).zoom("mouse",n(g(D.that.__zoom,D.mouse[0]=De(B,A),D.mouse[1]),D.extent,s))}function V(B){$.on("mousemove.zoom mouseup.zoom",null),Zi(B.view,D.moved),$t(B),D.event(B).end()}}function O(S,...I){if(e.apply(this,arguments)){var A=this.__zoom,D=De(S.changedTouches?S.changedTouches[0]:S,this),$=A.invert(D),k=A.k*(S.shiftKey?.5:2),L=n(g(E(A,k),D,$),t.apply(this,I),s);$t(S),a>0?we(this).transition().duration(a).call(_,L,D,S):we(this).call(w.transform,L,D,S)}}function R(S,...I){if(e.apply(this,arguments)){var A=S.touches,D=A.length,$=C(this,I,S.changedTouches.length===D).event(S),k,L,z,F;for(ar(S),L=0;L<D;++L)z=A[L],F=De(z,this),F=[F,this.__zoom.invert(F),z.identifier],$.touch0?!$.touch1&&$.touch0[2]!==F[2]&&($.touch1=F,$.taps=0):($.touch0=F,k=!0,$.taps=1+!!l);l&&(l=clearTimeout(l)),k&&($.taps<2&&(f=F[0],l=setTimeout(function(){l=null},h)),Sn(this),$.start())}}function j(S,...I){if(this.__zooming){var A=C(this,I).event(S),D=S.changedTouches,$=D.length,k,L,z,F;for($t(S),k=0;k<$;++k)L=D[k],z=De(L,this),A.touch0&&A.touch0[2]===L.identifier?A.touch0[0]=z:A.touch1&&A.touch1[2]===L.identifier&&(A.touch1[0]=z);if(L=A.that.__zoom,A.touch1){var V=A.touch0[0],B=A.touch0[1],W=A.touch1[0],X=A.touch1[1],U=(U=W[0]-V[0])*U+(U=W[1]-V[1])*U,H=(H=X[0]-B[0])*H+(H=X[1]-B[1])*H;L=E(L,Math.sqrt(U/H)),z=[(V[0]+W[0])/2,(V[1]+W[1])/2],F=[(B[0]+X[0])/2,(B[1]+X[1])/2]}else if(A.touch0)z=A.touch0[0],F=A.touch0[1];else return;A.zoom("touch",n(g(L,z,F),A.extent,s))}}function P(S,...I){if(this.__zooming){var A=C(this,I).event(S),D=S.changedTouches,$=D.length,k,L;for(ar(S),d&&clearTimeout(d),d=setTimeout(function(){d=null},h),k=0;k<$;++k)L=D[k],A.touch0&&A.touch0[2]===L.identifier?delete A.touch0:A.touch1&&A.touch1[2]===L.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(L=De(L,this),Math.hypot(f[0]-L[0],f[1]-L[1])<x)){var z=we(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return w.wheelDelta=function(S){return arguments.length?(r=typeof S=="function"?S:fn(+S),w):r},w.filter=function(S){return arguments.length?(e=typeof S=="function"?S:fn(!!S),w):e},w.touchable=function(S){return arguments.length?(o=typeof S=="function"?S:fn(!!S),w):o},w.extent=function(S){return arguments.length?(t=typeof S=="function"?S:fn([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),w):t},w.scaleExtent=function(S){return arguments.length?(i[0]=+S[0],i[1]=+S[1],w):[i[0],i[1]]},w.translateExtent=function(S){return arguments.length?(s[0][0]=+S[0][0],s[1][0]=+S[1][0],s[0][1]=+S[0][1],s[1][1]=+S[1][1],w):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},w.constrain=function(S){return arguments.length?(n=S,w):n},w.duration=function(S){return arguments.length?(a=+S,w):a},w.interpolate=function(S){return arguments.length?(c=S,w):c},w.on=function(){var S=u.on.apply(u,arguments);return S===u?w:S},w.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,w):Math.sqrt(p)},w.tapDistance=function(S){return arguments.length?(x=+S,w):x},w}const Oe={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Xt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],is=["Enter"," ","Escape"],ss={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Mt;(function(e){e.Strict="strict",e.Loose="loose"})(Mt||(Mt={}));var ft;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(ft||(ft={}));var Yt;(function(e){e.Partial="partial",e.Full="full"})(Yt||(Yt={}));const as={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var rt;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(rt||(rt={}));var Nn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Nn||(Nn={}));var K;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(K||(K={}));const Mo={[K.Left]:K.Right,[K.Right]:K.Left,[K.Top]:K.Bottom,[K.Bottom]:K.Top};function cs(e){return e===null?null:e?"valid":"invalid"}const ls=e=>"id"in e&&"source"in e&&"target"in e,sf=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Wr=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Qt=(e,t=[0,0])=>{const{width:n,height:r}=Ge(e),o=e.origin??t,i=n*o[0],s=r*o[1];return{x:e.position.x-i,y:e.position.y-s}},af=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,o)=>{const i=typeof o=="string";let s=!t.nodeLookup&&!i?o:void 0;t.nodeLookup&&(s=i?t.nodeLookup.get(o):Wr(o)?o:t.nodeLookup.get(o.id));const a=s?An(s,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Fn(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Bn(n)},en=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(r=>{if(t.filter===void 0||t.filter(r)){const o=An(r);n=Fn(n,o)}}),Bn(n)},Ur=(e,t,[n,r,o]=[0,0,1],i=!1,s=!1)=>{const a={...tn(t,[n,r,o]),width:t.width/o,height:t.height/o},c=[];for(const u of e.values()){const{measured:l,selectable:f=!0,hidden:d=!1}=u;if(s&&!f||d)continue;const h=l.width??u.width??u.initialWidth??null,m=l.height??u.height??u.initialHeight??null,p=Wt(a,At(u)),x=(h??0)*(m??0),w=i&&p>0;(!u.internals.handleBounds||w||p>=x||u.dragging)&&c.push(u)}return c},cf=(e,t)=>{const n=new Set;return e.forEach(r=>{n.add(r.id)}),t.filter(r=>n.has(r.source)||n.has(r.target))};function lf(e,t){const n=new Map,r=t!=null&&t.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!o.hidden)&&(!r||r.has(o.id))&&n.set(o.id,o)}),n}async function uf({nodes:e,width:t,height:n,panZoom:r,minZoom:o,maxZoom:i},s){if(e.size===0)return Promise.resolve(!0);const a=lf(e,s),c=en(a),u=qr(c,t,n,(s==null?void 0:s.minZoom)??o,(s==null?void 0:s.maxZoom)??i,(s==null?void 0:s.padding)??.1);return await r.setViewport(u,{duration:s==null?void 0:s.duration,ease:s==null?void 0:s.ease,interpolate:s==null?void 0:s.interpolate}),Promise.resolve(!0)}function us({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:o,onError:i}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},l=s.origin??r;let f=s.extent||o;if(s.extent==="parent"&&!s.expandParent)if(!a)i==null||i("005",Oe.error005());else{const h=a.measured.width,m=a.measured.height;h&&m&&(f=[[c,u],[c+h,u+m]])}else a&&Dt(s.extent)&&(f=[[s.extent[0][0]+c,s.extent[0][1]+u],[s.extent[1][0]+c,s.extent[1][1]+u]]);const d=Dt(f)?gt(t,f,s.measured):t;return(s.measured.width===void 0||s.measured.height===void 0)&&(i==null||i("015",Oe.error015())),{position:{x:d.x-c+(s.measured.width??0)*l[0],y:d.y-u+(s.measured.height??0)*l[1]},positionAbsolute:d}}async function df({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:r,onBeforeDelete:o}){const i=new Set(e.map(d=>d.id)),s=[];for(const d of n){if(d.deletable===!1)continue;const h=i.has(d.id),m=!h&&d.parentId&&s.find(p=>p.id===d.parentId);(h||m)&&s.push(d)}const a=new Set(t.map(d=>d.id)),c=r.filter(d=>d.deletable!==!1),l=cf(s,c);for(const d of c)a.has(d.id)&&!l.find(m=>m.id===d.id)&&l.push(d);if(!o)return{edges:l,nodes:s};const f=await o({nodes:s,edges:l});return typeof f=="boolean"?f?{edges:l,nodes:s}:{edges:[],nodes:[]}:f}const Nt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),gt=(e={x:0,y:0},t,n)=>({x:Nt(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Nt(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function ds(e,t,n){const{width:r,height:o}=Ge(n),{x:i,y:s}=n.internals.positionAbsolute;return gt(e,[[i,s],[i+r,s+o]],t)}const No=(e,t,n)=>e<t?Nt(Math.abs(e-t),1,t)/t:e>n?-Nt(Math.abs(e-n),1,t)/t:0,fs=(e,t,n=15,r=40)=>{const o=No(e.x,r,t.width-r)*n,i=No(e.y,r,t.height-r)*n;return[o,i]},Fn=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Ar=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),Bn=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),At=(e,t=[0,0])=>{var o,i;const{x:n,y:r}=Wr(e)?e.internals.positionAbsolute:Qt(e,t);return{x:n,y:r,width:((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},An=(e,t=[0,0])=>{var o,i;const{x:n,y:r}=Wr(e)?e.internals.positionAbsolute:Qt(e,t);return{x:n,y:r,x2:n+(((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0),y2:r+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},hs=(e,t)=>Bn(Fn(Ar(e),Ar(t))),Wt=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},Ao=e=>Ie(e.width)&&Ie(e.height)&&Ie(e.x)&&Ie(e.y),Ie=e=>!isNaN(e)&&isFinite(e),ff=(e,t)=>{},Hn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),tn=({x:e,y:t},[n,r,o],i=!1,s=[1,1])=>{const a={x:(e-n)/o,y:(t-r)/o};return i?Hn(a,s):a},Dn=({x:e,y:t},[n,r,o])=>({x:e*o+n,y:t*o+r});function vt(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function hf(e,t,n){if(typeof e=="string"||typeof e=="number"){const r=vt(e,n),o=vt(e,t);return{top:r,right:o,bottom:r,left:o,x:o*2,y:r*2}}if(typeof e=="object"){const r=vt(e.top??e.y??0,n),o=vt(e.bottom??e.y??0,n),i=vt(e.left??e.x??0,t),s=vt(e.right??e.x??0,t);return{top:r,right:s,bottom:o,left:i,x:i+s,y:r+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function gf(e,t,n,r,o,i){const{x:s,y:a}=Dn(e,[t,n,r]),{x:c,y:u}=Dn({x:e.x+e.width,y:e.y+e.height},[t,n,r]),l=o-c,f=i-u;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(l),bottom:Math.floor(f)}}const qr=(e,t,n,r,o,i)=>{const s=hf(i,t,n),a=(t-s.x)/e.width,c=(n-s.y)/e.height,u=Math.min(a,c),l=Nt(u,r,o),f=e.x+e.width/2,d=e.y+e.height/2,h=t/2-f*l,m=n/2-d*l,p=gf(e,h,m,l,t,n),x={left:Math.min(p.left-s.left,0),top:Math.min(p.top-s.top,0),right:Math.min(p.right-s.right,0),bottom:Math.min(p.bottom-s.bottom,0)};return{x:h-x.left+x.right,y:m-x.top+x.bottom,zoom:l}},In=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Dt(e){return e!==void 0&&e!=="parent"}function Ge(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function gs(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function ps(e,t={width:0,height:0},n,r,o){const i={...e},s=r.get(n);if(s){const a=s.origin||o;i.x+=s.internals.positionAbsolute.x-(t.width??0)*a[0],i.y+=s.internals.positionAbsolute.y-(t.height??0)*a[1]}return i}function Do(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function pf(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function mf(e){return{...ss,...e||{}}}function Ot(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:r,containerBounds:o}){const{x:i,y:s}=ze(e),a=tn({x:i-((o==null?void 0:o.left)??0),y:s-((o==null?void 0:o.top)??0)},r),{x:c,y:u}=n?Hn(a,t):a;return{xSnapped:c,ySnapped:u,...a}}const Gr=e=>({width:e.offsetWidth,height:e.offsetHeight}),ms=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},yf=["INPUT","SELECT","TEXTAREA"];function ys(e){var r,o;const t=((o=(r=e.composedPath)==null?void 0:r.call(e))==null?void 0:o[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:yf.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const xs=e=>"clientX"in e,ze=(e,t)=>{var i,s;const n=xs(e),r=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,o=n?e.clientY:(s=e.touches)==null?void 0:s[0].clientY;return{x:r-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},Io=(e,t,n,r,o)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:e,nodeId:o,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...Gr(s)}})};function vs({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:o,sourceControlY:i,targetControlX:s,targetControlY:a}){const c=e*.125+o*.375+s*.375+n*.125,u=t*.125+i*.375+a*.375+r*.125,l=Math.abs(c-e),f=Math.abs(u-t);return[c,u,l,f]}function hn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function ko({pos:e,x1:t,y1:n,x2:r,y2:o,c:i}){switch(e){case K.Left:return[t-hn(t-r,i),n];case K.Right:return[t+hn(r-t,i),n];case K.Top:return[t,n-hn(n-o,i)];case K.Bottom:return[t,n+hn(o-n,i)]}}function ws({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top,curvature:s=.25}){const[a,c]=ko({pos:n,x1:e,y1:t,x2:r,y2:o,c:s}),[u,l]=ko({pos:i,x1:r,y1:o,x2:e,y2:t,c:s}),[f,d,h,m]=vs({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:a,sourceControlY:c,targetControlX:u,targetControlY:l});return[`M${e},${t} C${a},${c} ${u},${l} ${r},${o}`,f,d,h,m]}function bs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const o=Math.abs(n-e)/2,i=n<e?n+o:n-o,s=Math.abs(r-t)/2,a=r<t?r+s:r-s;return[i,a,o,s]}function xf({sourceNode:e,targetNode:t,selected:n=!1,zIndex:r,elevateOnSelect:o=!1}){if(r!==void 0)return r;const i=o&&n?1e3:0,s=Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0);return i+s}function vf({sourceNode:e,targetNode:t,width:n,height:r,transform:o}){const i=Fn(An(e),An(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const s={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:r/o[2]};return Wt(s,Bn(i))>0}const wf=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`xy-edge__${e}${t||""}-${n}${r||""}`,bf=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Ss=(e,t)=>{if(!e.source||!e.target)return t;let n;return ls(e)?n={...e}:n={...e,id:wf(e)},bf(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function _s({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[o,i,s,a]=bs({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,o,i,s,a]}const Ro={[K.Left]:{x:-1,y:0},[K.Right]:{x:1,y:0},[K.Top]:{x:0,y:-1},[K.Bottom]:{x:0,y:1}},Sf=({source:e,sourcePosition:t=K.Bottom,target:n})=>t===K.Left||t===K.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},To=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function _f({source:e,sourcePosition:t=K.Bottom,target:n,targetPosition:r=K.Top,center:o,offset:i,stepPosition:s}){const a=Ro[t],c=Ro[r],u={x:e.x+a.x*i,y:e.y+a.y*i},l={x:n.x+c.x*i,y:n.y+c.y*i},f=Sf({source:u,sourcePosition:t,target:l}),d=f.x!==0?"x":"y",h=f[d];let m=[],p,x;const w={x:0,y:0},E={x:0,y:0},[,,g,v]=bs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[d]*c[d]===-1){d==="x"?(p=o.x??u.x+(l.x-u.x)*s,x=o.y??(u.y+l.y)/2):(p=o.x??(u.x+l.x)/2,x=o.y??u.y+(l.y-u.y)*s);const C=[{x:p,y:u.y},{x:p,y:l.y}],M=[{x:u.x,y:x},{x:l.x,y:x}];a[d]===h?m=d==="x"?C:M:m=d==="x"?M:C}else{const C=[{x:u.x,y:l.y}],M=[{x:l.x,y:u.y}];if(d==="x"?m=a.x===h?M:C:m=a.y===h?C:M,t===r){const j=Math.abs(e[d]-n[d]);if(j<=i){const P=Math.min(i-1,i-j);a[d]===h?w[d]=(u[d]>e[d]?-1:1)*P:E[d]=(l[d]>n[d]?-1:1)*P}}if(t!==r){const j=d==="x"?"y":"x",P=a[d]===c[j],S=u[j]>l[j],I=u[j]<l[j];(a[d]===1&&(!P&&S||P&&I)||a[d]!==1&&(!P&&I||P&&S))&&(m=d==="x"?C:M)}const N={x:u.x+w.x,y:u.y+w.y},T={x:l.x+E.x,y:l.y+E.y},O=Math.max(Math.abs(N.x-m[0].x),Math.abs(T.x-m[0].x)),R=Math.max(Math.abs(N.y-m[0].y),Math.abs(T.y-m[0].y));O>=R?(p=(N.x+T.x)/2,x=m[0].y):(p=m[0].x,x=(N.y+T.y)/2)}return[[e,{x:u.x+w.x,y:u.y+w.y},...m,{x:l.x+E.x,y:l.y+E.y},n],p,x,g,v]}function Ef(e,t,n,r){const o=Math.min(To(e,t)/2,To(t,n)/2,r),{x:i,y:s}=t;if(e.x===i&&i===n.x||e.y===s&&s===n.y)return`L${i} ${s}`;if(e.y===s){const u=e.x<n.x?-1:1,l=e.y<n.y?1:-1;return`L ${i+o*u},${s}Q ${i},${s} ${i},${s+o*l}`}const a=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${i},${s+o*c}Q ${i},${s} ${i+o*a},${s}`}function Dr({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top,borderRadius:s=5,centerX:a,centerY:c,offset:u=20,stepPosition:l=.5}){const[f,d,h,m,p]=_f({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:o},targetPosition:i,center:{x:a,y:c},offset:u,stepPosition:l});return[f.reduce((w,E,g)=>{let v="";return g>0&&g<f.length-1?v=Ef(f[g-1],E,f[g+1],s):v=`${g===0?"M":"L"}${E.x} ${E.y}`,w+=v,w},""),d,h,m,p]}function Po(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Cf(e){var f;const{sourceNode:t,targetNode:n}=e;if(!Po(t)||!Po(n))return null;const r=t.internals.handleBounds||jo(t.handles),o=n.internals.handleBounds||jo(n.handles),i=$o((r==null?void 0:r.source)??[],e.sourceHandle),s=$o(e.connectionMode===Mt.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),e.targetHandle);if(!i||!s)return(f=e.onError)==null||f.call(e,"008",Oe.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(i==null?void 0:i.position)||K.Bottom,c=(s==null?void 0:s.position)||K.Top,u=Ut(t,i,a),l=Ut(n,s,c);return{sourceX:u.x,sourceY:u.y,targetX:l.x,targetY:l.y,sourcePosition:a,targetPosition:c}}function jo(e){if(!e)return null;const t=[],n=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&n.push(r);return{source:t,target:n}}function Ut(e,t,n=K.Left,r=!1){const o=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??Ge(e);if(r)return{x:o+s/2,y:i+a/2};switch((t==null?void 0:t.position)??n){case K.Top:return{x:o+s/2,y:i};case K.Right:return{x:o+s,y:i+a/2};case K.Bottom:return{x:o+s/2,y:i+a};case K.Left:return{x:o,y:i+a/2}}}function $o(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Ir(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`:""}function Mf(e,{id:t,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:o}){const i=new Set;return e.reduce((s,a)=>([a.markerStart||r,a.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const u=Ir(c,t);i.has(u)||(s.push({id:u,color:c.color||n,...c}),i.add(u))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Kr={nodeOrigin:[0,0],nodeExtent:Xt,elevateNodesOnSelect:!0,defaults:{}},Nf={...Kr,checkEquality:!0};function Zr(e,t){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}function Af(e,t,n){const r=Zr(Kr,n);for(const o of e.values())if(o.parentId)Jr(o,e,t,r);else{const i=Qt(o,r.nodeOrigin),s=Dt(o.extent)?o.extent:r.nodeExtent,a=gt(i,s,Ge(o));o.internals.positionAbsolute=a}}function kr(e,t,n,r){var c,u;const o=Zr(Nf,r);let i=e.length>0;const s=new Map(t),a=o!=null&&o.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let f=s.get(l.id);if(o.checkEquality&&l===(f==null?void 0:f.internals.userNode))t.set(l.id,f);else{const d=Qt(l,o.nodeOrigin),h=Dt(l.extent)?l.extent:o.nodeExtent,m=gt(d,h,Ge(l));f={...o.defaults,...l,measured:{width:(c=l.measured)==null?void 0:c.width,height:(u=l.measured)==null?void 0:u.height},internals:{positionAbsolute:m,handleBounds:l.measured?f==null?void 0:f.internals.handleBounds:void 0,z:Es(l,a),userNode:l}},t.set(l.id,f)}(f.measured===void 0||f.measured.width===void 0||f.measured.height===void 0)&&!f.hidden&&(i=!1),l.parentId&&Jr(f,t,n,r)}return i}function Df(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Jr(e,t,n,r){const{elevateNodesOnSelect:o,nodeOrigin:i,nodeExtent:s}=Zr(Kr,r),a=e.parentId,c=t.get(a);if(!c){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Df(e,n);const u=o?1e3:0,{x:l,y:f,z:d}=If(e,c,i,s,u),{positionAbsolute:h}=e.internals,m=l!==h.x||f!==h.y;(m||d!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:m?{x:l,y:f}:h,z:d}})}function Es(e,t){return(Ie(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function If(e,t,n,r,o){const{x:i,y:s}=t.internals.positionAbsolute,a=Ge(e),c=Qt(e,n),u=Dt(e.extent)?gt(c,e.extent,a):c;let l=gt({x:i+u.x,y:s+u.y},r,a);e.extent==="parent"&&(l=ds(l,a,t));const f=Es(e,o),d=t.internals.z??0;return{x:l.x,y:l.y,z:d>=f?d+1:f}}function Qr(e,t,n,r=[0,0]){var s;const o=[],i=new Map;for(const a of e){const c=t.get(a.parentId);if(!c)continue;const u=((s=i.get(a.parentId))==null?void 0:s.expandedRect)??At(c),l=hs(u,a.rect);i.set(a.parentId,{expandedRect:l,parent:c})}return i.size>0&&i.forEach(({expandedRect:a,parent:c},u)=>{var g;const l=c.internals.positionAbsolute,f=Ge(c),d=c.origin??r,h=a.x<l.x?Math.round(Math.abs(l.x-a.x)):0,m=a.y<l.y?Math.round(Math.abs(l.y-a.y)):0,p=Math.max(f.width,Math.round(a.width)),x=Math.max(f.height,Math.round(a.height)),w=(p-f.width)*d[0],E=(x-f.height)*d[1];(h>0||m>0||w||E)&&(o.push({id:u,type:"position",position:{x:c.position.x-h+w,y:c.position.y-m+E}}),(g=n.get(u))==null||g.forEach(v=>{e.some(_=>_.id===v.id)||o.push({id:v.id,type:"position",position:{x:v.position.x+h,y:v.position.y+m}})})),(f.width<a.width||f.height<a.height||h||m)&&o.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:p+(h?d[0]*h-w:0),height:x+(m?d[1]*m-E:0)}})}),o}function kf(e,t,n,r,o,i){const s=r==null?void 0:r.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const c=[],u=window.getComputedStyle(s),{m22:l}=new window.DOMMatrixReadOnly(u.transform),f=[];for(const d of e.values()){const h=t.get(d.id);if(!h)continue;if(h.hidden){t.set(h.id,{...h,internals:{...h.internals,handleBounds:void 0}}),a=!0;continue}const m=Gr(d.nodeElement),p=h.measured.width!==m.width||h.measured.height!==m.height;if(!!(m.width&&m.height&&(p||!h.internals.handleBounds||d.force))){const w=d.nodeElement.getBoundingClientRect(),E=Dt(h.extent)?h.extent:i;let{positionAbsolute:g}=h.internals;h.parentId&&h.extent==="parent"?g=ds(g,m,t.get(h.parentId)):E&&(g=gt(g,E,m));const v={...h,measured:m,internals:{...h.internals,positionAbsolute:g,handleBounds:{source:Io("source",d.nodeElement,w,l,h.id),target:Io("target",d.nodeElement,w,l,h.id)}}};t.set(h.id,v),h.parentId&&Jr(v,t,n,{nodeOrigin:o}),a=!0,p&&(c.push({id:h.id,type:"dimensions",dimensions:m}),h.expandParent&&h.parentId&&f.push({id:h.id,parentId:h.parentId,rect:At(v,o)}))}}if(f.length>0){const d=Qr(f,t,n,o);c.push(...d)}return{changes:c,updatedInternals:a}}async function Rf({delta:e,panZoom:t,transform:n,translateExtent:r,width:o,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[o,i]],r),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function Lo(e,t,n,r,o,i){let s=o;const a=r.get(s)||new Map;r.set(s,a.set(n,t)),s=`${o}-${e}`;const c=r.get(s)||new Map;if(r.set(s,c.set(n,t)),i){s=`${o}-${e}-${i}`;const u=r.get(s)||new Map;r.set(s,u.set(n,t))}}function Cs(e,t,n){e.clear(),t.clear();for(const r of n){const{source:o,target:i,sourceHandle:s=null,targetHandle:a=null}=r,c={edgeId:r.id,source:o,target:i,sourceHandle:s,targetHandle:a},u=`${o}-${s}--${i}-${a}`,l=`${i}-${a}--${o}-${s}`;Lo("source",c,l,e,o,s),Lo("target",c,u,e,i,a),t.set(r.id,r)}}function Ms(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Ms(n,t):!1}function zo(e,t,n){var o;let r=e;do{if((o=r==null?void 0:r.matches)!=null&&o.call(r,t))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function Tf(e,t,n,r){const o=new Map;for(const[i,s]of e)if((s.selected||s.id===r)&&(!s.parentId||!Ms(s,e))&&(s.draggable||t&&typeof s.draggable>"u")){const a=e.get(i);a&&o.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return o}function cr({nodeId:e,dragItems:t,nodeLookup:n,dragging:r=!0}){var s,a,c;const o=[];for(const[u,l]of t){const f=(s=n.get(u))==null?void 0:s.internals.userNode;f&&o.push({...f,position:l.position,dragging:r})}if(!e)return[o[0],o];const i=(a=n.get(e))==null?void 0:a.internals.userNode;return[i?{...i,position:((c=t.get(e))==null?void 0:c.position)||i.position,dragging:r}:o[0],o]}function Pf({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:r,onDragStop:o}){let i={x:null,y:null},s=0,a=new Map,c=!1,u={x:0,y:0},l=null,f=!1,d=null,h=!1,m=!1;function p({noDragClassName:w,handleSelector:E,domNode:g,isSelectable:v,nodeId:_,nodeClickDistance:C=0}){d=we(g);function M({x:R,y:j},P){const{nodeLookup:S,nodeExtent:I,snapGrid:A,snapToGrid:D,nodeOrigin:$,onNodeDrag:k,onSelectionDrag:L,onError:z,updateNodePositions:F}=t();i={x:R,y:j};let V=!1,B={x:0,y:0,x2:0,y2:0};if(a.size>1&&I){const W=en(a);B=Ar(W)}for(const[W,X]of a){if(!S.has(W))continue;let U={x:R-X.distance.x,y:j-X.distance.y};D&&(U=Hn(U,A));let H=[[I[0][0],I[0][1]],[I[1][0],I[1][1]]];if(a.size>1&&I&&!X.extent){const{positionAbsolute:Q}=X.internals,G=Q.x-B.x+I[0][0],J=Q.x+X.measured.width-B.x2+I[1][0],Z=Q.y-B.y+I[0][1],te=Q.y+X.measured.height-B.y2+I[1][1];H=[[G,Z],[J,te]]}const{position:q,positionAbsolute:Y}=us({nodeId:W,nextPosition:U,nodeLookup:S,nodeExtent:H,nodeOrigin:$,onError:z});V=V||X.position.x!==q.x||X.position.y!==q.y,X.position=q,X.internals.positionAbsolute=Y}if(m=m||V,!!V&&(F(a,!0),P&&(r||k||!_&&L))){const[W,X]=cr({nodeId:_,dragItems:a,nodeLookup:S});r==null||r(P,a,W,X),k==null||k(P,W,X),_||L==null||L(P,X)}}async function N(){if(!l)return;const{transform:R,panBy:j,autoPanSpeed:P,autoPanOnNodeDrag:S}=t();if(!S){c=!1,cancelAnimationFrame(s);return}const[I,A]=fs(u,l,P);(I!==0||A!==0)&&(i.x=(i.x??0)-I/R[2],i.y=(i.y??0)-A/R[2],await j({x:I,y:A})&&M(i,null)),s=requestAnimationFrame(N)}function T(R){var V;const{nodeLookup:j,multiSelectionActive:P,nodesDraggable:S,transform:I,snapGrid:A,snapToGrid:D,selectNodesOnDrag:$,onNodeDragStart:k,onSelectionDragStart:L,unselectNodesAndEdges:z}=t();f=!0,(!$||!v)&&!P&&_&&((V=j.get(_))!=null&&V.selected||z()),v&&$&&_&&(e==null||e(_));const F=Ot(R.sourceEvent,{transform:I,snapGrid:A,snapToGrid:D,containerBounds:l});if(i=F,a=Tf(j,S,F,_),a.size>0&&(n||k||!_&&L)){const[B,W]=cr({nodeId:_,dragItems:a,nodeLookup:j});n==null||n(R.sourceEvent,a,B,W),k==null||k(R.sourceEvent,B,W),_||L==null||L(R.sourceEvent,W)}}const O=Ji().clickDistance(C).on("start",R=>{const{domNode:j,nodeDragThreshold:P,transform:S,snapGrid:I,snapToGrid:A}=t();l=(j==null?void 0:j.getBoundingClientRect())||null,h=!1,m=!1,P===0&&T(R),i=Ot(R.sourceEvent,{transform:S,snapGrid:I,snapToGrid:A,containerBounds:l}),u=ze(R.sourceEvent,l)}).on("drag",R=>{const{autoPanOnNodeDrag:j,transform:P,snapGrid:S,snapToGrid:I,nodeDragThreshold:A,nodeLookup:D}=t(),$=Ot(R.sourceEvent,{transform:P,snapGrid:S,snapToGrid:I,containerBounds:l});if((R.sourceEvent.type==="touchmove"&&R.sourceEvent.touches.length>1||_&&!D.has(_))&&(h=!0),!h){if(!c&&j&&f&&(c=!0,N()),!f){const k=$.xSnapped-(i.x??0),L=$.ySnapped-(i.y??0);Math.sqrt(k*k+L*L)>A&&T(R)}(i.x!==$.xSnapped||i.y!==$.ySnapped)&&a&&f&&(u=ze(R.sourceEvent,l),M($,R.sourceEvent))}}).on("end",R=>{if(!(!f||h)&&(c=!1,f=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:j,updateNodePositions:P,onNodeDragStop:S,onSelectionDragStop:I}=t();if(m&&(P(a,!1),m=!1),o||S||!_&&I){const[A,D]=cr({nodeId:_,dragItems:a,nodeLookup:j,dragging:!1});o==null||o(R.sourceEvent,a,A,D),S==null||S(R.sourceEvent,A,D),_||I==null||I(R.sourceEvent,D)}}}).filter(R=>{const j=R.target;return!R.button&&(!w||!zo(j,`.${w}`,g))&&(!E||zo(j,E,g))});d.call(O)}function x(){d==null||d.on(".drag",null)}return{update:p,destroy:x}}function jf(e,t,n){const r=[],o={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())Wt(o,At(i))>0&&r.push(i);return r}const $f=250;function Lf(e,t,n,r){var a,c;let o=[],i=1/0;const s=jf(e,n,t+$f);for(const u of s){const l=[...((a=u.internals.handleBounds)==null?void 0:a.source)??[],...((c=u.internals.handleBounds)==null?void 0:c.target)??[]];for(const f of l){if(r.nodeId===f.nodeId&&r.type===f.type&&r.id===f.id)continue;const{x:d,y:h}=Ut(u,f,f.position,!0),m=Math.sqrt(Math.pow(d-e.x,2)+Math.pow(h-e.y,2));m>t||(m<i?(o=[{...f,x:d,y:h}],i=m):m===i&&o.push({...f,x:d,y:h}))}}if(!o.length)return null;if(o.length>1){const u=r.type==="source"?"target":"source";return o.find(l=>l.type===u)??o[0]}return o[0]}function Ns(e,t,n,r,o,i=!1){var u,l,f;const s=r.get(e);if(!s)return null;const a=o==="strict"?(u=s.internals.handleBounds)==null?void 0:u[t]:[...((l=s.internals.handleBounds)==null?void 0:l.source)??[],...((f=s.internals.handleBounds)==null?void 0:f.target)??[]],c=(n?a==null?void 0:a.find(d=>d.id===n):a==null?void 0:a[0])??null;return c&&i?{...c,...Ut(s,c,c.position,!0)}:c}function As(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function zf(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Ds=()=>!0;function Of(e,{connectionMode:t,connectionRadius:n,handleId:r,nodeId:o,edgeUpdaterType:i,isTarget:s,domNode:a,nodeLookup:c,lib:u,autoPanOnConnect:l,flowId:f,panBy:d,cancelConnection:h,onConnectStart:m,onConnect:p,onConnectEnd:x,isValidConnection:w=Ds,onReconnectEnd:E,updateConnection:g,getTransform:v,getFromHandle:_,autoPanSpeed:C,dragThreshold:M=1}){const N=ms(e.target);let T=0,O;const{x:R,y:j}=ze(e),P=N==null?void 0:N.elementFromPoint(R,j),S=As(i,P),I=a==null?void 0:a.getBoundingClientRect();let A=!1;if(!I||!S)return;const D=Ns(o,S,r,c,t);if(!D)return;let $=ze(e,I),k=!1,L=null,z=!1,F=null;function V(){if(!l||!I)return;const[Q,G]=fs($,I,C);d({x:Q,y:G}),T=requestAnimationFrame(V)}const B={...D,nodeId:o,type:S,position:D.position},W=c.get(o);let U={inProgress:!0,isValid:null,from:Ut(W,B,K.Left,!0),fromHandle:B,fromPosition:B.position,fromNode:W,to:$,toHandle:null,toPosition:Mo[B.position],toNode:null};function H(){A=!0,g(U),m==null||m(e,{nodeId:o,handleId:r,handleType:S})}M===0&&H();function q(Q){if(!A){const{x:te,y:re}=ze(Q),Se=te-R,He=re-j;if(!(Se*Se+He*He>M*M))return;H()}if(!_()||!B){Y(Q);return}const G=v();$=ze(Q,I),O=Lf(tn($,G,!1,[1,1]),n,c,B),k||(V(),k=!0);const J=Is(Q,{handle:O,connectionMode:t,fromNodeId:o,fromHandleId:r,fromType:s?"target":"source",isValidConnection:w,doc:N,lib:u,flowId:f,nodeLookup:c});F=J.handleDomNode,L=J.connection,z=zf(!!O,J.isValid);const Z={...U,isValid:z,to:J.toHandle&&z?Dn({x:J.toHandle.x,y:J.toHandle.y},G):$,toHandle:J.toHandle,toPosition:z&&J.toHandle?J.toHandle.position:Mo[B.position],toNode:J.toHandle?c.get(J.toHandle.nodeId):null};z&&O&&U.toHandle&&Z.toHandle&&U.toHandle.type===Z.toHandle.type&&U.toHandle.nodeId===Z.toHandle.nodeId&&U.toHandle.id===Z.toHandle.id&&U.to.x===Z.to.x&&U.to.y===Z.to.y||(g(Z),U=Z)}function Y(Q){if(A){(O||F)&&L&&z&&(p==null||p(L));const{inProgress:G,...J}=U,Z={...J,toPosition:U.toHandle?U.toPosition:null};x==null||x(Q,Z),i&&(E==null||E(Q,Z))}h(),cancelAnimationFrame(T),k=!1,z=!1,L=null,F=null,N.removeEventListener("mousemove",q),N.removeEventListener("mouseup",Y),N.removeEventListener("touchmove",q),N.removeEventListener("touchend",Y)}N.addEventListener("mousemove",q),N.addEventListener("mouseup",Y),N.addEventListener("touchmove",q),N.addEventListener("touchend",Y)}function Is(e,{handle:t,connectionMode:n,fromNodeId:r,fromHandleId:o,fromType:i,doc:s,lib:a,flowId:c,isValidConnection:u=Ds,nodeLookup:l}){const f=i==="target",d=t?s.querySelector(`.${a}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:h,y:m}=ze(e),p=s.elementFromPoint(h,m),x=p!=null&&p.classList.contains(`${a}-flow__handle`)?p:d,w={handleDomNode:x,isValid:!1,connection:null,toHandle:null};if(x){const E=As(void 0,x),g=x.getAttribute("data-nodeid"),v=x.getAttribute("data-handleid"),_=x.classList.contains("connectable"),C=x.classList.contains("connectableend");if(!g||!E)return w;const M={source:f?g:r,sourceHandle:f?v:o,target:f?r:g,targetHandle:f?o:v};w.connection=M;const T=_&&C&&(n===Mt.Strict?f&&E==="source"||!f&&E==="target":g!==r||v!==o);w.isValid=T&&u(M),w.toHandle=Ns(g,E,v,l,n,!0)}return w}const Rr={onPointerDown:Of,isValid:Is};function Ff({domNode:e,panZoom:t,getTransform:n,getViewScale:r}){const o=we(e);function i({translateExtent:a,width:c,height:u,zoomStep:l=10,pannable:f=!0,zoomable:d=!0,inversePan:h=!1}){const m=g=>{const v=n();if(g.sourceEvent.type!=="wheel"||!t)return;const _=-g.sourceEvent.deltaY*(g.sourceEvent.deltaMode===1?.05:g.sourceEvent.deltaMode?1:.002)*l,C=v[2]*Math.pow(2,_);t.scaleTo(C)};let p=[0,0];const x=g=>{(g.sourceEvent.type==="mousedown"||g.sourceEvent.type==="touchstart")&&(p=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY])},w=g=>{const v=n();if(g.sourceEvent.type!=="mousemove"&&g.sourceEvent.type!=="touchmove"||!t)return;const _=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY],C=[_[0]-p[0],_[1]-p[1]];p=_;const M=r()*Math.max(v[2],Math.log(v[2]))*(h?-1:1),N={x:v[0]-C[0]*M,y:v[1]-C[1]*M},T=[[0,0],[c,u]];t.setViewportConstrained({x:N.x,y:N.y,zoom:v[2]},T,a)},E=os().on("start",x).on("zoom",f?w:null).on("zoom.wheel",d?m:null);o.call(E,{})}function s(){o.on("zoom",null)}return{update:i,destroy:s,pointer:De}}const Bf=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,Vn=e=>({x:e.x,y:e.y,zoom:e.k}),lr=({x:e,y:t,zoom:n})=>On.translate(e,t).scale(n),wt=(e,t)=>e.target.closest(`.${t}`),ks=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Hf=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,ur=(e,t=0,n=Hf,r=()=>{})=>{const o=typeof t=="number"&&t>0;return o||r(),o?e.transition().duration(t).ease(n).on("end",r):e},Rs=e=>{const t=e.ctrlKey&&In()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Vf({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:i,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:u}){return l=>{if(wt(l,t))return!1;l.preventDefault(),l.stopImmediatePropagation();const f=n.property("__zoom").k||1;if(l.ctrlKey&&s){const x=De(l),w=Rs(l),E=f*Math.pow(2,w);r.scaleTo(n,E,x,l);return}const d=l.deltaMode===1?20:1;let h=o===ft.Vertical?0:l.deltaX*d,m=o===ft.Horizontal?0:l.deltaY*d;!In()&&l.shiftKey&&o!==ft.Vertical&&(h=l.deltaY*d,m=0),r.translateBy(n,-(h/f)*i,-(m/f)*i,{internal:!0});const p=Vn(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,a==null||a(l,p)),e.isPanScrolling&&(c==null||c(l,p),e.panScrollTimeout=setTimeout(()=>{u==null||u(l,p),e.isPanScrolling=!1},150))}}function Xf({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(r,o){const i=r.type==="wheel",s=!t&&i&&!r.ctrlKey,a=wt(r,e);if(r.ctrlKey&&i&&a&&r.preventDefault(),s||a)return null;r.preventDefault(),n.call(this,r,o)}}function Yf({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return r=>{var i,s,a;if((i=r.sourceEvent)!=null&&i.internal)return;const o=Vn(r.transform);e.mouseButton=((s=r.sourceEvent)==null?void 0:s.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=o,((a=r.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(r.sourceEvent,o))}}function Wf({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:r,onPanZoom:o}){return i=>{var s,a;e.usedRightMouseButton=!!(n&&ks(t,e.mouseButton??0)),(s=i.sourceEvent)!=null&&s.sync||r([i.transform.x,i.transform.y,i.transform.k]),o&&!((a=i.sourceEvent)!=null&&a.internal)&&(o==null||o(i.sourceEvent,Vn(i.transform)))}}function Uf({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:i}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,i&&ks(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&i(s.sourceEvent),e.usedRightMouseButton=!1,r(!1),o&&Bf(e.prevViewport,s.transform))){const c=Vn(s.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o==null||o(s.sourceEvent,c)},n?150:0)}}}function qf({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:i,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:u}){return l=>{var m;const f=e||t,d=n&&l.ctrlKey;if(l.button===1&&l.type==="mousedown"&&(wt(l,`${u}-flow__node`)||wt(l,`${u}-flow__edge`)))return!0;if(!r&&!f&&!o&&!i&&!n||s||wt(l,a)&&l.type==="wheel"||wt(l,c)&&(l.type!=="wheel"||o&&l.type==="wheel"&&!e)||!n&&l.ctrlKey&&l.type==="wheel")return!1;if(!n&&l.type==="touchstart"&&((m=l.touches)==null?void 0:m.length)>1)return l.preventDefault(),!1;if(!f&&!o&&!d&&l.type==="wheel"||!r&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(r)&&!r.includes(l.button)&&l.type==="mousedown")return!1;const h=Array.isArray(r)&&r.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||l.type==="wheel")&&h}}function Gf({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:r,translateExtent:o,viewport:i,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:u}){const l={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=e.getBoundingClientRect(),d=os().clickDistance(!Ie(r)||r<0?0:r).scaleExtent([t,n]).translateExtent(o),h=we(e).call(d);g({x:i.x,y:i.y,zoom:Nt(i.zoom,t,n)},[[0,0],[f.width,f.height]],o);const m=h.on("wheel.zoom"),p=h.on("dblclick.zoom");d.wheelDelta(Rs);function x(j,P){return h?new Promise(S=>{d==null||d.interpolate((P==null?void 0:P.interpolate)==="linear"?zt:vn).transform(ur(h,P==null?void 0:P.duration,P==null?void 0:P.ease,()=>S(!0)),j)}):Promise.resolve(!1)}function w({noWheelClassName:j,noPanClassName:P,onPaneContextMenu:S,userSelectionActive:I,panOnScroll:A,panOnDrag:D,panOnScrollMode:$,panOnScrollSpeed:k,preventScrolling:L,zoomOnPinch:z,zoomOnScroll:F,zoomOnDoubleClick:V,zoomActivationKeyPressed:B,lib:W,onTransformChange:X}){I&&!l.isZoomingOrPanning&&E();const H=A&&!B&&!I?Vf({zoomPanValues:l,noWheelClassName:j,d3Selection:h,d3Zoom:d,panOnScrollMode:$,panOnScrollSpeed:k,zoomOnPinch:z,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):Xf({noWheelClassName:j,preventScrolling:L,d3ZoomHandler:m});if(h.on("wheel.zoom",H,{passive:!1}),!I){const Y=Yf({zoomPanValues:l,onDraggingChange:u,onPanZoomStart:a});d.on("start",Y);const Q=Wf({zoomPanValues:l,panOnDrag:D,onPaneContextMenu:!!S,onPanZoom:s,onTransformChange:X});d.on("zoom",Q);const G=Uf({zoomPanValues:l,panOnDrag:D,panOnScroll:A,onPaneContextMenu:S,onPanZoomEnd:c,onDraggingChange:u});d.on("end",G)}const q=qf({zoomActivationKeyPressed:B,panOnDrag:D,zoomOnScroll:F,panOnScroll:A,zoomOnDoubleClick:V,zoomOnPinch:z,userSelectionActive:I,noPanClassName:P,noWheelClassName:j,lib:W});d.filter(q),V?h.on("dblclick.zoom",p):h.on("dblclick.zoom",null)}function E(){d.on("zoom",null)}async function g(j,P,S){const I=lr(j),A=d==null?void 0:d.constrain()(I,P,S);return A&&await x(A),new Promise(D=>D(A))}async function v(j,P){const S=lr(j);return await x(S,P),new Promise(I=>I(S))}function _(j){if(h){const P=lr(j),S=h.property("__zoom");(S.k!==j.zoom||S.x!==j.x||S.y!==j.y)&&(d==null||d.transform(h,P,null,{sync:!0}))}}function C(){const j=h?rs(h.node()):{x:0,y:0,k:1};return{x:j.x,y:j.y,zoom:j.k}}function M(j,P){return h?new Promise(S=>{d==null||d.interpolate((P==null?void 0:P.interpolate)==="linear"?zt:vn).scaleTo(ur(h,P==null?void 0:P.duration,P==null?void 0:P.ease,()=>S(!0)),j)}):Promise.resolve(!1)}function N(j,P){return h?new Promise(S=>{d==null||d.interpolate((P==null?void 0:P.interpolate)==="linear"?zt:vn).scaleBy(ur(h,P==null?void 0:P.duration,P==null?void 0:P.ease,()=>S(!0)),j)}):Promise.resolve(!1)}function T(j){d==null||d.scaleExtent(j)}function O(j){d==null||d.translateExtent(j)}function R(j){const P=!Ie(j)||j<0?0:j;d==null||d.clickDistance(P)}return{update:w,destroy:E,setViewport:v,setViewportConstrained:g,getViewport:C,scaleTo:M,scaleBy:N,setScaleExtent:T,setTranslateExtent:O,syncViewport:_,setClickDistance:R}}var It;(function(e){e.Line="line",e.Handle="handle"})(It||(It={}));function Kf({width:e,prevWidth:t,height:n,prevHeight:r,affectsX:o,affectsY:i}){const s=e-t,a=n-r,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&o&&(c[0]=c[0]*-1),a&&i&&(c[1]=c[1]*-1),c}function Zf(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),r=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:r,affectsY:o}}function et(e,t){return Math.max(0,t-e)}function tt(e,t){return Math.max(0,e-t)}function gn(e,t,n){return Math.max(0,t-e,e-n)}function Oo(e,t){return e?!t:t}function Jf(e,t,n,r,o,i,s,a){let{affectsX:c,affectsY:u}=t;const{isHorizontal:l,isVertical:f}=t,d=l&&f,{xSnapped:h,ySnapped:m}=n,{minWidth:p,maxWidth:x,minHeight:w,maxHeight:E}=r,{x:g,y:v,width:_,height:C,aspectRatio:M}=e;let N=Math.floor(l?h-e.pointerX:0),T=Math.floor(f?m-e.pointerY:0);const O=_+(c?-N:N),R=C+(u?-T:T),j=-i[0]*_,P=-i[1]*C;let S=gn(O,p,x),I=gn(R,w,E);if(s){let $=0,k=0;c&&N<0?$=et(g+N+j,s[0][0]):!c&&N>0&&($=tt(g+O+j,s[1][0])),u&&T<0?k=et(v+T+P,s[0][1]):!u&&T>0&&(k=tt(v+R+P,s[1][1])),S=Math.max(S,$),I=Math.max(I,k)}if(a){let $=0,k=0;c&&N>0?$=tt(g+N,a[0][0]):!c&&N<0&&($=et(g+O,a[1][0])),u&&T>0?k=tt(v+T,a[0][1]):!u&&T<0&&(k=et(v+R,a[1][1])),S=Math.max(S,$),I=Math.max(I,k)}if(o){if(l){const $=gn(O/M,w,E)*M;if(S=Math.max(S,$),s){let k=0;!c&&!u||c&&!u&&d?k=tt(v+P+O/M,s[1][1])*M:k=et(v+P+(c?N:-N)/M,s[0][1])*M,S=Math.max(S,k)}if(a){let k=0;!c&&!u||c&&!u&&d?k=et(v+O/M,a[1][1])*M:k=tt(v+(c?N:-N)/M,a[0][1])*M,S=Math.max(S,k)}}if(f){const $=gn(R*M,p,x)/M;if(I=Math.max(I,$),s){let k=0;!c&&!u||u&&!c&&d?k=tt(g+R*M+j,s[1][0])/M:k=et(g+(u?T:-T)*M+j,s[0][0])/M,I=Math.max(I,k)}if(a){let k=0;!c&&!u||u&&!c&&d?k=et(g+R*M,a[1][0])/M:k=tt(g+(u?T:-T)*M,a[0][0])/M,I=Math.max(I,k)}}}T=T+(T<0?I:-I),N=N+(N<0?S:-S),o&&(d?O>R*M?T=(Oo(c,u)?-N:N)/M:N=(Oo(c,u)?-T:T)*M:l?(T=N/M,u=c):(N=T*M,c=u));const A=c?g+N:g,D=u?v+T:v;return{width:_+(c?-N:N),height:C+(u?-T:T),x:i[0]*N*(c?-1:1)+A,y:i[1]*T*(u?-1:1)+D}}const Ts={width:0,height:0,x:0,y:0},Qf={...Ts,pointerX:0,pointerY:0,aspectRatio:1};function eh(e){return[[0,0],[e.measured.width,e.measured.height]]}function th(e,t,n){const r=t.position.x+e.position.x,o=t.position.y+e.position.y,i=e.measured.width??0,s=e.measured.height??0,a=n[0]*i,c=n[1]*s;return[[r-a,o-c],[r+i-a,o+s-c]]}function nh({domNode:e,nodeId:t,getStoreItems:n,onChange:r,onEnd:o}){const i=we(e);function s({controlPosition:c,boundaries:u,keepAspectRatio:l,resizeDirection:f,onResizeStart:d,onResize:h,onResizeEnd:m,shouldResize:p}){let x={...Ts},w={...Qf};const E=Zf(c);let g,v=null,_=[],C,M,N;const T=Ji().on("start",O=>{const{nodeLookup:R,transform:j,snapGrid:P,snapToGrid:S,nodeOrigin:I,paneDomNode:A}=n();if(g=R.get(t),!g)return;v=(A==null?void 0:A.getBoundingClientRect())??null;const{xSnapped:D,ySnapped:$}=Ot(O.sourceEvent,{transform:j,snapGrid:P,snapToGrid:S,containerBounds:v});x={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},w={...x,pointerX:D,pointerY:$,aspectRatio:x.width/x.height},C=void 0,g.parentId&&(g.extent==="parent"||g.expandParent)&&(C=R.get(g.parentId),M=C&&g.extent==="parent"?eh(C):void 0),_=[],N=void 0;for(const[k,L]of R)if(L.parentId===t&&(_.push({id:k,position:{...L.position},extent:L.extent}),L.extent==="parent"||L.expandParent)){const z=th(L,g,L.origin??I);N?N=[[Math.min(z[0][0],N[0][0]),Math.min(z[0][1],N[0][1])],[Math.max(z[1][0],N[1][0]),Math.max(z[1][1],N[1][1])]]:N=z}d==null||d(O,{...x})}).on("drag",O=>{const{transform:R,snapGrid:j,snapToGrid:P,nodeOrigin:S}=n(),I=Ot(O.sourceEvent,{transform:R,snapGrid:j,snapToGrid:P,containerBounds:v}),A=[];if(!g)return;const{x:D,y:$,width:k,height:L}=x,z={},F=g.origin??S,{width:V,height:B,x:W,y:X}=Jf(w,E,I,u,l,F,M,N),U=V!==k,H=B!==L,q=W!==D&&U,Y=X!==$&&H;if(!q&&!Y&&!U&&!H)return;if((q||Y||F[0]===1||F[1]===1)&&(z.x=q?W:x.x,z.y=Y?X:x.y,x.x=z.x,x.y=z.y,_.length>0)){const Z=W-D,te=X-$;for(const re of _)re.position={x:re.position.x-Z+F[0]*(V-k),y:re.position.y-te+F[1]*(B-L)},A.push(re)}if((U||H)&&(z.width=U&&(!f||f==="horizontal")?V:x.width,z.height=H&&(!f||f==="vertical")?B:x.height,x.width=z.width,x.height=z.height),C&&g.expandParent){const Z=F[0]*(z.width??0);z.x&&z.x<Z&&(x.x=Z,w.x=w.x-(z.x-Z));const te=F[1]*(z.height??0);z.y&&z.y<te&&(x.y=te,w.y=w.y-(z.y-te))}const Q=Kf({width:x.width,prevWidth:k,height:x.height,prevHeight:L,affectsX:E.affectsX,affectsY:E.affectsY}),G={...x,direction:Q};(p==null?void 0:p(O,G))!==!1&&(h==null||h(O,G),r(z,A))}).on("end",O=>{m==null||m(O,{...x}),o==null||o({...x})});i.call(T)}function a(){i.on(".drag",null)}return{update:s,destroy:a}}var dr={exports:{}},fr={},hr={exports:{}},gr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fo;function rh(){if(Fo)return gr;Fo=1;var e=Ai();function t(f,d){return f===d&&(f!==0||1/f===1/d)||f!==f&&d!==d}var n=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,i=e.useLayoutEffect,s=e.useDebugValue;function a(f,d){var h=d(),m=r({inst:{value:h,getSnapshot:d}}),p=m[0].inst,x=m[1];return i(function(){p.value=h,p.getSnapshot=d,c(p)&&x({inst:p})},[f,h,d]),o(function(){return c(p)&&x({inst:p}),f(function(){c(p)&&x({inst:p})})},[f]),s(h),h}function c(f){var d=f.getSnapshot;f=f.value;try{var h=d();return!n(f,h)}catch{return!0}}function u(f,d){return d()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return gr.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,gr}var Bo;function oh(){return Bo||(Bo=1,hr.exports=rh()),hr.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ho;function ih(){if(Ho)return fr;Ho=1;var e=Ai(),t=oh();function n(u,l){return u===l&&(u!==0||1/u===1/l)||u!==u&&l!==l}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,i=e.useRef,s=e.useEffect,a=e.useMemo,c=e.useDebugValue;return fr.useSyncExternalStoreWithSelector=function(u,l,f,d,h){var m=i(null);if(m.current===null){var p={hasValue:!1,value:null};m.current=p}else p=m.current;m=a(function(){function w(C){if(!E){if(E=!0,g=C,C=d(C),h!==void 0&&p.hasValue){var M=p.value;if(h(M,C))return v=M}return v=C}if(M=v,r(g,C))return M;var N=d(C);return h!==void 0&&h(M,N)?(g=C,M):(g=C,v=N)}var E=!1,g,v,_=f===void 0?null:f;return[function(){return w(l())},_===null?void 0:function(){return w(_())}]},[l,f,d,h]);var x=o(u,m[0],m[1]);return s(function(){p.hasValue=!0,p.value=x},[x]),c(x),x},fr}var Vo;function sh(){return Vo||(Vo=1,dr.exports=ih()),dr.exports}var ah=sh();const ch=dc(ah),lh={},Xo=e=>{let t;const n=new Set,r=(l,f)=>{const d=typeof l=="function"?l(t):l;if(!Object.is(d,t)){const h=t;t=f??(typeof d!="object"||d===null)?d:Object.assign({},t,d),n.forEach(m=>m(t,h))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>u,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{(lh?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=t=e(r,o,c);return c},uh=e=>e?Xo(e):Xo,{useDebugValue:dh}=fe,{useSyncExternalStoreWithSelector:fh}=ch,hh=e=>e;function Ps(e,t=hh,n){const r=fh(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return dh(r),r}const Yo=(e,t)=>{const n=uh(e),r=(o,i=t)=>Ps(n,o,i);return Object.assign(r,n),r},gh=(e,t)=>e?Yo(e,t):Yo;function ie(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const Xn=b.createContext(null),ph=Xn.Provider,js=Oe.error001();function ee(e,t){const n=b.useContext(Xn);if(n===null)throw new Error(js);return Ps(n,e,t)}function oe(){const e=b.useContext(Xn);if(e===null)throw new Error(js);return b.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Wo={display:"none"},mh={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},$s="react-flow__node-desc",Ls="react-flow__edge-desc",yh="react-flow__aria-live",xh=e=>e.ariaLiveMessage,vh=e=>e.ariaLabelConfig;function wh({rfId:e}){const t=ee(xh);return y.jsx("div",{id:`${yh}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:mh,children:t})}function bh({rfId:e,disableKeyboardA11y:t}){const n=ee(vh);return y.jsxs(y.Fragment,{children:[y.jsx("div",{id:`${$s}-${e}`,style:Wo,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),y.jsx("div",{id:`${Ls}-${e}`,style:Wo,children:n["edge.a11yDescription.default"]}),!t&&y.jsx(wh,{rfId:e})]})}const Yn=b.forwardRef(({position:e="top-left",children:t,className:n,style:r,...o},i)=>{const s=`${e}`.split("-");return y.jsx("div",{className:ae(["react-flow__panel",n,...s]),style:r,ref:i,...o,children:t})});Yn.displayName="Panel";function Sh({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:y.jsx(Yn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:y.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const _h=e=>{const t=[],n=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&n.push(r);return{selectedNodes:t,selectedEdges:n}},pn=e=>e.id;function Eh(e,t){return ie(e.selectedNodes.map(pn),t.selectedNodes.map(pn))&&ie(e.selectedEdges.map(pn),t.selectedEdges.map(pn))}function Ch({onSelectionChange:e}){const t=oe(),{selectedNodes:n,selectedEdges:r}=ee(_h,Eh);return b.useEffect(()=>{const o={nodes:n,edges:r};e==null||e(o),t.getState().onSelectionChangeHandlers.forEach(i=>i(o))},[n,r,e]),null}const Mh=e=>!!e.onSelectionChangeHandlers;function Nh({onSelectionChange:e}){const t=ee(Mh);return e||t?y.jsx(Ch,{onSelectionChange:e}):null}const zs=[0,0],Ah={x:0,y:0,zoom:1},Dh=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],Uo=[...Dh,"rfId"],Ih=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),qo={translateExtent:Xt,nodeOrigin:zs,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function kh(e){const{setNodes:t,setEdges:n,setMinZoom:r,setMaxZoom:o,setTranslateExtent:i,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c,setPaneClickDistance:u}=ee(Ih,ie),l=oe();b.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{f.current=qo,a()}),[]);const f=b.useRef(qo);return b.useEffect(()=>{for(const d of Uo){const h=e[d],m=f.current[d];h!==m&&(typeof e[d]>"u"||(d==="nodes"?t(h):d==="edges"?n(h):d==="minZoom"?r(h):d==="maxZoom"?o(h):d==="translateExtent"?i(h):d==="nodeExtent"?s(h):d==="paneClickDistance"?u(h):d==="ariaLabelConfig"?l.setState({ariaLabelConfig:mf(h)}):d==="fitView"?l.setState({fitViewQueued:h}):d==="fitViewOptions"?l.setState({fitViewOptions:h}):l.setState({[d]:h})))}f.current=e},Uo.map(d=>e[d])),null}function Go(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Rh(e){var r;const[t,n]=b.useState(e==="system"?null:e);return b.useEffect(()=>{if(e!=="system"){n(e);return}const o=Go(),i=()=>n(o!=null&&o.matches?"dark":"light");return i(),o==null||o.addEventListener("change",i),()=>{o==null||o.removeEventListener("change",i)}},[e]),t!==null?t:(r=Go())!=null&&r.matches?"dark":"light"}const Ko=typeof document<"u"?document:null;function qt(e=null,t={target:Ko,actInsideInputWithModifier:!0}){const[n,r]=b.useState(!1),o=b.useRef(!1),i=b.useRef(new Set([])),[s,a]=b.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=u.reduce((f,d)=>f.concat(...d),[]);return[u,l]}return[[],[]]},[e]);return b.useEffect(()=>{const c=(t==null?void 0:t.target)??Ko,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const l=h=>{var x,w;if(o.current=h.ctrlKey||h.metaKey||h.shiftKey||h.altKey,(!o.current||o.current&&!u)&&ys(h))return!1;const p=Jo(h.code,a);if(i.current.add(h[p]),Zo(s,i.current,!1)){const E=((w=(x=h.composedPath)==null?void 0:x.call(h))==null?void 0:w[0])||h.target,g=(E==null?void 0:E.nodeName)==="BUTTON"||(E==null?void 0:E.nodeName)==="A";t.preventDefault!==!1&&(o.current||!g)&&h.preventDefault(),r(!0)}},f=h=>{const m=Jo(h.code,a);Zo(s,i.current,!0)?(r(!1),i.current.clear()):i.current.delete(h[m]),h.key==="Meta"&&i.current.clear(),o.current=!1},d=()=>{i.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",f),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",f),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,r]),n}function Zo(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function Jo(e,t){return t.includes(e)?"code":"key"}const Th=()=>{const e=oe();return b.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[r,o,i],panZoom:s}=e.getState();return s?(await s.setViewport({x:t.x??r,y:t.y??o,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},setCenter:async(t,n,r)=>e.getState().setCenter(t,n,r),fitBounds:async(t,n)=>{const{width:r,height:o,minZoom:i,maxZoom:s,panZoom:a}=e.getState(),c=qr(t,r,o,i,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:r,snapGrid:o,snapToGrid:i,domNode:s}=e.getState();if(!s)return t;const{x:a,y:c}=s.getBoundingClientRect(),u={x:t.x-a,y:t.y-c},l=n.snapGrid??o,f=n.snapToGrid??i;return tn(u,r,f,l)},flowToScreenPosition:t=>{const{transform:n,domNode:r}=e.getState();if(!r)return t;const{x:o,y:i}=r.getBoundingClientRect(),s=Dn(t,n);return{x:s.x+o,y:s.y+i}}}),[])};function Os(e,t){const n=[],r=new Map,o=[];for(const i of e)if(i.type==="add"){o.push(i);continue}else if(i.type==="remove"||i.type==="replace")r.set(i.id,[i]);else{const s=r.get(i.id);s?s.push(i):r.set(i.id,[i])}for(const i of t){const s=r.get(i.id);if(!s){n.push(i);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...i};for(const c of s)Ph(c,a);n.push(a)}return o.length&&o.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function Ph(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Fs(e,t){return Os(e,t)}function Bs(e,t){return Os(e,t)}function dt(e,t){return{id:e,type:"select",selected:t}}function bt(e,t=new Set,n=!1){const r=[];for(const[o,i]of e){const s=t.has(o);!(i.selected===void 0&&!s)&&i.selected!==s&&(n&&(i.selected=s),r.push(dt(i.id,s)))}return r}function Qo({items:e=[],lookup:t}){var o;const n=[],r=new Map(e.map(i=>[i.id,i]));for(const[i,s]of e.entries()){const a=t.get(s.id),c=((o=a==null?void 0:a.internals)==null?void 0:o.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:i})}for(const[i]of t)r.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function ei(e){return{id:e.id,type:"remove"}}const ti=e=>sf(e),jh=e=>ls(e);function Hs(e){return b.forwardRef(e)}const $h=typeof window<"u"?b.useLayoutEffect:b.useEffect;function ni(e){const[t,n]=b.useState(BigInt(0)),[r]=b.useState(()=>Lh(()=>n(o=>o+BigInt(1))));return $h(()=>{const o=r.get();o.length&&(e(o),r.reset())},[t]),r}function Lh(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Vs=b.createContext(null);function zh({children:e}){const t=oe(),n=b.useCallback(a=>{const{nodes:c=[],setNodes:u,hasDefaultNodes:l,onNodesChange:f,nodeLookup:d,fitViewQueued:h}=t.getState();let m=c;for(const x of a)m=typeof x=="function"?x(m):x;const p=Qo({items:m,lookup:d});l&&u(m),p.length>0?f==null||f(p):h&&window.requestAnimationFrame(()=>{const{fitViewQueued:x,nodes:w,setNodes:E}=t.getState();x&&E(w)})},[]),r=ni(n),o=b.useCallback(a=>{const{edges:c=[],setEdges:u,hasDefaultEdges:l,onEdgesChange:f,edgeLookup:d}=t.getState();let h=c;for(const m of a)h=typeof m=="function"?m(h):m;l?u(h):f&&f(Qo({items:h,lookup:d}))},[]),i=ni(o),s=b.useMemo(()=>({nodeQueue:r,edgeQueue:i}),[]);return y.jsx(Vs.Provider,{value:s,children:e})}function Oh(){const e=b.useContext(Vs);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Fh=e=>!!e.panZoom;function eo(){const e=Th(),t=oe(),n=Oh(),r=ee(Fh),o=b.useMemo(()=>{const i=f=>t.getState().nodeLookup.get(f),s=f=>{n.nodeQueue.push(f)},a=f=>{n.edgeQueue.push(f)},c=f=>{var w,E;const{nodeLookup:d,nodeOrigin:h}=t.getState(),m=ti(f)?f:d.get(f.id),p=m.parentId?ps(m.position,m.measured,m.parentId,d,h):m.position,x={...m,position:p,width:((w=m.measured)==null?void 0:w.width)??m.width,height:((E=m.measured)==null?void 0:E.height)??m.height};return At(x)},u=(f,d,h={replace:!1})=>{s(m=>m.map(p=>{if(p.id===f){const x=typeof d=="function"?d(p):d;return h.replace&&ti(x)?x:{...p,...x}}return p}))},l=(f,d,h={replace:!1})=>{a(m=>m.map(p=>{if(p.id===f){const x=typeof d=="function"?d(p):d;return h.replace&&jh(x)?x:{...p,...x}}return p}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>{var d;return(d=i(f))==null?void 0:d.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(d=>({...d}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:s,setEdges:a,addNodes:f=>{const d=Array.isArray(f)?f:[f];n.nodeQueue.push(h=>[...h,...d])},addEdges:f=>{const d=Array.isArray(f)?f:[f];n.edgeQueue.push(h=>[...h,...d])},toObject:()=>{const{nodes:f=[],edges:d=[],transform:h}=t.getState(),[m,p,x]=h;return{nodes:f.map(w=>({...w})),edges:d.map(w=>({...w})),viewport:{x:m,y:p,zoom:x}}},deleteElements:async({nodes:f=[],edges:d=[]})=>{const{nodes:h,edges:m,onNodesDelete:p,onEdgesDelete:x,triggerNodeChanges:w,triggerEdgeChanges:E,onDelete:g,onBeforeDelete:v}=t.getState(),{nodes:_,edges:C}=await df({nodesToRemove:f,edgesToRemove:d,nodes:h,edges:m,onBeforeDelete:v}),M=C.length>0,N=_.length>0;if(M){const T=C.map(ei);x==null||x(C),E(T)}if(N){const T=_.map(ei);p==null||p(_),w(T)}return(N||M)&&(g==null||g({nodes:_,edges:C})),{deletedNodes:_,deletedEdges:C}},getIntersectingNodes:(f,d=!0,h)=>{const m=Ao(f),p=m?f:c(f),x=h!==void 0;return p?(h||t.getState().nodes).filter(w=>{const E=t.getState().nodeLookup.get(w.id);if(E&&!m&&(w.id===f.id||!E.internals.positionAbsolute))return!1;const g=At(x?w:E),v=Wt(g,p);return d&&v>0||v>=g.width*g.height||v>=p.width*p.height}):[]},isNodeIntersecting:(f,d,h=!0)=>{const p=Ao(f)?f:c(f);if(!p)return!1;const x=Wt(p,d);return h&&x>0||x>=p.width*p.height},updateNode:u,updateNodeData:(f,d,h={replace:!1})=>{u(f,m=>{const p=typeof d=="function"?d(m):d;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},updateEdge:l,updateEdgeData:(f,d,h={replace:!1})=>{l(f,m=>{const p=typeof d=="function"?d(m):d;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},getNodesBounds:f=>{const{nodeLookup:d,nodeOrigin:h}=t.getState();return af(f,{nodeLookup:d,nodeOrigin:h})},getHandleConnections:({type:f,id:d,nodeId:h})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${h}-${f}${d?`-${d}`:""}`))==null?void 0:m.values())??[])},getNodeConnections:({type:f,handleId:d,nodeId:h})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${h}${f?d?`-${f}-${d}`:`-${f}`:""}`))==null?void 0:m.values())??[])},fitView:async f=>{const d=t.getState().fitViewResolver??pf();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:d}),n.nodeQueue.push(h=>[...h]),d.promise}}},[]);return b.useMemo(()=>({...o,...e,viewportInitialized:r}),[r])}const ri=e=>e.selected,Bh=typeof window<"u"?window:void 0;function Hh({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=oe(),{deleteElements:r}=eo(),o=qt(e,{actInsideInputWithModifier:!1}),i=qt(t,{target:Bh});b.useEffect(()=>{if(o){const{edges:s,nodes:a}=n.getState();r({nodes:a.filter(ri),edges:s.filter(ri)}),n.setState({nodesSelectionActive:!1})}},[o]),b.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function Vh(e){const t=oe();b.useEffect(()=>{const n=()=>{var o,i;if(!e.current)return!1;const r=Gr(e.current);(r.height===0||r.width===0)&&((i=(o=t.getState()).onError)==null||i.call(o,"004",Oe.error004())),t.setState({width:r.width||500,height:r.height||500})};if(e.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(e.current),()=>{window.removeEventListener("resize",n),r&&e.current&&r.unobserve(e.current)}}},[])}const Wn={position:"absolute",width:"100%",height:"100%",top:0,left:0},Xh=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function Yh({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:i=ft.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:u,minZoom:l,maxZoom:f,zoomActivationKeyCode:d,preventScrolling:h=!0,children:m,noWheelClassName:p,noPanClassName:x,onViewportChange:w,isControlledViewport:E,paneClickDistance:g}){const v=oe(),_=b.useRef(null),{userSelectionActive:C,lib:M}=ee(Xh,ie),N=qt(d),T=b.useRef();Vh(_);const O=b.useCallback(R=>{w==null||w({x:R[0],y:R[1],zoom:R[2]}),E||v.setState({transform:R})},[w,E]);return b.useEffect(()=>{if(_.current){T.current=Gf({domNode:_.current,minZoom:l,maxZoom:f,translateExtent:u,viewport:c,paneClickDistance:g,onDraggingChange:S=>v.setState({paneDragging:S}),onPanZoomStart:(S,I)=>{const{onViewportChangeStart:A,onMoveStart:D}=v.getState();D==null||D(S,I),A==null||A(I)},onPanZoom:(S,I)=>{const{onViewportChange:A,onMove:D}=v.getState();D==null||D(S,I),A==null||A(I)},onPanZoomEnd:(S,I)=>{const{onViewportChangeEnd:A,onMoveEnd:D}=v.getState();D==null||D(S,I),A==null||A(I)}});const{x:R,y:j,zoom:P}=T.current.getViewport();return v.setState({panZoom:T.current,transform:[R,j,P],domNode:_.current.closest(".react-flow")}),()=>{var S;(S=T.current)==null||S.destroy()}}},[]),b.useEffect(()=>{var R;(R=T.current)==null||R.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:i,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:N,preventScrolling:h,noPanClassName:x,userSelectionActive:C,noWheelClassName:p,lib:M,onTransformChange:O})},[e,t,n,r,o,i,s,a,N,h,x,C,p,M,O]),y.jsx("div",{className:"react-flow__renderer",ref:_,style:Wn,children:m})}const Wh=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Uh(){const{userSelectionActive:e,userSelectionRect:t}=ee(Wh,ie);return e&&t?y.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const pr=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},qh=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function Gh({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Yt.Full,panOnDrag:r,selectionOnDrag:o,onSelectionStart:i,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:c,onPaneScroll:u,onPaneMouseEnter:l,onPaneMouseMove:f,onPaneMouseLeave:d,children:h}){const m=oe(),{userSelectionActive:p,elementsSelectable:x,dragging:w,connectionInProgress:E}=ee(qh,ie),g=x&&(e||p),v=b.useRef(null),_=b.useRef(),C=b.useRef(new Set),M=b.useRef(new Set),N=b.useRef(!1),T=b.useRef(!1),O=D=>{if(N.current||E){N.current=!1;return}a==null||a(D),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},R=D=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){D.preventDefault();return}c==null||c(D)},j=u?D=>u(D):void 0,P=D=>{var F,V;const{resetSelectedElements:$,domNode:k}=m.getState();if(_.current=k==null?void 0:k.getBoundingClientRect(),!x||!e||D.button!==0||D.target!==v.current||!_.current)return;(V=(F=D.target)==null?void 0:F.setPointerCapture)==null||V.call(F,D.pointerId),T.current=!0,N.current=!1;const{x:L,y:z}=ze(D.nativeEvent,_.current);$(),m.setState({userSelectionRect:{width:0,height:0,startX:L,startY:z,x:L,y:z}}),i==null||i(D)},S=D=>{const{userSelectionRect:$,transform:k,nodeLookup:L,edgeLookup:z,connectionLookup:F,triggerNodeChanges:V,triggerEdgeChanges:B,defaultEdgeOptions:W}=m.getState();if(!_.current||!$)return;N.current=!0;const{x:X,y:U}=ze(D.nativeEvent,_.current),{startX:H,startY:q}=$,Y={startX:H,startY:q,x:X<H?X:H,y:U<q?U:q,width:Math.abs(X-H),height:Math.abs(U-q)},Q=C.current,G=M.current;C.current=new Set(Ur(L,Y,k,n===Yt.Partial,!0).map(Z=>Z.id)),M.current=new Set;const J=(W==null?void 0:W.selectable)??!0;for(const Z of C.current){const te=F.get(Z);if(te)for(const{edgeId:re}of te.values()){const Se=z.get(re);Se&&(Se.selectable??J)&&M.current.add(re)}}if(!Do(Q,C.current)){const Z=bt(L,C.current,!0);V(Z)}if(!Do(G,M.current)){const Z=bt(z,M.current);B(Z)}m.setState({userSelectionRect:Y,userSelectionActive:!0,nodesSelectionActive:!1})},I=D=>{var k,L;if(D.button!==0||!T.current)return;(L=(k=D.target)==null?void 0:k.releasePointerCapture)==null||L.call(k,D.pointerId);const{userSelectionRect:$}=m.getState();!p&&$&&D.target===v.current&&(O==null||O(D)),m.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:C.current.size>0}),s==null||s(D),(t||o)&&(N.current=!1),T.current=!1},A=r===!0||Array.isArray(r)&&r.includes(0);return y.jsxs("div",{className:ae(["react-flow__pane",{draggable:A,dragging:w,selection:e}]),onClick:g?void 0:pr(O,v),onContextMenu:pr(R,v),onWheel:pr(j,v),onPointerEnter:g?void 0:l,onPointerDown:g?P:f,onPointerMove:g?S:f,onPointerUp:g?I:void 0,onPointerLeave:d,ref:v,style:Wn,children:[h,y.jsx(Uh,{})]})}function Tr({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:i,multiSelectionActive:s,nodeLookup:a,onError:c}=t.getState(),u=a.get(e);if(!u){c==null||c("012",Oe.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&s)&&(i({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var l;return(l=r==null?void 0:r.current)==null?void 0:l.blur()})):o([e])}function Xs({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:i,nodeClickDistance:s}){const a=oe(),[c,u]=b.useState(!1),l=b.useRef();return b.useEffect(()=>{l.current=Pf({getStoreItems:()=>a.getState(),onNodeMouseDown:f=>{Tr({id:f,store:a,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),b.useEffect(()=>{var f,d;if(t)(f=l.current)==null||f.destroy();else if(e.current)return(d=l.current)==null||d.update({noDragClassName:n,handleSelector:r,domNode:e.current,isSelectable:i,nodeId:o,nodeClickDistance:s}),()=>{var h;(h=l.current)==null||h.destroy()}},[n,r,t,i,e,o]),c}const Kh=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Ys(){const e=oe();return b.useCallback(n=>{const{nodeExtent:r,snapToGrid:o,snapGrid:i,nodesDraggable:s,onError:a,updateNodePositions:c,nodeLookup:u,nodeOrigin:l}=e.getState(),f=new Map,d=Kh(s),h=o?i[0]:5,m=o?i[1]:5,p=n.direction.x*h*n.factor,x=n.direction.y*m*n.factor;for(const[,w]of u){if(!d(w))continue;let E={x:w.internals.positionAbsolute.x+p,y:w.internals.positionAbsolute.y+x};o&&(E=Hn(E,i));const{position:g,positionAbsolute:v}=us({nodeId:w.id,nextPosition:E,nodeLookup:u,nodeExtent:r,nodeOrigin:l,onError:a});w.position=g,w.internals.positionAbsolute=v,f.set(w.id,w)}c(f)},[])}const to=b.createContext(null),Zh=to.Provider;to.Consumer;const Ws=()=>b.useContext(to),Jh=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Qh=(e,t,n)=>r=>{const{connectionClickStartHandle:o,connectionMode:i,connection:s}=r,{fromHandle:a,toHandle:c,isValid:u}=s,l=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:l,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===n,isPossibleEndHandle:i===Mt.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!o,valid:l&&u}};function eg({type:e="source",position:t=K.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:i=!0,id:s,onConnect:a,children:c,className:u,onMouseDown:l,onTouchStart:f,...d},h){var I,A;const m=s||null,p=e==="target",x=oe(),w=Ws(),{connectOnClick:E,noPanClassName:g,rfId:v}=ee(Jh,ie),{connectingFrom:_,connectingTo:C,clickConnecting:M,isPossibleEndHandle:N,connectionInProcess:T,clickConnectionInProcess:O,valid:R}=ee(Qh(w,m,e),ie);w||(A=(I=x.getState()).onError)==null||A.call(I,"010",Oe.error010());const j=D=>{const{defaultEdgeOptions:$,onConnect:k,hasDefaultEdges:L}=x.getState(),z={...$,...D};if(L){const{edges:F,setEdges:V}=x.getState();V(Ss(z,F))}k==null||k(z),a==null||a(z)},P=D=>{if(!w)return;const $=xs(D.nativeEvent);if(o&&($&&D.button===0||!$)){const k=x.getState();Rr.onPointerDown(D.nativeEvent,{autoPanOnConnect:k.autoPanOnConnect,connectionMode:k.connectionMode,connectionRadius:k.connectionRadius,domNode:k.domNode,nodeLookup:k.nodeLookup,lib:k.lib,isTarget:p,handleId:m,nodeId:w,flowId:k.rfId,panBy:k.panBy,cancelConnection:k.cancelConnection,onConnectStart:k.onConnectStart,onConnectEnd:k.onConnectEnd,updateConnection:k.updateConnection,onConnect:j,isValidConnection:n||k.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:k.autoPanSpeed,dragThreshold:k.connectionDragThreshold})}$?l==null||l(D):f==null||f(D)},S=D=>{const{onClickConnectStart:$,onClickConnectEnd:k,connectionClickStartHandle:L,connectionMode:z,isValidConnection:F,lib:V,rfId:B,nodeLookup:W,connection:X}=x.getState();if(!w||!L&&!o)return;if(!L){$==null||$(D.nativeEvent,{nodeId:w,handleId:m,handleType:e}),x.setState({connectionClickStartHandle:{nodeId:w,type:e,id:m}});return}const U=ms(D.target),H=n||F,{connection:q,isValid:Y}=Rr.isValid(D.nativeEvent,{handle:{nodeId:w,id:m,type:e},connectionMode:z,fromNodeId:L.nodeId,fromHandleId:L.id||null,fromType:L.type,isValidConnection:H,flowId:B,doc:U,lib:V,nodeLookup:W});Y&&q&&j(q);const Q=structuredClone(X);delete Q.inProgress,Q.toPosition=Q.toHandle?Q.toHandle.position:null,k==null||k(D,Q),x.setState({connectionClickStartHandle:null})};return y.jsx("div",{"data-handleid":m,"data-nodeid":w,"data-handlepos":t,"data-id":`${v}-${w}-${m}-${e}`,className:ae(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",g,u,{source:!p,target:p,connectable:r,connectablestart:o,connectableend:i,clickconnecting:M,connectingfrom:_,connectingto:C,valid:R,connectionindicator:r&&(!T||N)&&(T||O?i:o)}]),onMouseDown:P,onTouchStart:P,onClick:E?S:void 0,ref:h,...d,children:c})}const Ue=b.memo(Hs(eg));function tg({data:e,isConnectable:t,sourcePosition:n=K.Bottom}){return y.jsxs(y.Fragment,{children:[e==null?void 0:e.label,y.jsx(Ue,{type:"source",position:n,isConnectable:t})]})}function ng({data:e,isConnectable:t,targetPosition:n=K.Top,sourcePosition:r=K.Bottom}){return y.jsxs(y.Fragment,{children:[y.jsx(Ue,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,y.jsx(Ue,{type:"source",position:r,isConnectable:t})]})}function rg(){return null}function og({data:e,isConnectable:t,targetPosition:n=K.Top}){return y.jsxs(y.Fragment,{children:[y.jsx(Ue,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const kn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},oi={input:tg,default:ng,output:og,group:rg};function ig(e){var t,n,r,o;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((r=e.style)==null?void 0:r.width),height:e.height??((o=e.style)==null?void 0:o.height)}}const sg=e=>{const{width:t,height:n,x:r,y:o}=en(e.nodeLookup,{filter:i=>!!i.selected});return{width:Ie(t)?t:null,height:Ie(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${o}px)`}};function ag({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=oe(),{width:o,height:i,transformString:s,userSelectionActive:a}=ee(sg,ie),c=Ys(),u=b.useRef(null);if(b.useEffect(()=>{var d;n||(d=u.current)==null||d.focus({preventScroll:!0})},[n]),Xs({nodeRef:u}),a||!o||!i)return null;const l=e?d=>{const h=r.getState().nodes.filter(m=>m.selected);e(d,h)}:void 0,f=d=>{Object.prototype.hasOwnProperty.call(kn,d.key)&&(d.preventDefault(),c({direction:kn[d.key],factor:d.shiftKey?4:1}))};return y.jsx("div",{className:ae(["react-flow__nodesselection","react-flow__container",t]),style:{transform:s},children:y.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:n?void 0:-1,onKeyDown:n?void 0:f,style:{width:o,height:i}})})}const ii=typeof window<"u"?window:void 0,cg=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Us({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:u,selectionOnDrag:l,selectionMode:f,onSelectionStart:d,onSelectionEnd:h,multiSelectionKeyCode:m,panActivationKeyCode:p,zoomActivationKeyCode:x,elementsSelectable:w,zoomOnScroll:E,zoomOnPinch:g,panOnScroll:v,panOnScrollSpeed:_,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:N,defaultViewport:T,translateExtent:O,minZoom:R,maxZoom:j,preventScrolling:P,onSelectionContextMenu:S,noWheelClassName:I,noPanClassName:A,disableKeyboardA11y:D,onViewportChange:$,isControlledViewport:k}){const{nodesSelectionActive:L,userSelectionActive:z}=ee(cg),F=qt(u,{target:ii}),V=qt(p,{target:ii}),B=V||N,W=V||v,X=l&&B!==!0,U=F||z||X;return Hh({deleteKeyCode:c,multiSelectionKeyCode:m}),y.jsx(Yh,{onPaneContextMenu:i,elementsSelectable:w,zoomOnScroll:E,zoomOnPinch:g,panOnScroll:W,panOnScrollSpeed:_,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:!F&&B,defaultViewport:T,translateExtent:O,minZoom:R,maxZoom:j,zoomActivationKeyCode:x,preventScrolling:P,noWheelClassName:I,noPanClassName:A,onViewportChange:$,isControlledViewport:k,paneClickDistance:a,children:y.jsxs(Gh,{onSelectionStart:d,onSelectionEnd:h,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,panOnDrag:B,isSelecting:!!U,selectionMode:f,selectionKeyPressed:F,selectionOnDrag:X,children:[e,L&&y.jsx(ag,{onSelectionContextMenu:S,noPanClassName:A,disableKeyboardA11y:D})]})})}Us.displayName="FlowRenderer";const lg=b.memo(Us),ug=e=>t=>e?Ur(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function dg(e){return ee(b.useCallback(ug(e),[e]),ie)}const fg=e=>e.updateNodeInternals;function hg(){const e=ee(fg),[t]=b.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(o=>{const i=o.target.getAttribute("data-id");r.set(i,{id:i,nodeElement:o.target,force:!0})}),e(r)}));return b.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function gg({node:e,nodeType:t,hasDimensions:n,resizeObserver:r}){const o=oe(),i=b.useRef(null),s=b.useRef(null),a=b.useRef(e.sourcePosition),c=b.useRef(e.targetPosition),u=b.useRef(t),l=n&&!!e.internals.handleBounds;return b.useEffect(()=>{i.current&&!e.hidden&&(!l||s.current!==i.current)&&(s.current&&(r==null||r.unobserve(s.current)),r==null||r.observe(i.current),s.current=i.current)},[l,e.hidden]),b.useEffect(()=>()=>{s.current&&(r==null||r.unobserve(s.current),s.current=null)},[]),b.useEffect(()=>{if(i.current){const f=u.current!==t,d=a.current!==e.sourcePosition,h=c.current!==e.targetPosition;(f||d||h)&&(u.current=t,a.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function pg({id:e,onClick:t,onMouseEnter:n,onMouseMove:r,onMouseLeave:o,onContextMenu:i,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:u,nodesFocusable:l,resizeObserver:f,noDragClassName:d,noPanClassName:h,disableKeyboardA11y:m,rfId:p,nodeTypes:x,nodeClickDistance:w,onError:E}){const{node:g,internals:v,isParent:_}=ee(H=>{const q=H.nodeLookup.get(e),Y=H.parentLookup.has(e);return{node:q,internals:q.internals,isParent:Y}},ie);let C=g.type||"default",M=(x==null?void 0:x[C])||oi[C];M===void 0&&(E==null||E("003",Oe.error003(C)),C="default",M=(x==null?void 0:x.default)||oi.default);const N=!!(g.draggable||a&&typeof g.draggable>"u"),T=!!(g.selectable||c&&typeof g.selectable>"u"),O=!!(g.connectable||u&&typeof g.connectable>"u"),R=!!(g.focusable||l&&typeof g.focusable>"u"),j=oe(),P=gs(g),S=gg({node:g,nodeType:C,hasDimensions:P,resizeObserver:f}),I=Xs({nodeRef:S,disabled:g.hidden||!N,noDragClassName:d,handleSelector:g.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:w}),A=Ys();if(g.hidden)return null;const D=Ge(g),$=ig(g),k=T||N||t||n||r||o,L=n?H=>n(H,{...v.userNode}):void 0,z=r?H=>r(H,{...v.userNode}):void 0,F=o?H=>o(H,{...v.userNode}):void 0,V=i?H=>i(H,{...v.userNode}):void 0,B=s?H=>s(H,{...v.userNode}):void 0,W=H=>{const{selectNodesOnDrag:q,nodeDragThreshold:Y}=j.getState();T&&(!q||!N||Y>0)&&Tr({id:e,store:j,nodeRef:S}),t&&t(H,{...v.userNode})},X=H=>{if(!(ys(H.nativeEvent)||m)){if(is.includes(H.key)&&T){const q=H.key==="Escape";Tr({id:e,store:j,unselect:q,nodeRef:S})}else if(N&&g.selected&&Object.prototype.hasOwnProperty.call(kn,H.key)){H.preventDefault();const{ariaLabelConfig:q}=j.getState();j.setState({ariaLiveMessage:q["node.a11yDescription.ariaLiveMessage"]({direction:H.key.replace("Arrow","").toLowerCase(),x:~~v.positionAbsolute.x,y:~~v.positionAbsolute.y})}),A({direction:kn[H.key],factor:H.shiftKey?4:1})}}},U=()=>{var Z;if(m||!((Z=S.current)!=null&&Z.matches(":focus-visible")))return;const{transform:H,width:q,height:Y,autoPanOnNodeFocus:Q,setCenter:G}=j.getState();if(!Q)return;Ur(new Map([[e,g]]),{x:0,y:0,width:q,height:Y},H,!0).length>0||G(g.position.x+D.width/2,g.position.y+D.height/2,{zoom:H[2]})};return y.jsx("div",{className:ae(["react-flow__node",`react-flow__node-${C}`,{[h]:N},g.className,{selected:g.selected,selectable:T,parent:_,draggable:N,dragging:I}]),ref:S,style:{zIndex:v.z,transform:`translate(${v.positionAbsolute.x}px,${v.positionAbsolute.y}px)`,pointerEvents:k?"all":"none",visibility:P?"visible":"hidden",...g.style,...$},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:L,onMouseMove:z,onMouseLeave:F,onContextMenu:V,onClick:W,onDoubleClick:B,onKeyDown:R?X:void 0,tabIndex:R?0:void 0,onFocus:R?U:void 0,role:g.ariaRole??(R?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${$s}-${p}`,"aria-label":g.ariaLabel,...g.domAttributes,children:y.jsx(Zh,{value:e,children:y.jsx(M,{id:e,data:g.data,type:C,positionAbsoluteX:v.positionAbsolute.x,positionAbsoluteY:v.positionAbsolute.y,selected:g.selected??!1,selectable:T,draggable:N,deletable:g.deletable??!0,isConnectable:O,sourcePosition:g.sourcePosition,targetPosition:g.targetPosition,dragging:I,dragHandle:g.dragHandle,zIndex:v.z,parentId:g.parentId,...D})})})}const mg=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function qs(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,onError:i}=ee(mg,ie),s=dg(e.onlyRenderVisibleElements),a=hg();return y.jsx("div",{className:"react-flow__nodes",style:Wn,children:s.map(c=>y.jsx(pg,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:i},c))})}qs.displayName="NodeRenderer";const yg=b.memo(qs);function xg(e){return ee(b.useCallback(n=>{if(!e)return n.edges.map(o=>o.id);const r=[];if(n.width&&n.height)for(const o of n.edges){const i=n.nodeLookup.get(o.source),s=n.nodeLookup.get(o.target);i&&s&&vf({sourceNode:i,targetNode:s,width:n.width,height:n.height,transform:n.transform})&&r.push(o.id)}return r},[e]),ie)}const vg=({color:e="none",strokeWidth:t=1})=>y.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),wg=({color:e="none",strokeWidth:t=1})=>y.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),si={[Nn.Arrow]:vg,[Nn.ArrowClosed]:wg};function bg(e){const t=oe();return b.useMemo(()=>{var o,i;return Object.prototype.hasOwnProperty.call(si,e)?si[e]:((i=(o=t.getState()).onError)==null||i.call(o,"009",Oe.error009(e)),null)},[e])}const Sg=({id:e,type:t,color:n,width:r=12.5,height:o=12.5,markerUnits:i="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=bg(t);return c?y.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0",children:y.jsx(c,{color:n,strokeWidth:s})}):null},Gs=({defaultColor:e,rfId:t})=>{const n=ee(i=>i.edges),r=ee(i=>i.defaultEdgeOptions),o=b.useMemo(()=>Mf(n,{id:t,defaultColor:e,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,t,e]);return o.length?y.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:y.jsx("defs",{children:o.map(i=>y.jsx(Sg,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};Gs.displayName="MarkerDefinitions";var _g=b.memo(Gs);function Ks({x:e,y:t,label:n,labelStyle:r,labelShowBg:o=!0,labelBgStyle:i,labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:u,...l}){const[f,d]=b.useState({x:1,y:0,width:0,height:0}),h=ae(["react-flow__edge-textwrapper",u]),m=b.useRef(null);return b.useEffect(()=>{if(m.current){const p=m.current.getBBox();d({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?y.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:h,visibility:f.width?"visible":"hidden",...l,children:[o&&y.jsx("rect",{width:f.width+2*s[0],x:-s[0],y:-s[1],height:f.height+2*s[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),y.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]}):null}Ks.displayName="EdgeText";const Eg=b.memo(Ks);function Un({path:e,labelX:t,labelY:n,label:r,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c,interactionWidth:u=20,...l}){return y.jsxs(y.Fragment,{children:[y.jsx("path",{...l,d:e,fill:"none",className:ae(["react-flow__edge-path",l.className])}),u&&y.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}),r&&Ie(t)&&Ie(n)?y.jsx(Eg,{x:t,y:n,label:r,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c}):null]})}function ai({pos:e,x1:t,y1:n,x2:r,y2:o}){return e===K.Left||e===K.Right?[.5*(t+r),n]:[t,.5*(n+o)]}function Zs({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top}){const[s,a]=ai({pos:n,x1:e,y1:t,x2:r,y2:o}),[c,u]=ai({pos:i,x1:r,y1:o,x2:e,y2:t}),[l,f,d,h]=vs({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:u});return[`M${e},${t} C${s},${a} ${c},${u} ${r},${o}`,l,f,d,h]}function Js(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,sourcePosition:s,targetPosition:a,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:x,interactionWidth:w})=>{const[E,g,v]=Zs({sourceX:n,sourceY:r,sourcePosition:s,targetX:o,targetY:i,targetPosition:a}),_=e.isInternal?void 0:t;return y.jsx(Un,{id:_,path:E,labelX:g,labelY:v,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:x,interactionWidth:w})})}const Cg=Js({isInternal:!1}),Qs=Js({isInternal:!0});Cg.displayName="SimpleBezierEdge";Qs.displayName="SimpleBezierEdgeInternal";function ea(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,sourcePosition:h=K.Bottom,targetPosition:m=K.Top,markerEnd:p,markerStart:x,pathOptions:w,interactionWidth:E})=>{const[g,v,_]=Dr({sourceX:n,sourceY:r,sourcePosition:h,targetX:o,targetY:i,targetPosition:m,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset,stepPosition:w==null?void 0:w.stepPosition}),C=e.isInternal?void 0:t;return y.jsx(Un,{id:C,path:g,labelX:v,labelY:_,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,markerEnd:p,markerStart:x,interactionWidth:E})})}const ta=ea({isInternal:!1}),na=ea({isInternal:!0});ta.displayName="SmoothStepEdge";na.displayName="SmoothStepEdgeInternal";function ra(e){return b.memo(({id:t,...n})=>{var o;const r=e.isInternal?void 0:t;return y.jsx(ta,{...n,id:r,pathOptions:b.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const Mg=ra({isInternal:!1}),oa=ra({isInternal:!0});Mg.displayName="StepEdge";oa.displayName="StepEdgeInternal";function ia(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,markerEnd:h,markerStart:m,interactionWidth:p})=>{const[x,w,E]=_s({sourceX:n,sourceY:r,targetX:o,targetY:i}),g=e.isInternal?void 0:t;return y.jsx(Un,{id:g,path:x,labelX:w,labelY:E,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:f,style:d,markerEnd:h,markerStart:m,interactionWidth:p})})}const Ng=ia({isInternal:!1}),sa=ia({isInternal:!0});Ng.displayName="StraightEdge";sa.displayName="StraightEdgeInternal";function aa(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,sourcePosition:s=K.Bottom,targetPosition:a=K.Top,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:x,pathOptions:w,interactionWidth:E})=>{const[g,v,_]=ws({sourceX:n,sourceY:r,sourcePosition:s,targetX:o,targetY:i,targetPosition:a,curvature:w==null?void 0:w.curvature}),C=e.isInternal?void 0:t;return y.jsx(Un,{id:C,path:g,labelX:v,labelY:_,label:c,labelStyle:u,labelShowBg:l,labelBgStyle:f,labelBgPadding:d,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:x,interactionWidth:E})})}const Ag=aa({isInternal:!1}),ca=aa({isInternal:!0});Ag.displayName="BezierEdge";ca.displayName="BezierEdgeInternal";const ci={default:ca,straight:sa,step:oa,smoothstep:na,simplebezier:Qs},li={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Dg=(e,t,n)=>n===K.Left?e-t:n===K.Right?e+t:e,Ig=(e,t,n)=>n===K.Top?e-t:n===K.Bottom?e+t:e,ui="react-flow__edgeupdater";function di({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:i,onMouseOut:s,type:a}){return y.jsx("circle",{onMouseDown:o,onMouseEnter:i,onMouseOut:s,className:ae([ui,`${ui}-${a}`]),cx:Dg(t,r,e),cy:Ig(n,r,e),r,stroke:"transparent",fill:"transparent"})}function kg({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:r,sourceY:o,targetX:i,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:u,onReconnectStart:l,onReconnectEnd:f,setReconnecting:d,setUpdateHover:h}){const m=oe(),p=(v,_)=>{if(v.button!==0)return;const{autoPanOnConnect:C,domNode:M,isValidConnection:N,connectionMode:T,connectionRadius:O,lib:R,onConnectStart:j,onConnectEnd:P,cancelConnection:S,nodeLookup:I,rfId:A,panBy:D,updateConnection:$}=m.getState(),k=_.type==="target",L=(V,B)=>{d(!1),f==null||f(V,n,_.type,B)},z=V=>u==null?void 0:u(n,V),F=(V,B)=>{d(!0),l==null||l(v,n,_.type),j==null||j(V,B)};Rr.onPointerDown(v.nativeEvent,{autoPanOnConnect:C,connectionMode:T,connectionRadius:O,domNode:M,handleId:_.id,nodeId:_.nodeId,nodeLookup:I,isTarget:k,edgeUpdaterType:_.type,lib:R,flowId:A,cancelConnection:S,panBy:D,isValidConnection:N,onConnect:z,onConnectStart:F,onConnectEnd:P,onReconnectEnd:L,updateConnection:$,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold})},x=v=>p(v,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),w=v=>p(v,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),E=()=>h(!0),g=()=>h(!1);return y.jsxs(y.Fragment,{children:[(e===!0||e==="source")&&y.jsx(di,{position:a,centerX:r,centerY:o,radius:t,onMouseDown:x,onMouseEnter:E,onMouseOut:g,type:"source"}),(e===!0||e==="target")&&y.jsx(di,{position:c,centerX:i,centerY:s,radius:t,onMouseDown:w,onMouseEnter:E,onMouseOut:g,type:"target"})]})}function Rg({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:r,onClick:o,onDoubleClick:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,reconnectRadius:l,onReconnect:f,onReconnectStart:d,onReconnectEnd:h,rfId:m,edgeTypes:p,noPanClassName:x,onError:w,disableKeyboardA11y:E}){let g=ee(G=>G.edgeLookup.get(e));const v=ee(G=>G.defaultEdgeOptions);g=v?{...v,...g}:g;let _=g.type||"default",C=(p==null?void 0:p[_])||ci[_];C===void 0&&(w==null||w("011",Oe.error011(_)),_="default",C=(p==null?void 0:p.default)||ci.default);const M=!!(g.focusable||t&&typeof g.focusable>"u"),N=typeof f<"u"&&(g.reconnectable||n&&typeof g.reconnectable>"u"),T=!!(g.selectable||r&&typeof g.selectable>"u"),O=b.useRef(null),[R,j]=b.useState(!1),[P,S]=b.useState(!1),I=oe(),{zIndex:A,sourceX:D,sourceY:$,targetX:k,targetY:L,sourcePosition:z,targetPosition:F}=ee(b.useCallback(G=>{const J=G.nodeLookup.get(g.source),Z=G.nodeLookup.get(g.target);if(!J||!Z)return{zIndex:g.zIndex,...li};const te=Cf({id:e,sourceNode:J,targetNode:Z,sourceHandle:g.sourceHandle||null,targetHandle:g.targetHandle||null,connectionMode:G.connectionMode,onError:w});return{zIndex:xf({selected:g.selected,zIndex:g.zIndex,sourceNode:J,targetNode:Z,elevateOnSelect:G.elevateEdgesOnSelect}),...te||li}},[g.source,g.target,g.sourceHandle,g.targetHandle,g.selected,g.zIndex]),ie),V=b.useMemo(()=>g.markerStart?`url('#${Ir(g.markerStart,m)}')`:void 0,[g.markerStart,m]),B=b.useMemo(()=>g.markerEnd?`url('#${Ir(g.markerEnd,m)}')`:void 0,[g.markerEnd,m]);if(g.hidden||D===null||$===null||k===null||L===null)return null;const W=G=>{var re;const{addSelectedEdges:J,unselectNodesAndEdges:Z,multiSelectionActive:te}=I.getState();T&&(I.setState({nodesSelectionActive:!1}),g.selected&&te?(Z({nodes:[],edges:[g]}),(re=O.current)==null||re.blur()):J([e])),o&&o(G,g)},X=i?G=>{i(G,{...g})}:void 0,U=s?G=>{s(G,{...g})}:void 0,H=a?G=>{a(G,{...g})}:void 0,q=c?G=>{c(G,{...g})}:void 0,Y=u?G=>{u(G,{...g})}:void 0,Q=G=>{var J;if(!E&&is.includes(G.key)&&T){const{unselectNodesAndEdges:Z,addSelectedEdges:te}=I.getState();G.key==="Escape"?((J=O.current)==null||J.blur(),Z({edges:[g]})):te([e])}};return y.jsx("svg",{style:{zIndex:A},children:y.jsxs("g",{className:ae(["react-flow__edge",`react-flow__edge-${_}`,g.className,x,{selected:g.selected,animated:g.animated,inactive:!T&&!o,updating:R,selectable:T}]),onClick:W,onDoubleClick:X,onContextMenu:U,onMouseEnter:H,onMouseMove:q,onMouseLeave:Y,onKeyDown:M?Q:void 0,tabIndex:M?0:void 0,role:g.ariaRole??(M?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":g.ariaLabel===null?void 0:g.ariaLabel||`Edge from ${g.source} to ${g.target}`,"aria-describedby":M?`${Ls}-${m}`:void 0,ref:O,...g.domAttributes,children:[!P&&y.jsx(C,{id:e,source:g.source,target:g.target,type:g.type,selected:g.selected,animated:g.animated,selectable:T,deletable:g.deletable??!0,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,sourceX:D,sourceY:$,targetX:k,targetY:L,sourcePosition:z,targetPosition:F,data:g.data,style:g.style,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerStart:V,markerEnd:B,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth}),N&&y.jsx(kg,{edge:g,isReconnectable:N,reconnectRadius:l,onReconnect:f,onReconnectStart:d,onReconnectEnd:h,sourceX:D,sourceY:$,targetX:k,targetY:L,sourcePosition:z,targetPosition:F,setUpdateHover:j,setReconnecting:S})]})})}const Tg=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function la({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:r,noPanClassName:o,onReconnect:i,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:u,onEdgeClick:l,reconnectRadius:f,onEdgeDoubleClick:d,onReconnectStart:h,onReconnectEnd:m,disableKeyboardA11y:p}){const{edgesFocusable:x,edgesReconnectable:w,elementsSelectable:E,onError:g}=ee(Tg,ie),v=xg(t);return y.jsxs("div",{className:"react-flow__edges",children:[y.jsx(_g,{defaultColor:e,rfId:n}),v.map(_=>y.jsx(Rg,{id:_,edgesFocusable:x,edgesReconnectable:w,elementsSelectable:E,noPanClassName:o,onReconnect:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,onClick:l,reconnectRadius:f,onDoubleClick:d,onReconnectStart:h,onReconnectEnd:m,rfId:n,onError:g,edgeTypes:r,disableKeyboardA11y:p},_))]})}la.displayName="EdgeRenderer";const Pg=b.memo(la),jg=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function $g({children:e}){const t=ee(jg);return y.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Lg(e){const t=eo(),n=b.useRef(!1);b.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const zg=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function Og(e){const t=ee(zg),n=oe();return b.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Fg(e){return e.connection.inProgress?{...e.connection,to:tn(e.connection.to,e.transform)}:{...e.connection}}function Bg(e){return Fg}function Hg(e){const t=Bg();return ee(t,ie)}const Vg=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Xg({containerStyle:e,style:t,type:n,component:r}){const{nodesConnectable:o,width:i,height:s,isValid:a,inProgress:c}=ee(Vg,ie);return!(i&&o&&c)?null:y.jsx("svg",{style:e,width:i,height:s,className:"react-flow__connectionline react-flow__container",children:y.jsx("g",{className:ae(["react-flow__connection",cs(a)]),children:y.jsx(ua,{style:t,type:n,CustomComponent:r,isValid:a})})})}const ua=({style:e,type:t=rt.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:o,from:i,fromNode:s,fromHandle:a,fromPosition:c,to:u,toNode:l,toHandle:f,toPosition:d}=Hg();if(!o)return;if(n)return y.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:s,fromHandle:a,fromX:i.x,fromY:i.y,toX:u.x,toY:u.y,fromPosition:c,toPosition:d,connectionStatus:cs(r),toNode:l,toHandle:f});let h="";const m={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:u.x,targetY:u.y,targetPosition:d};switch(t){case rt.Bezier:[h]=ws(m);break;case rt.SimpleBezier:[h]=Zs(m);break;case rt.Step:[h]=Dr({...m,borderRadius:0});break;case rt.SmoothStep:[h]=Dr(m);break;default:[h]=_s(m)}return y.jsx("path",{d:h,fill:"none",className:"react-flow__connection-path",style:e})};ua.displayName="ConnectionLine";const Yg={};function fi(e=Yg){b.useRef(e),oe(),b.useEffect(()=>{},[e])}function Wg(){oe(),b.useRef(!1),b.useEffect(()=>{},[])}function da({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:i,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:l,onSelectionContextMenu:f,onSelectionStart:d,onSelectionEnd:h,connectionLineType:m,connectionLineStyle:p,connectionLineComponent:x,connectionLineContainerStyle:w,selectionKeyCode:E,selectionOnDrag:g,selectionMode:v,multiSelectionKeyCode:_,panActivationKeyCode:C,zoomActivationKeyCode:M,deleteKeyCode:N,onlyRenderVisibleElements:T,elementsSelectable:O,defaultViewport:R,translateExtent:j,minZoom:P,maxZoom:S,preventScrolling:I,defaultMarkerColor:A,zoomOnScroll:D,zoomOnPinch:$,panOnScroll:k,panOnScrollSpeed:L,panOnScrollMode:z,zoomOnDoubleClick:F,panOnDrag:V,onPaneClick:B,onPaneMouseEnter:W,onPaneMouseMove:X,onPaneMouseLeave:U,onPaneScroll:H,onPaneContextMenu:q,paneClickDistance:Y,nodeClickDistance:Q,onEdgeContextMenu:G,onEdgeMouseEnter:J,onEdgeMouseMove:Z,onEdgeMouseLeave:te,reconnectRadius:re,onReconnect:Se,onReconnectStart:He,onReconnectEnd:Ke,noDragClassName:xe,noWheelClassName:Ve,noPanClassName:Te,disableKeyboardA11y:Ze,nodeExtent:mt,rfId:yt,viewport:Je,onViewportChange:_e}){return fi(e),fi(t),Wg(),Lg(n),Og(Je),y.jsx(lg,{onPaneClick:B,onPaneMouseEnter:W,onPaneMouseMove:X,onPaneMouseLeave:U,onPaneContextMenu:q,onPaneScroll:H,paneClickDistance:Y,deleteKeyCode:N,selectionKeyCode:E,selectionOnDrag:g,selectionMode:v,onSelectionStart:d,onSelectionEnd:h,multiSelectionKeyCode:_,panActivationKeyCode:C,zoomActivationKeyCode:M,elementsSelectable:O,zoomOnScroll:D,zoomOnPinch:$,zoomOnDoubleClick:F,panOnScroll:k,panOnScrollSpeed:L,panOnScrollMode:z,panOnDrag:V,defaultViewport:R,translateExtent:j,minZoom:P,maxZoom:S,onSelectionContextMenu:f,preventScrolling:I,noDragClassName:xe,noWheelClassName:Ve,noPanClassName:Te,disableKeyboardA11y:Ze,onViewportChange:_e,isControlledViewport:!!Je,children:y.jsxs($g,{children:[y.jsx(Pg,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:s,onReconnect:Se,onReconnectStart:He,onReconnectEnd:Ke,onlyRenderVisibleElements:T,onEdgeContextMenu:G,onEdgeMouseEnter:J,onEdgeMouseMove:Z,onEdgeMouseLeave:te,reconnectRadius:re,defaultMarkerColor:A,noPanClassName:Te,disableKeyboardA11y:Ze,rfId:yt}),y.jsx(Xg,{style:p,type:m,component:x,containerStyle:w}),y.jsx("div",{className:"react-flow__edgelabel-renderer"}),y.jsx(yg,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:l,nodeClickDistance:Q,onlyRenderVisibleElements:T,noPanClassName:Te,noDragClassName:xe,disableKeyboardA11y:Ze,nodeExtent:mt,rfId:yt}),y.jsx("div",{className:"react-flow__viewport-portal"})]})})}da.displayName="GraphView";const Ug=b.memo(da),hi=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c=.5,maxZoom:u=2,nodeOrigin:l,nodeExtent:f}={})=>{const d=new Map,h=new Map,m=new Map,p=new Map,x=r??t??[],w=n??e??[],E=l??[0,0],g=f??Xt;Cs(m,p,x);const v=kr(w,d,h,{nodeOrigin:E,nodeExtent:g,elevateNodesOnSelect:!1});let _=[0,0,1];if(s&&o&&i){const C=en(d,{filter:O=>!!((O.width||O.initialWidth)&&(O.height||O.initialHeight))}),{x:M,y:N,zoom:T}=qr(C,o,i,c,u,(a==null?void 0:a.padding)??.1);_=[M,N,T]}return{rfId:"1",width:0,height:0,transform:_,nodes:w,nodesInitialized:v,nodeLookup:d,parentLookup:h,edges:x,edgeLookup:p,connectionLookup:m,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:u,translateExtent:Xt,nodeExtent:g,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Mt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:E,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:a,fitViewResolver:null,connection:{...as},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:ff,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:ss}},qg=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:l,nodeExtent:f})=>gh((d,h)=>{async function m(){const{nodeLookup:p,panZoom:x,fitViewOptions:w,fitViewResolver:E,width:g,height:v,minZoom:_,maxZoom:C}=h();x&&(await uf({nodes:p,width:g,height:v,panZoom:x,minZoom:_,maxZoom:C},w),E==null||E.resolve(!0),d({fitViewResolver:null}))}return{...hi({nodes:e,edges:t,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:l,nodeExtent:f,defaultNodes:n,defaultEdges:r}),setNodes:p=>{const{nodeLookup:x,parentLookup:w,nodeOrigin:E,elevateNodesOnSelect:g,fitViewQueued:v}=h(),_=kr(p,x,w,{nodeOrigin:E,nodeExtent:f,elevateNodesOnSelect:g,checkEquality:!0});v&&_?(m(),d({nodes:p,nodesInitialized:_,fitViewQueued:!1,fitViewOptions:void 0})):d({nodes:p,nodesInitialized:_})},setEdges:p=>{const{connectionLookup:x,edgeLookup:w}=h();Cs(x,w,p),d({edges:p})},setDefaultNodesAndEdges:(p,x)=>{if(p){const{setNodes:w}=h();w(p),d({hasDefaultNodes:!0})}if(x){const{setEdges:w}=h();w(x),d({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:x,nodeLookup:w,parentLookup:E,domNode:g,nodeOrigin:v,nodeExtent:_,debug:C,fitViewQueued:M}=h(),{changes:N,updatedInternals:T}=kf(p,w,E,g,v,_);T&&(Af(w,E,{nodeOrigin:v,nodeExtent:_}),M?(m(),d({fitViewQueued:!1,fitViewOptions:void 0})):d({}),(N==null?void 0:N.length)>0&&(C&&console.log("React Flow: trigger node changes",N),x==null||x(N)))},updateNodePositions:(p,x=!1)=>{const w=[],E=[],{nodeLookup:g,triggerNodeChanges:v}=h();for(const[_,C]of p){const M=g.get(_),N=!!(M!=null&&M.expandParent&&(M!=null&&M.parentId)&&(C!=null&&C.position)),T={id:_,type:"position",position:N?{x:Math.max(0,C.position.x),y:Math.max(0,C.position.y)}:C.position,dragging:x};N&&M.parentId&&w.push({id:_,parentId:M.parentId,rect:{...C.internals.positionAbsolute,width:C.measured.width??0,height:C.measured.height??0}}),E.push(T)}if(w.length>0){const{parentLookup:_,nodeOrigin:C}=h(),M=Qr(w,g,_,C);E.push(...M)}v(E)},triggerNodeChanges:p=>{const{onNodesChange:x,setNodes:w,nodes:E,hasDefaultNodes:g,debug:v}=h();if(p!=null&&p.length){if(g){const _=Fs(p,E);w(_)}v&&console.log("React Flow: trigger node changes",p),x==null||x(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:x,setEdges:w,edges:E,hasDefaultEdges:g,debug:v}=h();if(p!=null&&p.length){if(g){const _=Bs(p,E);w(_)}v&&console.log("React Flow: trigger edge changes",p),x==null||x(p)}},addSelectedNodes:p=>{const{multiSelectionActive:x,edgeLookup:w,nodeLookup:E,triggerNodeChanges:g,triggerEdgeChanges:v}=h();if(x){const _=p.map(C=>dt(C,!0));g(_);return}g(bt(E,new Set([...p]),!0)),v(bt(w))},addSelectedEdges:p=>{const{multiSelectionActive:x,edgeLookup:w,nodeLookup:E,triggerNodeChanges:g,triggerEdgeChanges:v}=h();if(x){const _=p.map(C=>dt(C,!0));v(_);return}v(bt(w,new Set([...p]))),g(bt(E,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:x}={})=>{const{edges:w,nodes:E,nodeLookup:g,triggerNodeChanges:v,triggerEdgeChanges:_}=h(),C=p||E,M=x||w,N=C.map(O=>{const R=g.get(O.id);return R&&(R.selected=!1),dt(O.id,!1)}),T=M.map(O=>dt(O.id,!1));v(N),_(T)},setMinZoom:p=>{const{panZoom:x,maxZoom:w}=h();x==null||x.setScaleExtent([p,w]),d({minZoom:p})},setMaxZoom:p=>{const{panZoom:x,minZoom:w}=h();x==null||x.setScaleExtent([w,p]),d({maxZoom:p})},setTranslateExtent:p=>{var x;(x=h().panZoom)==null||x.setTranslateExtent(p),d({translateExtent:p})},setPaneClickDistance:p=>{var x;(x=h().panZoom)==null||x.setClickDistance(p)},resetSelectedElements:()=>{const{edges:p,nodes:x,triggerNodeChanges:w,triggerEdgeChanges:E,elementsSelectable:g}=h();if(!g)return;const v=x.reduce((C,M)=>M.selected?[...C,dt(M.id,!1)]:C,[]),_=p.reduce((C,M)=>M.selected?[...C,dt(M.id,!1)]:C,[]);w(v),E(_)},setNodeExtent:p=>{const{nodes:x,nodeLookup:w,parentLookup:E,nodeOrigin:g,elevateNodesOnSelect:v,nodeExtent:_}=h();p[0][0]===_[0][0]&&p[0][1]===_[0][1]&&p[1][0]===_[1][0]&&p[1][1]===_[1][1]||(kr(x,w,E,{nodeOrigin:g,nodeExtent:p,elevateNodesOnSelect:v,checkEquality:!1}),d({nodeExtent:p}))},panBy:p=>{const{transform:x,width:w,height:E,panZoom:g,translateExtent:v}=h();return Rf({delta:p,panZoom:g,transform:x,translateExtent:v,width:w,height:E})},setCenter:async(p,x,w)=>{const{width:E,height:g,maxZoom:v,panZoom:_}=h();if(!_)return Promise.resolve(!1);const C=typeof(w==null?void 0:w.zoom)<"u"?w.zoom:v;return await _.setViewport({x:E/2-p*C,y:g/2-x*C,zoom:C},{duration:w==null?void 0:w.duration,ease:w==null?void 0:w.ease,interpolate:w==null?void 0:w.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{d({connection:{...as}})},updateConnection:p=>{d({connection:p})},reset:()=>d({...hi()})}},Object.is);function Gg({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:r,initialWidth:o,initialHeight:i,initialMinZoom:s,initialMaxZoom:a,initialFitViewOptions:c,fitView:u,nodeOrigin:l,nodeExtent:f,children:d}){const[h]=b.useState(()=>qg({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:u,minZoom:s,maxZoom:a,fitViewOptions:c,nodeOrigin:l,nodeExtent:f}));return y.jsx(ph,{value:h,children:y.jsx(zh,{children:d})})}function Kg({children:e,nodes:t,edges:n,defaultNodes:r,defaultEdges:o,width:i,height:s,fitView:a,fitViewOptions:c,minZoom:u,maxZoom:l,nodeOrigin:f,nodeExtent:d}){return b.useContext(Xn)?y.jsx(y.Fragment,{children:e}):y.jsx(Gg,{initialNodes:t,initialEdges:n,defaultNodes:r,defaultEdges:o,initialWidth:i,initialHeight:s,fitView:a,initialFitViewOptions:c,initialMinZoom:u,initialMaxZoom:l,nodeOrigin:f,nodeExtent:d,children:e})}const Zg={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Jg({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:i,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:u,onMove:l,onMoveStart:f,onMoveEnd:d,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:x,onClickConnectEnd:w,onNodeMouseEnter:E,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:_,onNodeDoubleClick:C,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:T,onNodesDelete:O,onEdgesDelete:R,onDelete:j,onSelectionChange:P,onSelectionDragStart:S,onSelectionDrag:I,onSelectionDragStop:A,onSelectionContextMenu:D,onSelectionStart:$,onSelectionEnd:k,onBeforeDelete:L,connectionMode:z,connectionLineType:F=rt.Bezier,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:W,deleteKeyCode:X="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:H=!1,selectionMode:q=Yt.Full,panActivationKeyCode:Y="Space",multiSelectionKeyCode:Q=In()?"Meta":"Control",zoomActivationKeyCode:G=In()?"Meta":"Control",snapToGrid:J,snapGrid:Z,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:re,nodesDraggable:Se,autoPanOnNodeFocus:He,nodesConnectable:Ke,nodesFocusable:xe,nodeOrigin:Ve=zs,edgesFocusable:Te,edgesReconnectable:Ze,elementsSelectable:mt=!0,defaultViewport:yt=Ah,minZoom:Je=.5,maxZoom:_e=2,translateExtent:Xe=Xt,preventScrolling:at=!0,nodeExtent:xt,defaultMarkerColor:Pe="#b1b1b7",zoomOnScroll:sn=!0,zoomOnPinch:Zn=!0,panOnScroll:Jn=!1,panOnScrollSpeed:Pt=.5,panOnScrollMode:an=ft.Free,zoomOnDoubleClick:Qn=!0,panOnDrag:cn=!0,onPaneClick:er,onPaneMouseEnter:tr,onPaneMouseMove:nr,onPaneMouseLeave:ue,onPaneScroll:he,onPaneContextMenu:ge,paneClickDistance:Ne=0,nodeClickDistance:me=0,children:pe,onReconnect:Ee,onReconnectStart:Qe,onReconnectEnd:ce,onEdgeContextMenu:je,onEdgeDoubleClick:Ce,onEdgeMouseEnter:Ae,onEdgeMouseMove:ct,onEdgeMouseLeave:lt,reconnectRadius:$e=10,onNodesChange:ut,onEdgesChange:jt,noDragClassName:ja="nodrag",noWheelClassName:$a="nowheel",noPanClassName:fo="nopan",fitView:ho,fitViewOptions:go,connectOnClick:La,attributionPosition:za,proOptions:Oa,defaultEdgeOptions:Fa,elevateNodesOnSelect:Ba,elevateEdgesOnSelect:Ha,disableKeyboardA11y:po=!1,autoPanOnConnect:Va,autoPanOnNodeDrag:Xa,autoPanSpeed:Ya,connectionRadius:Wa,isValidConnection:Ua,onError:qa,style:Ga,id:mo,nodeDragThreshold:Ka,connectionDragThreshold:Za,viewport:Ja,onViewportChange:Qa,width:ec,height:tc,colorMode:nc="light",debug:rc,onScroll:ln,ariaLabelConfig:oc,...ic},sc){const rr=mo||"1",ac=Rh(nc),cc=b.useCallback(yo=>{yo.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),ln==null||ln(yo)},[ln]);return y.jsx("div",{"data-testid":"rf__wrapper",...ic,onScroll:cc,style:{...Ga,...Zg},ref:sc,className:ae(["react-flow",o,ac]),id:mo,role:"application",children:y.jsxs(Kg,{nodes:e,edges:t,width:ec,height:tc,fitView:ho,fitViewOptions:go,minZoom:Je,maxZoom:_e,nodeOrigin:Ve,nodeExtent:xt,children:[y.jsx(Ug,{onInit:u,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:E,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:_,onNodeDoubleClick:C,nodeTypes:i,edgeTypes:s,connectionLineType:F,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:W,selectionKeyCode:U,selectionOnDrag:H,selectionMode:q,deleteKeyCode:X,multiSelectionKeyCode:Q,panActivationKeyCode:Y,zoomActivationKeyCode:G,onlyRenderVisibleElements:te,defaultViewport:yt,translateExtent:Xe,minZoom:Je,maxZoom:_e,preventScrolling:at,zoomOnScroll:sn,zoomOnPinch:Zn,zoomOnDoubleClick:Qn,panOnScroll:Jn,panOnScrollSpeed:Pt,panOnScrollMode:an,panOnDrag:cn,onPaneClick:er,onPaneMouseEnter:tr,onPaneMouseMove:nr,onPaneMouseLeave:ue,onPaneScroll:he,onPaneContextMenu:ge,paneClickDistance:Ne,nodeClickDistance:me,onSelectionContextMenu:D,onSelectionStart:$,onSelectionEnd:k,onReconnect:Ee,onReconnectStart:Qe,onReconnectEnd:ce,onEdgeContextMenu:je,onEdgeDoubleClick:Ce,onEdgeMouseEnter:Ae,onEdgeMouseMove:ct,onEdgeMouseLeave:lt,reconnectRadius:$e,defaultMarkerColor:Pe,noDragClassName:ja,noWheelClassName:$a,noPanClassName:fo,rfId:rr,disableKeyboardA11y:po,nodeExtent:xt,viewport:Ja,onViewportChange:Qa}),y.jsx(kh,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:x,onClickConnectEnd:w,nodesDraggable:Se,autoPanOnNodeFocus:He,nodesConnectable:Ke,nodesFocusable:xe,edgesFocusable:Te,edgesReconnectable:Ze,elementsSelectable:mt,elevateNodesOnSelect:Ba,elevateEdgesOnSelect:Ha,minZoom:Je,maxZoom:_e,nodeExtent:xt,onNodesChange:ut,onEdgesChange:jt,snapToGrid:J,snapGrid:Z,connectionMode:z,translateExtent:Xe,connectOnClick:La,defaultEdgeOptions:Fa,fitView:ho,fitViewOptions:go,onNodesDelete:O,onEdgesDelete:R,onDelete:j,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:T,onSelectionDrag:I,onSelectionDragStart:S,onSelectionDragStop:A,onMove:l,onMoveStart:f,onMoveEnd:d,noPanClassName:fo,nodeOrigin:Ve,rfId:rr,autoPanOnConnect:Va,autoPanOnNodeDrag:Xa,autoPanSpeed:Ya,onError:qa,connectionRadius:Wa,isValidConnection:Ua,selectNodesOnDrag:re,nodeDragThreshold:Ka,connectionDragThreshold:Za,onBeforeDelete:L,paneClickDistance:Ne,debug:rc,ariaLabelConfig:oc}),y.jsx(Nh,{onSelectionChange:P}),pe,y.jsx(Sh,{proOptions:Oa,position:za}),y.jsx(bh,{rfId:rr,disableKeyboardA11y:po})]})})}var Qg=Hs(Jg);function ep({dimensions:e,lineWidth:t,variant:n,className:r}){return y.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:ae(["react-flow__background-pattern",n,r])})}function tp({radius:e,className:t}){return y.jsx("circle",{cx:e,cy:e,r:e,className:ae(["react-flow__background-pattern","dots",t])})}var it;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(it||(it={}));const np={[it.Dots]:1,[it.Lines]:1,[it.Cross]:6},rp=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function fa({id:e,variant:t=it.Dots,gap:n=20,size:r,lineWidth:o=1,offset:i=0,color:s,bgColor:a,style:c,className:u,patternClassName:l}){const f=b.useRef(null),{transform:d,patternId:h}=ee(rp,ie),m=r||np[t],p=t===it.Dots,x=t===it.Cross,w=Array.isArray(n)?n:[n,n],E=[w[0]*d[2]||1,w[1]*d[2]||1],g=m*d[2],v=Array.isArray(i)?i:[i,i],_=x?[g,g]:E,C=[v[0]*d[2]||1+_[0]/2,v[1]*d[2]||1+_[1]/2],M=`${h}${e||""}`;return y.jsxs("svg",{className:ae(["react-flow__background",u]),style:{...c,...Wn,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:f,"data-testid":"rf__background",children:[y.jsx("pattern",{id:M,x:d[0]%E[0],y:d[1]%E[1],width:E[0],height:E[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`,children:p?y.jsx(tp,{radius:g/2,className:l}):y.jsx(ep,{dimensions:_,lineWidth:o,variant:t,className:l})}),y.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${M})`})]})}fa.displayName="Background";const op=b.memo(fa);function ip(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:y.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function sp(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:y.jsx("path",{d:"M0 0h32v4.2H0z"})})}function ap(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:y.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function cp(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:y.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function lp(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:y.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function mn({children:e,className:t,...n}){return y.jsx("button",{type:"button",className:ae(["react-flow__controls-button",t]),...n,children:e})}const up=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function ha({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:i,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:u,children:l,position:f="bottom-left",orientation:d="vertical","aria-label":h}){const m=oe(),{isInteractive:p,minZoomReached:x,maxZoomReached:w,ariaLabelConfig:E}=ee(up,ie),{zoomIn:g,zoomOut:v,fitView:_}=eo(),C=()=>{g(),i==null||i()},M=()=>{v(),s==null||s()},N=()=>{_(o),a==null||a()},T=()=>{m.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),c==null||c(!p)},O=d==="horizontal"?"horizontal":"vertical";return y.jsxs(Yn,{className:ae(["react-flow__controls",O,u]),position:f,style:e,"data-testid":"rf__controls","aria-label":h??E["controls.ariaLabel"],children:[t&&y.jsxs(y.Fragment,{children:[y.jsx(mn,{onClick:C,className:"react-flow__controls-zoomin",title:E["controls.zoomIn.ariaLabel"],"aria-label":E["controls.zoomIn.ariaLabel"],disabled:w,children:y.jsx(ip,{})}),y.jsx(mn,{onClick:M,className:"react-flow__controls-zoomout",title:E["controls.zoomOut.ariaLabel"],"aria-label":E["controls.zoomOut.ariaLabel"],disabled:x,children:y.jsx(sp,{})})]}),n&&y.jsx(mn,{className:"react-flow__controls-fitview",onClick:N,title:E["controls.fitView.ariaLabel"],"aria-label":E["controls.fitView.ariaLabel"],children:y.jsx(ap,{})}),r&&y.jsx(mn,{className:"react-flow__controls-interactive",onClick:T,title:E["controls.interactive.ariaLabel"],"aria-label":E["controls.interactive.ariaLabel"],children:p?y.jsx(lp,{}):y.jsx(cp,{})}),l]})}ha.displayName="Controls";const dp=b.memo(ha);function fp({id:e,x:t,y:n,width:r,height:o,style:i,color:s,strokeColor:a,strokeWidth:c,className:u,borderRadius:l,shapeRendering:f,selected:d,onClick:h}){const{background:m,backgroundColor:p}=i||{},x=s||m||p;return y.jsx("rect",{className:ae(["react-flow__minimap-node",{selected:d},u]),x:t,y:n,rx:l,ry:l,width:r,height:o,style:{fill:x,stroke:a,strokeWidth:c},shapeRendering:f,onClick:h?w=>h(w,e):void 0})}const hp=b.memo(fp),gp=e=>e.nodes.map(t=>t.id),mr=e=>e instanceof Function?e:()=>e;function pp({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:i=hp,onClick:s}){const a=ee(gp,ie),c=mr(t),u=mr(e),l=mr(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return y.jsx(y.Fragment,{children:a.map(d=>y.jsx(yp,{id:d,nodeColorFunc:c,nodeStrokeColorFunc:u,nodeClassNameFunc:l,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:i,onClick:s,shapeRendering:f},d))})}function mp({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:i,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:u,x:l,y:f,width:d,height:h}=ee(m=>{const{internals:p}=m.nodeLookup.get(e),x=p.userNode,{x:w,y:E}=p.positionAbsolute,{width:g,height:v}=Ge(x);return{node:x,x:w,y:E,width:g,height:v}},ie);return!u||u.hidden||!gs(u)?null:y.jsx(a,{x:l,y:f,width:d,height:h,style:u.style,selected:!!u.selected,className:r(u),color:t(u),borderRadius:o,strokeColor:n(u),strokeWidth:i,shapeRendering:s,onClick:c,id:u.id})}const yp=b.memo(mp);var xp=b.memo(pp);const vp=200,wp=150,bp=e=>!e.hidden,Sp=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?hs(en(e.nodeLookup,{filter:bp}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},_p="react-flow__minimap-desc";function ga({style:e,className:t,nodeStrokeColor:n,nodeColor:r,nodeClassName:o="",nodeBorderRadius:i=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:u,maskStrokeColor:l,maskStrokeWidth:f,position:d="bottom-right",onClick:h,onNodeClick:m,pannable:p=!1,zoomable:x=!1,ariaLabel:w,inversePan:E,zoomStep:g=10,offsetScale:v=5}){const _=oe(),C=b.useRef(null),{boundingRect:M,viewBB:N,rfId:T,panZoom:O,translateExtent:R,flowWidth:j,flowHeight:P,ariaLabelConfig:S}=ee(Sp,ie),I=(e==null?void 0:e.width)??vp,A=(e==null?void 0:e.height)??wp,D=M.width/I,$=M.height/A,k=Math.max(D,$),L=k*I,z=k*A,F=v*k,V=M.x-(L-M.width)/2-F,B=M.y-(z-M.height)/2-F,W=L+F*2,X=z+F*2,U=`${_p}-${T}`,H=b.useRef(0),q=b.useRef();H.current=k,b.useEffect(()=>{if(C.current&&O)return q.current=Ff({domNode:C.current,panZoom:O,getTransform:()=>_.getState().transform,getViewScale:()=>H.current}),()=>{var J;(J=q.current)==null||J.destroy()}},[O]),b.useEffect(()=>{var J;(J=q.current)==null||J.update({translateExtent:R,width:j,height:P,inversePan:E,pannable:p,zoomStep:g,zoomable:x})},[p,x,E,g,R,j,P]);const Y=h?J=>{var re;const[Z,te]=((re=q.current)==null?void 0:re.pointer(J))||[0,0];h(J,{x:Z,y:te})}:void 0,Q=m?b.useCallback((J,Z)=>{const te=_.getState().nodeLookup.get(Z).internals.userNode;m(J,te)},[]):void 0,G=w??S["minimap.ariaLabel"];return y.jsx(Yn,{position:d,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*k:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="number"?s:void 0},className:ae(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:y.jsxs("svg",{width:I,height:A,viewBox:`${V} ${B} ${W} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":U,ref:C,onClick:Y,children:[G&&y.jsx("title",{id:U,children:G}),y.jsx(xp,{onClick:Q,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:o,nodeStrokeWidth:s,nodeComponent:a}),y.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-F},${B-F}h${W+F*2}v${X+F*2}h${-W-F*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ga.displayName="MiniMap";const Ep=b.memo(ga),Cp=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Mp={[It.Line]:"right",[It.Handle]:"bottom-right"};function Np({nodeId:e,position:t,variant:n=It.Handle,className:r,style:o=void 0,children:i,color:s,minWidth:a=10,minHeight:c=10,maxWidth:u=Number.MAX_VALUE,maxHeight:l=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:d,autoScale:h=!0,shouldResize:m,onResizeStart:p,onResize:x,onResizeEnd:w}){const E=Ws(),g=typeof e=="string"?e:E,v=oe(),_=b.useRef(null),C=n===It.Handle,M=ee(b.useCallback(Cp(C&&h),[C,h]),ie),N=b.useRef(null),T=t??Mp[n];b.useEffect(()=>{if(!(!_.current||!g))return N.current||(N.current=nh({domNode:_.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:R,transform:j,snapGrid:P,snapToGrid:S,nodeOrigin:I,domNode:A}=v.getState();return{nodeLookup:R,transform:j,snapGrid:P,snapToGrid:S,nodeOrigin:I,paneDomNode:A}},onChange:(R,j)=>{const{triggerNodeChanges:P,nodeLookup:S,parentLookup:I,nodeOrigin:A}=v.getState(),D=[],$={x:R.x,y:R.y},k=S.get(g);if(k&&k.expandParent&&k.parentId){const L=k.origin??A,z=R.width??k.measured.width??0,F=R.height??k.measured.height??0,V={id:k.id,parentId:k.parentId,rect:{width:z,height:F,...ps({x:R.x??k.position.x,y:R.y??k.position.y},{width:z,height:F},k.parentId,S,L)}},B=Qr([V],S,I,A);D.push(...B),$.x=R.x?Math.max(L[0]*z,R.x):void 0,$.y=R.y?Math.max(L[1]*F,R.y):void 0}if($.x!==void 0&&$.y!==void 0){const L={id:g,type:"position",position:{...$}};D.push(L)}if(R.width!==void 0&&R.height!==void 0){const z={id:g,type:"dimensions",resizing:!0,setAttributes:d?d==="horizontal"?"width":"height":!0,dimensions:{width:R.width,height:R.height}};D.push(z)}for(const L of j){const z={...L,type:"position"};D.push(z)}P(D)},onEnd:({width:R,height:j})=>{const P={id:g,type:"dimensions",resizing:!1,dimensions:{width:R,height:j}};v.getState().triggerNodeChanges([P])}})),N.current.update({controlPosition:T,boundaries:{minWidth:a,minHeight:c,maxWidth:u,maxHeight:l},keepAspectRatio:f,resizeDirection:d,onResizeStart:p,onResize:x,onResizeEnd:w,shouldResize:m}),()=>{var R;(R=N.current)==null||R.destroy()}},[T,a,c,u,l,f,p,x,w,m]);const O=T.split("-");return y.jsx("div",{className:ae(["react-flow__resize-control","nodrag",...O,n,r]),ref:_,style:{...o,scale:M,...s&&{[C?"backgroundColor":"borderColor"]:s}},children:i})}b.memo(Np);const yr={width:10,height:10,bottom:-5};b.memo(({data:e,isConnectable:t})=>y.jsx(y.Fragment,{children:y.jsxs("div",{style:{padding:25},children:[y.jsx("div",{children:"Node"}),y.jsx(Ue,{type:"source",id:"red",position:K.Bottom,style:{...yr,left:"15%",background:"red"},onConnect:n=>console.log("handle onConnect",n),isConnectable:t}),y.jsx(Ue,{type:"source",position:K.Bottom,id:"blue",style:{...yr,left:"50%",background:"blue"},isConnectable:t}),y.jsx(Ue,{type:"target",position:K.Bottom,id:"orange",style:{...yr,left:"85%",background:"orange"},isConnectable:t})]})}));const Ap={custom:Ip};function Dp({initialNodes:e,initialEdges:t,component:n}){const{messageApi:r}=st(),[o,i]=b.useState(e),[s,a]=b.useState(t);b.useEffect(()=>{i(e)},[e]);const c=b.useCallback(d=>i(h=>Fs(d,h)),[]),u=b.useCallback(d=>a(h=>Bs(d,h)),[]),l=b.useCallback(d=>a(h=>Ss(d,h)),[]),f=async()=>{const d=o.map(p=>({component_id:p.id,position:p.position})),h={position:JSON.stringify(d),edges:JSON.stringify(s),component_id:n.component_id},m=await vc(h);console.log(m),r.success("保存成功")};return y.jsx(Ti,{title:"流程图",extra:y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:f,children:"保存"}),bodyStyle:{padding:0},children:y.jsx("div",{style:{height:"40vh"},children:y.jsxs(Qg,{nodes:o,edges:s,nodeTypes:Ap,onNodesChange:c,onEdgesChange:u,onConnect:l,fitView:!0,children:[y.jsx(dp,{}),y.jsx(Ep,{}),y.jsx(op,{gap:12,size:1})]})})})}function Ip({data:e}){const t=e.inputs||[],n=e.outputs||[];return y.jsxs("div",{style:{background:e.color||"#1976d2",color:"white",padding:10,borderRadius:12,minWidth:150,position:"relative"},children:[y.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:e.label}),t.map((r,o)=>y.jsx(xo,{content:y.jsx("div",{children:r.component_name}),children:y.jsx(Ue,{type:"target",position:K.Left,id:r.component_id,style:{top:30+o*20,background:"#555"}},r.component_id)})),n.map((r,o)=>y.jsx(xo,{content:y.jsx("div",{children:r.component_name}),children:y.jsx(Ue,{type:"source",position:K.Right,id:r.component_id,style:{top:30+o*20,background:"#888"}},r.component_id)}))]})}function kp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const qn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function kt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function no(e){return"nodeType"in e}function ye(e){var t,n;return e?kt(e)?e:no(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function ro(e){const{Document:t}=ye(e);return e instanceof t}function nn(e){return kt(e)?!1:e instanceof ye(e).HTMLElement}function pa(e){return e instanceof ye(e).SVGElement}function Rt(e){return e?kt(e)?e.document:no(e)?ro(e)?e:nn(e)||pa(e)?e.ownerDocument:document:document:document}const Fe=qn?b.useLayoutEffect:b.useEffect;function oo(e){const t=b.useRef(e);return Fe(()=>{t.current=e}),b.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function Rp(){const e=b.useRef(null),t=b.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=b.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Gt(e,t){t===void 0&&(t=[e]);const n=b.useRef(e);return Fe(()=>{n.current!==e&&(n.current=e)},t),n}function rn(e,t){const n=b.useRef();return b.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Rn(e){const t=oo(e),n=b.useRef(null),r=b.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function Pr(e){const t=b.useRef();return b.useEffect(()=>{t.current=e},[e]),t.current}let xr={};function on(e,t){return b.useMemo(()=>{if(t)return t;const n=xr[e]==null?0:xr[e]+1;return xr[e]=n,e+"-"+n},[e,t])}function ma(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((i,s)=>{const a=Object.entries(s);for(const[c,u]of a){const l=i[c];l!=null&&(i[c]=l+e*u)}return i},{...t})}}const Et=ma(1),Tn=ma(-1);function Tp(e){return"clientX"in e&&"clientY"in e}function io(e){if(!e)return!1;const{KeyboardEvent:t}=ye(e.target);return t&&e instanceof t}function Pp(e){if(!e)return!1;const{TouchEvent:t}=ye(e.target);return t&&e instanceof t}function jr(e){if(Pp(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Tp(e)?{x:e.clientX,y:e.clientY}:null}const Kt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Kt.Translate.toString(e),Kt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),gi="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function jp(e){return e.matches(gi)?e:e.querySelector(gi)}const $p={display:"none"};function Lp(e){let{id:t,value:n}=e;return fe.createElement("div",{id:t,style:$p},n)}function zp(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return fe.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function Op(){const[e,t]=b.useState("");return{announce:b.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const ya=b.createContext(null);function Fp(e){const t=b.useContext(ya);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Bp(){const[e]=b.useState(()=>new Set),t=b.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[b.useCallback(r=>{let{type:o,event:i}=r;e.forEach(s=>{var a;return(a=s[o])==null?void 0:a.call(s,i)})},[e]),t]}const Hp={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Vp={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Xp(e){let{announcements:t=Vp,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=Hp}=e;const{announce:i,announcement:s}=Op(),a=on("DndLiveRegion"),[c,u]=b.useState(!1);if(b.useEffect(()=>{u(!0)},[]),Fp(b.useMemo(()=>({onDragStart(f){let{active:d}=f;i(t.onDragStart({active:d}))},onDragMove(f){let{active:d,over:h}=f;t.onDragMove&&i(t.onDragMove({active:d,over:h}))},onDragOver(f){let{active:d,over:h}=f;i(t.onDragOver({active:d,over:h}))},onDragEnd(f){let{active:d,over:h}=f;i(t.onDragEnd({active:d,over:h}))},onDragCancel(f){let{active:d,over:h}=f;i(t.onDragCancel({active:d,over:h}))}}),[i,t])),!c)return null;const l=fe.createElement(fe.Fragment,null,fe.createElement(Lp,{id:r,value:o.draggable}),fe.createElement(zp,{id:a,announcement:s}));return n?Lt.createPortal(l,n):l}var le;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(le||(le={}));function Pn(){}function Yp(e,t){return b.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Wp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const ke=Object.freeze({x:0,y:0});function Up(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function qp(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Gp(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),s=o-r,a=i-n;if(r<o&&n<i){const c=t.width*t.height,u=e.width*e.height,l=s*a,f=l/(c+u-l);return Number(f.toFixed(4))}return 0}const Kp=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const i of r){const{id:s}=i,a=n.get(s);if(a){const c=Gp(a,t);c>0&&o.push({id:s,data:{droppableContainer:i,value:c}})}}return o.sort(Up)};function Zp(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function xa(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ke}function Jp(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o.reduce((s,a)=>({...s,top:s.top+e*a.y,bottom:s.bottom+e*a.y,left:s.left+e*a.x,right:s.right+e*a.x}),{...n})}}const Qp=Jp(1);function em(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function tm(e,t,n){const r=em(t);if(!r)return e;const{scaleX:o,scaleY:i,x:s,y:a}=r,c=e.left-s-(1-o)*parseFloat(n),u=e.top-a-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),l=o?e.width/o:e.width,f=i?e.height/i:e.height;return{width:l,height:f,top:u,right:c+l,bottom:u+f,left:c}}const nm={ignoreTransform:!1};function Tt(e,t){t===void 0&&(t=nm);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:l}=ye(e).getComputedStyle(e);u&&(n=tm(n,u,l))}const{top:r,left:o,width:i,height:s,bottom:a,right:c}=n;return{top:r,left:o,width:i,height:s,bottom:a,right:c}}function pi(e){return Tt(e,{ignoreTransform:!0})}function rm(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function om(e,t){return t===void 0&&(t=ye(e).getComputedStyle(e)),t.position==="fixed"}function im(e,t){t===void 0&&(t=ye(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const i=t[o];return typeof i=="string"?n.test(i):!1})}function so(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(ro(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!nn(o)||pa(o)||n.includes(o))return n;const i=ye(e).getComputedStyle(o);return o!==e&&im(o,i)&&n.push(o),om(o,i)?n:r(o.parentNode)}return e?r(e):n}function va(e){const[t]=so(e,1);return t??null}function vr(e){return!qn||!e?null:kt(e)?e:no(e)?ro(e)||e===Rt(e).scrollingElement?window:nn(e)?e:null:null}function wa(e){return kt(e)?e.scrollX:e.scrollLeft}function ba(e){return kt(e)?e.scrollY:e.scrollTop}function $r(e){return{x:wa(e),y:ba(e)}}var de;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(de||(de={}));function Sa(e){return!qn||!e?!1:e===document.scrollingElement}function _a(e){const t={x:0,y:0},n=Sa(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,s=e.scrollTop>=r.y,a=e.scrollLeft>=r.x;return{isTop:o,isLeft:i,isBottom:s,isRight:a,maxScroll:r,minScroll:t}}const sm={x:.2,y:.2};function am(e,t,n,r,o){let{top:i,left:s,right:a,bottom:c}=n;r===void 0&&(r=10),o===void 0&&(o=sm);const{isTop:u,isBottom:l,isLeft:f,isRight:d}=_a(e),h={x:0,y:0},m={x:0,y:0},p={height:t.height*o.y,width:t.width*o.x};return!u&&i<=t.top+p.height?(h.y=de.Backward,m.y=r*Math.abs((t.top+p.height-i)/p.height)):!l&&c>=t.bottom-p.height&&(h.y=de.Forward,m.y=r*Math.abs((t.bottom-p.height-c)/p.height)),!d&&a>=t.right-p.width?(h.x=de.Forward,m.x=r*Math.abs((t.right-p.width-a)/p.width)):!f&&s<=t.left+p.width&&(h.x=de.Backward,m.x=r*Math.abs((t.left+p.width-s)/p.width)),{direction:h,speed:m}}function cm(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:s}=window;return{top:0,left:0,right:i,bottom:s,width:i,height:s}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Ea(e){return e.reduce((t,n)=>Et(t,$r(n)),ke)}function lm(e){return e.reduce((t,n)=>t+wa(n),0)}function um(e){return e.reduce((t,n)=>t+ba(n),0)}function dm(e,t){if(t===void 0&&(t=Tt),!e)return;const{top:n,left:r,bottom:o,right:i}=t(e);va(e)&&(o<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const fm=[["x",["left","right"],lm],["y",["top","bottom"],um]];class ao{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=so(n),o=Ea(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,s,a]of fm)for(const c of s)Object.defineProperty(this,c,{get:()=>{const u=a(r),l=o[i]-u;return this.rect[c]+l},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ft{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function hm(e){const{EventTarget:t}=ye(e);return e instanceof t?e:Rt(e)}function wr(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var Me;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Me||(Me={}));function mi(e){e.preventDefault()}function gm(e){e.stopPropagation()}var ne;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ne||(ne={}));const Ca={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},pm=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class Ma{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ft(Rt(n)),this.windowListeners=new Ft(ye(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Me.Resize,this.handleCancel),this.windowListeners.add(Me.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Me.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&dm(r),n(ke)}handleKeyDown(t){if(io(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:i=Ca,coordinateGetter:s=pm,scrollBehavior:a="smooth"}=o,{code:c}=t;if(i.end.includes(c)){this.handleEnd(t);return}if(i.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:u}=r.current,l=u?{x:u.left,y:u.top}:ke;this.referenceCoordinates||(this.referenceCoordinates=l);const f=s(t,{active:n,context:r.current,currentCoordinates:l});if(f){const d=Tn(f,l),h={x:0,y:0},{scrollableAncestors:m}=r.current;for(const p of m){const x=t.code,{isTop:w,isRight:E,isLeft:g,isBottom:v,maxScroll:_,minScroll:C}=_a(p),M=cm(p),N={x:Math.min(x===ne.Right?M.right-M.width/2:M.right,Math.max(x===ne.Right?M.left:M.left+M.width/2,f.x)),y:Math.min(x===ne.Down?M.bottom-M.height/2:M.bottom,Math.max(x===ne.Down?M.top:M.top+M.height/2,f.y))},T=x===ne.Right&&!E||x===ne.Left&&!g,O=x===ne.Down&&!v||x===ne.Up&&!w;if(T&&N.x!==f.x){const R=p.scrollLeft+d.x,j=x===ne.Right&&R<=_.x||x===ne.Left&&R>=C.x;if(j&&!d.y){p.scrollTo({left:R,behavior:a});return}j?h.x=p.scrollLeft-R:h.x=x===ne.Right?p.scrollLeft-_.x:p.scrollLeft-C.x,h.x&&p.scrollBy({left:-h.x,behavior:a});break}else if(O&&N.y!==f.y){const R=p.scrollTop+d.y,j=x===ne.Down&&R<=_.y||x===ne.Up&&R>=C.y;if(j&&!d.x){p.scrollTo({top:R,behavior:a});return}j?h.y=p.scrollTop-R:h.y=x===ne.Down?p.scrollTop-_.y:p.scrollTop-C.y,h.y&&p.scrollBy({top:-h.y,behavior:a});break}}this.handleMove(t,Et(Tn(f,this.referenceCoordinates),h))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ma.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Ca,onActivation:o}=t,{active:i}=n;const{code:s}=e.nativeEvent;if(r.start.includes(s)){const a=i.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function yi(e){return!!(e&&"distance"in e)}function xi(e){return!!(e&&"delay"in e)}class co{constructor(t,n,r){var o;r===void 0&&(r=hm(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:s}=i;this.props=t,this.events=n,this.document=Rt(s),this.documentListeners=new Ft(this.document),this.listeners=new Ft(r),this.windowListeners=new Ft(ye(s)),this.initialCoordinates=(o=jr(i))!=null?o:ke,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Me.Resize,this.handleCancel),this.windowListeners.add(Me.DragStart,mi),this.windowListeners.add(Me.VisibilityChange,this.handleCancel),this.windowListeners.add(Me.ContextMenu,mi),this.documentListeners.add(Me.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(xi(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(yi(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Me.Click,gm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Me.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:i}=this,{onMove:s,options:{activationConstraint:a}}=i;if(!o)return;const c=(n=jr(t))!=null?n:ke,u=Tn(o,c);if(!r&&a){if(yi(a)){if(a.tolerance!=null&&wr(u,a.tolerance))return this.handleCancel();if(wr(u,a.distance))return this.handleStart()}if(xi(a)&&wr(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}t.cancelable&&t.preventDefault(),s(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const mm={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class lo extends co{constructor(t){const{event:n}=t,r=Rt(n.target);super(t,mm,r)}}lo.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const ym={move:{name:"mousemove"},end:{name:"mouseup"}};var Lr;(function(e){e[e.RightClick=2]="RightClick"})(Lr||(Lr={}));class xm extends co{constructor(t){super(t,ym,Rt(t.event.target))}}xm.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===Lr.RightClick?!1:(r==null||r({event:n}),!0)}}];const br={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class vm extends co{constructor(t){super(t,br)}static setup(){return window.addEventListener(br.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(br.move.name,t)};function t(){}}}vm.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var Bt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Bt||(Bt={}));var jn;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(jn||(jn={}));function wm(e){let{acceleration:t,activator:n=Bt.Pointer,canScroll:r,draggingRect:o,enabled:i,interval:s=5,order:a=jn.TreeOrder,pointerCoordinates:c,scrollableAncestors:u,scrollableAncestorRects:l,delta:f,threshold:d}=e;const h=Sm({delta:f,disabled:!i}),[m,p]=Rp(),x=b.useRef({x:0,y:0}),w=b.useRef({x:0,y:0}),E=b.useMemo(()=>{switch(n){case Bt.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Bt.DraggableRect:return o}},[n,o,c]),g=b.useRef(null),v=b.useCallback(()=>{const C=g.current;if(!C)return;const M=x.current.x*w.current.x,N=x.current.y*w.current.y;C.scrollBy(M,N)},[]),_=b.useMemo(()=>a===jn.TreeOrder?[...u].reverse():u,[a,u]);b.useEffect(()=>{if(!i||!u.length||!E){p();return}for(const C of _){if((r==null?void 0:r(C))===!1)continue;const M=u.indexOf(C),N=l[M];if(!N)continue;const{direction:T,speed:O}=am(C,N,E,t,d);for(const R of["x","y"])h[R][T[R]]||(O[R]=0,T[R]=0);if(O.x>0||O.y>0){p(),g.current=C,m(v,s),x.current=O,w.current=T;return}}x.current={x:0,y:0},w.current={x:0,y:0},p()},[t,v,r,p,i,s,JSON.stringify(E),JSON.stringify(h),m,u,_,l,JSON.stringify(d)])}const bm={x:{[de.Backward]:!1,[de.Forward]:!1},y:{[de.Backward]:!1,[de.Forward]:!1}};function Sm(e){let{delta:t,disabled:n}=e;const r=Pr(t);return rn(o=>{if(n||!r||!o)return bm;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[de.Backward]:o.x[de.Backward]||i.x===-1,[de.Forward]:o.x[de.Forward]||i.x===1},y:{[de.Backward]:o.y[de.Backward]||i.y===-1,[de.Forward]:o.y[de.Forward]||i.y===1}}},[n,t,r])}function _m(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return rn(o=>{var i;return t==null?null:(i=r??o)!=null?i:null},[r,t])}function Em(e,t){return b.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,i=o.activators.map(s=>({eventName:s.eventName,handler:t(s.handler,r)}));return[...n,...i]},[]),[e,t])}var Zt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Zt||(Zt={}));var zr;(function(e){e.Optimized="optimized"})(zr||(zr={}));const vi=new Map;function Cm(e,t){let{dragging:n,dependencies:r,config:o}=t;const[i,s]=b.useState(null),{frequency:a,measure:c,strategy:u}=o,l=b.useRef(e),f=x(),d=Gt(f),h=b.useCallback(function(w){w===void 0&&(w=[]),!d.current&&s(E=>E===null?w:E.concat(w.filter(g=>!E.includes(g))))},[d]),m=b.useRef(null),p=rn(w=>{if(f&&!n)return vi;if(!w||w===vi||l.current!==e||i!=null){const E=new Map;for(let g of e){if(!g)continue;if(i&&i.length>0&&!i.includes(g.id)&&g.rect.current){E.set(g.id,g.rect.current);continue}const v=g.node.current,_=v?new ao(c(v),v):null;g.rect.current=_,_&&E.set(g.id,_)}return E}return w},[e,i,n,f,c]);return b.useEffect(()=>{l.current=e},[e]),b.useEffect(()=>{f||h()},[n,f]),b.useEffect(()=>{i&&i.length>0&&s(null)},[JSON.stringify(i)]),b.useEffect(()=>{f||typeof a!="number"||m.current!==null||(m.current=setTimeout(()=>{h(),m.current=null},a))},[a,f,h,...r]),{droppableRects:p,measureDroppableContainers:h,measuringScheduled:i!=null};function x(){switch(u){case Zt.Always:return!1;case Zt.BeforeDragging:return n;default:return!n}}}function Na(e,t){return rn(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Mm(e,t){return Na(e,t)}function Nm(e){let{callback:t,disabled:n}=e;const r=oo(t),o=b.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return b.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function Gn(e){let{callback:t,disabled:n}=e;const r=oo(t),o=b.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return b.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function Am(e){return new ao(Tt(e),e)}function wi(e,t,n){t===void 0&&(t=Am);const[r,o]=b.useState(null);function i(){o(c=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=c??n)!=null?u:null}const l=t(e);return JSON.stringify(c)===JSON.stringify(l)?c:l})}const s=Nm({callback(c){if(e)for(const u of c){const{type:l,target:f}=u;if(l==="childList"&&f instanceof HTMLElement&&f.contains(e)){i();break}}}}),a=Gn({callback:i});return Fe(()=>{i(),e?(a==null||a.observe(e),s==null||s.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),s==null||s.disconnect())},[e]),r}function Dm(e){const t=Na(e);return xa(e,t)}const bi=[];function Im(e){const t=b.useRef(e),n=rn(r=>e?r&&r!==bi&&e&&t.current&&e.parentNode===t.current.parentNode?r:so(e):bi,[e]);return b.useEffect(()=>{t.current=e},[e]),n}function km(e){const[t,n]=b.useState(null),r=b.useRef(e),o=b.useCallback(i=>{const s=vr(i.target);s&&n(a=>a?(a.set(s,$r(s)),new Map(a)):null)},[]);return b.useEffect(()=>{const i=r.current;if(e!==i){s(i);const a=e.map(c=>{const u=vr(c);return u?(u.addEventListener("scroll",o,{passive:!0}),[u,$r(u)]):null}).filter(c=>c!=null);n(a.length?new Map(a):null),r.current=e}return()=>{s(e),s(i)};function s(a){a.forEach(c=>{const u=vr(c);u==null||u.removeEventListener("scroll",o)})}},[o,e]),b.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,s)=>Et(i,s),ke):Ea(e):ke,[e,t])}function Si(e,t){t===void 0&&(t=[]);const n=b.useRef(null);return b.useEffect(()=>{n.current=null},t),b.useEffect(()=>{const r=e!==ke;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Tn(e,n.current):ke}function Rm(e){b.useEffect(()=>{if(!qn)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Tm(e,t){return b.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:i}=r;return n[o]=s=>{i(s,t)},n},{}),[e,t])}function Aa(e){return b.useMemo(()=>e?rm(e):null,[e])}const _i=[];function Pm(e,t){t===void 0&&(t=Tt);const[n]=e,r=Aa(n?ye(n):null),[o,i]=b.useState(_i);function s(){i(()=>e.length?e.map(c=>Sa(c)?r:new ao(t(c),c)):_i)}const a=Gn({callback:s});return Fe(()=>{a==null||a.disconnect(),s(),e.forEach(c=>a==null?void 0:a.observe(c))},[e]),o}function jm(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return nn(t)?t:e}function $m(e){let{measure:t}=e;const[n,r]=b.useState(null),o=b.useCallback(u=>{for(const{target:l}of u)if(nn(l)){r(f=>{const d=t(l);return f?{...f,width:d.width,height:d.height}:d});break}},[t]),i=Gn({callback:o}),s=b.useCallback(u=>{const l=jm(u);i==null||i.disconnect(),l&&(i==null||i.observe(l)),r(l?t(l):null)},[t,i]),[a,c]=Rn(s);return b.useMemo(()=>({nodeRef:a,rect:n,setRef:c}),[n,a,c])}const Lm=[{sensor:lo,options:{}},{sensor:Ma,options:{}}],zm={current:{}},_n={draggable:{measure:pi},droppable:{measure:pi,strategy:Zt.WhileDragging,frequency:zr.Optimized},dragOverlay:{measure:Tt}};class Ht extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Om={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ht,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Pn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:_n,measureDroppableContainers:Pn,windowRect:null,measuringScheduled:!1},Fm={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Pn,draggableNodes:new Map,over:null,measureDroppableContainers:Pn},Kn=b.createContext(Fm),Da=b.createContext(Om);function Bm(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ht}}}function Hm(e,t){switch(t.type){case le.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case le.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case le.DragEnd:case le.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case le.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new Ht(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case le.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const s=new Ht(e.droppable.containers);return s.set(n,{...i,disabled:o}),{...e,droppable:{...e.droppable,containers:s}}}case le.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new Ht(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function Vm(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=b.useContext(Kn),i=Pr(r),s=Pr(n==null?void 0:n.id);return b.useEffect(()=>{if(!t&&!r&&i&&s!=null){if(!io(i)||document.activeElement===i.target)return;const a=o.get(s);if(!a)return;const{activatorNode:c,node:u}=a;if(!c.current&&!u.current)return;requestAnimationFrame(()=>{for(const l of[c.current,u.current]){if(!l)continue;const f=jp(l);if(f){f.focus();break}}})}},[r,t,o,s,i]),null}function Xm(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,i)=>i({transform:o,...r}),n):n}function Ym(e){return b.useMemo(()=>({draggable:{..._n.draggable,...e==null?void 0:e.draggable},droppable:{..._n.droppable,...e==null?void 0:e.droppable},dragOverlay:{..._n.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Wm(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const i=b.useRef(!1),{x:s,y:a}=typeof o=="boolean"?{x:o,y:o}:o;Fe(()=>{if(!s&&!a||!t){i.current=!1;return}if(i.current||!r)return;const u=t==null?void 0:t.node.current;if(!u||u.isConnected===!1)return;const l=n(u),f=xa(l,r);if(s||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const d=va(u);d&&d.scrollBy({top:f.y,left:f.x})}},[t,s,a,r,n])}const Ia=b.createContext({...ke,scaleX:1,scaleY:1});var nt;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(nt||(nt={}));const Um=b.memo(function(t){var n,r,o,i;let{id:s,accessibility:a,autoScroll:c=!0,children:u,sensors:l=Lm,collisionDetection:f=Kp,measuring:d,modifiers:h,...m}=t;const p=b.useReducer(Hm,void 0,Bm),[x,w]=p,[E,g]=Bp(),[v,_]=b.useState(nt.Uninitialized),C=v===nt.Initialized,{draggable:{active:M,nodes:N,translate:T},droppable:{containers:O}}=x,R=M!=null?N.get(M):null,j=b.useRef({initial:null,translated:null}),P=b.useMemo(()=>{var ue;return M!=null?{id:M,data:(ue=R==null?void 0:R.data)!=null?ue:zm,rect:j}:null},[M,R]),S=b.useRef(null),[I,A]=b.useState(null),[D,$]=b.useState(null),k=Gt(m,Object.values(m)),L=on("DndDescribedBy",s),z=b.useMemo(()=>O.getEnabled(),[O]),F=Ym(d),{droppableRects:V,measureDroppableContainers:B,measuringScheduled:W}=Cm(z,{dragging:C,dependencies:[T.x,T.y],config:F.droppable}),X=_m(N,M),U=b.useMemo(()=>D?jr(D):null,[D]),H=nr(),q=Mm(X,F.draggable.measure);Wm({activeNode:M!=null?N.get(M):null,config:H.layoutShiftCompensation,initialRect:q,measure:F.draggable.measure});const Y=wi(X,F.draggable.measure,q),Q=wi(X?X.parentElement:null),G=b.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=O.getNodeFor((n=G.current.over)==null?void 0:n.id),Z=$m({measure:F.dragOverlay.measure}),te=(r=Z.nodeRef.current)!=null?r:X,re=C?(o=Z.rect)!=null?o:Y:null,Se=!!(Z.nodeRef.current&&Z.rect),He=Dm(Se?null:Y),Ke=Aa(te?ye(te):null),xe=Im(C?J??X:null),Ve=Pm(xe),Te=Xm(h,{transform:{x:T.x-He.x,y:T.y-He.y,scaleX:1,scaleY:1},activatorEvent:D,active:P,activeNodeRect:Y,containerNodeRect:Q,draggingNodeRect:re,over:G.current.over,overlayNodeRect:Z.rect,scrollableAncestors:xe,scrollableAncestorRects:Ve,windowRect:Ke}),Ze=U?Et(U,T):null,mt=km(xe),yt=Si(mt),Je=Si(mt,[Y]),_e=Et(Te,yt),Xe=re?Qp(re,Te):null,at=P&&Xe?f({active:P,collisionRect:Xe,droppableRects:V,droppableContainers:z,pointerCoordinates:Ze}):null,xt=qp(at,"id"),[Pe,sn]=b.useState(null),Zn=Se?Te:Et(Te,Je),Jn=Zp(Zn,(i=Pe==null?void 0:Pe.rect)!=null?i:null,Y),Pt=b.useRef(null),an=b.useCallback((ue,he)=>{let{sensor:ge,options:Ne}=he;if(S.current==null)return;const me=N.get(S.current);if(!me)return;const pe=ue.nativeEvent,Ee=new ge({active:S.current,activeNode:me,event:pe,options:Ne,context:G,onAbort(ce){if(!N.get(ce))return;const{onDragAbort:Ce}=k.current,Ae={id:ce};Ce==null||Ce(Ae),E({type:"onDragAbort",event:Ae})},onPending(ce,je,Ce,Ae){if(!N.get(ce))return;const{onDragPending:lt}=k.current,$e={id:ce,constraint:je,initialCoordinates:Ce,offset:Ae};lt==null||lt($e),E({type:"onDragPending",event:$e})},onStart(ce){const je=S.current;if(je==null)return;const Ce=N.get(je);if(!Ce)return;const{onDragStart:Ae}=k.current,ct={activatorEvent:pe,active:{id:je,data:Ce.data,rect:j}};Lt.unstable_batchedUpdates(()=>{Ae==null||Ae(ct),_(nt.Initializing),w({type:le.DragStart,initialCoordinates:ce,active:je}),E({type:"onDragStart",event:ct}),A(Pt.current),$(pe)})},onMove(ce){w({type:le.DragMove,coordinates:ce})},onEnd:Qe(le.DragEnd),onCancel:Qe(le.DragCancel)});Pt.current=Ee;function Qe(ce){return async function(){const{active:Ce,collisions:Ae,over:ct,scrollAdjustedTranslate:lt}=G.current;let $e=null;if(Ce&&lt){const{cancelDrop:ut}=k.current;$e={activatorEvent:pe,active:Ce,collisions:Ae,delta:lt,over:ct},ce===le.DragEnd&&typeof ut=="function"&&await Promise.resolve(ut($e))&&(ce=le.DragCancel)}S.current=null,Lt.unstable_batchedUpdates(()=>{w({type:ce}),_(nt.Uninitialized),sn(null),A(null),$(null),Pt.current=null;const ut=ce===le.DragEnd?"onDragEnd":"onDragCancel";if($e){const jt=k.current[ut];jt==null||jt($e),E({type:ut,event:$e})}})}}},[N]),Qn=b.useCallback((ue,he)=>(ge,Ne)=>{const me=ge.nativeEvent,pe=N.get(Ne);if(S.current!==null||!pe||me.dndKit||me.defaultPrevented)return;const Ee={active:pe};ue(ge,he.options,Ee)===!0&&(me.dndKit={capturedBy:he.sensor},S.current=Ne,an(ge,he))},[N,an]),cn=Em(l,Qn);Rm(l),Fe(()=>{Y&&v===nt.Initializing&&_(nt.Initialized)},[Y,v]),b.useEffect(()=>{const{onDragMove:ue}=k.current,{active:he,activatorEvent:ge,collisions:Ne,over:me}=G.current;if(!he||!ge)return;const pe={active:he,activatorEvent:ge,collisions:Ne,delta:{x:_e.x,y:_e.y},over:me};Lt.unstable_batchedUpdates(()=>{ue==null||ue(pe),E({type:"onDragMove",event:pe})})},[_e.x,_e.y]),b.useEffect(()=>{const{active:ue,activatorEvent:he,collisions:ge,droppableContainers:Ne,scrollAdjustedTranslate:me}=G.current;if(!ue||S.current==null||!he||!me)return;const{onDragOver:pe}=k.current,Ee=Ne.get(xt),Qe=Ee&&Ee.rect.current?{id:Ee.id,rect:Ee.rect.current,data:Ee.data,disabled:Ee.disabled}:null,ce={active:ue,activatorEvent:he,collisions:ge,delta:{x:me.x,y:me.y},over:Qe};Lt.unstable_batchedUpdates(()=>{sn(Qe),pe==null||pe(ce),E({type:"onDragOver",event:ce})})},[xt]),Fe(()=>{G.current={activatorEvent:D,active:P,activeNode:X,collisionRect:Xe,collisions:at,droppableRects:V,draggableNodes:N,draggingNode:te,draggingNodeRect:re,droppableContainers:O,over:Pe,scrollableAncestors:xe,scrollAdjustedTranslate:_e},j.current={initial:re,translated:Xe}},[P,X,at,Xe,N,te,re,V,O,Pe,xe,_e]),wm({...H,delta:T,draggingRect:Xe,pointerCoordinates:Ze,scrollableAncestors:xe,scrollableAncestorRects:Ve});const er=b.useMemo(()=>({active:P,activeNode:X,activeNodeRect:Y,activatorEvent:D,collisions:at,containerNodeRect:Q,dragOverlay:Z,draggableNodes:N,droppableContainers:O,droppableRects:V,over:Pe,measureDroppableContainers:B,scrollableAncestors:xe,scrollableAncestorRects:Ve,measuringConfiguration:F,measuringScheduled:W,windowRect:Ke}),[P,X,Y,D,at,Q,Z,N,O,V,Pe,B,xe,Ve,F,W,Ke]),tr=b.useMemo(()=>({activatorEvent:D,activators:cn,active:P,activeNodeRect:Y,ariaDescribedById:{draggable:L},dispatch:w,draggableNodes:N,over:Pe,measureDroppableContainers:B}),[D,cn,P,Y,w,L,N,Pe,B]);return fe.createElement(ya.Provider,{value:g},fe.createElement(Kn.Provider,{value:tr},fe.createElement(Da.Provider,{value:er},fe.createElement(Ia.Provider,{value:Jn},u)),fe.createElement(Vm,{disabled:(a==null?void 0:a.restoreFocus)===!1})),fe.createElement(Xp,{...a,hiddenTextDescribedById:L}));function nr(){const ue=(I==null?void 0:I.autoScrollEnabled)===!1,he=typeof c=="object"?c.enabled===!1:c===!1,ge=C&&!ue&&!he;return typeof c=="object"?{...c,enabled:ge}:{enabled:ge}}}),qm=b.createContext(null),Ei="button",Gm="Draggable";function Km(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const i=on(Gm),{activators:s,activatorEvent:a,active:c,activeNodeRect:u,ariaDescribedById:l,draggableNodes:f,over:d}=b.useContext(Kn),{role:h=Ei,roleDescription:m="draggable",tabIndex:p=0}=o??{},x=(c==null?void 0:c.id)===t,w=b.useContext(x?Ia:qm),[E,g]=Rn(),[v,_]=Rn(),C=Tm(s,t),M=Gt(n);Fe(()=>(f.set(t,{id:t,key:i,node:E,activatorNode:v,data:M}),()=>{const T=f.get(t);T&&T.key===i&&f.delete(t)}),[f,t]);const N=b.useMemo(()=>({role:h,tabIndex:p,"aria-disabled":r,"aria-pressed":x&&h===Ei?!0:void 0,"aria-roledescription":m,"aria-describedby":l.draggable}),[r,h,p,x,m,l.draggable]);return{active:c,activatorEvent:a,activeNodeRect:u,attributes:N,isDragging:x,listeners:r?void 0:C,node:E,over:d,setNodeRef:g,setActivatorNodeRef:_,transform:w}}function Zm(){return b.useContext(Da)}const Jm="Droppable",Qm={timeout:25};function ey(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const i=on(Jm),{active:s,dispatch:a,over:c,measureDroppableContainers:u}=b.useContext(Kn),l=b.useRef({disabled:n}),f=b.useRef(!1),d=b.useRef(null),h=b.useRef(null),{disabled:m,updateMeasurementsFor:p,timeout:x}={...Qm,...o},w=Gt(p??r),E=b.useCallback(()=>{if(!f.current){f.current=!0;return}h.current!=null&&clearTimeout(h.current),h.current=setTimeout(()=>{u(Array.isArray(w.current)?w.current:[w.current]),h.current=null},x)},[x]),g=Gn({callback:E,disabled:m||!s}),v=b.useCallback((N,T)=>{g&&(T&&(g.unobserve(T),f.current=!1),N&&g.observe(N))},[g]),[_,C]=Rn(v),M=Gt(t);return b.useEffect(()=>{!g||!_.current||(g.disconnect(),f.current=!1,g.observe(_.current))},[_,g]),b.useEffect(()=>(a({type:le.RegisterDroppable,element:{id:r,key:i,disabled:n,node:_,rect:d,data:M}}),()=>a({type:le.UnregisterDroppable,key:i,id:r})),[r]),b.useEffect(()=>{n!==l.current.disabled&&(a({type:le.SetDroppableDisabled,id:r,key:i,disabled:n}),l.current.disabled=n)},[r,i,n,a]),{active:s,rect:d,isOver:(c==null?void 0:c.id)===r,node:_,over:c,setNodeRef:C}}const ty=e=>{let{transform:t}=e;return{...t,x:0}};function uo(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function ny(e,t){return e.reduce((n,r,o)=>{const i=t.get(r);return i&&(n[o]=i),n},Array(e.length))}function yn(e){return e!==null&&e>=0}function ry(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function oy(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const ka=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const i=uo(t,r,n),s=t[o],a=i[o];return!a||!s?null:{x:a.left-s.left,y:a.top-s.top,scaleX:a.width/s.width,scaleY:a.height/s.height}},xn={scaleX:1,scaleY:1},iy=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:i,overIndex:s}=e;const a=(t=i[n])!=null?t:r;if(!a)return null;if(o===n){const u=i[s];return u?{x:0,y:n<s?u.top+u.height-(a.top+a.height):u.top-a.top,...xn}:null}const c=sy(i,o,n);return o>n&&o<=s?{x:0,y:-a.height-c,...xn}:o<n&&o>=s?{x:0,y:a.height+c,...xn}:{x:0,y:0,...xn}};function sy(e,t,n){const r=e[t],o=e[t-1],i=e[t+1];return r?n<t?o?r.top-(o.top+o.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Ra="Sortable",Ta=fe.createContext({activeIndex:-1,containerId:Ra,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:ka,disabled:{draggable:!1,droppable:!1}});function ay(e){let{children:t,id:n,items:r,strategy:o=ka,disabled:i=!1}=e;const{active:s,dragOverlay:a,droppableRects:c,over:u,measureDroppableContainers:l}=Zm(),f=on(Ra,n),d=a.rect!==null,h=b.useMemo(()=>r.map(C=>typeof C=="object"&&"id"in C?C.id:C),[r]),m=s!=null,p=s?h.indexOf(s.id):-1,x=u?h.indexOf(u.id):-1,w=b.useRef(h),E=!ry(h,w.current),g=x!==-1&&p===-1||E,v=oy(i);Fe(()=>{E&&m&&l(h)},[E,h,m,l]),b.useEffect(()=>{w.current=h},[h]);const _=b.useMemo(()=>({activeIndex:p,containerId:f,disabled:v,disableTransforms:g,items:h,overIndex:x,useDragOverlay:d,sortedRects:ny(h,c),strategy:o}),[p,f,v.draggable,v.droppable,g,h,x,c,d,o]);return fe.createElement(Ta.Provider,{value:_},t)}const cy=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return uo(n,r,o).indexOf(t)},ly=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:i,newIndex:s,previousItems:a,previousContainerId:c,transition:u}=e;return!u||!r||a!==i&&o===s?!1:n?!0:s!==o&&t===c},uy={duration:200,easing:"ease"},Pa="transform",dy=Kt.Transition.toString({property:Pa,duration:0,easing:"linear"}),fy={roleDescription:"sortable"};function hy(e){let{disabled:t,index:n,node:r,rect:o}=e;const[i,s]=b.useState(null),a=b.useRef(n);return Fe(()=>{if(!t&&n!==a.current&&r.current){const c=o.current;if(c){const u=Tt(r.current,{ignoreTransform:!0}),l={x:c.left-u.left,y:c.top-u.top,scaleX:c.width/u.width,scaleY:c.height/u.height};(l.x||l.y)&&s(l)}}n!==a.current&&(a.current=n)},[t,n,r,o]),b.useEffect(()=>{i&&s(null)},[i]),i}function gy(e){let{animateLayoutChanges:t=ly,attributes:n,disabled:r,data:o,getNewIndex:i=cy,id:s,strategy:a,resizeObserverConfig:c,transition:u=uy}=e;const{items:l,containerId:f,activeIndex:d,disabled:h,disableTransforms:m,sortedRects:p,overIndex:x,useDragOverlay:w,strategy:E}=b.useContext(Ta),g=py(r,h),v=l.indexOf(s),_=b.useMemo(()=>({sortable:{containerId:f,index:v,items:l},...o}),[f,o,v,l]),C=b.useMemo(()=>l.slice(l.indexOf(s)),[l,s]),{rect:M,node:N,isOver:T,setNodeRef:O}=ey({id:s,data:_,disabled:g.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...c}}),{active:R,activatorEvent:j,activeNodeRect:P,attributes:S,setNodeRef:I,listeners:A,isDragging:D,over:$,setActivatorNodeRef:k,transform:L}=Km({id:s,data:_,attributes:{...fy,...n},disabled:g.draggable}),z=kp(O,I),F=!!R,V=F&&!m&&yn(d)&&yn(x),B=!w&&D,W=B&&V?L:null,U=V?W??(a??E)({rects:p,activeNodeRect:P,activeIndex:d,overIndex:x,index:v}):null,H=yn(d)&&yn(x)?i({id:s,items:l,activeIndex:d,overIndex:x}):v,q=R==null?void 0:R.id,Y=b.useRef({activeId:q,items:l,newIndex:H,containerId:f}),Q=l!==Y.current.items,G=t({active:R,containerId:f,isDragging:D,isSorting:F,id:s,index:v,items:l,newIndex:Y.current.newIndex,previousItems:Y.current.items,previousContainerId:Y.current.containerId,transition:u,wasDragging:Y.current.activeId!=null}),J=hy({disabled:!G,index:v,node:N,rect:M});return b.useEffect(()=>{F&&Y.current.newIndex!==H&&(Y.current.newIndex=H),f!==Y.current.containerId&&(Y.current.containerId=f),l!==Y.current.items&&(Y.current.items=l)},[F,H,f,l]),b.useEffect(()=>{if(q===Y.current.activeId)return;if(q!=null&&Y.current.activeId==null){Y.current.activeId=q;return}const te=setTimeout(()=>{Y.current.activeId=q},50);return()=>clearTimeout(te)},[q]),{active:R,activeIndex:d,attributes:S,data:_,rect:M,index:v,newIndex:H,items:l,isOver:T,isSorting:F,isDragging:D,listeners:A,node:N,overIndex:x,over:$,setNodeRef:z,setActivatorNodeRef:k,setDroppableNodeRef:O,setDraggableNodeRef:I,transform:J??U,transition:Z()};function Z(){if(J||Q&&Y.current.newIndex===v)return dy;if(!(B&&!io(j)||!u)&&(F||G))return Kt.Transition.toString({...u,property:Pa})}}function py(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}ne.Down,ne.Right,ne.Up,ne.Left;const my=[{title:"component_name",dataIndex:"component_name",render:(e,t)=>y.jsx(Di,{placement:"right",title:y.jsx(y.Fragment,{children:y.jsxs("ul",{children:[y.jsxs("li",{children:["component_id: ",t.component_id]}),y.jsxs("li",{children:["relation_id: ",t.relation_id]})]})}),children:t.component_name})}],yy=e=>{const{attributes:t,listeners:n,setNodeRef:r,transform:o,transition:i,isDragging:s}=gy({id:e["data-row-key"]}),a={...e.style,transform:Kt.Translate.toString(o),transition:i,cursor:"move",...s?{position:"relative",zIndex:9999}:{}};return y.jsx("tr",{...e,ref:r,style:a,...t,...n})},xy=({data:e,callback:t})=>{const[n,r]=b.useState(e),{messageApi:o}=st(),i=Wp(Yp(lo,{activationConstraint:{distance:1}})),s=async()=>{const c=n.map((u,l)=>({order_index:l,relation_id:u.relation_id}));await wc(c),o.success("保存成功"),t&&t()},a=({active:c,over:u})=>{c.id!==(u==null?void 0:u.id)&&r(l=>{const f=l.findIndex(h=>h.key===c.id),d=l.findIndex(h=>h.key===(u==null?void 0:u.id));return uo(l,f,d)})};return y.jsx(Um,{sensors:i,modifiers:[ty],onDragEnd:a,children:y.jsx(ay,{items:n.map(c=>c.key),strategy:iy,children:y.jsx(Fr,{pagination:!1,size:"small",components:{body:{row:yy}},rowKey:"key",columns:my,dataSource:n,footer:()=>y.jsx(ht,{justify:"end",children:y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:s,children:"保存"})})})})})},vy=({visible:e,onClose:t,params:n,callback:r})=>e?y.jsx(pt,{footer:null,open:e,onCancel:t,title:"更新排序",children:y.jsx(xy,{data:n.software.map(o=>({...o,key:o.component_id})),callback:r})}):null,wy=({visible:e,onClose:t,params:n,callback:r})=>e?y.jsx(pt,{title:"说明",width:"50%",onCancel:t,onClose:t,open:e,children:y.jsx(Pi,{data:n})}):null,qy=({})=>{console.log("Pipeline");const{component_type:e,component_id:t}=fc(),[n,r]=b.useState(),o=hc(),[i,s]=b.useState(!0),[a,c]=Ci.useMessage(),u={inputFile:b.useRef(null),outputFile:b.useRef(null)},{modal:l,openModal:f,closeModal:d}=gc(),{modals:h,openModals:m,closeModals:p}=pc(["modalD","metadataModal","bindSample"]),x=async()=>{let g=`/get-pipeline-v2/${t}?component_type=${e}`;e=="script"&&(g=`/get-component-parent/${t}?component_type=${e}`);let _=(await ot.get(g)).data;"content"in _&&(_={...JSON.parse(_.content),..._}),r(_),console.log(_)},E={deletePipelineRelation:async g=>{try{const v=await Ec(g);a.success("删除成功!"),x()}catch(v){console.log(v),a.error(`删除失败!${v.response.data.detail}`)}},openModal:f,openModals:m};return b.useEffect(()=>{x()},[]),y.jsxs("div",{style:{maxWidth:"1500px",margin:"0 auto"},children:[c,y.jsxs(ht,{style:{marginBottom:"1rem"},justify:"space-between",align:"center",gap:"small",children:[y.jsx("div",{children:n?y.jsxs(y.Fragment,{children:[y.jsxs("h2",{style:{margin:0},children:[n==null?void 0:n.component_name,y.jsx(Di,{title:n==null?void 0:n.namespace,children:y.jsxs("span",{style:{margin:"0",color:"rgba(0, 0, 0, 0.45)",fontSize:"1rem"},children:[" ",n==null?void 0:n.namespace_name]})})]}),!1,n.tags&&Array.isArray(n.tags)&&n.tags.map((g,v)=>y.jsx(Oc,{style:{marginTop:"0.5rem"},color:xc[v],children:g},v))]}):y.jsx(mc,{active:!0})}),y.jsxs(ht,{gap:"small",wrap:!0,children:[e=="pipeline"&&y.jsx(y.Fragment,{children:y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f("sortSoftware",{software:n.software})},children:"更新排序"})}),y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{E.openModal("modalG",n)},children:"查看依赖"}),y.jsx(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m("metadataModal",{...n,operatePipeline:E})},children:"metadata"}),y.jsxs(se,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f("modalC",{data:n,structure:{component_type:e}})},children:["更新",e]}),y.jsx(se,{size:"small",color:"primary",variant:"solid",onClick:x,children:"刷新"}),y.jsx(se,{size:"small",color:"primary",variant:"solid",onClick:()=>o(`/${e}-card`),children:"返回"})]})]}),y.jsx(Sy,{component_type:e||"",component:n,tableRef:u,operatePipeline:E}),y.jsx(el,{visible:l.key=="modalB"&&l.visible,onClose:d,callback:x,params:l.params}),y.jsx(bc,{callback:x,visible:l.key=="modalA"&&l.visible,onClose:d,params:{...l.params,namespace:n==null?void 0:n.namespace}}),y.jsx(Sc,{callback:x,visible:l.key=="modalC"&&l.visible,onClose:d,params:l.params}),y.jsx(tl,{visible:h.modalD.visible,params:h.modalD.params,onClose:()=>p("modalD")}),y.jsx(ol,{visible:l.key=="modalE"&&l.visible,onClose:d,params:l.params}),y.jsx(il,{visible:l.key=="modalF"&&l.visible,onClose:d,params:l.params}),y.jsx(Nc,{visible:l.key=="modalG"&&l.visible,onClose:d,callback:x,params:l.params}),y.jsx(_c,{visible:l.key=="modalH"&&l.visible,onClose:d,value:l.params}),y.jsx(kc,{visible:h.metadataModal.visible,onClose:()=>p("metadataModal"),params:h.metadataModal.params}),y.jsx(sl,{visible:l.key=="metadataForm"&&l.visible,onClose:d,params:l.params}),y.jsx(Rc,{visible:h.bindSample.visible,onClose:()=>p("bindSample"),operatePipeline:E,params:h.bindSample.params}),y.jsx(al,{visible:l.key=="openFile"&&l.visible,onClose:d,params:l.params}),y.jsx(vy,{visible:l.key=="sortSoftware"&&l.visible,onClose:d,params:l.params,callback:x}),y.jsx(wy,{visible:l.key=="descriptionModal"&&l.visible,onClose:d,params:l.params,callback:x})]})},by=({component_type:e,operatePipeline:t,component:n,...r})=>{if(!e||!n)return null;const i={pipeline:My,software:_y,file:Ey,script:Cy,module:"module-card"}[e];return i?y.jsx(i,{operatePipeline:t,component:n,...r}):null},Sy=fe.memo(by,(e,t)=>JSON.stringify(e)===JSON.stringify(t)),_y=({operatePipeline:e,component:t,...n})=>y.jsx(y.Fragment,{children:y.jsx(ki,{...t,operatePipeline:e})}),Ey=({operatePipeline:e,component:t,...n})=>{const{project:r}=st();return y.jsx(y.Fragment,{children:y.jsx(Ii,{...t,analysisMethod:[t],operatePipeline:e,project:r})})},Cy=({operatePipeline:e,component:t,...n})=>{const{project:r}=st();return y.jsx(y.Fragment,{children:y.jsx(Ii,{script:t.script,analysisMethod:t.parent||[],operatePipeline:e,project:r})})},My=({operatePipeline:e,component:t,...n})=>{const[r,o]=b.useState([]),{project:i}=st(),s=u=>{const l=u.software;return l?l.map((f,d)=>({key:f.component_id,label:f.component_name||f.component_id,children:y.jsx(ki,{...n,...f,hiddenUpstreamAnalysis:!0,pipeline:{component_id:u.component_id},operatePipeline:e})})):[]},a=u=>{const l=u.software;if(!l)return[];const d=(JSON.parse(u.position)||[]).reduce((m,p)=>(m[p.component_id]=p.position,m),{});return l.map((m,p)=>{const x=m.component_name,w=(m.inputFile||[]).map(g=>g),E=(m.outputFile||[]).map(g=>g);return{id:m.component_id,type:"custom",position:d[m.component_id]||{x:p*300,y:100},data:{label:x,color:"#"+((1<<24)*Math.random()|0).toString(16),inputs:w,outputs:E}}})||[]},c=u=>JSON.parse(u.edges)||[];return b.useEffect(()=>{t&&o(s(t))},[JSON.stringify(t)]),console.log("--->PipelineComponent渲染"),y.jsxs(y.Fragment,{children:[y.jsx(Dp,{initialEdges:c(t),initialNodes:a(t),component:t}),y.jsx("div",{style:{marginTop:"1rem"}}),y.jsx(yc,{...t,project:i,operatePipeline:e,inputAnalysisMethod:t.inputFile}),t&&Array.isArray(t==null?void 0:t.software)?y.jsx($n,{destroyInactiveTabPane:!0,items:r}):y.jsxs(Mi,{children:[y.jsx(se,{style:{marginRight:"0.5rem"},color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalC",{data:void 0,structure:{component_type:"software",relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"新增软件"}),y.jsx(se,{color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"添加软件"})]})]})};export{qy as default};

import{r,u as H,N,am as G,b as J,an as U,c as V,j as e,R as X,C as I,E as M,S as Z,F as T,B as F,x as O,a as Y,Q as ee}from"./main-Bb36JT4B.js";import{d as se}from"./index-D34bYyXo.js";import te from"./index-Bu1BS6Wx.js";import{u as oe}from"./useStickyTop-qo2B527V.js";import{C as $}from"./index-CedmWet4.js";import{R as re}from"./RedoOutlined-BVTMzSmO.js";import{T as ae}from"./Table-BmozZZHG.js";import"./index-hepvEPhH.js";import"./index-Bj9IZtAf.js";import"./index-2YD7whTu.js";import"./UpOutlined-CAwxhdnf.js";import"./DeleteOutlined-e3cflAOk.js";import"./index-JTUypjtn.js";import"./Dropdown-DN1o0f1Q.js";import"./index-D01PGZ6m.js";import"./index-CTSdT7in.js";import"./index-a5nKelg2.js";import"./addEventListener-DVSeb2Tw.js";import"./createForOfIteratorHelper-BcXv2kSG.js";import"./DeploymentUnitOutlined-BloW4Lk-.js";import"./UserSwitchOutlined-DWZ6YS85.js";import"./AudioOutlined-DZYHLJmY.js";import"./ClearOutlined-C8EAuPHL.js";import"./TableOutlined-C9X6pdqB.js";import"./NodeIndexOutlined-BKFsG5mC.js";import"./UndoOutlined-CGI6NSgT.js";import"./react-window-C6u_-vN5.js";import"./index-DV2HUdkJ.js";import"./index-B37dTN1Q.js";import"./study-page-b5Sf5qcC.js";import"./usePagination-Z7YQ7URL.js";import"./index-CiEuomCZ.js";import"./index-B-_UFcBZ.js";import"./index-BXw3nVYM.js";import"./callSuper-Difh5VKN.js";const Ke=()=>{const[m,i]=r.useState(!1),{project:a,projectObj:o}=H(s=>s.user),[h,R]=r.useState(),[j,x]=r.useState(),v=N(),g=new URLSearchParams(v.search),t=g.get("key"),n=g.get("project"),d=G(),{modal:l,openModal:k,closeModal:B}=J(),[E,L]=r.useState(t),K=async()=>{const s=await Y.get(`/project/find-by-project-id/${a}`);d(U({projectObj:s.data}))};r.useEffect(()=>{n&&n!=a&&d(U({project:n}))},[n]),r.useRef(null),V();const S=(s,c)=>{const{pathname:p,search:w,hash:f}=window.location,u=new URLSearchParams(w||"");u.set(s,c);const P=f.startsWith("#/");let y="";if(P){const[W,q=""]=f.replace(/^#/,"").split("?"),D=new URLSearchParams(q);D.set(s,c),y=`#${W}?${D.toString()}`}else y=`${p}?${u.toString()}`;window.history.pushState({},"",y)},[_,b]=r.useState("analysis_result"),{ref:Q,top:z,isSticky:A}=oe(576),C=async()=>{var c,p,w,f,u,P,y;i(!0);let s=await Y.post("/list-analysis-tree",{is_report:!0,project:a});R(s.data),!t&&s.data.length>0&&(c=s.data[0])!=null&&c.children&&((p=s.data[0])==null?void 0:p.children.length)>0&&(x((w=s.data[0])==null?void 0:w.children[0]),L((u=(f=s.data[0])==null?void 0:f.children[0])==null?void 0:u.key),S("project",a),S("key",(y=(P=s.data[0])==null?void 0:P.children[0])==null?void 0:y.key)),i(!1)};return r.useEffect(()=>{C()},[a]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"1rem auto"},children:[e.jsxs(X,{gutter:[A?16:0,16],children:[e.jsxs(I,{lg:20,sm:20,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("div",{style:{flex:1,display:_==="analysis_result"?"block":"none",height:"100%"},children:E?e.jsx(e.Fragment,{children:e.jsx(se,{overflowY:"auto",openPanel:b,loadTree:()=>{C()},analysis_id:E})}):e.jsx(e.Fragment,{children:e.jsx($,{size:"small",variant:"borderless",children:e.jsx(M,{})})})}),_=="note"&&e.jsx("div",{children:e.jsx($,{style:{flex:1,display:"flex",flexDirection:"column",height:" 100%",boxShadow:"none"},styles:{body:{flex:1,display:"flex",flexDirection:"column",height:" 100%",padding:0,overflowY:"auto"}},variant:"borderless",size:"small",extra:e.jsxs(T,{gap:"small",children:[e.jsx(F,{size:"small",color:"primary",variant:"solid",onClick:()=>{b("analysis_result")},children:"Back"}),e.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k("projectForm",{project_id:a})},children:"Edit"}),e.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>{K()},children:"Refresh"})]}),children:o!=null&&o.description?e.jsx(te,{data:o==null?void 0:o.description}):e.jsx(Z,{active:!0})})})]}),e.jsx(I,{lg:4,sm:4,xs:24,ref:Q,style:A?{overflowY:"hidden",position:"sticky",top:`${z}px`,alignSelf:"flex-start",height:`calc(100vh - ${z}px - 1rem )`}:{},children:e.jsx($,{loading:m,title:o==null?void 0:o.project_name,size:"small",style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(T,{gap:"small",children:e.jsx(re,{style:{cursor:"pointer"},onClick:C})}),children:Array.isArray(h)&&h.length!=0?e.jsx(e.Fragment,{children:e.jsx(ie,{onSelect:s=>{var c,p;((c=s.node)==null?void 0:c.type)=="analysis"?(x(s.node),L(s.node.key),S("project",a),S("key",s.node.key)):((p=s.node)==null?void 0:p.type)=="components"&&console.log(s.node)},defaultSelectKey:E,treeData:h})}):e.jsx(e.Fragment,{children:e.jsx(M,{})})})})]}),e.jsx(O,{research:!0,params:l.params,visible:l.key=="projectForm"&&l.visible,onClose:B})]})},ie=({treeData:m,defaultSelectKey:i,onSelect:a})=>{const[o,h]=r.useState(i),[R,j]=r.useState([]),x=(t,n,d=[])=>{for(const l of n){if(l.key===t)return d;if(l.children){const k=x(t,l.children,[...d,l.key]);if(k.length)return k}}return[]};r.useEffect(()=>{if(i){const t=x(i,m);j(t),h(i)}},[i,m]);const v=(t,n)=>{if(t.length>0){a(n),h(t[0]);const d=x(t[0],m);j(d)}},g=t=>{j(t)};return e.jsx(e.Fragment,{children:e.jsx(ae,{selectedKeys:[o],showLine:!0,expandedKeys:R,onExpand:g,autoExpandParent:!0,switcherIcon:e.jsx(ee,{}),onSelect:v,treeData:m})})};export{Ke as default};

import{Z as de,a0 as ue,a1 as _,r as h,a5 as Ae,O as B,Y as Ne,aj as Pe,ak as Te,al as Le,am as Be,an as We,ao as Ve,ap as He,aq as Re,x as qe,A as Ke,z as Ge,ag as Je,ar as he,ad as Ue,ae as ee,_ as Xe,as as te,$ as Ye,a2 as Qe,at as Ze,X as et,au as tt,a6 as nt,av as st,aw as it,d as W,j as s,F as w,S as V,I as L,T as rt,B as E,a as z,g as N,n as ot,c as H,M as me,P as K,q as ge,i as at,f as lt,U as ct,t as dt,b as ut,C as ht,m as pe}from"./index-B1qN1Q03.js";import{M as mt}from"./index-vCBpbpkZ.js";import{C as fe}from"./index-D5ZHtm1i.js";import{T as O}from"./index-BOQfS1L5.js";import{T as gt,M as xe}from"./index-QjP6pa1y.js";import{T as be}from"./index-Bt44_A0u.js";import{F as Se}from"./Table-hZz0WDRz.js";import{D as pt}from"./index-Cruyhe3m.js";import{S as ft}from"./index-Duih0CrQ.js";import{_ as xt}from"./callSuper-CddMmljM.js";import{I as bt}from"./index-ZXdJu6gQ.js";const R=(e,r,t,n,i)=>({background:e,border:`${_(n.lineWidth)} ${n.lineType} ${r}`,[`${i}-icon`]:{color:t}}),St=e=>{const{componentCls:r,motionDurationSlow:t,marginXS:n,marginSM:i,fontSize:o,fontSizeLG:c,lineHeight:a,borderRadiusLG:l,motionEaseInOutCirc:d,withDescriptionIconSize:u,colorText:m,colorTextHeading:g,withDescriptionPadding:f,defaultPadding:p}=e;return{[r]:Object.assign(Object.assign({},ue(e)),{position:"relative",display:"flex",alignItems:"center",padding:p,wordWrap:"break-word",borderRadius:l,[`&${r}-rtl`]:{direction:"rtl"},[`${r}-content`]:{flex:1,minWidth:0},[`${r}-icon`]:{marginInlineEnd:n,lineHeight:0},"&-description":{display:"none",fontSize:o,lineHeight:a},"&-message":{color:g},[`&${r}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${t} ${d}, opacity ${t} ${d},
        padding-top ${t} ${d}, padding-bottom ${t} ${d},
        margin-bottom ${t} ${d}`},[`&${r}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${r}-with-description`]:{alignItems:"flex-start",padding:f,[`${r}-icon`]:{marginInlineEnd:i,fontSize:u,lineHeight:0},[`${r}-message`]:{display:"block",marginBottom:n,color:g,fontSize:c},[`${r}-description`]:{display:"block",color:m}},[`${r}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},yt=e=>{const{componentCls:r,colorSuccess:t,colorSuccessBorder:n,colorSuccessBg:i,colorWarning:o,colorWarningBorder:c,colorWarningBg:a,colorError:l,colorErrorBorder:d,colorErrorBg:u,colorInfo:m,colorInfoBorder:g,colorInfoBg:f}=e;return{[r]:{"&-success":R(i,n,t,e,r),"&-info":R(f,g,m,e,r),"&-warning":R(a,c,o,e,r),"&-error":Object.assign(Object.assign({},R(u,d,l,e,r)),{[`${r}-description > pre`]:{margin:0,padding:0}})}}},vt=e=>{const{componentCls:r,iconCls:t,motionDurationMid:n,marginXS:i,fontSizeIcon:o,colorIcon:c,colorIconHover:a}=e;return{[r]:{"&-action":{marginInlineStart:i},[`${r}-close-icon`]:{marginInlineStart:i,padding:0,overflow:"hidden",fontSize:o,lineHeight:_(o),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${t}-close`]:{color:c,transition:`color ${n}`,"&:hover":{color:a}}},"&-close-text":{color:c,transition:`color ${n}`,"&:hover":{color:a}}}}},jt=e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:`${e.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${e.paddingMD}px ${e.paddingContentHorizontalLG}px`}),Ct=de("Alert",e=>[St(e),yt(e),vt(e)],jt);var ne=function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(t[n[i]]=e[n[i]]);return t};const wt={success:He,info:Ve,error:We,warning:Be},It=e=>{const{icon:r,prefixCls:t,type:n}=e,i=wt[n]||null;return r?Le(r,h.createElement("span",{className:`${t}-icon`},r),()=>({className:B(`${t}-icon`,r.props.className)})):h.createElement(i,{className:`${t}-icon`})},$t=e=>{const{isClosable:r,prefixCls:t,closeIcon:n,handleClose:i,ariaProps:o}=e,c=n===!0||n===void 0?h.createElement(Re,null):n;return r?h.createElement("button",Object.assign({type:"button",onClick:i,className:`${t}-close-icon`,tabIndex:0},o),c):null},ye=h.forwardRef((e,r)=>{const{description:t,prefixCls:n,message:i,banner:o,className:c,rootClassName:a,style:l,onMouseEnter:d,onMouseLeave:u,onClick:m,afterClose:g,showIcon:f,closable:p,closeText:S,closeIcon:b,action:C,id:j}=e,v=ne(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[x,I]=h.useState(!1),y=h.useRef(null);h.useImperativeHandle(r,()=>({nativeElement:y.current}));const{getPrefixCls:k,direction:F,closable:$,closeIcon:D,className:G,style:J}=Ae("alert"),M=k("alert",n),[U,$e,Ee]=Ct(M),Fe=A=>{var P;I(!0),(P=e.onClose)===null||P===void 0||P.call(e,A)},Y=h.useMemo(()=>e.type!==void 0?e.type:o?"warning":"info",[e.type,o]),Me=h.useMemo(()=>typeof p=="object"&&p.closeIcon||S?!0:typeof p=="boolean"?p:b!==!1&&b!==null&&b!==void 0?!0:!!$,[S,b,p,$]),Q=o&&f===void 0?!0:f,ze=B(M,`${M}-${Y}`,{[`${M}-with-description`]:!!t,[`${M}-no-icon`]:!Q,[`${M}-banner`]:!!o,[`${M}-rtl`]:F==="rtl"},G,c,a,Ee,$e),ke=Ne(v,{aria:!0,data:!0}),Oe=h.useMemo(()=>typeof p=="object"&&p.closeIcon?p.closeIcon:S||(b!==void 0?b:typeof $=="object"&&$.closeIcon?$.closeIcon:D),[b,p,S,D]),_e=h.useMemo(()=>{const A=p??$;if(typeof A=="object"){const{closeIcon:P}=A;return ne(A,["closeIcon"])}return{}},[p,$]);return U(h.createElement(Pe,{visible:!x,motionName:`${M}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:A=>({maxHeight:A.offsetHeight}),onLeaveEnd:g},(A,P)=>{let{className:Z,style:De}=A;return h.createElement("div",Object.assign({id:j,ref:Te(y,P),"data-show":!x,className:B(ze,Z),style:Object.assign(Object.assign(Object.assign({},J),l),De),onMouseEnter:d,onMouseLeave:u,onClick:m,role:"alert"},ke),Q?h.createElement(It,{description:t,icon:e.icon,prefixCls:M,type:Y}):null,h.createElement("div",{className:`${M}-content`},i?h.createElement("div",{className:`${M}-message`},i):null,t?h.createElement("div",{className:`${M}-description`},t):null),C?h.createElement("div",{className:`${M}-action`},C):null,h.createElement($t,{isClosable:Me,prefixCls:M,closeIcon:Oe,handleClose:Fe,ariaProps:_e}))}))});let Et=function(e){function r(){var t;return Ge(this,r),t=xt(this,r,arguments),t.state={error:void 0,info:{componentStack:""}},t}return qe(r,e),Ke(r,[{key:"componentDidCatch",value:function(n,i){this.setState({error:n,info:i})}},{key:"render",value:function(){const{message:n,description:i,id:o,children:c}=this.props,{error:a,info:l}=this.state,d=(l==null?void 0:l.componentStack)||null,u=typeof n>"u"?(a||"").toString():n,m=typeof i>"u"?d:i;return a?h.createElement(ye,{id:o,type:"error",message:u,description:h.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},m)}):c}}])}(h.Component);const ve=ye;ve.ErrorBoundary=Et;var Ft=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],je=h.forwardRef(function(e,r){var t,n=e.prefixCls,i=n===void 0?"rc-switch":n,o=e.className,c=e.checked,a=e.defaultChecked,l=e.disabled,d=e.loadingIcon,u=e.checkedChildren,m=e.unCheckedChildren,g=e.onClick,f=e.onChange,p=e.onKeyDown,S=Je(e,Ft),b=he(!1,{value:c,defaultValue:a}),C=Ue(b,2),j=C[0],v=C[1];function x(F,$){var D=j;return l||(D=F,v(D),f==null||f(D,$)),D}function I(F){F.which===te.LEFT?x(!1,F):F.which===te.RIGHT&&x(!0,F),p==null||p(F)}function y(F){var $=x(!j,F);g==null||g($,F)}var k=B(i,o,(t={},ee(t,"".concat(i,"-checked"),j),ee(t,"".concat(i,"-disabled"),l),t));return h.createElement("button",Xe({},S,{type:"button",role:"switch","aria-checked":j,disabled:l,className:k,ref:r,onKeyDown:I,onClick:y}),d,h.createElement("span",{className:"".concat(i,"-inner")},h.createElement("span",{className:"".concat(i,"-inner-checked")},u),h.createElement("span",{className:"".concat(i,"-inner-unchecked")},m)))});je.displayName="Switch";const Mt=e=>{const{componentCls:r,trackHeightSM:t,trackPadding:n,trackMinWidthSM:i,innerMinMarginSM:o,innerMaxMarginSM:c,handleSizeSM:a,calc:l}=e,d=`${r}-inner`,u=_(l(a).add(l(n).mul(2)).equal()),m=_(l(c).mul(2).equal());return{[r]:{[`&${r}-small`]:{minWidth:i,height:t,lineHeight:_(t),[`${r}-inner`]:{paddingInlineStart:c,paddingInlineEnd:o,[`${d}-checked, ${d}-unchecked`]:{minHeight:t},[`${d}-checked`]:{marginInlineStart:`calc(-100% + ${u} - ${m})`,marginInlineEnd:`calc(100% - ${u} + ${m})`},[`${d}-unchecked`]:{marginTop:l(t).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${r}-handle`]:{width:a,height:a},[`${r}-loading-icon`]:{top:l(l(a).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${r}-checked`]:{[`${r}-inner`]:{paddingInlineStart:o,paddingInlineEnd:c,[`${d}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${d}-unchecked`]:{marginInlineStart:`calc(100% - ${u} + ${m})`,marginInlineEnd:`calc(-100% + ${u} - ${m})`}},[`${r}-handle`]:{insetInlineStart:`calc(100% - ${_(l(a).add(n).equal())})`}},[`&:not(${r}-disabled):active`]:{[`&:not(${r}-checked) ${d}`]:{[`${d}-unchecked`]:{marginInlineStart:l(e.marginXXS).div(2).equal(),marginInlineEnd:l(e.marginXXS).mul(-1).div(2).equal()}},[`&${r}-checked ${d}`]:{[`${d}-checked`]:{marginInlineStart:l(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:l(e.marginXXS).div(2).equal()}}}}}}},zt=e=>{const{componentCls:r,handleSize:t,calc:n}=e;return{[r]:{[`${r}-loading-icon${e.iconCls}`]:{position:"relative",top:n(n(t).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${r}-checked ${r}-loading-icon`]:{color:e.switchColor}}}},kt=e=>{const{componentCls:r,trackPadding:t,handleBg:n,handleShadow:i,handleSize:o,calc:c}=e,a=`${r}-handle`;return{[r]:{[a]:{position:"absolute",top:t,insetInlineStart:t,width:o,height:o,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:n,borderRadius:c(o).div(2).equal(),boxShadow:i,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${r}-checked ${a}`]:{insetInlineStart:`calc(100% - ${_(c(o).add(t).equal())})`},[`&:not(${r}-disabled):active`]:{[`${a}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${r}-checked ${a}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Ot=e=>{const{componentCls:r,trackHeight:t,trackPadding:n,innerMinMargin:i,innerMaxMargin:o,handleSize:c,calc:a}=e,l=`${r}-inner`,d=_(a(c).add(a(n).mul(2)).equal()),u=_(a(o).mul(2).equal());return{[r]:{[l]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:o,paddingInlineEnd:i,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${l}-checked, ${l}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:t},[`${l}-checked`]:{marginInlineStart:`calc(-100% + ${d} - ${u})`,marginInlineEnd:`calc(100% - ${d} + ${u})`},[`${l}-unchecked`]:{marginTop:a(t).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${r}-checked ${l}`]:{paddingInlineStart:i,paddingInlineEnd:o,[`${l}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${l}-unchecked`]:{marginInlineStart:`calc(100% - ${d} + ${u})`,marginInlineEnd:`calc(-100% + ${d} - ${u})`}},[`&:not(${r}-disabled):active`]:{[`&:not(${r}-checked) ${l}`]:{[`${l}-unchecked`]:{marginInlineStart:a(n).mul(2).equal(),marginInlineEnd:a(n).mul(-1).mul(2).equal()}},[`&${r}-checked ${l}`]:{[`${l}-checked`]:{marginInlineStart:a(n).mul(-1).mul(2).equal(),marginInlineEnd:a(n).mul(2).equal()}}}}}},_t=e=>{const{componentCls:r,trackHeight:t,trackMinWidth:n}=e;return{[r]:Object.assign(Object.assign(Object.assign(Object.assign({},ue(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:n,height:t,lineHeight:_(t),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${r}-disabled)`]:{background:e.colorTextTertiary}}),Qe(e)),{[`&${r}-checked`]:{background:e.switchColor,[`&:hover:not(${r}-disabled)`]:{background:e.colorPrimaryHover}},[`&${r}-loading, &${r}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${r}-rtl`]:{direction:"rtl"}})}},Dt=e=>{const{fontSize:r,lineHeight:t,controlHeight:n,colorWhite:i}=e,o=r*t,c=n/2,a=2,l=o-a*2,d=c-a*2;return{trackHeight:o,trackHeightSM:c,trackMinWidth:l*2+a*4,trackMinWidthSM:d*2+a*2,trackPadding:a,handleBg:i,handleSize:l,handleSizeSM:d,handleShadow:`0 2px 4px 0 ${new Ze("#00230b").setA(.2).toRgbString()}`,innerMinMargin:l/2,innerMaxMargin:l+a+a*2,innerMinMarginSM:d/2,innerMaxMarginSM:d+a+a*2}},At=de("Switch",e=>{const r=Ye(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[_t(r),Ot(r),kt(r),zt(r),Mt(r)]},Dt);var Nt=function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(t[n[i]]=e[n[i]]);return t};const Pt=h.forwardRef((e,r)=>{const{prefixCls:t,size:n,disabled:i,loading:o,className:c,rootClassName:a,style:l,checked:d,value:u,defaultChecked:m,defaultValue:g,onChange:f}=e,p=Nt(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[S,b]=he(!1,{value:d??u,defaultValue:m??g}),{getPrefixCls:C,direction:j,switch:v}=h.useContext(et),x=h.useContext(tt),I=(i??x)||o,y=C("switch",t),k=h.createElement("div",{className:`${y}-handle`},o&&h.createElement(it,{className:`${y}-loading-icon`})),[F,$,D]=At(y),G=nt(n),J=B(v==null?void 0:v.className,{[`${y}-small`]:G==="small",[`${y}-loading`]:o,[`${y}-rtl`]:j==="rtl"},c,a,$,D),M=Object.assign(Object.assign({},v==null?void 0:v.style),l),U=function(){b(arguments.length<=0?void 0:arguments[0]),f==null||f.apply(void 0,arguments)};return F(h.createElement(st,{component:"Switch"},h.createElement(je,Object.assign({},p,{checked:S,onChange:U,prefixCls:y,className:J,style:M,disabled:I,ref:r,loadingIcon:k}))))}),Ce=Pt;Ce.__ANT_SWITCH=!0;const Tt=({type:e,dataMap:r,constDataMap:t,componentMap:n,inputAnalysisMethod:i,dataKey:o,data:c,name:a,component_id:l,inputKey:d,...u})=>{if(!r)return s.jsx("div",{children:"加载中...."});r={...r,...t};const m=n[e];if(!m)return s.jsxs("div",{children:["未知类型 ",e]});const{Component:g,dataKey:f,...p}=m;console.log(p);let S=[];return c?S=c:i?S=r[i]:o?o in r&&(S=r[o]):f?f in r&&(S=r[f]):"first_data_key"in r?S=r[r.first_data_key]:l in r&&(S=r[l]),s.jsx(g,{...p,...u,data:S,name:a})},X=h.memo(({formJson:e,dataMap:r})=>{if(!e)return null;const{projectObj:t}=W(),o={rank:[{label:"SGB",value:"SGB"},{label:"SPECIES",value:"SPECIES"},{label:"GENUS",value:"GENUS"},{label:"FAMILY",value:"FAMILY"},{label:"ORDER",value:"ORDER"},{label:"CLASS",value:"CLASS"},{label:"PHYLUM",value:"PHYLUM"}],group_field:t!=null&&t.metadata_form?t==null?void 0:t.metadata_form.map(a=>({label:a.label,value:a.name})):[]},c={GroupSelect:{Component:q,dataKey:"sample_group_list"},Input:{Component:Vt},GroupCompareSelect:{Component:Wt},BaseSelect:{Component:q},BaseInputNumber:{Component:qt},BaseInput:{Component:Ht},BaseSwitch:{Component:Rt},RankSelect:{Component:q,dataKey:"rank",mode:void 0,initialValue:"SPECIES"},GroupFieldSelect:{Component:q,dataKey:"group_field",mode:void 0,initialValue:"group"},FilterFieldSelect:{Component:Lt,dataKey:"sample_group_list",mode:void 0},GroupSelectSampleButton:{Component:Kt},MetaphlanCladeSelect:{Component:Bt},SelectAll:{Component:Gt,dataKey:"sample_group_list"}};return s.jsx(s.Fragment,{children:e.map((a,l)=>s.jsx(Tt,{...a,dataMap:r,componentMap:c,constDataMap:o},l))})},(e,r)=>(console.log("prevProps==nextProps: ",JSON.stringify(e)===JSON.stringify(r)),JSON.stringify(e)===JSON.stringify(r))),Lt=({label:e,name:r,data:t,rules:n,field:i,...o})=>{const[c,a]=h.useState(),l=w.useFormInstance();return h.useEffect(()=>{if(t&&i){const d=[...new Set(t.map(i))],u=d.map(m=>({label:m,value:m}));a(u),l.setFieldValue(r,d[0])}},[t]),s.jsx(s.Fragment,{children:s.jsx(w.Item,{label:e,name:r,rules:n,children:s.jsx(we,{...o,options:c})})})},we=({options:e,clear:r,value:t,onChange:n,...i})=>{const o=w.useFormInstance(),c=a=>{n(a),r&&o.resetFields(r)};return s.jsx(V,{showSearch:!0,filterOption:(a,l)=>((l==null?void 0:l.label)??"").toLowerCase().includes(a.toLowerCase()),...i,options:e,value:t,onChange:c})},Bt=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>{const[c,a]=h.useState(),l=async()=>{let u=(await z.get("/fast-api/get_metaphlan_clade")).data.map(m=>({label:`${m.taxon.replaceAll(" ","_")}_${m.clade}`,value:m.clade}));a(u)};return h.useEffect(()=>{l()},[]),s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(V,{...o,options:c,showSearch:!0,filterOption:(d,u)=>((u==null?void 0:u.label)??"").toLowerCase().includes(d.toLowerCase())})})})},Wt=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>{const c=w.useFormInstance(),a=w.useWatch(["sites1","group"],c),l=w.useWatch(["sites2","group"],c),[d,u]=h.useState();return h.useEffect(()=>{a&&l&&u([{label:"Prevalent in both sites",value:"Prevalent in both sites"},{label:`Prevalent in ${l.join("-")}`,value:`Prevalent in ${l.join("-")}`},{label:`Prevalent in ${a.join("-")}`,value:`Prevalent in ${a.join("-")}`},{label:"Not prevalent in either sites",value:"Not prevalent in either sites"}])},[a,l]),s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(V,{showSearch:!0,filterOption:(m,g)=>((g==null?void 0:g.label)??"").toLowerCase().includes(m.toLowerCase()),...o,options:d})})})},Vt=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(rt,{...o})})}),Ht=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(L,{...o})})}),Rt=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(Ce,{...o})})}),qt=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(gt,{...o})})}),q=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n||null,label:e,name:r,rules:i,children:s.jsx(we,{...o,options:t})})}),Kt=({label:e,name:r,rules:t,data:n,filter:i,group:o,groupField:c})=>{const[a,l]=h.useState(),[d,u]=h.useState([]),m=w.useFormInstance();let g=[];i&&(g=i.map(b=>b.name));const f=w.useWatch(b=>{const C=Object.entries(b).filter(([j])=>g.includes(j));return Object.fromEntries(C)},m),p=w.useWatch(o,m),S=(b,C)=>{const j=b.reduce((v,x)=>{const I=x[C];return v[I]||(v[I]=[]),v[I].push(x.value),v},{});l(j)};return h.useEffect(()=>{i&&f&&(n=i.reduce((b,C)=>b.filter(j=>C.method(j)===f[C.name]),n),n=n.map(b=>{const{label:C,id:j,value:v,...x}=b;return{label:`${b.label}(${i[0].method(b)})`,value:b.value,...x}})),n&&c?S(n,c):n&&p&&S(n,p),u(n)},[n,p,f]),s.jsxs(s.Fragment,{children:[s.jsx(w.Item,{label:e,name:[r,"sample"],rules:t,children:s.jsx(Ut,{sampleGrouped:a,sampleGroup:d,watch:[r,"group"]})}),s.jsx(w.Item,{label:e,name:[r,"group"],children:s.jsx(Xt,{sampleGrouped:a})})]})},Gt=({label:e,name:r,data:t,initialValue:n,rules:i,...o})=>s.jsx(s.Fragment,{children:s.jsx(w.Item,{initialValue:n,label:e,name:r,rules:i,children:s.jsx(Jt,{data:t,...o})})}),Jt=({data:e,value:r,onChange:t,mode:n,...i})=>{const[o,c]=h.useState(r),a=l=>{console.log(l),t(l),c(l)};return s.jsxs(s.Fragment,{children:[s.jsx(V,{...i,mode:n,value:o,onChange:a,allowClear:!0,options:e}),n=="multiple"&&s.jsxs(E,{onClick:()=>{const l=e.map(d=>d.value);c(l),t(l)},children:["选择全部",o&&s.jsxs(s.Fragment,{children:["(",o.length,")"]})]})]})},Ut=({value:e,onChange:r,sampleGroup:t,watch:n,sampleGrouped:i})=>{const[o,c]=h.useState(),a=w.useFormInstance(),l=w.useWatch(n,a);h.useEffect(()=>{c(l)},[l]);const d=u=>{const m=Object.entries(i||{}).filter(([g])=>u.includes(g)).flatMap(([,g])=>g);r(m)};return h.useEffect(()=>{o&&d(o)},[o]),s.jsxs(s.Fragment,{children:[s.jsx(V,{showSearch:!0,filterOption:(u,m)=>((m==null?void 0:m.label)??"").toLowerCase().includes(u.toLowerCase()),mode:"multiple",value:e,onChange:r,options:t}),e&&s.jsxs(s.Fragment,{children:["一共选择",e.length,"个样本"]})]})},Xt=({value:e,onChange:r,sampleGrouped:t})=>{const n=i=>{if((e||[]).includes(i)){const o=(e||[]).filter(c=>!c.includes(i));r(o)}else{const o=[...e||[],i];r(o)}};return s.jsx(s.Fragment,{children:s.jsx(N,{gap:"small",wrap:!0,children:Object.entries(t||{}).map(([i,o])=>s.jsx("span",{children:s.jsxs(E,{size:"small",type:(e||[]).includes(i)?"primary":"dashed",onClick:()=>n(i),children:[i,"(",o.length,")"]})},i))})})},Bn=async e=>await z.get("/file-operation/read-file",{params:{file_path:e}}),Yt=async(e,r=0)=>await z.get("/file-operation/read-log-file",{params:{file_path:e,offset:r}}),Wn=async(e,r)=>await z.post("/file-operation/write-file",{file_path:e,content:r}),Vn=async e=>await z.get(`/find-analysis-by-id/${e}`),Qt=async(e,r)=>await z.post(`/run-analysis-v2/${e}?run_type=${r}`),Zt=async e=>await z.post(`/analysis/stop-analysis/${e}`);function T(e,r,t){let n=t.initialDeps??[],i;function o(){var c,a,l,d;let u;t.key&&((c=t.debug)!=null&&c.call(t))&&(u=Date.now());const m=e();if(!(m.length!==n.length||m.some((p,S)=>n[S]!==p)))return i;n=m;let f;if(t.key&&((a=t.debug)!=null&&a.call(t))&&(f=Date.now()),i=r(...m),t.key&&((l=t.debug)!=null&&l.call(t))){const p=Math.round((Date.now()-u)*100)/100,S=Math.round((Date.now()-f)*100)/100,b=S/16,C=(j,v)=>{for(j=String(j);j.length<v;)j=" "+j;return j};console.info(`%c⏱ ${C(S,5)} /${C(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*b,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(d=t==null?void 0:t.onChange)==null||d.call(t,i),i}return o.updateDeps=c=>{n=c},o}function se(e,r){if(e===void 0)throw new Error("Unexpected undefined");return e}const en=(e,r)=>Math.abs(e-r)<1.01,tn=(e,r,t)=>{let n;return function(...i){e.clearTimeout(n),n=e.setTimeout(()=>r.apply(this,i),t)}},ie=e=>{const{offsetWidth:r,offsetHeight:t}=e;return{width:r,height:t}},nn=e=>e,sn=e=>{const r=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),n=[];for(let i=r;i<=t;i++)n.push(i);return n},rn=(e,r)=>{const t=e.scrollElement;if(!t)return;const n=e.targetWindow;if(!n)return;const i=c=>{const{width:a,height:l}=c;r({width:Math.round(a),height:Math.round(l)})};if(i(ie(t)),!n.ResizeObserver)return()=>{};const o=new n.ResizeObserver(c=>{const a=()=>{const l=c[0];if(l!=null&&l.borderBoxSize){const d=l.borderBoxSize[0];if(d){i({width:d.inlineSize,height:d.blockSize});return}}i(ie(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return o.observe(t,{box:"border-box"}),()=>{o.unobserve(t)}},re={passive:!0},oe=typeof window>"u"?!0:"onscrollend"in window,on=(e,r)=>{const t=e.scrollElement;if(!t)return;const n=e.targetWindow;if(!n)return;let i=0;const o=e.options.useScrollendEvent&&oe?()=>{}:tn(n,()=>{r(i,!1)},e.options.isScrollingResetDelay),c=u=>()=>{const{horizontal:m,isRtl:g}=e.options;i=m?t.scrollLeft*(g&&-1||1):t.scrollTop,o(),r(i,u)},a=c(!0),l=c(!1);l(),t.addEventListener("scroll",a,re);const d=e.options.useScrollendEvent&&oe;return d&&t.addEventListener("scrollend",l,re),()=>{t.removeEventListener("scroll",a),d&&t.removeEventListener("scrollend",l)}},an=(e,r,t)=>{if(r!=null&&r.borderBoxSize){const n=r.borderBoxSize[0];if(n)return Math.round(n[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},ln=(e,{adjustments:r=0,behavior:t},n)=>{var i,o;const c=e+r;(o=(i=n.scrollElement)==null?void 0:i.scrollTo)==null||o.call(i,{[n.options.horizontal?"left":"top"]:c,behavior:t})};class cn{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const n=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(i=>{i.forEach(o=>{const c=()=>{this._measureElement(o.target,o)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()})}));return{disconnect:()=>{var i;(i=n())==null||i.disconnect(),t=null},observe:i=>{var o;return(o=n())==null?void 0:o.observe(i,{box:"border-box"})},unobserve:i=>{var o;return(o=n())==null?void 0:o.unobserve(i)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([n,i])=>{typeof i>"u"&&delete t[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:nn,rangeExtractor:sn,onChange:()=>{},measureElement:an,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var n,i;(i=(n=this.options).onChange)==null||i.call(n,this,t)},this.maybeNotify=T(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,n)=>{const i=new Map,o=new Map;for(let c=n-1;c>=0;c--){const a=t[c];if(i.has(a.lane))continue;const l=o.get(a.lane);if(l==null||a.end>l.end?o.set(a.lane,a):a.end<l.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((c,a)=>c.end===a.end?c.index-a.index:c.end-a.end)[0]:void 0},this.getMeasurementOptions=T(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,n,i,o,c)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:n,scrollMargin:i,getItemKey:o,enabled:c}),{key:!1}),this.getMeasurements=T(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:n,scrollMargin:i,getItemKey:o,enabled:c},a)=>{if(!c)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const d=this.measurementsCache.slice(0,l);for(let u=l;u<t;u++){const m=o(u),g=this.options.lanes===1?d[u-1]:this.getFurthestMeasurement(d,u),f=g?g.end+this.options.gap:n+i,p=a.get(m),S=typeof p=="number"?p:this.options.estimateSize(u),b=f+S,C=g?g.lane:u%this.options.lanes;d[u]={index:u,start:f,size:S,end:b,key:m,lane:C}}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=T(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,n,i,o)=>this.range=t.length>0&&n>0?dn({measurements:t,outerSize:n,scrollOffset:i,lanes:o}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=T(()=>{let t=null,n=null;const i=this.calculateRange();return i&&(t=i.startIndex,n=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,n]},(t,n,i,o,c)=>o===null||c===null?[]:t({startIndex:o,endIndex:c,overscan:n,count:i}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const n=this.options.indexAttribute,i=t.getAttribute(n);return i?parseInt(i,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(t,n)=>{const i=this.indexFromElement(t),o=this.measurementsCache[i];if(!o)return;const c=o.key,a=this.elementsCache.get(c);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(c,t)),t.isConnected&&this.resizeItem(i,this.options.measureElement(t,n,this))},this.resizeItem=(t,n)=>{const i=this.measurementsCache[t];if(!i)return;const o=this.itemSizeCache.get(i.key)??i.size,c=n-o;c!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,c,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=c,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,n)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((n,i)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(i))});return}this._measureElement(t,void 0)},this.getVirtualItems=T(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,n)=>{const i=[];for(let o=0,c=t.length;o<c;o++){const a=t[o],l=n[a];i.push(l)}return i},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const n=this.getMeasurements();if(n.length!==0)return se(n[Ie(0,n.length-1,i=>se(n[i]).start,t)])},this.getOffsetForAlignment=(t,n,i=0)=>{const o=this.getSize(),c=this.getScrollOffset();n==="auto"&&(n=t>=c+o?"end":"start"),n==="center"?t+=(i-o)/2:n==="end"&&(t-=o);const a=this.getTotalSize()+this.options.scrollMargin-o;return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,n="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const i=this.measurementsCache[t];if(!i)return;const o=this.getSize(),c=this.getScrollOffset();if(n==="auto")if(i.end>=c+o-this.options.scrollPaddingEnd)n="end";else if(i.start<=c+this.options.scrollPaddingStart)n="start";else return[c,n];const a=n==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,n,i.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:n="start",behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,n),{adjustments:void 0,behavior:i})},this.scrollToIndex=(t,{align:n="auto",behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1));let o=0;const c=10,a=d=>{if(!this.targetWindow)return;const u=this.getOffsetForIndex(t,d);if(!u){console.warn("Failed to get offset for index:",t);return}const[m,g]=u;this._scrollToOffset(m,{adjustments:void 0,behavior:i}),this.targetWindow.requestAnimationFrame(()=>{const f=this.getScrollOffset(),p=this.getOffsetForIndex(t,g);if(!p){console.warn("Failed to get offset for index:",t);return}en(p[0],f)||l(g)})},l=d=>{this.targetWindow&&(o++,o<c?this.targetWindow.requestAnimationFrame(()=>a(d)):console.warn(`Failed to scroll to index ${t} after ${c} attempts.`))};a(n)},this.scrollBy=(t,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var t;const n=this.getMeasurements();let i;if(n.length===0)i=this.options.paddingStart;else if(this.options.lanes===1)i=((t=n[n.length-1])==null?void 0:t.end)??0;else{const o=Array(this.options.lanes).fill(null);let c=n.length-1;for(;c>=0&&o.some(a=>a===null);){const a=n[c];o[a.lane]===null&&(o[a.lane]=a.end),c--}i=Math.max(...o.filter(a=>a!==null))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:n,behavior:i})=>{this.options.scrollToFn(t,{behavior:i,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(r)}}const Ie=(e,r,t,n)=>{for(;e<=r;){const i=(e+r)/2|0,o=t(i);if(o<n)e=i+1;else if(o>n)r=i-1;else return i}return e>0?e-1:0};function dn({measurements:e,outerSize:r,scrollOffset:t,lanes:n}){const i=e.length-1,o=l=>e[l].start;if(e.length<=n)return{startIndex:0,endIndex:i};let c=Ie(0,i,o,t),a=c;if(n===1)for(;a<i&&e[a].end<t+r;)a++;else if(n>1){const l=Array(n).fill(0);for(;a<i&&l.some(u=>u<t+r);){const u=e[a];l[u.lane]=u.end,a++}const d=Array(n).fill(t+r);for(;c>=0&&d.some(u=>u>=t);){const u=e[c];d[u.lane]=u.start,c--}c=Math.max(0,c-c%n),a=Math.min(i,a+(n-1-a%n))}return{startIndex:c,endIndex:a}}const ae=typeof document<"u"?h.useLayoutEffect:h.useEffect;function un(e){const r=h.useReducer(()=>({}),{})[1],t={...e,onChange:(i,o)=>{var c;o?ot.flushSync(r):r(),(c=e.onChange)==null||c.call(e,i,o)}},[n]=h.useState(()=>new cn(t));return n.setOptions(t),ae(()=>n._didMount(),[]),ae(()=>n._willUpdate()),n}function hn(e){return un({observeElementRect:rn,observeElementOffset:on,scrollToFn:ln,...e})}const{Text:le}=H,mn=({file_path:e})=>{var d;h.useEffect(()=>{console.log("fileKey",e),e&&o(e)},[e]);const{messageApi:r}=W(),t=h.useRef(0),[n,i]=h.useState([]),o=async(u,m=!1)=>{const g=await Yt(u);t.current=g.data.offset,i(g.data.content),m&&r.success(`日志加载成功: ${u}`)},c=h.useRef(null),a=hn({count:n.length,getScrollElement:()=>c.current,estimateSize:()=>30,overscan:10});h.useEffect(()=>{(n==null?void 0:n.length)>0&&a.scrollToIndex(n.length-1,{align:"end",behavior:"smooth"})},[n==null?void 0:n.length]);const l=a.getVirtualItems();return s.jsx(fe,{size:"small",extra:s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:()=>{o(e)},children:"刷新日志"}),title:s.jsxs(N,{gap:"small",wrap:"wrap",children:[s.jsxs(O,{color:"blue",children:["文件: ",e]}),s.jsxs(O,{color:"purple",children:["偏移量: ",t.current]})]}),bodyStyle:{padding:0},children:s.jsx("div",{ref:c,style:{height:400,overflowY:"auto",fontFamily:"monospace",backgroundColor:"#1e1e1e",color:"#d4d4d4",padding:"0 12px"},children:s.jsx("div",{style:{height:a.getTotalSize(),width:"100%",position:"relative"},children:s.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${((d=l[0])==null?void 0:d.start)??0}px)`},children:l.map(u=>s.jsx("div",{"data-index":u.index,ref:a.measureElement,style:{padding:"4px 0",borderBottom:"1px solid #333"},children:s.jsxs(N,{gap:"middle",children:[s.jsxs(le,{type:"secondary",style:{width:60,color:"#d4d4d4"},children:["#",u.index+1]}),s.jsx(le,{style:{whiteSpace:"pre-wrap",color:"#d4d4d4"},children:n[u.index]})]})},u.key))})})})})},gn=({visible:e,onClose:r,params:t})=>s.jsx(me,{footer:null,title:"参数",width:"50%",open:e,onCancel:r,children:s.jsx(H,{children:s.jsx("pre",{children:JSON.stringify(t,null,2)})})}),pn=({formJson:e,openModal:r})=>{if(!e)return null;const[t,n]=h.useState([]),i=async()=>{const o=e.map(l=>l.dataKey),a=((await z.post("/list-bio-database",{type_list:o})).data||[]).reduce((l,d)=>{const u=d.type;l[u]||(l[u]=[]);const{name:m,database_id:g,...f}=d;return l[u].push({label:m,value:g,...f}),l},{});n(a),console.log(a)};return h.useEffect(()=>{i()},[e]),s.jsx(s.Fragment,{children:s.jsxs(N,{gap:"small",children:[s.jsx("div",{style:{flex:1},children:s.jsx(X,{formJson:e,dataMap:t})}),s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:r,children:"配置数据库"}),s.jsx(E,{onClick:i,size:"small",type:"primary",children:"刷新"})]})})},fn=({visible:e,onClose:r,params:t,callback:n})=>{if(!e)return null;const[i,o]=h.useState([]),[c,a]=h.useState(!1),[l]=w.useForm(),[d,u]=h.useState(t[0].dataKey),[m,g]=h.useState(null),f=async x=>{a(!0);const I=await z.post("/list-bio-database",x);o(I.data),a(!1)},p=async()=>({...await l.validateFields(),type:d}),S=async()=>{const x=await p();m?await z.post("/update-bio-database",{...x,database_id:m.database_id}):await z.post("/add-bio-database",x),b(),g(void 0),l.resetFields()},b=()=>{f({type:d})};h.useEffect(()=>{f({type:d})},[t]);const C=x=>{u(x),f({type:x})},j=async x=>{await z.delete(`/delete-bio-database/${x.id}`),b()},v=x=>{l.setFieldsValue(x),g(x)};return s.jsxs(me,{title:"数据库操作",open:e,onCancel:r,width:"50%",footer:null,children:[s.jsx(be,{tabBarExtraContent:s.jsxs(s.Fragment,{children:[s.jsx(E,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:b,children:" 刷新"}),s.jsxs(E,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{g(void 0),S()},children:[" ",m?"更新":"添加"]})]}),activeKey:d,onChange:C,items:t.map(x=>({key:x.name,label:x.label,children:s.jsx("div",{})}))}),s.jsxs(w,{form:l,style:{maxWidth:600},labelCol:{span:3},children:[s.jsx(w.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:s.jsx(L,{})}),s.jsx(w.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:s.jsx(L,{})}),s.jsx(w.Item,{name:"db_index",label:"索引",children:s.jsx(L,{})})]}),s.jsx(Se,{dataSource:i,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(x,I)=>s.jsxs(N,{gap:"small",children:[s.jsx(K,{title:"确定删除吗？",onConfirm:()=>{j(I)},children:s.jsx(E,{size:"small",type:"primary",danger:!0,children:"删除"})}),s.jsx(E,{size:"small",type:"primary",onClick:()=>{v(I)},children:"编辑"})]})}],loading:c,pagination:!1})]})},xn=({visible:e,params:r,onClose:t,callback:n})=>{var b,C,j;const[i]=w.useForm(),{messageApi:o,project:c}=W();h.useEffect(()=>{e&&p()},[r]);const[a,l]=h.useState(),[d,u]=h.useState(),m=()=>{t(),n&&n()},[g,f]=h.useState(),p=async()=>{f(!0);const v=await z.post(`/analysis/edit-params/${r}`);l(v.data),u(v.data.analysis_result),i.resetFields(),i.setFieldsValue(v.data.request_param),f(!1)},S=v=>{if(v&&Object.keys(v).length>0)return Object.keys(v)[0]};return s.jsx(s.Fragment,{children:s.jsx(pt,{size:"default",loading:g,title:s.jsx(s.Fragment,{children:a&&s.jsxs(s.Fragment,{children:[s.jsx(O,{children:a==null?void 0:a.component_name}),s.jsx(O,{children:a==null?void 0:a.analysis_name}),s.jsx(O,{children:String(a==null?void 0:a.analysis_id).slice(0,8)})]})}),width:"50%",open:e,onClose:t,children:a&&s.jsx(s.Fragment,{children:s.jsx(bn,{form:i,requestParam:{...a.request_param,analysis_id:a==null?void 0:a.analysis_id},dataMap:{...d,first_data_key:S(d)},formJson:[...((b=a.content)==null?void 0:b.formJson)||[],...((C=a.content)==null?void 0:C.upstreamFormJson)||[],...(a==null?void 0:a.inputFormJson)||[]],databases:(j=a.content)==null?void 0:j.databases,upstreamFormJson:a==null?void 0:a.upstreamFormJson,callback:m})})})})},bn=({form:e,requestParam:r,dataMap:t,formJson:n,databases:i,callback:o,showCancal:c=!1})=>{const{modals:a,openModals:l,closeModals:d}=ge(["paramsView","bioDatabases"]),[u,m]=h.useState([]),[g,f]=h.useState([]),{messageApi:p,projectList:S,project:b}=W();h.useEffect(()=>{C()},[JSON.stringify(n)]);const C=()=>{if(Array.isArray(n)){const x=n.filter(y=>!(y!=null&&y.required)&&!(y!=null&&y.db)&&!y.component_id),I=n.filter(y=>(y==null?void 0:y.required)||(y==null?void 0:y.db)||y.component_id);m(I),f(x)}},j=x=>({...r,...x}),v=async(x,I=!1)=>{var F;const y=await e.validateFields(),k=j(y);try{const $=await z.post(`/fast-api/analysis-controller?save=${x}&is_submit=${I}`,k);console.log($),x?(p.success("执行成功!"),o&&o()):l("paramsView",$.data)}catch($){console.log($),(F=$.response)!=null&&F.data&&p.error($.response.data.detail)}};return s.jsxs(s.Fragment,{children:[s.jsxs(w,{form:e,onValuesChange:(x,I)=>{},children:[s.jsx(be,{items:[{key:"1",label:"必填参数",forceRender:!0,children:s.jsxs(s.Fragment,{children:[s.jsx(X,{formJson:[...u],dataMap:t}),i&&s.jsx(pn,{openModal:()=>{l("bioDatabases",i)},formJson:i})]})},{key:"2",label:"可选参数",forceRender:!0,children:s.jsx(s.Fragment,{children:s.jsx(X,{formJson:[...g],dataMap:{}})})}]}),s.jsx(w.Item,{label:"分析名称",name:"analysis_name",style:{maxWidth:600},rules:[{required:!0,message:"该字段不能为空!"}],children:s.jsx(L,{})}),s.jsxs(N,{gap:"small",children:[s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:()=>{v(!1)},children:"查看参数"}),s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:()=>v(!0),children:r!=null&&r.analysis_id?s.jsxs(s.Fragment,{children:["更新分析(",r.analysis_name,")(",String(r.analysis_id).slice(0,8),")"]}):s.jsx(s.Fragment,{children:"保存分析"})}),(r==null?void 0:r.analysis_id)&&c&&s.jsx(E,{size:"small",color:"cyan",onClick:()=>e.setFieldValue("analysis_id",void 0),children:"取消更新"})]}),s.jsx(at,{ghost:!0,items:[{key:"1",label:"更多",children:s.jsx(s.Fragment,{children:s.jsx(w.Item,{noStyle:!0,shouldUpdate:!0,children:()=>s.jsx(H,{children:s.jsx("pre",{children:JSON.stringify(j(e.getFieldsValue()),null,2)})})})})}]})]}),s.jsx(gn,{visible:a.paramsView.visible,onClose:()=>d("paramsView"),params:a.paramsView.params}),s.jsx(fn,{visible:a.bioDatabases.visible,onClose:()=>d("bioDatabases"),params:a.bioDatabases.params})]})},Sn=({data:e,url:r,filename:t})=>{const{Search:n}=L,[i,o]=h.useState([]),c=a=>a?Object.keys(a).map(l=>({title:l,dataIndex:l,key:l,ellipsis:!0,width:150})):[];return h.useEffect(()=>{if(e){const a=e.map((l,d)=>({...l,key:d}));o(a)}},[e]),s.jsx(s.Fragment,{children:Array.isArray(i)&&s.jsx(s.Fragment,{children:s.jsx(Se,{size:"small",title:()=>s.jsxs(N,{gap:"small",children:[s.jsx(n,{size:"small",placeholder:"input search text",allowClear:!0,onSearch:a=>{const l=e.filter(d=>Object.values(d).some(u=>typeof u=="string"&&u.includes(a)));o(l)},style:{width:304}}),r&&s.jsx(pe,{title:`${window.location.origin}${r}`,children:s.jsx(E,{size:"small",onClick:()=>{window.open(`${r}?t=${Date.now()}`,"_blank")},type:"primary",children:"下载"})}),s.jsx("span",{children:t})]}),scroll:{x:"max-content",y:55*5},dataSource:i,pagination:!1,virtual:!0,columns:c(e[0]),footer:()=>`一共${e.length}条记录`})})})},ce=({data:e,url:r,filename:t})=>s.jsx("div",{children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(bt,{src:t!=null&&t.endsWith("pdf")?e:`${e}?t=${Date.now()}`,style:{maxWidth:"20rem",marginRight:"0.5rem"}}),r&&s.jsxs("div",{children:[s.jsx(pe,{title:`${window.location.origin}${r}`,children:s.jsx(E,{size:"small",onClick:()=>{window.open(`${r}?t=${Date.now()}`,"_blank")},type:"primary",children:"下载"})}),t]})]})}),{Paragraph:Hn}=H,yn=({data:e})=>s.jsx(s.Fragment,{children:s.jsx(xe,{value:e})}),vn=({data:e})=>s.jsx("div",{style:{padding:"1rem"},children:s.jsx(ve,{closable:!0,message:e,type:"info",showIcon:!0})}),jn=({data:e})=>s.jsx(s.Fragment,{children:s.jsx(H,{children:s.jsx("pre",{style:{margin:0},children:e})})}),Cn=({data:e})=>s.jsx(s.Fragment,{children:s.jsx(xe,{value:e,defaultLanguage:"json"})}),wn=({data:e})=>s.jsx(s.Fragment,{children:e&&e.startsWith("/brave")?s.jsx(s.Fragment,{children:s.jsx("iframe",{src:e,width:"100%",style:{height:"80vh",border:"none"}})}):s.jsx(s.Fragment,{children:e})}),In={table:Sn,string:yn,html:wn,json:Cn,text:jn,info:vn},$n=({type:e,...r})=>{const t=In[e]||(()=>s.jsxs("div",{children:["未知类型 ",e]}));return s.jsx(t,{...r})},Rn=h.forwardRef(({params:e,visible:r,onClose:t},n)=>{const{output_dir:i,analysis_id:o}=e||{};return r?s.jsx(s.Fragment,{children:o&&s.jsx(En,{onClose:t,analysis_id:o})}):null}),En=({analysis_id:e,onClose:r,cancalReportCallback:t})=>{var j,v;const[n,i]=h.useState(!1),[o,c]=h.useState(null),a=lt(),{eventSourceRef:l,status:d,reconnect:u}=ct(),m=h.useRef(null),g=h.useRef(null),{messageApi:f}=W(),{modals:p,openModals:S,closeModals:b}=ge(["editParams"]),C=async x=>{i(!0);const I=await z.get(`/analysis/visualization-results/${x}`);c(I.data),m.current=x,i(!1)};return h.useEffect(()=>{C(e)},[e]),h.useEffect(()=>{var x;if(l){const I=y=>{const k=JSON.parse(y.data);g.current=k,m.current==k.analysis_id&&(k.event=="analysis_complete"||k.event=="analysis_failed"||k.event=="analysis_started")&&C(m.current)};return(x=l.current)==null||x.addEventListener("message",I),()=>{var y;console.log("removeEventListener"),(y=l.current)==null||y.removeEventListener("message",I)}}},[l.current]),s.jsx(s.Fragment,{children:s.jsxs(fe,{size:"small",title:s.jsx(s.Fragment,{children:o?s.jsxs(s.Fragment,{children:[s.jsx(O,{style:{cursor:"pointer"},onClick:()=>{a(`/component/${o==null?void 0:o.component_type}/${o==null?void 0:o.component_id}`)},children:o==null?void 0:o.component_name}),s.jsx(O,{children:o==null?void 0:o.analysis_name}),s.jsx(O,{children:String(o==null?void 0:o.analysis_id).slice(0,8)}),s.jsx(O,{children:o==null?void 0:o.analysis_status}),m.current==((j=g.current)==null?void 0:j.analysis_id)&&s.jsxs(O,{children:[" ",s.jsx(s.Fragment,{children:(v=g.current)==null?void 0:v.event})]})]}):s.jsx(s.Fragment,{})}),extra:s.jsxs(N,{gap:"small",children:[r&&s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:()=>r(),children:"关闭"}),o&&s.jsxs(s.Fragment,{children:[s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:()=>{S("editParams",o.analysis_id)},children:"编辑参数"}),(o==null?void 0:o.analysis_status)=="running"?s.jsx(s.Fragment,{children:s.jsx(K,{title:"是否停止!",onConfirm:async()=>{await Zt(o.analysis_id),f.success("停止成功")},children:s.jsx(E,{size:"small",color:"cyan",variant:"solid",children:"停止"})})}):s.jsx(s.Fragment,{children:s.jsx(K,{title:"是否运行!",onConfirm:async()=>{await Qt(o.analysis_id,"job"),f.success("运行成功")},children:s.jsx(E,{size:"small",color:"cyan",variant:"solid",children:o.analysis_status=="created"?"运行":"重新运行"})})})]}),s.jsx(K,{title:o!=null&&o.is_report?"是否取消报告":"是否报告",onConfirm:async()=>{await z.post(`/analysis/update-report/${o==null?void 0:o.analysis_id}`),f.success("操作成功!"),c(null),t&&t()},children:s.jsx(E,{size:"small",color:"cyan",variant:"solid",children:o!=null&&o.is_report?"取消报告":"报告"})}),s.jsx(E,{size:"small",color:"cyan",variant:"solid",onClick:()=>C(e),children:"刷新"})]}),children:[(o==null?void 0:o.analysis_status)=="failed"?s.jsx("div",{style:{textAlign:"center"},children:s.jsx(mn,{file_path:o==null?void 0:o.command_log_path})}):s.jsx(s.Fragment,{children:(o==null?void 0:o.analysis_status)=="running"&&(o==null?void 0:o.run_type)!="server"?s.jsx(dt,{active:!0}):s.jsx(s.Fragment,{children:e&&s.jsx(Fn,{analsyisResult:o,loading:n})})}),s.jsx(xn,{callback:()=>C(e),visible:p.editParams.visible,params:p.editParams.params,onClose:()=>b("editParams")})]})})},Fn=({analsyisResult:e,loading:r})=>s.jsxs(ft,{spinning:r,children:[e&&s.jsxs(s.Fragment,{children:[e.images&&s.jsx("div",{children:Array.isArray(e.images)?s.jsx(ut,{gutter:{xs:8,sm:16,md:24,lg:32},children:e.images.map((t,n)=>s.jsx(ht,{span:4,children:s.jsx(ce,{...t})},n))}):s.jsx(s.Fragment,{children:s.jsx(ce,{...e.images})})}),e.tables&&Array.isArray(e.tables)&&s.jsx(s.Fragment,{children:e.tables.map((t,n)=>s.jsx($n,{...t},n))})]}),s.jsx(mt,{data:e==null?void 0:e.description})]});export{Rn as A,fn as B,bn as C,xn as E,X as F,mn as L,gn as P,pn as a,Bn as b,$n as c,En as d,Vn as f,Qt as r,Zt as s,Wn as w};

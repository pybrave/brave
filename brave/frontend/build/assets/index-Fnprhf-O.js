import{r as a,u as H,Y as Q,aP as W,b as Y,aQ as q,c as D,j as e,R as G,C as b,E as A,F as J,B,x as N,a as V,$ as X}from"./main-DXywrSBF.js";import{d as Z}from"./index-CqFY2fF-.js";import O from"./index-DKfe01fJ.js";import{C as v}from"./index-BwawJwES.js";import{T as ee}from"./index-qwSUrHIR.js";import{T as se}from"./Table-DFI76zEx.js";import"./index-DjoHMCCX.js";import"./index-C4p1iVpj.js";import"./index-K-Wj2x7K.js";import"./UpOutlined-7MciF88_.js";import"./index-BT58XBAc.js";import"./index-gpGOOqTj.js";import"./study-page-BYtG-saP.js";import"./usePagination-D0YIndB3.js";import"./index-CWc1_CU5.js";import"./RedoOutlined-CU0rkWuz.js";import"./index-CGxiMSah.js";import"./callSuper-DcWcRBJA.js";import"./index-Bc2PCwt1.js";import"./addEventListener-DnTxgold.js";import"./DownloadOutlined-CSSEbxCr.js";import"./Dropdown-CgdcCv_B.js";const Ee=()=>{const[m,n]=a.useState(!1),{project:o,projectObj:r}=H(s=>s.user),[h,P]=a.useState(),[g,p]=a.useState(),E=Q(),j=new URLSearchParams(E.search),t=j.get("key"),i=j.get("project"),y=W(),{modal:c,openModal:k,closeModal:K}=Y(),[F,$]=a.useState(t);a.useEffect(()=>{i&&i!=o&&y(q({project:i}))},[i]),a.useRef(null),D();const w=(s,l)=>{const{pathname:d,search:R,hash:x}=window.location,f=new URLSearchParams(R||"");f.set(s,l);const S=x.startsWith("#/");let u="";if(S){const[_,I=""]=x.replace(/^#/,"").split("?"),U=new URLSearchParams(I);U.set(s,l),u=`#${_}?${U.toString()}`}else u=`${d}?${f.toString()}`;window.history.pushState({},"",u)},C=a.useRef(null),[T,M]=a.useState(null),L=()=>{if(C.current){const s=C.current.getBoundingClientRect().top;M(s)}};a.useEffect(()=>(L(),window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L)}),[]);const z=async()=>{var l,d,R,x,f,S,u;n(!0);let s=await V.post("/list-analysis-tree",{is_report:!0,project:o});P(s.data),!t&&s.data.length>0&&(l=s.data[0])!=null&&l.children&&((d=s.data[0])==null?void 0:d.children.length)>0&&(p((R=s.data[0])==null?void 0:R.children[0]),$((f=(x=s.data[0])==null?void 0:x.children[0])==null?void 0:f.key),w("project",o),w("key",(u=(S=s.data[0])==null?void 0:S.children[0])==null?void 0:u.key)),n(!1)};return a.useEffect(()=>{z()},[o]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"0 auto"},children:[e.jsxs(G,{style:{marginTop:"1rem"},children:[e.jsx(b,{lg:6,sm:6,xs:24,ref:C,style:{position:"sticky",top:`${T}px`,alignSelf:"flex-start",height:`calc(100vh - ${T}px - 1rem )`},children:e.jsx(v,{loading:m,title:r==null?void 0:r.project_name,size:"small",style:{height:"100%"},styles:{body:{height:"90%",overflowY:"auto"}},extra:e.jsx(J,{gap:"small",children:e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:z,children:"Refresh"})}),children:Array.isArray(h)&&h.length!=0?e.jsx(e.Fragment,{children:e.jsx(te,{onSelect:s=>{var l,d;((l=s.node)==null?void 0:l.type)=="analysis"?(p(s.node),$(s.node.key),w("project",o),w("key",s.node.key)):((d=s.node)==null?void 0:d.type)=="components"&&console.log(s.node)},defaultSelectKey:F,treeData:h})}):e.jsx(e.Fragment,{children:e.jsx(A,{})})})}),e.jsx(b,{lg:18,sm:18,xs:24,style:{paddingLeft:"1rem"},children:e.jsx(ee,{type:"card",size:"small",tabPosition:"right",items:[{key:"1",label:"Analysis Result",children:e.jsx(e.Fragment,{children:F?e.jsx(e.Fragment,{children:e.jsx(Z,{cancalReportCallback:()=>{z()},analysis_id:F})}):e.jsx(e.Fragment,{children:e.jsx(v,{size:"small",children:e.jsx(A,{})})})})},{key:"2",label:"Records",children:e.jsx(e.Fragment,{children:e.jsx(v,{size:"small",style:{marginBottom:"1rem"},extra:e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k("projectForm",{project_id:o})},children:"Edit"}),children:r!=null&&r.description?e.jsx(O,{data:r==null?void 0:r.description}):e.jsx(A,{})})})}],defaultActiveKey:"1"})})]}),e.jsx(N,{research:!0,params:c.params,visible:c.key=="projectForm"&&c.visible,onClose:K})]})},te=({treeData:m,defaultSelectKey:n,onSelect:o})=>{const[r,h]=a.useState(n),[P,g]=a.useState([]),p=(t,i,y=[])=>{for(const c of i){if(c.key===t)return y;if(c.children){const k=p(t,c.children,[...y,c.key]);if(k.length)return k}}return[]};a.useEffect(()=>{if(n){const t=p(n,m);g(t),h(n)}},[n,m]);const E=(t,i)=>{if(t.length>0){o(i),h(t[0]);const y=p(t[0],m);g(y)}},j=t=>{g(t)};return e.jsx(e.Fragment,{children:e.jsx(se,{selectedKeys:[r],showLine:!0,expandedKeys:P,onExpand:j,autoExpandParent:!0,switcherIcon:e.jsx(X,{}),onSelect:E,treeData:m})})};export{Ee as default};

import{r as b,d as Si,j as x,f as bt,P as ac,B as le,a as Ft,F as nt,c as it,g as cc,E as _i,h as Ei,b as Ci,M as Pn,I as wr,i as Mi,k as lc,W as fe,l as po,m as Pt,n as Ni,u as uc,e as dc,o as fc,p as hc,q as gc}from"./index-B_3LX8Sv.js";import{U as Ai,A as Di,a as pc}from"./index-C2fPXklV.js";import{c as mc}from"./utils-D2B0dIuM.js";import{s as yc,a as vc,C as xc,b as wc,d as bc}from"./index-DxbtQs0z.js";import{M as Sc,a as _c}from"./index-ufbsmYFx.js";import{D as Ec}from"./index-BWj5Fyk7.js";import{T as Ii,C as ki}from"./index-BKM-36RV.js";import{F as Cc,B as Mc,P as Nc}from"./index-BR1xyGpG.js";import{F as Ri}from"./Table-DPfHYlNE.js";import{D as Ac}from"./index-DCyJhlMn.js";import{f as Dc,u as Ic,a as kc,M as Rc,B as Tc}from"./index-DcQUXs6x.js";import{O as Pc}from"./index-OGLv2aFq.js";import{T as $c,c as Lc,i as Sn,a as _n,d as zr,t as jc,n as zc}from"./index-cUFOooy2.js";import{M as Oc}from"./index-D0T1H4s6.js";import{T as Fc}from"./index-CnwY4WqK.js";import"./index-DpyPNgke.js";import"./index-Cd7H0E4W.js";import"./index-C_2k1w2Z.js";import"./index-T5bbXZ1z.js";import"./callSuper-DcPjgIPQ.js";import"./index-iZ4aO8fm.js";import"./addEventListener-BOhPI-H5.js";function mo(e,t,n){var r=new $c;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}function Bc(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(i){for(o=0;o<n;++o)r[o]=e[o]*(1-i)+t[o]*i;return r}}function Hc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Vc(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,o=new Array(r),i=new Array(n),s;for(s=0;s<r;++s)o[s]=$t(e[s],t[s]);for(;s<n;++s)i[s]=t[s];return function(a){for(s=0;s<r;++s)i[s]=o[s](a);return i}}function Xc(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Le(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Yc(e,t){var n={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?n[o]=$t(e[o],t[o]):r[o]=t[o];return function(i){for(o in n)r[o]=n[o](i);return r}}var br=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nr=new RegExp(br.source,"g");function Wc(e){return function(){return e}}function Uc(e){return function(t){return e(t)+""}}function Ti(e,t){var n=br.lastIndex=nr.lastIndex=0,r,o,i,s=-1,a=[],c=[];for(e=e+"",t=t+"";(r=br.exec(e))&&(o=nr.exec(t));)(i=o.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(r=r[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,c.push({i:s,x:Le(r,o)})),n=nr.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?c[0]?Uc(c[0].x):Wc(t):(t=c.length,function(d){for(var l=0,f;l<t;++l)a[(f=c[l]).i]=f.x(d);return a.join("")})}function $t(e,t){var n=typeof t,r;return t==null||n==="boolean"?Lc(t):(n==="number"?Le:n==="string"?(r=_n(t))?(t=r,Sn):Ti:t instanceof _n?Sn:t instanceof Date?Xc:Hc(t)?Bc:Array.isArray(t)?Vc:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Yc:Le)(e,t)}var yo=180/Math.PI,Sr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Pi(e,t,n,r,o,i){var s,a,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),e*r<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*yo,skewX:Math.atan(c)*yo,scaleX:s,scaleY:a}}var cn;function qc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Sr:Pi(t.a,t.b,t.c,t.d,t.e,t.f)}function Gc(e){return e==null||(cn||(cn=document.createElementNS("http://www.w3.org/2000/svg","g")),cn.setAttribute("transform",e),!(e=cn.transform.baseVal.consolidate()))?Sr:(e=e.matrix,Pi(e.a,e.b,e.c,e.d,e.e,e.f))}function $i(e,t,n,r){function o(d){return d.length?d.pop()+" ":""}function i(d,l,f,u,h,m){if(d!==f||l!==u){var p=h.push("translate(",null,t,null,n);m.push({i:p-4,x:Le(d,f)},{i:p-2,x:Le(l,u)})}else(f||u)&&h.push("translate("+f+t+u+n)}function s(d,l,f,u){d!==l?(d-l>180?l+=360:l-d>180&&(d+=360),u.push({i:f.push(o(f)+"rotate(",null,r)-2,x:Le(d,l)})):l&&f.push(o(f)+"rotate("+l+r)}function a(d,l,f,u){d!==l?u.push({i:f.push(o(f)+"skewX(",null,r)-2,x:Le(d,l)}):l&&f.push(o(f)+"skewX("+l+r)}function c(d,l,f,u,h,m){if(d!==f||l!==u){var p=h.push(o(h)+"scale(",null,",",null,")");m.push({i:p-4,x:Le(d,f)},{i:p-2,x:Le(l,u)})}else(f!==1||u!==1)&&h.push(o(h)+"scale("+f+","+u+")")}return function(d,l){var f=[],u=[];return d=e(d),l=e(l),i(d.translateX,d.translateY,l.translateX,l.translateY,f,u),s(d.rotate,l.rotate,f,u),a(d.skewX,l.skewX,f,u),c(d.scaleX,d.scaleY,l.scaleX,l.scaleY,f,u),d=l=null,function(h){for(var m=-1,p=u.length,y;++m<p;)f[(y=u[m]).i]=y.x(h);return f.join("")}}}var Kc=$i(qc,"px, ","px)","deg)"),Zc=$i(Gc,", ",")",")"),Jc=1e-12;function vo(e){return((e=Math.exp(e))+1/e)/2}function Qc(e){return((e=Math.exp(e))-1/e)/2}function el(e){return((e=Math.exp(2*e))-1)/(e+1)}const yn=function e(t,n,r){function o(i,s){var a=i[0],c=i[1],d=i[2],l=s[0],f=s[1],u=s[2],h=l-a,m=f-c,p=h*h+m*m,y,w;if(p<Jc)w=Math.log(u/d)/t,y=function(M){return[a+M*h,c+M*m,d*Math.exp(t*M*w)]};else{var E=Math.sqrt(p),g=(u*u-d*d+r*p)/(2*d*n*E),v=(u*u-d*d-r*p)/(2*u*n*E),_=Math.log(Math.sqrt(g*g+1)-g),C=Math.log(Math.sqrt(v*v+1)-v);w=(C-_)/t,y=function(M){var N=M*w,T=vo(_),O=d/(n*E)*(T*el(t*N+_)-Qc(_));return[a+O*h,c+O*m,d*T/vo(t*N+_)]}}return y.duration=w*1e3*t/Math.SQRT2,y}return o.rho=function(i){var s=Math.max(.001,+i),a=s*s,c=a*a;return e(s,a,c)},o}(Math.SQRT2,2,4),tl=({visible:e,onClose:t,params:n,callback:r})=>{if(!e)return null;const[o,i]=b.useState(),[s,a]=Si.useMessage(),[c,d]=b.useState("main"),l=b.useRef(null),f=async u=>{try{const h=await Ft.get(`/get-component-module-content/${u.component_id}?script_name=${c}`);console.log(h),i(h.data)}catch(h){s.error(`${h.response.data.detail}`)}};return b.useEffect(()=>{f(n)},[JSON.stringify(n),c]),x.jsxs(x.Fragment,{children:[a,x.jsxs(Ec,{extra:x.jsxs(bt,{justify:"flex-end",gap:"small",children:[x.jsx(ac,{title:"是否生成脚本",onConfirm:async()=>{await Ft.post(`/component/convert-ipynb/${n.component_id}`),s.success("是否生成脚本成功!"),f(n)},children:x.jsx(le,{size:"small",color:"cyan",variant:"solid",children:"生成脚本"})}),x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f(n)},children:"刷新"}),x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{l.current.setValue(o==null?void 0:o.content)},children:"保存"})]}),title:"查看文件",open:e,onClose:t,width:"50%",children:[x.jsx("ul",{children:x.jsxs("li",{children:["path:",o==null?void 0:o.path]})}),x.jsx("hr",{}),x.jsx(Ii,{onChange:u=>{d(u)},items:[{label:"main",key:"main"},{label:"input_parse",key:"input_parse"},{label:"output_parse",key:"output_parse"}]}),x.jsx(Sc,{value:o==null?void 0:o.content,editorRef:l,defaultLanguage:"python"})]})]})},nl=({parseData:e,columns:t,importData:n})=>x.jsx(Ri,{size:"small",bordered:!0,pagination:!1,footer:()=>x.jsxs("div",{style:{textAlign:"right"},children:["一共",e.length,"条记录   ",x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:n,children:"确认"})]}),columns:t,dataSource:e}),rr=({component_type:e,component_id:t,component_name:n,inputForm:r,operatePipeline:o,name:i,callback:s})=>{const[a]=nt.useForm();console.log("-->ImportFile渲染");const{messageApi:c,project:d}=it(),[l,f]=b.useState([]);cc(g=>g.global.setting);const[u,h]=b.useState(),m=b.useRef(null);b.useEffect(()=>{if(r){let v=r.map(_=>Array.isArray(_.name)?_.name[1]:_.name).map(_=>({title:_,dataIndex:_,key:_,render:C=>x.jsx("span",{children:C})}));v=[{title:"样本名称",dataIndex:"sample_name",key:"sample_name",render:_=>x.jsx("span",{children:_})},...v,{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(_,C)=>x.jsx(bt,{gap:"small",children:x.jsx(le,{size:"small",danger:!0,onClick:()=>{p(C.sample_name)},children:"删除"})})}],console.log(v),m.current=v,h(v)}},[r]);const p=g=>{f(v=>v.filter(_=>_.sample_name!==g))},y=g=>{const{content:v,sample_name:_}=g;return l?l.map(C=>{const{sample_name:M,...N}=C;return{...g,project:d,component_id:t,content:JSON.stringify(N),sample_name:M}}):[{...g,project:d,component_id:t,content:JSON.stringify(v),sample_name:_}]},w=async()=>{const g=await a.validateFields();if(g.length==0){c.error("没有数据添加!");return}if(r&&r.length==0){c.error("该组件没有配置inputForm!");return}const v=y(g);try{const _=await Ft.post("/import-data",v);c.success("导入成功"),s&&s()}catch(_){c.error(_.response.data.detail)}},E=async()=>{const g=await a.validateFields();if(r&&r.length==0){c.error("该组件没有配置inputForm!");return}const v=await Ft.post("/parse-import-data",{content:JSON.stringify(g.content)});console.log(v),f(v.data)};return b.useEffect(()=>{const g=v=>{var O;const _=((O=v.clipboardData)==null?void 0:O.getData("Text"))||"";if(!_)return;const C=_.includes("	")?"	":",",N=_.split(/\r?\n/).filter(R=>R.trim()!=="").map(R=>R.split(C).map(P=>P.trim()));console.log(N);const T=N.map(R=>{const P={};return m.current.forEach(($,S)=>{R.length<=S?P[$.dataIndex]="unknown":P[$.dataIndex]=R[S]}),P});f(T),c.success("粘贴成功！")};return document.addEventListener("paste",g),()=>{document.removeEventListener("paste",g)}},[]),x.jsx(x.Fragment,{children:x.jsx(ki,{title:`${n}(${t})`,extra:x.jsxs(bt,{gap:"small",children:[x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{o.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"编辑inputForm"}),x.jsx(le,{size:"small",color:"cyan",variant:"solid",disabled:!l,onClick:()=>f([]),children:"清空"}),x.jsx(le,{size:"small",color:"cyan",variant:"solid",disabled:!r,onClick:E,children:"解析"})]}),children:x.jsxs(nt,{form:a,children:[r?x.jsx(x.Fragment,{children:x.jsx(Cc,{formJson:r,dataMap:{}})}):x.jsx(x.Fragment,{children:x.jsx(_i,{description:"该组件没有配置inputForm!",children:x.jsx(le,{color:"cyan",variant:"solid",onClick:()=>{o.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"配置inputForm"})})}),x.jsx(nl,{parseData:l,columns:u,importData:w}),x.jsx(Ei,{ghost:!0,items:[{key:"1",label:"更多",children:x.jsx(x.Fragment,{children:x.jsx(nt.Item,{noStyle:!0,shouldUpdate:!0,children:()=>x.jsx(Ci,{children:x.jsx("pre",{children:JSON.stringify(y(a.getFieldsValue()),null,2)})})})})}]})]})})})},rl=({visible:e,onClose:t,params:n,callback:r})=>e?x.jsx(x.Fragment,{children:x.jsx(Pn,{open:e,onClose:t,width:"80%",onCancel:t,title:"导入数据",footer:null,children:x.jsx(il,{params:n,type:"inputFile",callback:t})})}):null,ol=({params:e,type:t,callback:n})=>{if(!e)return x.jsx(x.Fragment,{children:"无数据"});if(e.component_type=="software"){if(e[t]&&Array.isArray(e[t])&&e[t].length>0)return e[t].map((r,o)=>b.createElement(rr,{...r,operatePipeline:e.operatePipeline,key:o,callback:n}))}else{if(e.component_type=="pipeline")return x.jsx(rr,{...e});if(e.component_type=="file")return x.jsx(rr,{...e})}},il=b.memo(ol);wr.TextArea;const sl=({visible:e,onClose:t,params:n})=>{var f;if(!e)return null;const[r]=nt.useForm(),{callback:o}=n,{messageApi:i}=it(),{project:s,projectObj:a}=it(),c=u=>{const h=u.metadata;return delete u.metadata,{...u,sample_id:n.sample_id,project:s,analysis_result_id:n.analysis_result_id,metadata:JSON.stringify(h)}},d=async()=>{const u=await Dc(n.sample_id);r.setFieldsValue(u.data)};b.useEffect(()=>{n.sample_id&&d()},[n==null?void 0:n.sample_id]);const l=async()=>{const u=await r.validateFields(),h=c(u);h.sample_id?(await Ic(h),i.success("更新成功")):(await kc(h),i.success("添加成功")),o==null||o(),t()};return x.jsxs(Pn,{onOk:l,open:e,onClose:t,onCancel:t,title:`${n.sample_id?"编辑":"添加"}metadata`,children:[JSON.stringify(a),x.jsxs(nt,{form:r,children:[x.jsx(nt.Item,{label:"样本名称",name:"sample_name",children:x.jsx(wr,{})}),(a==null?void 0:a.metadata_form)&&Array.isArray(a==null?void 0:a.metadata_form)&&((f=a==null?void 0:a.metadata_form)==null?void 0:f.map(u=>x.jsx(nt.Item,{label:u.label,name:["metadata",u.name],children:x.jsx(wr,{})},u.name))),x.jsx(Ei,{ghost:!0,items:[{key:"1",label:"更多",children:x.jsx(x.Fragment,{children:x.jsx(nt.Item,{noStyle:!0,shouldUpdate:!0,children:()=>x.jsx(Ci,{children:x.jsx("pre",{children:JSON.stringify(c(r.getFieldsValue()),null,2)})})})})}]})]})]})};function se(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=se(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var _r="http://www.w3.org/1999/xhtml";const xo={svg:"http://www.w3.org/2000/svg",xhtml:_r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $n(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),xo.hasOwnProperty(t)?{space:xo[t],local:e}:e}function al(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===_r&&t.documentElement.namespaceURI===_r?t.createElement(e):t.createElementNS(n,e)}}function cl(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Li(e){var t=$n(e);return(t.local?cl:al)(t)}function ll(){}function Or(e){return e==null?ll:function(){return this.querySelector(e)}}function ul(e){typeof e!="function"&&(e=Or(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=new Array(s),c,d,l=0;l<s;++l)(c=i[l])&&(d=e.call(c,c.__data__,l,i))&&("__data__"in c&&(d.__data__=c.__data__),a[l]=d);return new we(r,this._parents)}function dl(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function fl(){return[]}function ji(e){return e==null?fl:function(){return this.querySelectorAll(e)}}function hl(e){return function(){return dl(e.apply(this,arguments))}}function gl(e){typeof e=="function"?e=hl(e):e=ji(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var s=t[i],a=s.length,c,d=0;d<a;++d)(c=s[d])&&(r.push(e.call(c,c.__data__,d,s)),o.push(c));return new we(r,o)}function zi(e){return function(){return this.matches(e)}}function Oi(e){return function(t){return t.matches(e)}}var pl=Array.prototype.find;function ml(e){return function(){return pl.call(this.children,e)}}function yl(){return this.firstElementChild}function vl(e){return this.select(e==null?yl:ml(typeof e=="function"?e:Oi(e)))}var xl=Array.prototype.filter;function wl(){return Array.from(this.children)}function bl(e){return function(){return xl.call(this.children,e)}}function Sl(e){return this.selectAll(e==null?wl:bl(typeof e=="function"?e:Oi(e)))}function _l(e){typeof e!="function"&&(e=zi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],c,d=0;d<s;++d)(c=i[d])&&e.call(c,c.__data__,d,i)&&a.push(c);return new we(r,this._parents)}function Fi(e){return new Array(e.length)}function El(){return new we(this._enter||this._groups.map(Fi),this._parents)}function En(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}En.prototype={constructor:En,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Cl(e){return function(){return e}}function Ml(e,t,n,r,o,i){for(var s=0,a,c=t.length,d=i.length;s<d;++s)(a=t[s])?(a.__data__=i[s],r[s]=a):n[s]=new En(e,i[s]);for(;s<c;++s)(a=t[s])&&(o[s]=a)}function Nl(e,t,n,r,o,i,s){var a,c,d=new Map,l=t.length,f=i.length,u=new Array(l),h;for(a=0;a<l;++a)(c=t[a])&&(u[a]=h=s.call(c,c.__data__,a,t)+"",d.has(h)?o[a]=c:d.set(h,c));for(a=0;a<f;++a)h=s.call(e,i[a],a,i)+"",(c=d.get(h))?(r[a]=c,c.__data__=i[a],d.delete(h)):n[a]=new En(e,i[a]);for(a=0;a<l;++a)(c=t[a])&&d.get(u[a])===c&&(o[a]=c)}function Al(e){return e.__data__}function Dl(e,t){if(!arguments.length)return Array.from(this,Al);var n=t?Nl:Ml,r=this._parents,o=this._groups;typeof e!="function"&&(e=Cl(e));for(var i=o.length,s=new Array(i),a=new Array(i),c=new Array(i),d=0;d<i;++d){var l=r[d],f=o[d],u=f.length,h=Il(e.call(l,l&&l.__data__,d,r)),m=h.length,p=a[d]=new Array(m),y=s[d]=new Array(m),w=c[d]=new Array(u);n(l,f,p,y,w,h,t);for(var E=0,g=0,v,_;E<m;++E)if(v=p[E]){for(E>=g&&(g=E+1);!(_=y[g])&&++g<m;);v._next=_||null}}return s=new we(s,r),s._enter=a,s._exit=c,s}function Il(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function kl(){return new we(this._exit||this._groups.map(Fi),this._parents)}function Rl(e,t,n){var r=this.enter(),o=this,i=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?i.remove():n(i),r&&o?r.merge(o).order():o}function Tl(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,i=r.length,s=Math.min(o,i),a=new Array(o),c=0;c<s;++c)for(var d=n[c],l=r[c],f=d.length,u=a[c]=new Array(f),h,m=0;m<f;++m)(h=d[m]||l[m])&&(u[m]=h);for(;c<o;++c)a[c]=n[c];return new we(a,this._parents)}function Pl(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function $l(e){e||(e=Ll);function t(f,u){return f&&u?e(f.__data__,u.__data__):!f-!u}for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var s=n[i],a=s.length,c=o[i]=new Array(a),d,l=0;l<a;++l)(d=s[l])&&(c[l]=d);c.sort(t)}return new we(o,this._parents).order()}function Ll(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function jl(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function zl(){return Array.from(this)}function Ol(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function Fl(){let e=0;for(const t of this)++e;return e}function Bl(){return!this.node()}function Hl(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],i=0,s=o.length,a;i<s;++i)(a=o[i])&&e.call(a,a.__data__,i,o);return this}function Vl(e){return function(){this.removeAttribute(e)}}function Xl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Yl(e,t){return function(){this.setAttribute(e,t)}}function Wl(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ul(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function ql(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Gl(e,t){var n=$n(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Xl:Vl:typeof t=="function"?n.local?ql:Ul:n.local?Wl:Yl)(n,t))}function Bi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Kl(e){return function(){this.style.removeProperty(e)}}function Zl(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Jl(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Ql(e,t,n){return arguments.length>1?this.each((t==null?Kl:typeof t=="function"?Jl:Zl)(e,t,n??"")):St(this.node(),e)}function St(e,t){return e.style.getPropertyValue(t)||Bi(e).getComputedStyle(e,null).getPropertyValue(t)}function eu(e){return function(){delete this[e]}}function tu(e,t){return function(){this[e]=t}}function nu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function ru(e,t){return arguments.length>1?this.each((t==null?eu:typeof t=="function"?nu:tu)(e,t)):this.node()[e]}function Hi(e){return e.trim().split(/^|\s+/)}function Fr(e){return e.classList||new Vi(e)}function Vi(e){this._node=e,this._names=Hi(e.getAttribute("class")||"")}Vi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Xi(e,t){for(var n=Fr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Yi(e,t){for(var n=Fr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function ou(e){return function(){Xi(this,e)}}function iu(e){return function(){Yi(this,e)}}function su(e,t){return function(){(t.apply(this,arguments)?Xi:Yi)(this,e)}}function au(e,t){var n=Hi(e+"");if(arguments.length<2){for(var r=Fr(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?su:t?ou:iu)(n,t))}function cu(){this.textContent=""}function lu(e){return function(){this.textContent=e}}function uu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function du(e){return arguments.length?this.each(e==null?cu:(typeof e=="function"?uu:lu)(e)):this.node().textContent}function fu(){this.innerHTML=""}function hu(e){return function(){this.innerHTML=e}}function gu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function pu(e){return arguments.length?this.each(e==null?fu:(typeof e=="function"?gu:hu)(e)):this.node().innerHTML}function mu(){this.nextSibling&&this.parentNode.appendChild(this)}function yu(){return this.each(mu)}function vu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function xu(){return this.each(vu)}function wu(e){var t=typeof e=="function"?e:Li(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function bu(){return null}function Su(e,t){var n=typeof e=="function"?e:Li(e),r=t==null?bu:typeof t=="function"?t:Or(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function _u(){var e=this.parentNode;e&&e.removeChild(this)}function Eu(){return this.each(_u)}function Cu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Mu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Nu(e){return this.select(e?Mu:Cu)}function Au(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Du(e){return function(t){e.call(this,t,this.__data__)}}function Iu(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function ku(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,i;n<o;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++r]=i;++r?t.length=r:delete this.__on}}}function Ru(e,t,n){return function(){var r=this.__on,o,i=Du(t);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),o.value=t;return}}this.addEventListener(e.type,i,n),o={type:e.type,name:e.name,value:t,listener:i,options:n},r?r.push(o):this.__on=[o]}}function Tu(e,t,n){var r=Iu(e+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,d=a.length,l;c<d;++c)for(o=0,l=a[c];o<i;++o)if((s=r[o]).type===l.type&&s.name===l.name)return l.value}return}for(a=t?Ru:ku,o=0;o<i;++o)this.each(a(r[o],t,n));return this}function Wi(e,t,n){var r=Bi(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Pu(e,t){return function(){return Wi(this,e,t)}}function $u(e,t){return function(){return Wi(this,e,t.apply(this,arguments))}}function Lu(e,t){return this.each((typeof t=="function"?$u:Pu)(e,t))}function*ju(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var Ui=[null];function we(e,t){this._groups=e,this._parents=t}function Kt(){return new we([[document.documentElement]],Ui)}function zu(){return this}we.prototype=Kt.prototype={constructor:we,select:ul,selectAll:gl,selectChild:vl,selectChildren:Sl,filter:_l,data:Dl,enter:El,exit:kl,join:Rl,merge:Tl,selection:zu,order:Pl,sort:$l,call:jl,nodes:zl,node:Ol,size:Fl,empty:Bl,each:Hl,attr:Gl,style:Ql,property:ru,classed:au,text:du,html:pu,raise:yu,lower:xu,append:wu,insert:Su,remove:Eu,clone:Nu,datum:Au,on:Tu,dispatch:Lu,[Symbol.iterator]:ju};function xe(e){return typeof e=="string"?new we([[document.querySelector(e)]],[document.documentElement]):new we([[e]],Ui)}function Ou(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ae(e,t){if(e=Ou(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Fu={passive:!1},Bt={capture:!0,passive:!1};function or(e){e.stopImmediatePropagation()}function xt(e){e.preventDefault(),e.stopImmediatePropagation()}function qi(e){var t=e.document.documentElement,n=xe(e).on("dragstart.drag",xt,Bt);"onselectstart"in t?n.on("selectstart.drag",xt,Bt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Gi(e,t){var n=e.document.documentElement,r=xe(e).on("dragstart.drag",null);t&&(r.on("click.drag",xt,Bt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const ln=e=>()=>e;function Er(e,{sourceEvent:t,subject:n,target:r,identifier:o,active:i,x:s,y:a,dx:c,dy:d,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:l}})}Er.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Bu(e){return!e.ctrlKey&&!e.button}function Hu(){return this.parentNode}function Vu(e,t){return t??{x:e.x,y:e.y}}function Xu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ki(){var e=Bu,t=Hu,n=Vu,r=Xu,o={},i=zr("start","drag","end"),s=0,a,c,d,l,f=0;function u(v){v.on("mousedown.drag",h).filter(r).on("touchstart.drag",y).on("touchmove.drag",w,Fu).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(v,_){if(!(l||!e.call(this,v,_))){var C=g(this,t.call(this,v,_),v,_,"mouse");C&&(xe(v.view).on("mousemove.drag",m,Bt).on("mouseup.drag",p,Bt),qi(v.view),or(v),d=!1,a=v.clientX,c=v.clientY,C("start",v))}}function m(v){if(xt(v),!d){var _=v.clientX-a,C=v.clientY-c;d=_*_+C*C>f}o.mouse("drag",v)}function p(v){xe(v.view).on("mousemove.drag mouseup.drag",null),Gi(v.view,d),xt(v),o.mouse("end",v)}function y(v,_){if(e.call(this,v,_)){var C=v.changedTouches,M=t.call(this,v,_),N=C.length,T,O;for(T=0;T<N;++T)(O=g(this,M,v,_,C[T].identifier,C[T]))&&(or(v),O("start",v,C[T]))}}function w(v){var _=v.changedTouches,C=_.length,M,N;for(M=0;M<C;++M)(N=o[_[M].identifier])&&(xt(v),N("drag",v,_[M]))}function E(v){var _=v.changedTouches,C=_.length,M,N;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),M=0;M<C;++M)(N=o[_[M].identifier])&&(or(v),N("end",v,_[M]))}function g(v,_,C,M,N,T){var O=i.copy(),R=Ae(T||C,_),P,$,S;if((S=n.call(v,new Er("beforestart",{sourceEvent:C,target:u,identifier:N,active:s,x:R[0],y:R[1],dx:0,dy:0,dispatch:O}),M))!=null)return P=S.x-R[0]||0,$=S.y-R[1]||0,function k(A,D,L){var I=R,j;switch(A){case"start":o[N]=k,j=s++;break;case"end":delete o[N],--s;case"drag":R=Ae(L||D,_),j=s;break}O.call(A,v,new Er(A,{sourceEvent:D,subject:S,target:u,identifier:N,active:j,x:R[0]+P,y:R[1]+$,dx:R[0]-I[0],dy:R[1]-I[1],dispatch:O}),M)}}return u.filter=function(v){return arguments.length?(e=typeof v=="function"?v:ln(!!v),u):e},u.container=function(v){return arguments.length?(t=typeof v=="function"?v:ln(v),u):t},u.subject=function(v){return arguments.length?(n=typeof v=="function"?v:ln(v),u):n},u.touchable=function(v){return arguments.length?(r=typeof v=="function"?v:ln(!!v),u):r},u.on=function(){var v=i.on.apply(i,arguments);return v===i?u:v},u.clickDistance=function(v){return arguments.length?(f=(v=+v)*v,u):Math.sqrt(f)},u}var Yu=zr("start","end","cancel","interrupt"),Wu=[],Zi=0,wo=1,Cr=2,vn=3,bo=4,Mr=5,xn=6;function Ln(e,t,n,r,o,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;Uu(e,n,{name:t,index:r,group:o,on:Yu,tween:Wu,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Zi})}function Br(e,t){var n=ke(e,t);if(n.state>Zi)throw new Error("too late; already scheduled");return n}function Fe(e,t){var n=ke(e,t);if(n.state>vn)throw new Error("too late; already running");return n}function ke(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Uu(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=jc(i,0,n.time);function i(d){n.state=wo,n.timer.restart(s,n.delay,n.time),n.delay<=d&&s(d-n.delay)}function s(d){var l,f,u,h;if(n.state!==wo)return c();for(l in r)if(h=r[l],h.name===n.name){if(h.state===vn)return mo(s);h.state===bo?(h.state=xn,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete r[l]):+l<t&&(h.state=xn,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete r[l])}if(mo(function(){n.state===vn&&(n.state=bo,n.timer.restart(a,n.delay,n.time),a(d))}),n.state=Cr,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Cr){for(n.state=vn,o=new Array(u=n.tween.length),l=0,f=-1;l<u;++l)(h=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(o[++f]=h);o.length=f+1}}function a(d){for(var l=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(c),n.state=Mr,1),f=-1,u=o.length;++f<u;)o[f].call(e,l);n.state===Mr&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=xn,n.timer.stop(),delete r[t];for(var d in r)return;delete e.__transition}}function wn(e,t){var n=e.__transition,r,o,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){i=!1;continue}o=r.state>Cr&&r.state<Mr,r.state=xn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}i&&delete e.__transition}}function qu(e){return this.each(function(){wn(this,e)})}function Gu(e,t){var n,r;return function(){var o=Fe(this,e),i=o.tween;if(i!==n){r=n=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function Ku(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var i=Fe(this,e),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:t,value:n},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=a;break}c===d&&o.push(a)}i.tween=o}}function Zu(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=ke(this.node(),n).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===e)return s.value;return null}return this.each((t==null?Gu:Ku)(n,e,t))}function Hr(e,t,n){var r=e._id;return e.each(function(){var o=Fe(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return ke(o,r).value[t]}}function Ji(e,t){var n;return(typeof t=="number"?Le:t instanceof _n?Sn:(n=_n(t))?(t=n,Sn):Ti)(e,t)}function Ju(e){return function(){this.removeAttribute(e)}}function Qu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ed(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,n)}}function td(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,n)}}function nd(e,t,n){var r,o,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=a+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a)))}}function rd(e,t,n){var r,o,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=a+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a)))}}function od(e,t){var n=$n(e),r=n==="transform"?Zc:Ji;return this.attrTween(e,typeof t=="function"?(n.local?rd:nd)(n,r,Hr(this,"attr."+e,t)):t==null?(n.local?Qu:Ju)(n):(n.local?td:ed)(n,r,t))}function id(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function sd(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ad(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&sd(e,i)),n}return o._value=t,o}function cd(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&id(e,i)),n}return o._value=t,o}function ld(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=$n(e);return this.tween(n,(r.local?ad:cd)(r,t))}function ud(e,t){return function(){Br(this,e).delay=+t.apply(this,arguments)}}function dd(e,t){return t=+t,function(){Br(this,e).delay=t}}function fd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ud:dd)(t,e)):ke(this.node(),t).delay}function hd(e,t){return function(){Fe(this,e).duration=+t.apply(this,arguments)}}function gd(e,t){return t=+t,function(){Fe(this,e).duration=t}}function pd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hd:gd)(t,e)):ke(this.node(),t).duration}function md(e,t){if(typeof t!="function")throw new Error;return function(){Fe(this,e).ease=t}}function yd(e){var t=this._id;return arguments.length?this.each(md(t,e)):ke(this.node(),t).ease}function vd(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Fe(this,e).ease=n}}function xd(e){if(typeof e!="function")throw new Error;return this.each(vd(this._id,e))}function wd(e){typeof e!="function"&&(e=zi(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],c,d=0;d<s;++d)(c=i[d])&&e.call(c,c.__data__,d,i)&&a.push(c);return new Ue(r,this._parents,this._name,this._id)}function bd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var c=t[a],d=n[a],l=c.length,f=s[a]=new Array(l),u,h=0;h<l;++h)(u=c[h]||d[h])&&(f[h]=u);for(;a<r;++a)s[a]=t[a];return new Ue(s,this._parents,this._name,this._id)}function Sd(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function _d(e,t,n){var r,o,i=Sd(t)?Br:Fe;return function(){var s=i(this,e),a=s.on;a!==r&&(o=(r=a).copy()).on(t,n),s.on=o}}function Ed(e,t){var n=this._id;return arguments.length<2?ke(this.node(),n).on.on(e):this.each(_d(n,e,t))}function Cd(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Md(){return this.on("end.remove",Cd(this._id))}function Nd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Or(e));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],c=a.length,d=i[s]=new Array(c),l,f,u=0;u<c;++u)(l=a[u])&&(f=e.call(l,l.__data__,u,a))&&("__data__"in l&&(f.__data__=l.__data__),d[u]=f,Ln(d[u],t,n,u,d,ke(l,n)));return new Ue(i,this._parents,t,n)}function Ad(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ji(e));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var c=r[a],d=c.length,l,f=0;f<d;++f)if(l=c[f]){for(var u=e.call(l,l.__data__,f,c),h,m=ke(l,n),p=0,y=u.length;p<y;++p)(h=u[p])&&Ln(h,t,n,p,u,m);i.push(u),s.push(l)}return new Ue(i,s,t,n)}var Dd=Kt.prototype.constructor;function Id(){return new Dd(this._groups,this._parents)}function kd(e,t){var n,r,o;return function(){var i=St(this,e),s=(this.style.removeProperty(e),St(this,e));return i===s?null:i===n&&s===r?o:o=t(n=i,r=s)}}function Qi(e){return function(){this.style.removeProperty(e)}}function Rd(e,t,n){var r,o=n+"",i;return function(){var s=St(this,e);return s===o?null:s===r?i:i=t(r=s,n)}}function Td(e,t,n){var r,o,i;return function(){var s=St(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),St(this,e))),s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,a))}}function Pd(e,t){var n,r,o,i="style."+t,s="end."+i,a;return function(){var c=Fe(this,e),d=c.on,l=c.value[i]==null?a||(a=Qi(t)):void 0;(d!==n||o!==l)&&(r=(n=d).copy()).on(s,o=l),c.on=r}}function $d(e,t,n){var r=(e+="")=="transform"?Kc:Ji;return t==null?this.styleTween(e,kd(e,r)).on("end.style."+e,Qi(e)):typeof t=="function"?this.styleTween(e,Td(e,r,Hr(this,"style."+e,t))).each(Pd(this._id,e)):this.styleTween(e,Rd(e,r,t),n).on("end.style."+e,null)}function Ld(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function jd(e,t,n){var r,o;function i(){var s=t.apply(this,arguments);return s!==o&&(r=(o=s)&&Ld(e,s,n)),r}return i._value=t,i}function zd(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,jd(e,t,n??""))}function Od(e){return function(){this.textContent=e}}function Fd(e){return function(){var t=e(this);this.textContent=t??""}}function Bd(e){return this.tween("text",typeof e=="function"?Fd(Hr(this,"text",e)):Od(e==null?"":e+""))}function Hd(e){return function(t){this.textContent=e.call(this,t)}}function Vd(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Hd(o)),t}return r._value=e,r}function Xd(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Vd(e))}function Yd(){for(var e=this._name,t=this._id,n=es(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,c,d=0;d<a;++d)if(c=s[d]){var l=ke(c,t);Ln(c,e,n,d,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new Ue(r,this._parents,e,n)}function Wd(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(i,s){var a={value:s},c={value:function(){--o===0&&i()}};n.each(function(){var d=Fe(this,r),l=d.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),d.on=t}),o===0&&i()})}var Ud=0;function Ue(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function es(){return++Ud}var Xe=Kt.prototype;Ue.prototype={constructor:Ue,select:Nd,selectAll:Ad,selectChild:Xe.selectChild,selectChildren:Xe.selectChildren,filter:wd,merge:bd,selection:Id,transition:Yd,call:Xe.call,nodes:Xe.nodes,node:Xe.node,size:Xe.size,empty:Xe.empty,each:Xe.each,on:Ed,attr:od,attrTween:ld,style:$d,styleTween:zd,text:Bd,textTween:Xd,remove:Md,tween:Zu,delay:fd,duration:pd,ease:yd,easeVarying:xd,end:Wd,[Symbol.iterator]:Xe[Symbol.iterator]};function qd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Gd={time:null,delay:0,duration:250,ease:qd};function Kd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Zd(e){var t,n;e instanceof Ue?(t=e._id,e=e._name):(t=es(),(n=Gd).time=zc(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,c,d=0;d<a;++d)(c=s[d])&&Ln(c,e,t,d,s,n||Kd(c,t));return new Ue(r,this._parents,e,t)}Kt.prototype.interrupt=qu;Kt.prototype.transition=Zd;const un=e=>()=>e;function Jd(e,{sourceEvent:t,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Ye(e,t,n){this.k=e,this.x=t,this.y=n}Ye.prototype={constructor:Ye,scale:function(e){return e===1?this:new Ye(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ye(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var jn=new Ye(1,0,0);ts.prototype=Ye.prototype;function ts(e){for(;!e.__zoom;)if(!(e=e.parentNode))return jn;return e.__zoom}function ir(e){e.stopImmediatePropagation()}function Tt(e){e.preventDefault(),e.stopImmediatePropagation()}function Qd(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function ef(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function So(){return this.__zoom||jn}function tf(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function nf(){return navigator.maxTouchPoints||"ontouchstart"in this}function rf(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function ns(){var e=Qd,t=ef,n=rf,r=tf,o=nf,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=yn,d=zr("start","zoom","end"),l,f,u,h=500,m=150,p=0,y=10;function w(S){S.property("__zoom",So).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",O).filter(o).on("touchstart.zoom",R).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(S,k,A,D){var L=S.selection?S.selection():S;L.property("__zoom",So),S!==L?_(S,k,A,D):L.interrupt().each(function(){C(this,arguments).event(D).start().zoom(null,typeof k=="function"?k.apply(this,arguments):k).end()})},w.scaleBy=function(S,k,A,D){w.scaleTo(S,function(){var L=this.__zoom.k,I=typeof k=="function"?k.apply(this,arguments):k;return L*I},A,D)},w.scaleTo=function(S,k,A,D){w.transform(S,function(){var L=t.apply(this,arguments),I=this.__zoom,j=A==null?v(L):typeof A=="function"?A.apply(this,arguments):A,z=I.invert(j),F=typeof k=="function"?k.apply(this,arguments):k;return n(g(E(I,F),j,z),L,s)},A,D)},w.translateBy=function(S,k,A,D){w.transform(S,function(){return n(this.__zoom.translate(typeof k=="function"?k.apply(this,arguments):k,typeof A=="function"?A.apply(this,arguments):A),t.apply(this,arguments),s)},null,D)},w.translateTo=function(S,k,A,D,L){w.transform(S,function(){var I=t.apply(this,arguments),j=this.__zoom,z=D==null?v(I):typeof D=="function"?D.apply(this,arguments):D;return n(jn.translate(z[0],z[1]).scale(j.k).translate(typeof k=="function"?-k.apply(this,arguments):-k,typeof A=="function"?-A.apply(this,arguments):-A),I,s)},D,L)};function E(S,k){return k=Math.max(i[0],Math.min(i[1],k)),k===S.k?S:new Ye(k,S.x,S.y)}function g(S,k,A){var D=k[0]-A[0]*S.k,L=k[1]-A[1]*S.k;return D===S.x&&L===S.y?S:new Ye(S.k,D,L)}function v(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function _(S,k,A,D){S.on("start.zoom",function(){C(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(D).end()}).tween("zoom",function(){var L=this,I=arguments,j=C(L,I).event(D),z=t.apply(L,I),F=A==null?v(z):typeof A=="function"?A.apply(L,I):A,V=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),B=L.__zoom,W=typeof k=="function"?k.apply(L,I):k,X=c(B.invert(F).concat(V/B.k),W.invert(F).concat(V/W.k));return function(U){if(U===1)U=W;else{var H=X(U),q=V/H[2];U=new Ye(q,F[0]-H[0]*q,F[1]-H[1]*q)}j.zoom(null,U)}})}function C(S,k,A){return!A&&S.__zooming||new M(S,k)}function M(S,k){this.that=S,this.args=k,this.active=0,this.sourceEvent=null,this.extent=t.apply(S,k),this.taps=0}M.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,k){return this.mouse&&S!=="mouse"&&(this.mouse[1]=k.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=k.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=k.invert(this.touch1[0])),this.that.__zoom=k,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var k=xe(this.that).datum();d.call(S,this.that,new Jd(S,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:d}),k)}};function N(S,...k){if(!e.apply(this,arguments))return;var A=C(this,k).event(S),D=this.__zoom,L=Math.max(i[0],Math.min(i[1],D.k*Math.pow(2,r.apply(this,arguments)))),I=Ae(S);if(A.wheel)(A.mouse[0][0]!==I[0]||A.mouse[0][1]!==I[1])&&(A.mouse[1]=D.invert(A.mouse[0]=I)),clearTimeout(A.wheel);else{if(D.k===L)return;A.mouse=[I,D.invert(I)],wn(this),A.start()}Tt(S),A.wheel=setTimeout(j,m),A.zoom("mouse",n(g(E(D,L),A.mouse[0],A.mouse[1]),A.extent,s));function j(){A.wheel=null,A.end()}}function T(S,...k){if(u||!e.apply(this,arguments))return;var A=S.currentTarget,D=C(this,k,!0).event(S),L=xe(S.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",V,!0),I=Ae(S,A),j=S.clientX,z=S.clientY;qi(S.view),ir(S),D.mouse=[I,this.__zoom.invert(I)],wn(this),D.start();function F(B){if(Tt(B),!D.moved){var W=B.clientX-j,X=B.clientY-z;D.moved=W*W+X*X>p}D.event(B).zoom("mouse",n(g(D.that.__zoom,D.mouse[0]=Ae(B,A),D.mouse[1]),D.extent,s))}function V(B){L.on("mousemove.zoom mouseup.zoom",null),Gi(B.view,D.moved),Tt(B),D.event(B).end()}}function O(S,...k){if(e.apply(this,arguments)){var A=this.__zoom,D=Ae(S.changedTouches?S.changedTouches[0]:S,this),L=A.invert(D),I=A.k*(S.shiftKey?.5:2),j=n(g(E(A,I),D,L),t.apply(this,k),s);Tt(S),a>0?xe(this).transition().duration(a).call(_,j,D,S):xe(this).call(w.transform,j,D,S)}}function R(S,...k){if(e.apply(this,arguments)){var A=S.touches,D=A.length,L=C(this,k,S.changedTouches.length===D).event(S),I,j,z,F;for(ir(S),j=0;j<D;++j)z=A[j],F=Ae(z,this),F=[F,this.__zoom.invert(F),z.identifier],L.touch0?!L.touch1&&L.touch0[2]!==F[2]&&(L.touch1=F,L.taps=0):(L.touch0=F,I=!0,L.taps=1+!!l);l&&(l=clearTimeout(l)),I&&(L.taps<2&&(f=F[0],l=setTimeout(function(){l=null},h)),wn(this),L.start())}}function P(S,...k){if(this.__zooming){var A=C(this,k).event(S),D=S.changedTouches,L=D.length,I,j,z,F;for(Tt(S),I=0;I<L;++I)j=D[I],z=Ae(j,this),A.touch0&&A.touch0[2]===j.identifier?A.touch0[0]=z:A.touch1&&A.touch1[2]===j.identifier&&(A.touch1[0]=z);if(j=A.that.__zoom,A.touch1){var V=A.touch0[0],B=A.touch0[1],W=A.touch1[0],X=A.touch1[1],U=(U=W[0]-V[0])*U+(U=W[1]-V[1])*U,H=(H=X[0]-B[0])*H+(H=X[1]-B[1])*H;j=E(j,Math.sqrt(U/H)),z=[(V[0]+W[0])/2,(V[1]+W[1])/2],F=[(B[0]+X[0])/2,(B[1]+X[1])/2]}else if(A.touch0)z=A.touch0[0],F=A.touch0[1];else return;A.zoom("touch",n(g(j,z,F),A.extent,s))}}function $(S,...k){if(this.__zooming){var A=C(this,k).event(S),D=S.changedTouches,L=D.length,I,j;for(ir(S),u&&clearTimeout(u),u=setTimeout(function(){u=null},h),I=0;I<L;++I)j=D[I],A.touch0&&A.touch0[2]===j.identifier?delete A.touch0:A.touch1&&A.touch1[2]===j.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(j=Ae(j,this),Math.hypot(f[0]-j[0],f[1]-j[1])<y)){var z=xe(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return w.wheelDelta=function(S){return arguments.length?(r=typeof S=="function"?S:un(+S),w):r},w.filter=function(S){return arguments.length?(e=typeof S=="function"?S:un(!!S),w):e},w.touchable=function(S){return arguments.length?(o=typeof S=="function"?S:un(!!S),w):o},w.extent=function(S){return arguments.length?(t=typeof S=="function"?S:un([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),w):t},w.scaleExtent=function(S){return arguments.length?(i[0]=+S[0],i[1]=+S[1],w):[i[0],i[1]]},w.translateExtent=function(S){return arguments.length?(s[0][0]=+S[0][0],s[1][0]=+S[1][0],s[0][1]=+S[0][1],s[1][1]=+S[1][1],w):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},w.constrain=function(S){return arguments.length?(n=S,w):n},w.duration=function(S){return arguments.length?(a=+S,w):a},w.interpolate=function(S){return arguments.length?(c=S,w):c},w.on=function(){var S=d.on.apply(d,arguments);return S===d?w:S},w.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,w):Math.sqrt(p)},w.tapDistance=function(S){return arguments.length?(y=+S,w):y},w}const ze={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Ht=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],rs=["Enter"," ","Escape"],os={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var _t;(function(e){e.Strict="strict",e.Loose="loose"})(_t||(_t={}));var dt;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(dt||(dt={}));var Vt;(function(e){e.Partial="partial",e.Full="full"})(Vt||(Vt={}));const is={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var rt;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(rt||(rt={}));var Cn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Cn||(Cn={}));var K;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(K||(K={}));const _o={[K.Left]:K.Right,[K.Right]:K.Left,[K.Top]:K.Bottom,[K.Bottom]:K.Top};function ss(e){return e===null?null:e?"valid":"invalid"}const as=e=>"id"in e&&"source"in e&&"target"in e,of=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Vr=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Zt=(e,t=[0,0])=>{const{width:n,height:r}=qe(e),o=e.origin??t,i=n*o[0],s=r*o[1];return{x:e.position.x-i,y:e.position.y-s}},sf=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,o)=>{const i=typeof o=="string";let s=!t.nodeLookup&&!i?o:void 0;t.nodeLookup&&(s=i?t.nodeLookup.get(o):Vr(o)?o:t.nodeLookup.get(o.id));const a=s?Mn(s,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return zn(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return On(n)},Jt=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(r=>{if(t.filter===void 0||t.filter(r)){const o=Mn(r);n=zn(n,o)}}),On(n)},Xr=(e,t,[n,r,o]=[0,0,1],i=!1,s=!1)=>{const a={...Qt(t,[n,r,o]),width:t.width/o,height:t.height/o},c=[];for(const d of e.values()){const{measured:l,selectable:f=!0,hidden:u=!1}=d;if(s&&!f||u)continue;const h=l.width??d.width??d.initialWidth??null,m=l.height??d.height??d.initialHeight??null,p=Xt(a,Ct(d)),y=(h??0)*(m??0),w=i&&p>0;(!d.internals.handleBounds||w||p>=y||d.dragging)&&c.push(d)}return c},af=(e,t)=>{const n=new Set;return e.forEach(r=>{n.add(r.id)}),t.filter(r=>n.has(r.source)||n.has(r.target))};function cf(e,t){const n=new Map,r=t!=null&&t.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!o.hidden)&&(!r||r.has(o.id))&&n.set(o.id,o)}),n}async function lf({nodes:e,width:t,height:n,panZoom:r,minZoom:o,maxZoom:i},s){if(e.size===0)return Promise.resolve(!0);const a=cf(e,s),c=Jt(a),d=Yr(c,t,n,(s==null?void 0:s.minZoom)??o,(s==null?void 0:s.maxZoom)??i,(s==null?void 0:s.padding)??.1);return await r.setViewport(d,{duration:s==null?void 0:s.duration,ease:s==null?void 0:s.ease,interpolate:s==null?void 0:s.interpolate}),Promise.resolve(!0)}function cs({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:o,onError:i}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:d}=a?a.internals.positionAbsolute:{x:0,y:0},l=s.origin??r;let f=s.extent||o;if(s.extent==="parent"&&!s.expandParent)if(!a)i==null||i("005",ze.error005());else{const h=a.measured.width,m=a.measured.height;h&&m&&(f=[[c,d],[c+h,d+m]])}else a&&Mt(s.extent)&&(f=[[s.extent[0][0]+c,s.extent[0][1]+d],[s.extent[1][0]+c,s.extent[1][1]+d]]);const u=Mt(f)?ft(t,f,s.measured):t;return(s.measured.width===void 0||s.measured.height===void 0)&&(i==null||i("015",ze.error015())),{position:{x:u.x-c+(s.measured.width??0)*l[0],y:u.y-d+(s.measured.height??0)*l[1]},positionAbsolute:u}}async function uf({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:r,onBeforeDelete:o}){const i=new Set(e.map(u=>u.id)),s=[];for(const u of n){if(u.deletable===!1)continue;const h=i.has(u.id),m=!h&&u.parentId&&s.find(p=>p.id===u.parentId);(h||m)&&s.push(u)}const a=new Set(t.map(u=>u.id)),c=r.filter(u=>u.deletable!==!1),l=af(s,c);for(const u of c)a.has(u.id)&&!l.find(m=>m.id===u.id)&&l.push(u);if(!o)return{edges:l,nodes:s};const f=await o({nodes:s,edges:l});return typeof f=="boolean"?f?{edges:l,nodes:s}:{edges:[],nodes:[]}:f}const Et=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),ft=(e={x:0,y:0},t,n)=>({x:Et(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Et(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function ls(e,t,n){const{width:r,height:o}=qe(n),{x:i,y:s}=n.internals.positionAbsolute;return ft(e,[[i,s],[i+r,s+o]],t)}const Eo=(e,t,n)=>e<t?Et(Math.abs(e-t),1,t)/t:e>n?-Et(Math.abs(e-n),1,t)/t:0,us=(e,t,n=15,r=40)=>{const o=Eo(e.x,r,t.width-r)*n,i=Eo(e.y,r,t.height-r)*n;return[o,i]},zn=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Nr=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),On=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),Ct=(e,t=[0,0])=>{var o,i;const{x:n,y:r}=Vr(e)?e.internals.positionAbsolute:Zt(e,t);return{x:n,y:r,width:((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},Mn=(e,t=[0,0])=>{var o,i;const{x:n,y:r}=Vr(e)?e.internals.positionAbsolute:Zt(e,t);return{x:n,y:r,x2:n+(((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0),y2:r+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},ds=(e,t)=>On(zn(Nr(e),Nr(t))),Xt=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},Co=e=>De(e.width)&&De(e.height)&&De(e.x)&&De(e.y),De=e=>!isNaN(e)&&isFinite(e),df=(e,t)=>{},Fn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Qt=({x:e,y:t},[n,r,o],i=!1,s=[1,1])=>{const a={x:(e-n)/o,y:(t-r)/o};return i?Fn(a,s):a},Nn=({x:e,y:t},[n,r,o])=>({x:e*o+n,y:t*o+r});function mt(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function ff(e,t,n){if(typeof e=="string"||typeof e=="number"){const r=mt(e,n),o=mt(e,t);return{top:r,right:o,bottom:r,left:o,x:o*2,y:r*2}}if(typeof e=="object"){const r=mt(e.top??e.y??0,n),o=mt(e.bottom??e.y??0,n),i=mt(e.left??e.x??0,t),s=mt(e.right??e.x??0,t);return{top:r,right:s,bottom:o,left:i,x:i+s,y:r+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function hf(e,t,n,r,o,i){const{x:s,y:a}=Nn(e,[t,n,r]),{x:c,y:d}=Nn({x:e.x+e.width,y:e.y+e.height},[t,n,r]),l=o-c,f=i-d;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(l),bottom:Math.floor(f)}}const Yr=(e,t,n,r,o,i)=>{const s=ff(i,t,n),a=(t-s.x)/e.width,c=(n-s.y)/e.height,d=Math.min(a,c),l=Et(d,r,o),f=e.x+e.width/2,u=e.y+e.height/2,h=t/2-f*l,m=n/2-u*l,p=hf(e,h,m,l,t,n),y={left:Math.min(p.left-s.left,0),top:Math.min(p.top-s.top,0),right:Math.min(p.right-s.right,0),bottom:Math.min(p.bottom-s.bottom,0)};return{x:h-y.left+y.right,y:m-y.top+y.bottom,zoom:l}},An=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Mt(e){return e!==void 0&&e!=="parent"}function qe(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function fs(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function hs(e,t={width:0,height:0},n,r,o){const i={...e},s=r.get(n);if(s){const a=s.origin||o;i.x+=s.internals.positionAbsolute.x-(t.width??0)*a[0],i.y+=s.internals.positionAbsolute.y-(t.height??0)*a[1]}return i}function Mo(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function gf(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function pf(e){return{...os,...e||{}}}function Lt(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:r,containerBounds:o}){const{x:i,y:s}=je(e),a=Qt({x:i-((o==null?void 0:o.left)??0),y:s-((o==null?void 0:o.top)??0)},r),{x:c,y:d}=n?Fn(a,t):a;return{xSnapped:c,ySnapped:d,...a}}const Wr=e=>({width:e.offsetWidth,height:e.offsetHeight}),gs=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},mf=["INPUT","SELECT","TEXTAREA"];function ps(e){var r,o;const t=((o=(r=e.composedPath)==null?void 0:r.call(e))==null?void 0:o[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:mf.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const ms=e=>"clientX"in e,je=(e,t)=>{var i,s;const n=ms(e),r=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,o=n?e.clientY:(s=e.touches)==null?void 0:s[0].clientY;return{x:r-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},No=(e,t,n,r,o)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:e,nodeId:o,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...Wr(s)}})};function ys({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:o,sourceControlY:i,targetControlX:s,targetControlY:a}){const c=e*.125+o*.375+s*.375+n*.125,d=t*.125+i*.375+a*.375+r*.125,l=Math.abs(c-e),f=Math.abs(d-t);return[c,d,l,f]}function dn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function Ao({pos:e,x1:t,y1:n,x2:r,y2:o,c:i}){switch(e){case K.Left:return[t-dn(t-r,i),n];case K.Right:return[t+dn(r-t,i),n];case K.Top:return[t,n-dn(n-o,i)];case K.Bottom:return[t,n+dn(o-n,i)]}}function vs({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top,curvature:s=.25}){const[a,c]=Ao({pos:n,x1:e,y1:t,x2:r,y2:o,c:s}),[d,l]=Ao({pos:i,x1:r,y1:o,x2:e,y2:t,c:s}),[f,u,h,m]=ys({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:a,sourceControlY:c,targetControlX:d,targetControlY:l});return[`M${e},${t} C${a},${c} ${d},${l} ${r},${o}`,f,u,h,m]}function xs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const o=Math.abs(n-e)/2,i=n<e?n+o:n-o,s=Math.abs(r-t)/2,a=r<t?r+s:r-s;return[i,a,o,s]}function yf({sourceNode:e,targetNode:t,selected:n=!1,zIndex:r,elevateOnSelect:o=!1}){if(r!==void 0)return r;const i=o&&n?1e3:0,s=Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0);return i+s}function vf({sourceNode:e,targetNode:t,width:n,height:r,transform:o}){const i=zn(Mn(e),Mn(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const s={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:r/o[2]};return Xt(s,On(i))>0}const xf=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`xy-edge__${e}${t||""}-${n}${r||""}`,wf=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),ws=(e,t)=>{if(!e.source||!e.target)return t;let n;return as(e)?n={...e}:n={...e,id:xf(e)},wf(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function bs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[o,i,s,a]=xs({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,o,i,s,a]}const Do={[K.Left]:{x:-1,y:0},[K.Right]:{x:1,y:0},[K.Top]:{x:0,y:-1},[K.Bottom]:{x:0,y:1}},bf=({source:e,sourcePosition:t=K.Bottom,target:n})=>t===K.Left||t===K.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},Io=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Sf({source:e,sourcePosition:t=K.Bottom,target:n,targetPosition:r=K.Top,center:o,offset:i,stepPosition:s}){const a=Do[t],c=Do[r],d={x:e.x+a.x*i,y:e.y+a.y*i},l={x:n.x+c.x*i,y:n.y+c.y*i},f=bf({source:d,sourcePosition:t,target:l}),u=f.x!==0?"x":"y",h=f[u];let m=[],p,y;const w={x:0,y:0},E={x:0,y:0},[,,g,v]=xs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[u]*c[u]===-1){u==="x"?(p=o.x??d.x+(l.x-d.x)*s,y=o.y??(d.y+l.y)/2):(p=o.x??(d.x+l.x)/2,y=o.y??d.y+(l.y-d.y)*s);const C=[{x:p,y:d.y},{x:p,y:l.y}],M=[{x:d.x,y},{x:l.x,y}];a[u]===h?m=u==="x"?C:M:m=u==="x"?M:C}else{const C=[{x:d.x,y:l.y}],M=[{x:l.x,y:d.y}];if(u==="x"?m=a.x===h?M:C:m=a.y===h?C:M,t===r){const P=Math.abs(e[u]-n[u]);if(P<=i){const $=Math.min(i-1,i-P);a[u]===h?w[u]=(d[u]>e[u]?-1:1)*$:E[u]=(l[u]>n[u]?-1:1)*$}}if(t!==r){const P=u==="x"?"y":"x",$=a[u]===c[P],S=d[P]>l[P],k=d[P]<l[P];(a[u]===1&&(!$&&S||$&&k)||a[u]!==1&&(!$&&k||$&&S))&&(m=u==="x"?C:M)}const N={x:d.x+w.x,y:d.y+w.y},T={x:l.x+E.x,y:l.y+E.y},O=Math.max(Math.abs(N.x-m[0].x),Math.abs(T.x-m[0].x)),R=Math.max(Math.abs(N.y-m[0].y),Math.abs(T.y-m[0].y));O>=R?(p=(N.x+T.x)/2,y=m[0].y):(p=m[0].x,y=(N.y+T.y)/2)}return[[e,{x:d.x+w.x,y:d.y+w.y},...m,{x:l.x+E.x,y:l.y+E.y},n],p,y,g,v]}function _f(e,t,n,r){const o=Math.min(Io(e,t)/2,Io(t,n)/2,r),{x:i,y:s}=t;if(e.x===i&&i===n.x||e.y===s&&s===n.y)return`L${i} ${s}`;if(e.y===s){const d=e.x<n.x?-1:1,l=e.y<n.y?1:-1;return`L ${i+o*d},${s}Q ${i},${s} ${i},${s+o*l}`}const a=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${i},${s+o*c}Q ${i},${s} ${i+o*a},${s}`}function Ar({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top,borderRadius:s=5,centerX:a,centerY:c,offset:d=20,stepPosition:l=.5}){const[f,u,h,m,p]=Sf({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:o},targetPosition:i,center:{x:a,y:c},offset:d,stepPosition:l});return[f.reduce((w,E,g)=>{let v="";return g>0&&g<f.length-1?v=_f(f[g-1],E,f[g+1],s):v=`${g===0?"M":"L"}${E.x} ${E.y}`,w+=v,w},""),u,h,m,p]}function ko(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Ef(e){var f;const{sourceNode:t,targetNode:n}=e;if(!ko(t)||!ko(n))return null;const r=t.internals.handleBounds||Ro(t.handles),o=n.internals.handleBounds||Ro(n.handles),i=To((r==null?void 0:r.source)??[],e.sourceHandle),s=To(e.connectionMode===_t.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),e.targetHandle);if(!i||!s)return(f=e.onError)==null||f.call(e,"008",ze.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(i==null?void 0:i.position)||K.Bottom,c=(s==null?void 0:s.position)||K.Top,d=Yt(t,i,a),l=Yt(n,s,c);return{sourceX:d.x,sourceY:d.y,targetX:l.x,targetY:l.y,sourcePosition:a,targetPosition:c}}function Ro(e){if(!e)return null;const t=[],n=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&n.push(r);return{source:t,target:n}}function Yt(e,t,n=K.Left,r=!1){const o=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??qe(e);if(r)return{x:o+s/2,y:i+a/2};switch((t==null?void 0:t.position)??n){case K.Top:return{x:o+s/2,y:i};case K.Right:return{x:o+s,y:i+a/2};case K.Bottom:return{x:o+s/2,y:i+a};case K.Left:return{x:o,y:i+a/2}}}function To(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Dr(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`:""}function Cf(e,{id:t,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:o}){const i=new Set;return e.reduce((s,a)=>([a.markerStart||r,a.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const d=Dr(c,t);i.has(d)||(s.push({id:d,color:c.color||n,...c}),i.add(d))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Ur={nodeOrigin:[0,0],nodeExtent:Ht,elevateNodesOnSelect:!0,defaults:{}},Mf={...Ur,checkEquality:!0};function qr(e,t){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}function Nf(e,t,n){const r=qr(Ur,n);for(const o of e.values())if(o.parentId)Gr(o,e,t,r);else{const i=Zt(o,r.nodeOrigin),s=Mt(o.extent)?o.extent:r.nodeExtent,a=ft(i,s,qe(o));o.internals.positionAbsolute=a}}function Ir(e,t,n,r){var c,d;const o=qr(Mf,r);let i=e.length>0;const s=new Map(t),a=o!=null&&o.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let f=s.get(l.id);if(o.checkEquality&&l===(f==null?void 0:f.internals.userNode))t.set(l.id,f);else{const u=Zt(l,o.nodeOrigin),h=Mt(l.extent)?l.extent:o.nodeExtent,m=ft(u,h,qe(l));f={...o.defaults,...l,measured:{width:(c=l.measured)==null?void 0:c.width,height:(d=l.measured)==null?void 0:d.height},internals:{positionAbsolute:m,handleBounds:l.measured?f==null?void 0:f.internals.handleBounds:void 0,z:Ss(l,a),userNode:l}},t.set(l.id,f)}(f.measured===void 0||f.measured.width===void 0||f.measured.height===void 0)&&!f.hidden&&(i=!1),l.parentId&&Gr(f,t,n,r)}return i}function Af(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Gr(e,t,n,r){const{elevateNodesOnSelect:o,nodeOrigin:i,nodeExtent:s}=qr(Ur,r),a=e.parentId,c=t.get(a);if(!c){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Af(e,n);const d=o?1e3:0,{x:l,y:f,z:u}=Df(e,c,i,s,d),{positionAbsolute:h}=e.internals,m=l!==h.x||f!==h.y;(m||u!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:m?{x:l,y:f}:h,z:u}})}function Ss(e,t){return(De(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function Df(e,t,n,r,o){const{x:i,y:s}=t.internals.positionAbsolute,a=qe(e),c=Zt(e,n),d=Mt(e.extent)?ft(c,e.extent,a):c;let l=ft({x:i+d.x,y:s+d.y},r,a);e.extent==="parent"&&(l=ls(l,a,t));const f=Ss(e,o),u=t.internals.z??0;return{x:l.x,y:l.y,z:u>=f?u+1:f}}function Kr(e,t,n,r=[0,0]){var s;const o=[],i=new Map;for(const a of e){const c=t.get(a.parentId);if(!c)continue;const d=((s=i.get(a.parentId))==null?void 0:s.expandedRect)??Ct(c),l=ds(d,a.rect);i.set(a.parentId,{expandedRect:l,parent:c})}return i.size>0&&i.forEach(({expandedRect:a,parent:c},d)=>{var g;const l=c.internals.positionAbsolute,f=qe(c),u=c.origin??r,h=a.x<l.x?Math.round(Math.abs(l.x-a.x)):0,m=a.y<l.y?Math.round(Math.abs(l.y-a.y)):0,p=Math.max(f.width,Math.round(a.width)),y=Math.max(f.height,Math.round(a.height)),w=(p-f.width)*u[0],E=(y-f.height)*u[1];(h>0||m>0||w||E)&&(o.push({id:d,type:"position",position:{x:c.position.x-h+w,y:c.position.y-m+E}}),(g=n.get(d))==null||g.forEach(v=>{e.some(_=>_.id===v.id)||o.push({id:v.id,type:"position",position:{x:v.position.x+h,y:v.position.y+m}})})),(f.width<a.width||f.height<a.height||h||m)&&o.push({id:d,type:"dimensions",setAttributes:!0,dimensions:{width:p+(h?u[0]*h-w:0),height:y+(m?u[1]*m-E:0)}})}),o}function If(e,t,n,r,o,i){const s=r==null?void 0:r.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const c=[],d=window.getComputedStyle(s),{m22:l}=new window.DOMMatrixReadOnly(d.transform),f=[];for(const u of e.values()){const h=t.get(u.id);if(!h)continue;if(h.hidden){t.set(h.id,{...h,internals:{...h.internals,handleBounds:void 0}}),a=!0;continue}const m=Wr(u.nodeElement),p=h.measured.width!==m.width||h.measured.height!==m.height;if(!!(m.width&&m.height&&(p||!h.internals.handleBounds||u.force))){const w=u.nodeElement.getBoundingClientRect(),E=Mt(h.extent)?h.extent:i;let{positionAbsolute:g}=h.internals;h.parentId&&h.extent==="parent"?g=ls(g,m,t.get(h.parentId)):E&&(g=ft(g,E,m));const v={...h,measured:m,internals:{...h.internals,positionAbsolute:g,handleBounds:{source:No("source",u.nodeElement,w,l,h.id),target:No("target",u.nodeElement,w,l,h.id)}}};t.set(h.id,v),h.parentId&&Gr(v,t,n,{nodeOrigin:o}),a=!0,p&&(c.push({id:h.id,type:"dimensions",dimensions:m}),h.expandParent&&h.parentId&&f.push({id:h.id,parentId:h.parentId,rect:Ct(v,o)}))}}if(f.length>0){const u=Kr(f,t,n,o);c.push(...u)}return{changes:c,updatedInternals:a}}async function kf({delta:e,panZoom:t,transform:n,translateExtent:r,width:o,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[o,i]],r),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function Po(e,t,n,r,o,i){let s=o;const a=r.get(s)||new Map;r.set(s,a.set(n,t)),s=`${o}-${e}`;const c=r.get(s)||new Map;if(r.set(s,c.set(n,t)),i){s=`${o}-${e}-${i}`;const d=r.get(s)||new Map;r.set(s,d.set(n,t))}}function _s(e,t,n){e.clear(),t.clear();for(const r of n){const{source:o,target:i,sourceHandle:s=null,targetHandle:a=null}=r,c={edgeId:r.id,source:o,target:i,sourceHandle:s,targetHandle:a},d=`${o}-${s}--${i}-${a}`,l=`${i}-${a}--${o}-${s}`;Po("source",c,l,e,o,s),Po("target",c,d,e,i,a),t.set(r.id,r)}}function Es(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Es(n,t):!1}function $o(e,t,n){var o;let r=e;do{if((o=r==null?void 0:r.matches)!=null&&o.call(r,t))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function Rf(e,t,n,r){const o=new Map;for(const[i,s]of e)if((s.selected||s.id===r)&&(!s.parentId||!Es(s,e))&&(s.draggable||t&&typeof s.draggable>"u")){const a=e.get(i);a&&o.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return o}function sr({nodeId:e,dragItems:t,nodeLookup:n,dragging:r=!0}){var s,a,c;const o=[];for(const[d,l]of t){const f=(s=n.get(d))==null?void 0:s.internals.userNode;f&&o.push({...f,position:l.position,dragging:r})}if(!e)return[o[0],o];const i=(a=n.get(e))==null?void 0:a.internals.userNode;return[i?{...i,position:((c=t.get(e))==null?void 0:c.position)||i.position,dragging:r}:o[0],o]}function Tf({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:r,onDragStop:o}){let i={x:null,y:null},s=0,a=new Map,c=!1,d={x:0,y:0},l=null,f=!1,u=null,h=!1,m=!1;function p({noDragClassName:w,handleSelector:E,domNode:g,isSelectable:v,nodeId:_,nodeClickDistance:C=0}){u=xe(g);function M({x:R,y:P},$){const{nodeLookup:S,nodeExtent:k,snapGrid:A,snapToGrid:D,nodeOrigin:L,onNodeDrag:I,onSelectionDrag:j,onError:z,updateNodePositions:F}=t();i={x:R,y:P};let V=!1,B={x:0,y:0,x2:0,y2:0};if(a.size>1&&k){const W=Jt(a);B=Nr(W)}for(const[W,X]of a){if(!S.has(W))continue;let U={x:R-X.distance.x,y:P-X.distance.y};D&&(U=Fn(U,A));let H=[[k[0][0],k[0][1]],[k[1][0],k[1][1]]];if(a.size>1&&k&&!X.extent){const{positionAbsolute:Q}=X.internals,G=Q.x-B.x+k[0][0],J=Q.x+X.measured.width-B.x2+k[1][0],Z=Q.y-B.y+k[0][1],te=Q.y+X.measured.height-B.y2+k[1][1];H=[[G,Z],[J,te]]}const{position:q,positionAbsolute:Y}=cs({nodeId:W,nextPosition:U,nodeLookup:S,nodeExtent:H,nodeOrigin:L,onError:z});V=V||X.position.x!==q.x||X.position.y!==q.y,X.position=q,X.internals.positionAbsolute=Y}if(m=m||V,!!V&&(F(a,!0),$&&(r||I||!_&&j))){const[W,X]=sr({nodeId:_,dragItems:a,nodeLookup:S});r==null||r($,a,W,X),I==null||I($,W,X),_||j==null||j($,X)}}async function N(){if(!l)return;const{transform:R,panBy:P,autoPanSpeed:$,autoPanOnNodeDrag:S}=t();if(!S){c=!1,cancelAnimationFrame(s);return}const[k,A]=us(d,l,$);(k!==0||A!==0)&&(i.x=(i.x??0)-k/R[2],i.y=(i.y??0)-A/R[2],await P({x:k,y:A})&&M(i,null)),s=requestAnimationFrame(N)}function T(R){var V;const{nodeLookup:P,multiSelectionActive:$,nodesDraggable:S,transform:k,snapGrid:A,snapToGrid:D,selectNodesOnDrag:L,onNodeDragStart:I,onSelectionDragStart:j,unselectNodesAndEdges:z}=t();f=!0,(!L||!v)&&!$&&_&&((V=P.get(_))!=null&&V.selected||z()),v&&L&&_&&(e==null||e(_));const F=Lt(R.sourceEvent,{transform:k,snapGrid:A,snapToGrid:D,containerBounds:l});if(i=F,a=Rf(P,S,F,_),a.size>0&&(n||I||!_&&j)){const[B,W]=sr({nodeId:_,dragItems:a,nodeLookup:P});n==null||n(R.sourceEvent,a,B,W),I==null||I(R.sourceEvent,B,W),_||j==null||j(R.sourceEvent,W)}}const O=Ki().clickDistance(C).on("start",R=>{const{domNode:P,nodeDragThreshold:$,transform:S,snapGrid:k,snapToGrid:A}=t();l=(P==null?void 0:P.getBoundingClientRect())||null,h=!1,m=!1,$===0&&T(R),i=Lt(R.sourceEvent,{transform:S,snapGrid:k,snapToGrid:A,containerBounds:l}),d=je(R.sourceEvent,l)}).on("drag",R=>{const{autoPanOnNodeDrag:P,transform:$,snapGrid:S,snapToGrid:k,nodeDragThreshold:A,nodeLookup:D}=t(),L=Lt(R.sourceEvent,{transform:$,snapGrid:S,snapToGrid:k,containerBounds:l});if((R.sourceEvent.type==="touchmove"&&R.sourceEvent.touches.length>1||_&&!D.has(_))&&(h=!0),!h){if(!c&&P&&f&&(c=!0,N()),!f){const I=L.xSnapped-(i.x??0),j=L.ySnapped-(i.y??0);Math.sqrt(I*I+j*j)>A&&T(R)}(i.x!==L.xSnapped||i.y!==L.ySnapped)&&a&&f&&(d=je(R.sourceEvent,l),M(L,R.sourceEvent))}}).on("end",R=>{if(!(!f||h)&&(c=!1,f=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:P,updateNodePositions:$,onNodeDragStop:S,onSelectionDragStop:k}=t();if(m&&($(a,!1),m=!1),o||S||!_&&k){const[A,D]=sr({nodeId:_,dragItems:a,nodeLookup:P,dragging:!1});o==null||o(R.sourceEvent,a,A,D),S==null||S(R.sourceEvent,A,D),_||k==null||k(R.sourceEvent,D)}}}).filter(R=>{const P=R.target;return!R.button&&(!w||!$o(P,`.${w}`,g))&&(!E||$o(P,E,g))});u.call(O)}function y(){u==null||u.on(".drag",null)}return{update:p,destroy:y}}function Pf(e,t,n){const r=[],o={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())Xt(o,Ct(i))>0&&r.push(i);return r}const $f=250;function Lf(e,t,n,r){var a,c;let o=[],i=1/0;const s=Pf(e,n,t+$f);for(const d of s){const l=[...((a=d.internals.handleBounds)==null?void 0:a.source)??[],...((c=d.internals.handleBounds)==null?void 0:c.target)??[]];for(const f of l){if(r.nodeId===f.nodeId&&r.type===f.type&&r.id===f.id)continue;const{x:u,y:h}=Yt(d,f,f.position,!0),m=Math.sqrt(Math.pow(u-e.x,2)+Math.pow(h-e.y,2));m>t||(m<i?(o=[{...f,x:u,y:h}],i=m):m===i&&o.push({...f,x:u,y:h}))}}if(!o.length)return null;if(o.length>1){const d=r.type==="source"?"target":"source";return o.find(l=>l.type===d)??o[0]}return o[0]}function Cs(e,t,n,r,o,i=!1){var d,l,f;const s=r.get(e);if(!s)return null;const a=o==="strict"?(d=s.internals.handleBounds)==null?void 0:d[t]:[...((l=s.internals.handleBounds)==null?void 0:l.source)??[],...((f=s.internals.handleBounds)==null?void 0:f.target)??[]],c=(n?a==null?void 0:a.find(u=>u.id===n):a==null?void 0:a[0])??null;return c&&i?{...c,...Yt(s,c,c.position,!0)}:c}function Ms(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function jf(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Ns=()=>!0;function zf(e,{connectionMode:t,connectionRadius:n,handleId:r,nodeId:o,edgeUpdaterType:i,isTarget:s,domNode:a,nodeLookup:c,lib:d,autoPanOnConnect:l,flowId:f,panBy:u,cancelConnection:h,onConnectStart:m,onConnect:p,onConnectEnd:y,isValidConnection:w=Ns,onReconnectEnd:E,updateConnection:g,getTransform:v,getFromHandle:_,autoPanSpeed:C,dragThreshold:M=1}){const N=gs(e.target);let T=0,O;const{x:R,y:P}=je(e),$=N==null?void 0:N.elementFromPoint(R,P),S=Ms(i,$),k=a==null?void 0:a.getBoundingClientRect();let A=!1;if(!k||!S)return;const D=Cs(o,S,r,c,t);if(!D)return;let L=je(e,k),I=!1,j=null,z=!1,F=null;function V(){if(!l||!k)return;const[Q,G]=us(L,k,C);u({x:Q,y:G}),T=requestAnimationFrame(V)}const B={...D,nodeId:o,type:S,position:D.position},W=c.get(o);let U={inProgress:!0,isValid:null,from:Yt(W,B,K.Left,!0),fromHandle:B,fromPosition:B.position,fromNode:W,to:L,toHandle:null,toPosition:_o[B.position],toNode:null};function H(){A=!0,g(U),m==null||m(e,{nodeId:o,handleId:r,handleType:S})}M===0&&H();function q(Q){if(!A){const{x:te,y:re}=je(Q),be=te-R,Be=re-P;if(!(be*be+Be*Be>M*M))return;H()}if(!_()||!B){Y(Q);return}const G=v();L=je(Q,k),O=Lf(Qt(L,G,!1,[1,1]),n,c,B),I||(V(),I=!0);const J=As(Q,{handle:O,connectionMode:t,fromNodeId:o,fromHandleId:r,fromType:s?"target":"source",isValidConnection:w,doc:N,lib:d,flowId:f,nodeLookup:c});F=J.handleDomNode,j=J.connection,z=jf(!!O,J.isValid);const Z={...U,isValid:z,to:J.toHandle&&z?Nn({x:J.toHandle.x,y:J.toHandle.y},G):L,toHandle:J.toHandle,toPosition:z&&J.toHandle?J.toHandle.position:_o[B.position],toNode:J.toHandle?c.get(J.toHandle.nodeId):null};z&&O&&U.toHandle&&Z.toHandle&&U.toHandle.type===Z.toHandle.type&&U.toHandle.nodeId===Z.toHandle.nodeId&&U.toHandle.id===Z.toHandle.id&&U.to.x===Z.to.x&&U.to.y===Z.to.y||(g(Z),U=Z)}function Y(Q){if(A){(O||F)&&j&&z&&(p==null||p(j));const{inProgress:G,...J}=U,Z={...J,toPosition:U.toHandle?U.toPosition:null};y==null||y(Q,Z),i&&(E==null||E(Q,Z))}h(),cancelAnimationFrame(T),I=!1,z=!1,j=null,F=null,N.removeEventListener("mousemove",q),N.removeEventListener("mouseup",Y),N.removeEventListener("touchmove",q),N.removeEventListener("touchend",Y)}N.addEventListener("mousemove",q),N.addEventListener("mouseup",Y),N.addEventListener("touchmove",q),N.addEventListener("touchend",Y)}function As(e,{handle:t,connectionMode:n,fromNodeId:r,fromHandleId:o,fromType:i,doc:s,lib:a,flowId:c,isValidConnection:d=Ns,nodeLookup:l}){const f=i==="target",u=t?s.querySelector(`.${a}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:h,y:m}=je(e),p=s.elementFromPoint(h,m),y=p!=null&&p.classList.contains(`${a}-flow__handle`)?p:u,w={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const E=Ms(void 0,y),g=y.getAttribute("data-nodeid"),v=y.getAttribute("data-handleid"),_=y.classList.contains("connectable"),C=y.classList.contains("connectableend");if(!g||!E)return w;const M={source:f?g:r,sourceHandle:f?v:o,target:f?r:g,targetHandle:f?o:v};w.connection=M;const T=_&&C&&(n===_t.Strict?f&&E==="source"||!f&&E==="target":g!==r||v!==o);w.isValid=T&&d(M),w.toHandle=Cs(g,E,v,l,n,!0)}return w}const kr={onPointerDown:zf,isValid:As};function Of({domNode:e,panZoom:t,getTransform:n,getViewScale:r}){const o=xe(e);function i({translateExtent:a,width:c,height:d,zoomStep:l=10,pannable:f=!0,zoomable:u=!0,inversePan:h=!1}){const m=g=>{const v=n();if(g.sourceEvent.type!=="wheel"||!t)return;const _=-g.sourceEvent.deltaY*(g.sourceEvent.deltaMode===1?.05:g.sourceEvent.deltaMode?1:.002)*l,C=v[2]*Math.pow(2,_);t.scaleTo(C)};let p=[0,0];const y=g=>{(g.sourceEvent.type==="mousedown"||g.sourceEvent.type==="touchstart")&&(p=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY])},w=g=>{const v=n();if(g.sourceEvent.type!=="mousemove"&&g.sourceEvent.type!=="touchmove"||!t)return;const _=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY],C=[_[0]-p[0],_[1]-p[1]];p=_;const M=r()*Math.max(v[2],Math.log(v[2]))*(h?-1:1),N={x:v[0]-C[0]*M,y:v[1]-C[1]*M},T=[[0,0],[c,d]];t.setViewportConstrained({x:N.x,y:N.y,zoom:v[2]},T,a)},E=ns().on("start",y).on("zoom",f?w:null).on("zoom.wheel",u?m:null);o.call(E,{})}function s(){o.on("zoom",null)}return{update:i,destroy:s,pointer:Ae}}const Ff=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,Bn=e=>({x:e.x,y:e.y,zoom:e.k}),ar=({x:e,y:t,zoom:n})=>jn.translate(e,t).scale(n),yt=(e,t)=>e.target.closest(`.${t}`),Ds=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Bf=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,cr=(e,t=0,n=Bf,r=()=>{})=>{const o=typeof t=="number"&&t>0;return o||r(),o?e.transition().duration(t).ease(n).on("end",r):e},Is=e=>{const t=e.ctrlKey&&An()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Hf({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:i,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:d}){return l=>{if(yt(l,t))return!1;l.preventDefault(),l.stopImmediatePropagation();const f=n.property("__zoom").k||1;if(l.ctrlKey&&s){const y=Ae(l),w=Is(l),E=f*Math.pow(2,w);r.scaleTo(n,E,y,l);return}const u=l.deltaMode===1?20:1;let h=o===dt.Vertical?0:l.deltaX*u,m=o===dt.Horizontal?0:l.deltaY*u;!An()&&l.shiftKey&&o!==dt.Vertical&&(h=l.deltaY*u,m=0),r.translateBy(n,-(h/f)*i,-(m/f)*i,{internal:!0});const p=Bn(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,a==null||a(l,p)),e.isPanScrolling&&(c==null||c(l,p),e.panScrollTimeout=setTimeout(()=>{d==null||d(l,p),e.isPanScrolling=!1},150))}}function Vf({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(r,o){const i=r.type==="wheel",s=!t&&i&&!r.ctrlKey,a=yt(r,e);if(r.ctrlKey&&i&&a&&r.preventDefault(),s||a)return null;r.preventDefault(),n.call(this,r,o)}}function Xf({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return r=>{var i,s,a;if((i=r.sourceEvent)!=null&&i.internal)return;const o=Bn(r.transform);e.mouseButton=((s=r.sourceEvent)==null?void 0:s.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=o,((a=r.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(r.sourceEvent,o))}}function Yf({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:r,onPanZoom:o}){return i=>{var s,a;e.usedRightMouseButton=!!(n&&Ds(t,e.mouseButton??0)),(s=i.sourceEvent)!=null&&s.sync||r([i.transform.x,i.transform.y,i.transform.k]),o&&!((a=i.sourceEvent)!=null&&a.internal)&&(o==null||o(i.sourceEvent,Bn(i.transform)))}}function Wf({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:i}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,i&&Ds(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&i(s.sourceEvent),e.usedRightMouseButton=!1,r(!1),o&&Ff(e.prevViewport,s.transform))){const c=Bn(s.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o==null||o(s.sourceEvent,c)},n?150:0)}}}function Uf({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:i,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:d}){return l=>{var m;const f=e||t,u=n&&l.ctrlKey;if(l.button===1&&l.type==="mousedown"&&(yt(l,`${d}-flow__node`)||yt(l,`${d}-flow__edge`)))return!0;if(!r&&!f&&!o&&!i&&!n||s||yt(l,a)&&l.type==="wheel"||yt(l,c)&&(l.type!=="wheel"||o&&l.type==="wheel"&&!e)||!n&&l.ctrlKey&&l.type==="wheel")return!1;if(!n&&l.type==="touchstart"&&((m=l.touches)==null?void 0:m.length)>1)return l.preventDefault(),!1;if(!f&&!o&&!u&&l.type==="wheel"||!r&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(r)&&!r.includes(l.button)&&l.type==="mousedown")return!1;const h=Array.isArray(r)&&r.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||l.type==="wheel")&&h}}function qf({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:r,translateExtent:o,viewport:i,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:d}){const l={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=e.getBoundingClientRect(),u=ns().clickDistance(!De(r)||r<0?0:r).scaleExtent([t,n]).translateExtent(o),h=xe(e).call(u);g({x:i.x,y:i.y,zoom:Et(i.zoom,t,n)},[[0,0],[f.width,f.height]],o);const m=h.on("wheel.zoom"),p=h.on("dblclick.zoom");u.wheelDelta(Is);function y(P,$){return h?new Promise(S=>{u==null||u.interpolate(($==null?void 0:$.interpolate)==="linear"?$t:yn).transform(cr(h,$==null?void 0:$.duration,$==null?void 0:$.ease,()=>S(!0)),P)}):Promise.resolve(!1)}function w({noWheelClassName:P,noPanClassName:$,onPaneContextMenu:S,userSelectionActive:k,panOnScroll:A,panOnDrag:D,panOnScrollMode:L,panOnScrollSpeed:I,preventScrolling:j,zoomOnPinch:z,zoomOnScroll:F,zoomOnDoubleClick:V,zoomActivationKeyPressed:B,lib:W,onTransformChange:X}){k&&!l.isZoomingOrPanning&&E();const H=A&&!B&&!k?Hf({zoomPanValues:l,noWheelClassName:P,d3Selection:h,d3Zoom:u,panOnScrollMode:L,panOnScrollSpeed:I,zoomOnPinch:z,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):Vf({noWheelClassName:P,preventScrolling:j,d3ZoomHandler:m});if(h.on("wheel.zoom",H,{passive:!1}),!k){const Y=Xf({zoomPanValues:l,onDraggingChange:d,onPanZoomStart:a});u.on("start",Y);const Q=Yf({zoomPanValues:l,panOnDrag:D,onPaneContextMenu:!!S,onPanZoom:s,onTransformChange:X});u.on("zoom",Q);const G=Wf({zoomPanValues:l,panOnDrag:D,panOnScroll:A,onPaneContextMenu:S,onPanZoomEnd:c,onDraggingChange:d});u.on("end",G)}const q=Uf({zoomActivationKeyPressed:B,panOnDrag:D,zoomOnScroll:F,panOnScroll:A,zoomOnDoubleClick:V,zoomOnPinch:z,userSelectionActive:k,noPanClassName:$,noWheelClassName:P,lib:W});u.filter(q),V?h.on("dblclick.zoom",p):h.on("dblclick.zoom",null)}function E(){u.on("zoom",null)}async function g(P,$,S){const k=ar(P),A=u==null?void 0:u.constrain()(k,$,S);return A&&await y(A),new Promise(D=>D(A))}async function v(P,$){const S=ar(P);return await y(S,$),new Promise(k=>k(S))}function _(P){if(h){const $=ar(P),S=h.property("__zoom");(S.k!==P.zoom||S.x!==P.x||S.y!==P.y)&&(u==null||u.transform(h,$,null,{sync:!0}))}}function C(){const P=h?ts(h.node()):{x:0,y:0,k:1};return{x:P.x,y:P.y,zoom:P.k}}function M(P,$){return h?new Promise(S=>{u==null||u.interpolate(($==null?void 0:$.interpolate)==="linear"?$t:yn).scaleTo(cr(h,$==null?void 0:$.duration,$==null?void 0:$.ease,()=>S(!0)),P)}):Promise.resolve(!1)}function N(P,$){return h?new Promise(S=>{u==null||u.interpolate(($==null?void 0:$.interpolate)==="linear"?$t:yn).scaleBy(cr(h,$==null?void 0:$.duration,$==null?void 0:$.ease,()=>S(!0)),P)}):Promise.resolve(!1)}function T(P){u==null||u.scaleExtent(P)}function O(P){u==null||u.translateExtent(P)}function R(P){const $=!De(P)||P<0?0:P;u==null||u.clickDistance($)}return{update:w,destroy:E,setViewport:v,setViewportConstrained:g,getViewport:C,scaleTo:M,scaleBy:N,setScaleExtent:T,setTranslateExtent:O,syncViewport:_,setClickDistance:R}}var Nt;(function(e){e.Line="line",e.Handle="handle"})(Nt||(Nt={}));function Gf({width:e,prevWidth:t,height:n,prevHeight:r,affectsX:o,affectsY:i}){const s=e-t,a=n-r,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&o&&(c[0]=c[0]*-1),a&&i&&(c[1]=c[1]*-1),c}function Kf(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),r=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:r,affectsY:o}}function Qe(e,t){return Math.max(0,t-e)}function et(e,t){return Math.max(0,e-t)}function fn(e,t,n){return Math.max(0,t-e,e-n)}function Lo(e,t){return e?!t:t}function Zf(e,t,n,r,o,i,s,a){let{affectsX:c,affectsY:d}=t;const{isHorizontal:l,isVertical:f}=t,u=l&&f,{xSnapped:h,ySnapped:m}=n,{minWidth:p,maxWidth:y,minHeight:w,maxHeight:E}=r,{x:g,y:v,width:_,height:C,aspectRatio:M}=e;let N=Math.floor(l?h-e.pointerX:0),T=Math.floor(f?m-e.pointerY:0);const O=_+(c?-N:N),R=C+(d?-T:T),P=-i[0]*_,$=-i[1]*C;let S=fn(O,p,y),k=fn(R,w,E);if(s){let L=0,I=0;c&&N<0?L=Qe(g+N+P,s[0][0]):!c&&N>0&&(L=et(g+O+P,s[1][0])),d&&T<0?I=Qe(v+T+$,s[0][1]):!d&&T>0&&(I=et(v+R+$,s[1][1])),S=Math.max(S,L),k=Math.max(k,I)}if(a){let L=0,I=0;c&&N>0?L=et(g+N,a[0][0]):!c&&N<0&&(L=Qe(g+O,a[1][0])),d&&T>0?I=et(v+T,a[0][1]):!d&&T<0&&(I=Qe(v+R,a[1][1])),S=Math.max(S,L),k=Math.max(k,I)}if(o){if(l){const L=fn(O/M,w,E)*M;if(S=Math.max(S,L),s){let I=0;!c&&!d||c&&!d&&u?I=et(v+$+O/M,s[1][1])*M:I=Qe(v+$+(c?N:-N)/M,s[0][1])*M,S=Math.max(S,I)}if(a){let I=0;!c&&!d||c&&!d&&u?I=Qe(v+O/M,a[1][1])*M:I=et(v+(c?N:-N)/M,a[0][1])*M,S=Math.max(S,I)}}if(f){const L=fn(R*M,p,y)/M;if(k=Math.max(k,L),s){let I=0;!c&&!d||d&&!c&&u?I=et(g+R*M+P,s[1][0])/M:I=Qe(g+(d?T:-T)*M+P,s[0][0])/M,k=Math.max(k,I)}if(a){let I=0;!c&&!d||d&&!c&&u?I=Qe(g+R*M,a[1][0])/M:I=et(g+(d?T:-T)*M,a[0][0])/M,k=Math.max(k,I)}}}T=T+(T<0?k:-k),N=N+(N<0?S:-S),o&&(u?O>R*M?T=(Lo(c,d)?-N:N)/M:N=(Lo(c,d)?-T:T)*M:l?(T=N/M,d=c):(N=T*M,c=d));const A=c?g+N:g,D=d?v+T:v;return{width:_+(c?-N:N),height:C+(d?-T:T),x:i[0]*N*(c?-1:1)+A,y:i[1]*T*(d?-1:1)+D}}const ks={width:0,height:0,x:0,y:0},Jf={...ks,pointerX:0,pointerY:0,aspectRatio:1};function Qf(e){return[[0,0],[e.measured.width,e.measured.height]]}function eh(e,t,n){const r=t.position.x+e.position.x,o=t.position.y+e.position.y,i=e.measured.width??0,s=e.measured.height??0,a=n[0]*i,c=n[1]*s;return[[r-a,o-c],[r+i-a,o+s-c]]}function th({domNode:e,nodeId:t,getStoreItems:n,onChange:r,onEnd:o}){const i=xe(e);function s({controlPosition:c,boundaries:d,keepAspectRatio:l,resizeDirection:f,onResizeStart:u,onResize:h,onResizeEnd:m,shouldResize:p}){let y={...ks},w={...Jf};const E=Kf(c);let g,v=null,_=[],C,M,N;const T=Ki().on("start",O=>{const{nodeLookup:R,transform:P,snapGrid:$,snapToGrid:S,nodeOrigin:k,paneDomNode:A}=n();if(g=R.get(t),!g)return;v=(A==null?void 0:A.getBoundingClientRect())??null;const{xSnapped:D,ySnapped:L}=Lt(O.sourceEvent,{transform:P,snapGrid:$,snapToGrid:S,containerBounds:v});y={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},w={...y,pointerX:D,pointerY:L,aspectRatio:y.width/y.height},C=void 0,g.parentId&&(g.extent==="parent"||g.expandParent)&&(C=R.get(g.parentId),M=C&&g.extent==="parent"?Qf(C):void 0),_=[],N=void 0;for(const[I,j]of R)if(j.parentId===t&&(_.push({id:I,position:{...j.position},extent:j.extent}),j.extent==="parent"||j.expandParent)){const z=eh(j,g,j.origin??k);N?N=[[Math.min(z[0][0],N[0][0]),Math.min(z[0][1],N[0][1])],[Math.max(z[1][0],N[1][0]),Math.max(z[1][1],N[1][1])]]:N=z}u==null||u(O,{...y})}).on("drag",O=>{const{transform:R,snapGrid:P,snapToGrid:$,nodeOrigin:S}=n(),k=Lt(O.sourceEvent,{transform:R,snapGrid:P,snapToGrid:$,containerBounds:v}),A=[];if(!g)return;const{x:D,y:L,width:I,height:j}=y,z={},F=g.origin??S,{width:V,height:B,x:W,y:X}=Zf(w,E,k,d,l,F,M,N),U=V!==I,H=B!==j,q=W!==D&&U,Y=X!==L&&H;if(!q&&!Y&&!U&&!H)return;if((q||Y||F[0]===1||F[1]===1)&&(z.x=q?W:y.x,z.y=Y?X:y.y,y.x=z.x,y.y=z.y,_.length>0)){const Z=W-D,te=X-L;for(const re of _)re.position={x:re.position.x-Z+F[0]*(V-I),y:re.position.y-te+F[1]*(B-j)},A.push(re)}if((U||H)&&(z.width=U&&(!f||f==="horizontal")?V:y.width,z.height=H&&(!f||f==="vertical")?B:y.height,y.width=z.width,y.height=z.height),C&&g.expandParent){const Z=F[0]*(z.width??0);z.x&&z.x<Z&&(y.x=Z,w.x=w.x-(z.x-Z));const te=F[1]*(z.height??0);z.y&&z.y<te&&(y.y=te,w.y=w.y-(z.y-te))}const Q=Gf({width:y.width,prevWidth:I,height:y.height,prevHeight:j,affectsX:E.affectsX,affectsY:E.affectsY}),G={...y,direction:Q};(p==null?void 0:p(O,G))!==!1&&(h==null||h(O,G),r(z,A))}).on("end",O=>{m==null||m(O,{...y}),o==null||o({...y})});i.call(T)}function a(){i.on(".drag",null)}return{update:s,destroy:a}}var lr={exports:{}},ur={},dr={exports:{}},fr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jo;function nh(){if(jo)return fr;jo=1;var e=Mi();function t(f,u){return f===u&&(f!==0||1/f===1/u)||f!==f&&u!==u}var n=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,i=e.useLayoutEffect,s=e.useDebugValue;function a(f,u){var h=u(),m=r({inst:{value:h,getSnapshot:u}}),p=m[0].inst,y=m[1];return i(function(){p.value=h,p.getSnapshot=u,c(p)&&y({inst:p})},[f,h,u]),o(function(){return c(p)&&y({inst:p}),f(function(){c(p)&&y({inst:p})})},[f]),s(h),h}function c(f){var u=f.getSnapshot;f=f.value;try{var h=u();return!n(f,h)}catch{return!0}}function d(f,u){return u()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:a;return fr.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,fr}var zo;function rh(){return zo||(zo=1,dr.exports=nh()),dr.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oo;function oh(){if(Oo)return ur;Oo=1;var e=Mi(),t=rh();function n(d,l){return d===l&&(d!==0||1/d===1/l)||d!==d&&l!==l}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,i=e.useRef,s=e.useEffect,a=e.useMemo,c=e.useDebugValue;return ur.useSyncExternalStoreWithSelector=function(d,l,f,u,h){var m=i(null);if(m.current===null){var p={hasValue:!1,value:null};m.current=p}else p=m.current;m=a(function(){function w(C){if(!E){if(E=!0,g=C,C=u(C),h!==void 0&&p.hasValue){var M=p.value;if(h(M,C))return v=M}return v=C}if(M=v,r(g,C))return M;var N=u(C);return h!==void 0&&h(M,N)?(g=C,M):(g=C,v=N)}var E=!1,g,v,_=f===void 0?null:f;return[function(){return w(l())},_===null?void 0:function(){return w(_())}]},[l,f,u,h]);var y=o(d,m[0],m[1]);return s(function(){p.hasValue=!0,p.value=y},[y]),c(y),y},ur}var Fo;function ih(){return Fo||(Fo=1,lr.exports=oh()),lr.exports}var sh=ih();const ah=lc(sh),ch={},Bo=e=>{let t;const n=new Set,r=(l,f)=>{const u=typeof l=="function"?l(t):l;if(!Object.is(u,t)){const h=t;t=f??(typeof u!="object"||u===null)?u:Object.assign({},t,u),n.forEach(m=>m(t,h))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>d,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{(ch?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},d=t=e(r,o,c);return c},lh=e=>e?Bo(e):Bo,{useDebugValue:uh}=fe,{useSyncExternalStoreWithSelector:dh}=ah,fh=e=>e;function Rs(e,t=fh,n){const r=dh(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return uh(r),r}const Ho=(e,t)=>{const n=lh(e),r=(o,i=t)=>Rs(n,o,i);return Object.assign(r,n),r},hh=(e,t)=>e?Ho(e,t):Ho;function ie(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const Hn=b.createContext(null),gh=Hn.Provider,Ts=ze.error001();function ee(e,t){const n=b.useContext(Hn);if(n===null)throw new Error(Ts);return Rs(n,e,t)}function oe(){const e=b.useContext(Hn);if(e===null)throw new Error(Ts);return b.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Vo={display:"none"},ph={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ps="react-flow__node-desc",$s="react-flow__edge-desc",mh="react-flow__aria-live",yh=e=>e.ariaLiveMessage,vh=e=>e.ariaLabelConfig;function xh({rfId:e}){const t=ee(yh);return x.jsx("div",{id:`${mh}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:ph,children:t})}function wh({rfId:e,disableKeyboardA11y:t}){const n=ee(vh);return x.jsxs(x.Fragment,{children:[x.jsx("div",{id:`${Ps}-${e}`,style:Vo,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),x.jsx("div",{id:`${$s}-${e}`,style:Vo,children:n["edge.a11yDescription.default"]}),!t&&x.jsx(xh,{rfId:e})]})}const Vn=b.forwardRef(({position:e="top-left",children:t,className:n,style:r,...o},i)=>{const s=`${e}`.split("-");return x.jsx("div",{className:se(["react-flow__panel",n,...s]),style:r,ref:i,...o,children:t})});Vn.displayName="Panel";function bh({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:x.jsx(Vn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:x.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Sh=e=>{const t=[],n=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&n.push(r);return{selectedNodes:t,selectedEdges:n}},hn=e=>e.id;function _h(e,t){return ie(e.selectedNodes.map(hn),t.selectedNodes.map(hn))&&ie(e.selectedEdges.map(hn),t.selectedEdges.map(hn))}function Eh({onSelectionChange:e}){const t=oe(),{selectedNodes:n,selectedEdges:r}=ee(Sh,_h);return b.useEffect(()=>{const o={nodes:n,edges:r};e==null||e(o),t.getState().onSelectionChangeHandlers.forEach(i=>i(o))},[n,r,e]),null}const Ch=e=>!!e.onSelectionChangeHandlers;function Mh({onSelectionChange:e}){const t=ee(Ch);return e||t?x.jsx(Eh,{onSelectionChange:e}):null}const Ls=[0,0],Nh={x:0,y:0,zoom:1},Ah=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],Xo=[...Ah,"rfId"],Dh=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),Yo={translateExtent:Ht,nodeOrigin:Ls,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function Ih(e){const{setNodes:t,setEdges:n,setMinZoom:r,setMaxZoom:o,setTranslateExtent:i,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c,setPaneClickDistance:d}=ee(Dh,ie),l=oe();b.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{f.current=Yo,a()}),[]);const f=b.useRef(Yo);return b.useEffect(()=>{for(const u of Xo){const h=e[u],m=f.current[u];h!==m&&(typeof e[u]>"u"||(u==="nodes"?t(h):u==="edges"?n(h):u==="minZoom"?r(h):u==="maxZoom"?o(h):u==="translateExtent"?i(h):u==="nodeExtent"?s(h):u==="paneClickDistance"?d(h):u==="ariaLabelConfig"?l.setState({ariaLabelConfig:pf(h)}):u==="fitView"?l.setState({fitViewQueued:h}):u==="fitViewOptions"?l.setState({fitViewOptions:h}):l.setState({[u]:h})))}f.current=e},Xo.map(u=>e[u])),null}function Wo(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function kh(e){var r;const[t,n]=b.useState(e==="system"?null:e);return b.useEffect(()=>{if(e!=="system"){n(e);return}const o=Wo(),i=()=>n(o!=null&&o.matches?"dark":"light");return i(),o==null||o.addEventListener("change",i),()=>{o==null||o.removeEventListener("change",i)}},[e]),t!==null?t:(r=Wo())!=null&&r.matches?"dark":"light"}const Uo=typeof document<"u"?document:null;function Wt(e=null,t={target:Uo,actInsideInputWithModifier:!0}){const[n,r]=b.useState(!1),o=b.useRef(!1),i=b.useRef(new Set([])),[s,a]=b.useMemo(()=>{if(e!==null){const d=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=d.reduce((f,u)=>f.concat(...u),[]);return[d,l]}return[[],[]]},[e]);return b.useEffect(()=>{const c=(t==null?void 0:t.target)??Uo,d=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const l=h=>{var y,w;if(o.current=h.ctrlKey||h.metaKey||h.shiftKey||h.altKey,(!o.current||o.current&&!d)&&ps(h))return!1;const p=Go(h.code,a);if(i.current.add(h[p]),qo(s,i.current,!1)){const E=((w=(y=h.composedPath)==null?void 0:y.call(h))==null?void 0:w[0])||h.target,g=(E==null?void 0:E.nodeName)==="BUTTON"||(E==null?void 0:E.nodeName)==="A";t.preventDefault!==!1&&(o.current||!g)&&h.preventDefault(),r(!0)}},f=h=>{const m=Go(h.code,a);qo(s,i.current,!0)?(r(!1),i.current.clear()):i.current.delete(h[m]),h.key==="Meta"&&i.current.clear(),o.current=!1},u=()=>{i.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",f),window.addEventListener("blur",u),window.addEventListener("contextmenu",u),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",f),window.removeEventListener("blur",u),window.removeEventListener("contextmenu",u)}}},[e,r]),n}function qo(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function Go(e,t){return t.includes(e)?"code":"key"}const Rh=()=>{const e=oe();return b.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[r,o,i],panZoom:s}=e.getState();return s?(await s.setViewport({x:t.x??r,y:t.y??o,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},setCenter:async(t,n,r)=>e.getState().setCenter(t,n,r),fitBounds:async(t,n)=>{const{width:r,height:o,minZoom:i,maxZoom:s,panZoom:a}=e.getState(),c=Yr(t,r,o,i,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:r,snapGrid:o,snapToGrid:i,domNode:s}=e.getState();if(!s)return t;const{x:a,y:c}=s.getBoundingClientRect(),d={x:t.x-a,y:t.y-c},l=n.snapGrid??o,f=n.snapToGrid??i;return Qt(d,r,f,l)},flowToScreenPosition:t=>{const{transform:n,domNode:r}=e.getState();if(!r)return t;const{x:o,y:i}=r.getBoundingClientRect(),s=Nn(t,n);return{x:s.x+o,y:s.y+i}}}),[])};function js(e,t){const n=[],r=new Map,o=[];for(const i of e)if(i.type==="add"){o.push(i);continue}else if(i.type==="remove"||i.type==="replace")r.set(i.id,[i]);else{const s=r.get(i.id);s?s.push(i):r.set(i.id,[i])}for(const i of t){const s=r.get(i.id);if(!s){n.push(i);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...i};for(const c of s)Th(c,a);n.push(a)}return o.length&&o.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function Th(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function zs(e,t){return js(e,t)}function Os(e,t){return js(e,t)}function ut(e,t){return{id:e,type:"select",selected:t}}function vt(e,t=new Set,n=!1){const r=[];for(const[o,i]of e){const s=t.has(o);!(i.selected===void 0&&!s)&&i.selected!==s&&(n&&(i.selected=s),r.push(ut(i.id,s)))}return r}function Ko({items:e=[],lookup:t}){var o;const n=[],r=new Map(e.map(i=>[i.id,i]));for(const[i,s]of e.entries()){const a=t.get(s.id),c=((o=a==null?void 0:a.internals)==null?void 0:o.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:i})}for(const[i]of t)r.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function Zo(e){return{id:e.id,type:"remove"}}const Jo=e=>of(e),Ph=e=>as(e);function Fs(e){return b.forwardRef(e)}const $h=typeof window<"u"?b.useLayoutEffect:b.useEffect;function Qo(e){const[t,n]=b.useState(BigInt(0)),[r]=b.useState(()=>Lh(()=>n(o=>o+BigInt(1))));return $h(()=>{const o=r.get();o.length&&(e(o),r.reset())},[t]),r}function Lh(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Bs=b.createContext(null);function jh({children:e}){const t=oe(),n=b.useCallback(a=>{const{nodes:c=[],setNodes:d,hasDefaultNodes:l,onNodesChange:f,nodeLookup:u,fitViewQueued:h}=t.getState();let m=c;for(const y of a)m=typeof y=="function"?y(m):y;const p=Ko({items:m,lookup:u});l&&d(m),p.length>0?f==null||f(p):h&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:w,setNodes:E}=t.getState();y&&E(w)})},[]),r=Qo(n),o=b.useCallback(a=>{const{edges:c=[],setEdges:d,hasDefaultEdges:l,onEdgesChange:f,edgeLookup:u}=t.getState();let h=c;for(const m of a)h=typeof m=="function"?m(h):m;l?d(h):f&&f(Ko({items:h,lookup:u}))},[]),i=Qo(o),s=b.useMemo(()=>({nodeQueue:r,edgeQueue:i}),[]);return x.jsx(Bs.Provider,{value:s,children:e})}function zh(){const e=b.useContext(Bs);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Oh=e=>!!e.panZoom;function Zr(){const e=Rh(),t=oe(),n=zh(),r=ee(Oh),o=b.useMemo(()=>{const i=f=>t.getState().nodeLookup.get(f),s=f=>{n.nodeQueue.push(f)},a=f=>{n.edgeQueue.push(f)},c=f=>{var w,E;const{nodeLookup:u,nodeOrigin:h}=t.getState(),m=Jo(f)?f:u.get(f.id),p=m.parentId?hs(m.position,m.measured,m.parentId,u,h):m.position,y={...m,position:p,width:((w=m.measured)==null?void 0:w.width)??m.width,height:((E=m.measured)==null?void 0:E.height)??m.height};return Ct(y)},d=(f,u,h={replace:!1})=>{s(m=>m.map(p=>{if(p.id===f){const y=typeof u=="function"?u(p):u;return h.replace&&Jo(y)?y:{...p,...y}}return p}))},l=(f,u,h={replace:!1})=>{a(m=>m.map(p=>{if(p.id===f){const y=typeof u=="function"?u(p):u;return h.replace&&Ph(y)?y:{...p,...y}}return p}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>{var u;return(u=i(f))==null?void 0:u.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(u=>({...u}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:s,setEdges:a,addNodes:f=>{const u=Array.isArray(f)?f:[f];n.nodeQueue.push(h=>[...h,...u])},addEdges:f=>{const u=Array.isArray(f)?f:[f];n.edgeQueue.push(h=>[...h,...u])},toObject:()=>{const{nodes:f=[],edges:u=[],transform:h}=t.getState(),[m,p,y]=h;return{nodes:f.map(w=>({...w})),edges:u.map(w=>({...w})),viewport:{x:m,y:p,zoom:y}}},deleteElements:async({nodes:f=[],edges:u=[]})=>{const{nodes:h,edges:m,onNodesDelete:p,onEdgesDelete:y,triggerNodeChanges:w,triggerEdgeChanges:E,onDelete:g,onBeforeDelete:v}=t.getState(),{nodes:_,edges:C}=await uf({nodesToRemove:f,edgesToRemove:u,nodes:h,edges:m,onBeforeDelete:v}),M=C.length>0,N=_.length>0;if(M){const T=C.map(Zo);y==null||y(C),E(T)}if(N){const T=_.map(Zo);p==null||p(_),w(T)}return(N||M)&&(g==null||g({nodes:_,edges:C})),{deletedNodes:_,deletedEdges:C}},getIntersectingNodes:(f,u=!0,h)=>{const m=Co(f),p=m?f:c(f),y=h!==void 0;return p?(h||t.getState().nodes).filter(w=>{const E=t.getState().nodeLookup.get(w.id);if(E&&!m&&(w.id===f.id||!E.internals.positionAbsolute))return!1;const g=Ct(y?w:E),v=Xt(g,p);return u&&v>0||v>=g.width*g.height||v>=p.width*p.height}):[]},isNodeIntersecting:(f,u,h=!0)=>{const p=Co(f)?f:c(f);if(!p)return!1;const y=Xt(p,u);return h&&y>0||y>=p.width*p.height},updateNode:d,updateNodeData:(f,u,h={replace:!1})=>{d(f,m=>{const p=typeof u=="function"?u(m):u;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},updateEdge:l,updateEdgeData:(f,u,h={replace:!1})=>{l(f,m=>{const p=typeof u=="function"?u(m):u;return h.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},h)},getNodesBounds:f=>{const{nodeLookup:u,nodeOrigin:h}=t.getState();return sf(f,{nodeLookup:u,nodeOrigin:h})},getHandleConnections:({type:f,id:u,nodeId:h})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${h}-${f}${u?`-${u}`:""}`))==null?void 0:m.values())??[])},getNodeConnections:({type:f,handleId:u,nodeId:h})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${h}${f?u?`-${f}-${u}`:`-${f}`:""}`))==null?void 0:m.values())??[])},fitView:async f=>{const u=t.getState().fitViewResolver??gf();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:u}),n.nodeQueue.push(h=>[...h]),u.promise}}},[]);return b.useMemo(()=>({...o,...e,viewportInitialized:r}),[r])}const ei=e=>e.selected,Fh=typeof window<"u"?window:void 0;function Bh({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=oe(),{deleteElements:r}=Zr(),o=Wt(e,{actInsideInputWithModifier:!1}),i=Wt(t,{target:Fh});b.useEffect(()=>{if(o){const{edges:s,nodes:a}=n.getState();r({nodes:a.filter(ei),edges:s.filter(ei)}),n.setState({nodesSelectionActive:!1})}},[o]),b.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function Hh(e){const t=oe();b.useEffect(()=>{const n=()=>{var o,i;if(!e.current)return!1;const r=Wr(e.current);(r.height===0||r.width===0)&&((i=(o=t.getState()).onError)==null||i.call(o,"004",ze.error004())),t.setState({width:r.width||500,height:r.height||500})};if(e.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(e.current),()=>{window.removeEventListener("resize",n),r&&e.current&&r.unobserve(e.current)}}},[])}const Xn={position:"absolute",width:"100%",height:"100%",top:0,left:0},Vh=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function Xh({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:i=dt.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:d,minZoom:l,maxZoom:f,zoomActivationKeyCode:u,preventScrolling:h=!0,children:m,noWheelClassName:p,noPanClassName:y,onViewportChange:w,isControlledViewport:E,paneClickDistance:g}){const v=oe(),_=b.useRef(null),{userSelectionActive:C,lib:M}=ee(Vh,ie),N=Wt(u),T=b.useRef();Hh(_);const O=b.useCallback(R=>{w==null||w({x:R[0],y:R[1],zoom:R[2]}),E||v.setState({transform:R})},[w,E]);return b.useEffect(()=>{if(_.current){T.current=qf({domNode:_.current,minZoom:l,maxZoom:f,translateExtent:d,viewport:c,paneClickDistance:g,onDraggingChange:S=>v.setState({paneDragging:S}),onPanZoomStart:(S,k)=>{const{onViewportChangeStart:A,onMoveStart:D}=v.getState();D==null||D(S,k),A==null||A(k)},onPanZoom:(S,k)=>{const{onViewportChange:A,onMove:D}=v.getState();D==null||D(S,k),A==null||A(k)},onPanZoomEnd:(S,k)=>{const{onViewportChangeEnd:A,onMoveEnd:D}=v.getState();D==null||D(S,k),A==null||A(k)}});const{x:R,y:P,zoom:$}=T.current.getViewport();return v.setState({panZoom:T.current,transform:[R,P,$],domNode:_.current.closest(".react-flow")}),()=>{var S;(S=T.current)==null||S.destroy()}}},[]),b.useEffect(()=>{var R;(R=T.current)==null||R.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:i,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:N,preventScrolling:h,noPanClassName:y,userSelectionActive:C,noWheelClassName:p,lib:M,onTransformChange:O})},[e,t,n,r,o,i,s,a,N,h,y,C,p,M,O]),x.jsx("div",{className:"react-flow__renderer",ref:_,style:Xn,children:m})}const Yh=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Wh(){const{userSelectionActive:e,userSelectionRect:t}=ee(Yh,ie);return e&&t?x.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const hr=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Uh=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function qh({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Vt.Full,panOnDrag:r,selectionOnDrag:o,onSelectionStart:i,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:c,onPaneScroll:d,onPaneMouseEnter:l,onPaneMouseMove:f,onPaneMouseLeave:u,children:h}){const m=oe(),{userSelectionActive:p,elementsSelectable:y,dragging:w,connectionInProgress:E}=ee(Uh,ie),g=y&&(e||p),v=b.useRef(null),_=b.useRef(),C=b.useRef(new Set),M=b.useRef(new Set),N=b.useRef(!1),T=b.useRef(!1),O=D=>{if(N.current||E){N.current=!1;return}a==null||a(D),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},R=D=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){D.preventDefault();return}c==null||c(D)},P=d?D=>d(D):void 0,$=D=>{var F,V;const{resetSelectedElements:L,domNode:I}=m.getState();if(_.current=I==null?void 0:I.getBoundingClientRect(),!y||!e||D.button!==0||D.target!==v.current||!_.current)return;(V=(F=D.target)==null?void 0:F.setPointerCapture)==null||V.call(F,D.pointerId),T.current=!0,N.current=!1;const{x:j,y:z}=je(D.nativeEvent,_.current);L(),m.setState({userSelectionRect:{width:0,height:0,startX:j,startY:z,x:j,y:z}}),i==null||i(D)},S=D=>{const{userSelectionRect:L,transform:I,nodeLookup:j,edgeLookup:z,connectionLookup:F,triggerNodeChanges:V,triggerEdgeChanges:B,defaultEdgeOptions:W}=m.getState();if(!_.current||!L)return;N.current=!0;const{x:X,y:U}=je(D.nativeEvent,_.current),{startX:H,startY:q}=L,Y={startX:H,startY:q,x:X<H?X:H,y:U<q?U:q,width:Math.abs(X-H),height:Math.abs(U-q)},Q=C.current,G=M.current;C.current=new Set(Xr(j,Y,I,n===Vt.Partial,!0).map(Z=>Z.id)),M.current=new Set;const J=(W==null?void 0:W.selectable)??!0;for(const Z of C.current){const te=F.get(Z);if(te)for(const{edgeId:re}of te.values()){const be=z.get(re);be&&(be.selectable??J)&&M.current.add(re)}}if(!Mo(Q,C.current)){const Z=vt(j,C.current,!0);V(Z)}if(!Mo(G,M.current)){const Z=vt(z,M.current);B(Z)}m.setState({userSelectionRect:Y,userSelectionActive:!0,nodesSelectionActive:!1})},k=D=>{var I,j;if(D.button!==0||!T.current)return;(j=(I=D.target)==null?void 0:I.releasePointerCapture)==null||j.call(I,D.pointerId);const{userSelectionRect:L}=m.getState();!p&&L&&D.target===v.current&&(O==null||O(D)),m.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:C.current.size>0}),s==null||s(D),(t||o)&&(N.current=!1),T.current=!1},A=r===!0||Array.isArray(r)&&r.includes(0);return x.jsxs("div",{className:se(["react-flow__pane",{draggable:A,dragging:w,selection:e}]),onClick:g?void 0:hr(O,v),onContextMenu:hr(R,v),onWheel:hr(P,v),onPointerEnter:g?void 0:l,onPointerDown:g?$:f,onPointerMove:g?S:f,onPointerUp:g?k:void 0,onPointerLeave:u,ref:v,style:Xn,children:[h,x.jsx(Wh,{})]})}function Rr({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:i,multiSelectionActive:s,nodeLookup:a,onError:c}=t.getState(),d=a.get(e);if(!d){c==null||c("012",ze.error012(e));return}t.setState({nodesSelectionActive:!1}),d.selected?(n||d.selected&&s)&&(i({nodes:[d],edges:[]}),requestAnimationFrame(()=>{var l;return(l=r==null?void 0:r.current)==null?void 0:l.blur()})):o([e])}function Hs({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:i,nodeClickDistance:s}){const a=oe(),[c,d]=b.useState(!1),l=b.useRef();return b.useEffect(()=>{l.current=Tf({getStoreItems:()=>a.getState(),onNodeMouseDown:f=>{Rr({id:f,store:a,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),b.useEffect(()=>{var f,u;if(t)(f=l.current)==null||f.destroy();else if(e.current)return(u=l.current)==null||u.update({noDragClassName:n,handleSelector:r,domNode:e.current,isSelectable:i,nodeId:o,nodeClickDistance:s}),()=>{var h;(h=l.current)==null||h.destroy()}},[n,r,t,i,e,o]),c}const Gh=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Vs(){const e=oe();return b.useCallback(n=>{const{nodeExtent:r,snapToGrid:o,snapGrid:i,nodesDraggable:s,onError:a,updateNodePositions:c,nodeLookup:d,nodeOrigin:l}=e.getState(),f=new Map,u=Gh(s),h=o?i[0]:5,m=o?i[1]:5,p=n.direction.x*h*n.factor,y=n.direction.y*m*n.factor;for(const[,w]of d){if(!u(w))continue;let E={x:w.internals.positionAbsolute.x+p,y:w.internals.positionAbsolute.y+y};o&&(E=Fn(E,i));const{position:g,positionAbsolute:v}=cs({nodeId:w.id,nextPosition:E,nodeLookup:d,nodeExtent:r,nodeOrigin:l,onError:a});w.position=g,w.internals.positionAbsolute=v,f.set(w.id,w)}c(f)},[])}const Jr=b.createContext(null),Kh=Jr.Provider;Jr.Consumer;const Xs=()=>b.useContext(Jr),Zh=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Jh=(e,t,n)=>r=>{const{connectionClickStartHandle:o,connectionMode:i,connection:s}=r,{fromHandle:a,toHandle:c,isValid:d}=s,l=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:l,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===n,isPossibleEndHandle:i===_t.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!o,valid:l&&d}};function Qh({type:e="source",position:t=K.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:i=!0,id:s,onConnect:a,children:c,className:d,onMouseDown:l,onTouchStart:f,...u},h){var k,A;const m=s||null,p=e==="target",y=oe(),w=Xs(),{connectOnClick:E,noPanClassName:g,rfId:v}=ee(Zh,ie),{connectingFrom:_,connectingTo:C,clickConnecting:M,isPossibleEndHandle:N,connectionInProcess:T,clickConnectionInProcess:O,valid:R}=ee(Jh(w,m,e),ie);w||(A=(k=y.getState()).onError)==null||A.call(k,"010",ze.error010());const P=D=>{const{defaultEdgeOptions:L,onConnect:I,hasDefaultEdges:j}=y.getState(),z={...L,...D};if(j){const{edges:F,setEdges:V}=y.getState();V(ws(z,F))}I==null||I(z),a==null||a(z)},$=D=>{if(!w)return;const L=ms(D.nativeEvent);if(o&&(L&&D.button===0||!L)){const I=y.getState();kr.onPointerDown(D.nativeEvent,{autoPanOnConnect:I.autoPanOnConnect,connectionMode:I.connectionMode,connectionRadius:I.connectionRadius,domNode:I.domNode,nodeLookup:I.nodeLookup,lib:I.lib,isTarget:p,handleId:m,nodeId:w,flowId:I.rfId,panBy:I.panBy,cancelConnection:I.cancelConnection,onConnectStart:I.onConnectStart,onConnectEnd:I.onConnectEnd,updateConnection:I.updateConnection,onConnect:P,isValidConnection:n||I.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:I.autoPanSpeed,dragThreshold:I.connectionDragThreshold})}L?l==null||l(D):f==null||f(D)},S=D=>{const{onClickConnectStart:L,onClickConnectEnd:I,connectionClickStartHandle:j,connectionMode:z,isValidConnection:F,lib:V,rfId:B,nodeLookup:W,connection:X}=y.getState();if(!w||!j&&!o)return;if(!j){L==null||L(D.nativeEvent,{nodeId:w,handleId:m,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:w,type:e,id:m}});return}const U=gs(D.target),H=n||F,{connection:q,isValid:Y}=kr.isValid(D.nativeEvent,{handle:{nodeId:w,id:m,type:e},connectionMode:z,fromNodeId:j.nodeId,fromHandleId:j.id||null,fromType:j.type,isValidConnection:H,flowId:B,doc:U,lib:V,nodeLookup:W});Y&&q&&P(q);const Q=structuredClone(X);delete Q.inProgress,Q.toPosition=Q.toHandle?Q.toHandle.position:null,I==null||I(D,Q),y.setState({connectionClickStartHandle:null})};return x.jsx("div",{"data-handleid":m,"data-nodeid":w,"data-handlepos":t,"data-id":`${v}-${w}-${m}-${e}`,className:se(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",g,d,{source:!p,target:p,connectable:r,connectablestart:o,connectableend:i,clickconnecting:M,connectingfrom:_,connectingto:C,valid:R,connectionindicator:r&&(!T||N)&&(T||O?i:o)}]),onMouseDown:$,onTouchStart:$,onClick:E?S:void 0,ref:h,...u,children:c})}const We=b.memo(Fs(Qh));function eg({data:e,isConnectable:t,sourcePosition:n=K.Bottom}){return x.jsxs(x.Fragment,{children:[e==null?void 0:e.label,x.jsx(We,{type:"source",position:n,isConnectable:t})]})}function tg({data:e,isConnectable:t,targetPosition:n=K.Top,sourcePosition:r=K.Bottom}){return x.jsxs(x.Fragment,{children:[x.jsx(We,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,x.jsx(We,{type:"source",position:r,isConnectable:t})]})}function ng(){return null}function rg({data:e,isConnectable:t,targetPosition:n=K.Top}){return x.jsxs(x.Fragment,{children:[x.jsx(We,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const Dn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},ti={input:eg,default:tg,output:rg,group:ng};function og(e){var t,n,r,o;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((r=e.style)==null?void 0:r.width),height:e.height??((o=e.style)==null?void 0:o.height)}}const ig=e=>{const{width:t,height:n,x:r,y:o}=Jt(e.nodeLookup,{filter:i=>!!i.selected});return{width:De(t)?t:null,height:De(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${o}px)`}};function sg({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=oe(),{width:o,height:i,transformString:s,userSelectionActive:a}=ee(ig,ie),c=Vs(),d=b.useRef(null);if(b.useEffect(()=>{var u;n||(u=d.current)==null||u.focus({preventScroll:!0})},[n]),Hs({nodeRef:d}),a||!o||!i)return null;const l=e?u=>{const h=r.getState().nodes.filter(m=>m.selected);e(u,h)}:void 0,f=u=>{Object.prototype.hasOwnProperty.call(Dn,u.key)&&(u.preventDefault(),c({direction:Dn[u.key],factor:u.shiftKey?4:1}))};return x.jsx("div",{className:se(["react-flow__nodesselection","react-flow__container",t]),style:{transform:s},children:x.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:n?void 0:-1,onKeyDown:n?void 0:f,style:{width:o,height:i}})})}const ni=typeof window<"u"?window:void 0,ag=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Ys({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:l,selectionMode:f,onSelectionStart:u,onSelectionEnd:h,multiSelectionKeyCode:m,panActivationKeyCode:p,zoomActivationKeyCode:y,elementsSelectable:w,zoomOnScroll:E,zoomOnPinch:g,panOnScroll:v,panOnScrollSpeed:_,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:N,defaultViewport:T,translateExtent:O,minZoom:R,maxZoom:P,preventScrolling:$,onSelectionContextMenu:S,noWheelClassName:k,noPanClassName:A,disableKeyboardA11y:D,onViewportChange:L,isControlledViewport:I}){const{nodesSelectionActive:j,userSelectionActive:z}=ee(ag),F=Wt(d,{target:ni}),V=Wt(p,{target:ni}),B=V||N,W=V||v,X=l&&B!==!0,U=F||z||X;return Bh({deleteKeyCode:c,multiSelectionKeyCode:m}),x.jsx(Xh,{onPaneContextMenu:i,elementsSelectable:w,zoomOnScroll:E,zoomOnPinch:g,panOnScroll:W,panOnScrollSpeed:_,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:!F&&B,defaultViewport:T,translateExtent:O,minZoom:R,maxZoom:P,zoomActivationKeyCode:y,preventScrolling:$,noWheelClassName:k,noPanClassName:A,onViewportChange:L,isControlledViewport:I,paneClickDistance:a,children:x.jsxs(qh,{onSelectionStart:u,onSelectionEnd:h,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,panOnDrag:B,isSelecting:!!U,selectionMode:f,selectionKeyPressed:F,selectionOnDrag:X,children:[e,j&&x.jsx(sg,{onSelectionContextMenu:S,noPanClassName:A,disableKeyboardA11y:D})]})})}Ys.displayName="FlowRenderer";const cg=b.memo(Ys),lg=e=>t=>e?Xr(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function ug(e){return ee(b.useCallback(lg(e),[e]),ie)}const dg=e=>e.updateNodeInternals;function fg(){const e=ee(dg),[t]=b.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(o=>{const i=o.target.getAttribute("data-id");r.set(i,{id:i,nodeElement:o.target,force:!0})}),e(r)}));return b.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function hg({node:e,nodeType:t,hasDimensions:n,resizeObserver:r}){const o=oe(),i=b.useRef(null),s=b.useRef(null),a=b.useRef(e.sourcePosition),c=b.useRef(e.targetPosition),d=b.useRef(t),l=n&&!!e.internals.handleBounds;return b.useEffect(()=>{i.current&&!e.hidden&&(!l||s.current!==i.current)&&(s.current&&(r==null||r.unobserve(s.current)),r==null||r.observe(i.current),s.current=i.current)},[l,e.hidden]),b.useEffect(()=>()=>{s.current&&(r==null||r.unobserve(s.current),s.current=null)},[]),b.useEffect(()=>{if(i.current){const f=d.current!==t,u=a.current!==e.sourcePosition,h=c.current!==e.targetPosition;(f||u||h)&&(d.current=t,a.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function gg({id:e,onClick:t,onMouseEnter:n,onMouseMove:r,onMouseLeave:o,onContextMenu:i,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:d,nodesFocusable:l,resizeObserver:f,noDragClassName:u,noPanClassName:h,disableKeyboardA11y:m,rfId:p,nodeTypes:y,nodeClickDistance:w,onError:E}){const{node:g,internals:v,isParent:_}=ee(H=>{const q=H.nodeLookup.get(e),Y=H.parentLookup.has(e);return{node:q,internals:q.internals,isParent:Y}},ie);let C=g.type||"default",M=(y==null?void 0:y[C])||ti[C];M===void 0&&(E==null||E("003",ze.error003(C)),C="default",M=(y==null?void 0:y.default)||ti.default);const N=!!(g.draggable||a&&typeof g.draggable>"u"),T=!!(g.selectable||c&&typeof g.selectable>"u"),O=!!(g.connectable||d&&typeof g.connectable>"u"),R=!!(g.focusable||l&&typeof g.focusable>"u"),P=oe(),$=fs(g),S=hg({node:g,nodeType:C,hasDimensions:$,resizeObserver:f}),k=Hs({nodeRef:S,disabled:g.hidden||!N,noDragClassName:u,handleSelector:g.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:w}),A=Vs();if(g.hidden)return null;const D=qe(g),L=og(g),I=T||N||t||n||r||o,j=n?H=>n(H,{...v.userNode}):void 0,z=r?H=>r(H,{...v.userNode}):void 0,F=o?H=>o(H,{...v.userNode}):void 0,V=i?H=>i(H,{...v.userNode}):void 0,B=s?H=>s(H,{...v.userNode}):void 0,W=H=>{const{selectNodesOnDrag:q,nodeDragThreshold:Y}=P.getState();T&&(!q||!N||Y>0)&&Rr({id:e,store:P,nodeRef:S}),t&&t(H,{...v.userNode})},X=H=>{if(!(ps(H.nativeEvent)||m)){if(rs.includes(H.key)&&T){const q=H.key==="Escape";Rr({id:e,store:P,unselect:q,nodeRef:S})}else if(N&&g.selected&&Object.prototype.hasOwnProperty.call(Dn,H.key)){H.preventDefault();const{ariaLabelConfig:q}=P.getState();P.setState({ariaLiveMessage:q["node.a11yDescription.ariaLiveMessage"]({direction:H.key.replace("Arrow","").toLowerCase(),x:~~v.positionAbsolute.x,y:~~v.positionAbsolute.y})}),A({direction:Dn[H.key],factor:H.shiftKey?4:1})}}},U=()=>{var Z;if(m||!((Z=S.current)!=null&&Z.matches(":focus-visible")))return;const{transform:H,width:q,height:Y,autoPanOnNodeFocus:Q,setCenter:G}=P.getState();if(!Q)return;Xr(new Map([[e,g]]),{x:0,y:0,width:q,height:Y},H,!0).length>0||G(g.position.x+D.width/2,g.position.y+D.height/2,{zoom:H[2]})};return x.jsx("div",{className:se(["react-flow__node",`react-flow__node-${C}`,{[h]:N},g.className,{selected:g.selected,selectable:T,parent:_,draggable:N,dragging:k}]),ref:S,style:{zIndex:v.z,transform:`translate(${v.positionAbsolute.x}px,${v.positionAbsolute.y}px)`,pointerEvents:I?"all":"none",visibility:$?"visible":"hidden",...g.style,...L},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:j,onMouseMove:z,onMouseLeave:F,onContextMenu:V,onClick:W,onDoubleClick:B,onKeyDown:R?X:void 0,tabIndex:R?0:void 0,onFocus:R?U:void 0,role:g.ariaRole??(R?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${Ps}-${p}`,"aria-label":g.ariaLabel,...g.domAttributes,children:x.jsx(Kh,{value:e,children:x.jsx(M,{id:e,data:g.data,type:C,positionAbsoluteX:v.positionAbsolute.x,positionAbsoluteY:v.positionAbsolute.y,selected:g.selected??!1,selectable:T,draggable:N,deletable:g.deletable??!0,isConnectable:O,sourcePosition:g.sourcePosition,targetPosition:g.targetPosition,dragging:k,dragHandle:g.dragHandle,zIndex:v.z,parentId:g.parentId,...D})})})}const pg=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Ws(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,onError:i}=ee(pg,ie),s=ug(e.onlyRenderVisibleElements),a=fg();return x.jsx("div",{className:"react-flow__nodes",style:Xn,children:s.map(c=>x.jsx(gg,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:i},c))})}Ws.displayName="NodeRenderer";const mg=b.memo(Ws);function yg(e){return ee(b.useCallback(n=>{if(!e)return n.edges.map(o=>o.id);const r=[];if(n.width&&n.height)for(const o of n.edges){const i=n.nodeLookup.get(o.source),s=n.nodeLookup.get(o.target);i&&s&&vf({sourceNode:i,targetNode:s,width:n.width,height:n.height,transform:n.transform})&&r.push(o.id)}return r},[e]),ie)}const vg=({color:e="none",strokeWidth:t=1})=>x.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),xg=({color:e="none",strokeWidth:t=1})=>x.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),ri={[Cn.Arrow]:vg,[Cn.ArrowClosed]:xg};function wg(e){const t=oe();return b.useMemo(()=>{var o,i;return Object.prototype.hasOwnProperty.call(ri,e)?ri[e]:((i=(o=t.getState()).onError)==null||i.call(o,"009",ze.error009(e)),null)},[e])}const bg=({id:e,type:t,color:n,width:r=12.5,height:o=12.5,markerUnits:i="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=wg(t);return c?x.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0",children:x.jsx(c,{color:n,strokeWidth:s})}):null},Us=({defaultColor:e,rfId:t})=>{const n=ee(i=>i.edges),r=ee(i=>i.defaultEdgeOptions),o=b.useMemo(()=>Cf(n,{id:t,defaultColor:e,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,t,e]);return o.length?x.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:x.jsx("defs",{children:o.map(i=>x.jsx(bg,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};Us.displayName="MarkerDefinitions";var Sg=b.memo(Us);function qs({x:e,y:t,label:n,labelStyle:r,labelShowBg:o=!0,labelBgStyle:i,labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:d,...l}){const[f,u]=b.useState({x:1,y:0,width:0,height:0}),h=se(["react-flow__edge-textwrapper",d]),m=b.useRef(null);return b.useEffect(()=>{if(m.current){const p=m.current.getBBox();u({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?x.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:h,visibility:f.width?"visible":"hidden",...l,children:[o&&x.jsx("rect",{width:f.width+2*s[0],x:-s[0],y:-s[1],height:f.height+2*s[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),x.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]}):null}qs.displayName="EdgeText";const _g=b.memo(qs);function Yn({path:e,labelX:t,labelY:n,label:r,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c,interactionWidth:d=20,...l}){return x.jsxs(x.Fragment,{children:[x.jsx("path",{...l,d:e,fill:"none",className:se(["react-flow__edge-path",l.className])}),d&&x.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}),r&&De(t)&&De(n)?x.jsx(_g,{x:t,y:n,label:r,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c}):null]})}function oi({pos:e,x1:t,y1:n,x2:r,y2:o}){return e===K.Left||e===K.Right?[.5*(t+r),n]:[t,.5*(n+o)]}function Gs({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:i=K.Top}){const[s,a]=oi({pos:n,x1:e,y1:t,x2:r,y2:o}),[c,d]=oi({pos:i,x1:r,y1:o,x2:e,y2:t}),[l,f,u,h]=ys({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:d});return[`M${e},${t} C${s},${a} ${c},${d} ${r},${o}`,l,f,u,h]}function Ks(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,sourcePosition:s,targetPosition:a,label:c,labelStyle:d,labelShowBg:l,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:y,interactionWidth:w})=>{const[E,g,v]=Gs({sourceX:n,sourceY:r,sourcePosition:s,targetX:o,targetY:i,targetPosition:a}),_=e.isInternal?void 0:t;return x.jsx(Yn,{id:_,path:E,labelX:g,labelY:v,label:c,labelStyle:d,labelShowBg:l,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:y,interactionWidth:w})})}const Eg=Ks({isInternal:!1}),Zs=Ks({isInternal:!0});Eg.displayName="SimpleBezierEdge";Zs.displayName="SimpleBezierEdgeInternal";function Js(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:d,labelBgPadding:l,labelBgBorderRadius:f,style:u,sourcePosition:h=K.Bottom,targetPosition:m=K.Top,markerEnd:p,markerStart:y,pathOptions:w,interactionWidth:E})=>{const[g,v,_]=Ar({sourceX:n,sourceY:r,sourcePosition:h,targetX:o,targetY:i,targetPosition:m,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset,stepPosition:w==null?void 0:w.stepPosition}),C=e.isInternal?void 0:t;return x.jsx(Yn,{id:C,path:g,labelX:v,labelY:_,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:d,labelBgPadding:l,labelBgBorderRadius:f,style:u,markerEnd:p,markerStart:y,interactionWidth:E})})}const Qs=Js({isInternal:!1}),ea=Js({isInternal:!0});Qs.displayName="SmoothStepEdge";ea.displayName="SmoothStepEdgeInternal";function ta(e){return b.memo(({id:t,...n})=>{var o;const r=e.isInternal?void 0:t;return x.jsx(Qs,{...n,id:r,pathOptions:b.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const Cg=ta({isInternal:!1}),na=ta({isInternal:!0});Cg.displayName="StepEdge";na.displayName="StepEdgeInternal";function ra(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:d,labelBgPadding:l,labelBgBorderRadius:f,style:u,markerEnd:h,markerStart:m,interactionWidth:p})=>{const[y,w,E]=bs({sourceX:n,sourceY:r,targetX:o,targetY:i}),g=e.isInternal?void 0:t;return x.jsx(Yn,{id:g,path:y,labelX:w,labelY:E,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:d,labelBgPadding:l,labelBgBorderRadius:f,style:u,markerEnd:h,markerStart:m,interactionWidth:p})})}const Mg=ra({isInternal:!1}),oa=ra({isInternal:!0});Mg.displayName="StraightEdge";oa.displayName="StraightEdgeInternal";function ia(e){return b.memo(({id:t,sourceX:n,sourceY:r,targetX:o,targetY:i,sourcePosition:s=K.Bottom,targetPosition:a=K.Top,label:c,labelStyle:d,labelShowBg:l,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:y,pathOptions:w,interactionWidth:E})=>{const[g,v,_]=vs({sourceX:n,sourceY:r,sourcePosition:s,targetX:o,targetY:i,targetPosition:a,curvature:w==null?void 0:w.curvature}),C=e.isInternal?void 0:t;return x.jsx(Yn,{id:C,path:g,labelX:v,labelY:_,label:c,labelStyle:d,labelShowBg:l,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:h,style:m,markerEnd:p,markerStart:y,interactionWidth:E})})}const Ng=ia({isInternal:!1}),sa=ia({isInternal:!0});Ng.displayName="BezierEdge";sa.displayName="BezierEdgeInternal";const ii={default:sa,straight:oa,step:na,smoothstep:ea,simplebezier:Zs},si={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Ag=(e,t,n)=>n===K.Left?e-t:n===K.Right?e+t:e,Dg=(e,t,n)=>n===K.Top?e-t:n===K.Bottom?e+t:e,ai="react-flow__edgeupdater";function ci({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:i,onMouseOut:s,type:a}){return x.jsx("circle",{onMouseDown:o,onMouseEnter:i,onMouseOut:s,className:se([ai,`${ai}-${a}`]),cx:Ag(t,r,e),cy:Dg(n,r,e),r,stroke:"transparent",fill:"transparent"})}function Ig({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:r,sourceY:o,targetX:i,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:d,onReconnectStart:l,onReconnectEnd:f,setReconnecting:u,setUpdateHover:h}){const m=oe(),p=(v,_)=>{if(v.button!==0)return;const{autoPanOnConnect:C,domNode:M,isValidConnection:N,connectionMode:T,connectionRadius:O,lib:R,onConnectStart:P,onConnectEnd:$,cancelConnection:S,nodeLookup:k,rfId:A,panBy:D,updateConnection:L}=m.getState(),I=_.type==="target",j=(V,B)=>{u(!1),f==null||f(V,n,_.type,B)},z=V=>d==null?void 0:d(n,V),F=(V,B)=>{u(!0),l==null||l(v,n,_.type),P==null||P(V,B)};kr.onPointerDown(v.nativeEvent,{autoPanOnConnect:C,connectionMode:T,connectionRadius:O,domNode:M,handleId:_.id,nodeId:_.nodeId,nodeLookup:k,isTarget:I,edgeUpdaterType:_.type,lib:R,flowId:A,cancelConnection:S,panBy:D,isValidConnection:N,onConnect:z,onConnectStart:F,onConnectEnd:$,onReconnectEnd:j,updateConnection:L,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold})},y=v=>p(v,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),w=v=>p(v,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),E=()=>h(!0),g=()=>h(!1);return x.jsxs(x.Fragment,{children:[(e===!0||e==="source")&&x.jsx(ci,{position:a,centerX:r,centerY:o,radius:t,onMouseDown:y,onMouseEnter:E,onMouseOut:g,type:"source"}),(e===!0||e==="target")&&x.jsx(ci,{position:c,centerX:i,centerY:s,radius:t,onMouseDown:w,onMouseEnter:E,onMouseOut:g,type:"target"})]})}function kg({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:r,onClick:o,onDoubleClick:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:d,reconnectRadius:l,onReconnect:f,onReconnectStart:u,onReconnectEnd:h,rfId:m,edgeTypes:p,noPanClassName:y,onError:w,disableKeyboardA11y:E}){let g=ee(G=>G.edgeLookup.get(e));const v=ee(G=>G.defaultEdgeOptions);g=v?{...v,...g}:g;let _=g.type||"default",C=(p==null?void 0:p[_])||ii[_];C===void 0&&(w==null||w("011",ze.error011(_)),_="default",C=(p==null?void 0:p.default)||ii.default);const M=!!(g.focusable||t&&typeof g.focusable>"u"),N=typeof f<"u"&&(g.reconnectable||n&&typeof g.reconnectable>"u"),T=!!(g.selectable||r&&typeof g.selectable>"u"),O=b.useRef(null),[R,P]=b.useState(!1),[$,S]=b.useState(!1),k=oe(),{zIndex:A,sourceX:D,sourceY:L,targetX:I,targetY:j,sourcePosition:z,targetPosition:F}=ee(b.useCallback(G=>{const J=G.nodeLookup.get(g.source),Z=G.nodeLookup.get(g.target);if(!J||!Z)return{zIndex:g.zIndex,...si};const te=Ef({id:e,sourceNode:J,targetNode:Z,sourceHandle:g.sourceHandle||null,targetHandle:g.targetHandle||null,connectionMode:G.connectionMode,onError:w});return{zIndex:yf({selected:g.selected,zIndex:g.zIndex,sourceNode:J,targetNode:Z,elevateOnSelect:G.elevateEdgesOnSelect}),...te||si}},[g.source,g.target,g.sourceHandle,g.targetHandle,g.selected,g.zIndex]),ie),V=b.useMemo(()=>g.markerStart?`url('#${Dr(g.markerStart,m)}')`:void 0,[g.markerStart,m]),B=b.useMemo(()=>g.markerEnd?`url('#${Dr(g.markerEnd,m)}')`:void 0,[g.markerEnd,m]);if(g.hidden||D===null||L===null||I===null||j===null)return null;const W=G=>{var re;const{addSelectedEdges:J,unselectNodesAndEdges:Z,multiSelectionActive:te}=k.getState();T&&(k.setState({nodesSelectionActive:!1}),g.selected&&te?(Z({nodes:[],edges:[g]}),(re=O.current)==null||re.blur()):J([e])),o&&o(G,g)},X=i?G=>{i(G,{...g})}:void 0,U=s?G=>{s(G,{...g})}:void 0,H=a?G=>{a(G,{...g})}:void 0,q=c?G=>{c(G,{...g})}:void 0,Y=d?G=>{d(G,{...g})}:void 0,Q=G=>{var J;if(!E&&rs.includes(G.key)&&T){const{unselectNodesAndEdges:Z,addSelectedEdges:te}=k.getState();G.key==="Escape"?((J=O.current)==null||J.blur(),Z({edges:[g]})):te([e])}};return x.jsx("svg",{style:{zIndex:A},children:x.jsxs("g",{className:se(["react-flow__edge",`react-flow__edge-${_}`,g.className,y,{selected:g.selected,animated:g.animated,inactive:!T&&!o,updating:R,selectable:T}]),onClick:W,onDoubleClick:X,onContextMenu:U,onMouseEnter:H,onMouseMove:q,onMouseLeave:Y,onKeyDown:M?Q:void 0,tabIndex:M?0:void 0,role:g.ariaRole??(M?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":g.ariaLabel===null?void 0:g.ariaLabel||`Edge from ${g.source} to ${g.target}`,"aria-describedby":M?`${$s}-${m}`:void 0,ref:O,...g.domAttributes,children:[!$&&x.jsx(C,{id:e,source:g.source,target:g.target,type:g.type,selected:g.selected,animated:g.animated,selectable:T,deletable:g.deletable??!0,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,sourceX:D,sourceY:L,targetX:I,targetY:j,sourcePosition:z,targetPosition:F,data:g.data,style:g.style,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerStart:V,markerEnd:B,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth}),N&&x.jsx(Ig,{edge:g,isReconnectable:N,reconnectRadius:l,onReconnect:f,onReconnectStart:u,onReconnectEnd:h,sourceX:D,sourceY:L,targetX:I,targetY:j,sourcePosition:z,targetPosition:F,setUpdateHover:P,setReconnecting:S})]})})}const Rg=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function aa({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:r,noPanClassName:o,onReconnect:i,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:l,reconnectRadius:f,onEdgeDoubleClick:u,onReconnectStart:h,onReconnectEnd:m,disableKeyboardA11y:p}){const{edgesFocusable:y,edgesReconnectable:w,elementsSelectable:E,onError:g}=ee(Rg,ie),v=yg(t);return x.jsxs("div",{className:"react-flow__edges",children:[x.jsx(Sg,{defaultColor:e,rfId:n}),v.map(_=>x.jsx(kg,{id:_,edgesFocusable:y,edgesReconnectable:w,elementsSelectable:E,noPanClassName:o,onReconnect:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:d,onClick:l,reconnectRadius:f,onDoubleClick:u,onReconnectStart:h,onReconnectEnd:m,rfId:n,onError:g,edgeTypes:r,disableKeyboardA11y:p},_))]})}aa.displayName="EdgeRenderer";const Tg=b.memo(aa),Pg=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function $g({children:e}){const t=ee(Pg);return x.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Lg(e){const t=Zr(),n=b.useRef(!1);b.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const jg=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function zg(e){const t=ee(jg),n=oe();return b.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Og(e){return e.connection.inProgress?{...e.connection,to:Qt(e.connection.to,e.transform)}:{...e.connection}}function Fg(e){return Og}function Bg(e){const t=Fg();return ee(t,ie)}const Hg=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Vg({containerStyle:e,style:t,type:n,component:r}){const{nodesConnectable:o,width:i,height:s,isValid:a,inProgress:c}=ee(Hg,ie);return!(i&&o&&c)?null:x.jsx("svg",{style:e,width:i,height:s,className:"react-flow__connectionline react-flow__container",children:x.jsx("g",{className:se(["react-flow__connection",ss(a)]),children:x.jsx(ca,{style:t,type:n,CustomComponent:r,isValid:a})})})}const ca=({style:e,type:t=rt.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:o,from:i,fromNode:s,fromHandle:a,fromPosition:c,to:d,toNode:l,toHandle:f,toPosition:u}=Bg();if(!o)return;if(n)return x.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:s,fromHandle:a,fromX:i.x,fromY:i.y,toX:d.x,toY:d.y,fromPosition:c,toPosition:u,connectionStatus:ss(r),toNode:l,toHandle:f});let h="";const m={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:d.x,targetY:d.y,targetPosition:u};switch(t){case rt.Bezier:[h]=vs(m);break;case rt.SimpleBezier:[h]=Gs(m);break;case rt.Step:[h]=Ar({...m,borderRadius:0});break;case rt.SmoothStep:[h]=Ar(m);break;default:[h]=bs(m)}return x.jsx("path",{d:h,fill:"none",className:"react-flow__connection-path",style:e})};ca.displayName="ConnectionLine";const Xg={};function li(e=Xg){b.useRef(e),oe(),b.useEffect(()=>{},[e])}function Yg(){oe(),b.useRef(!1),b.useEffect(()=>{},[])}function la({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:i,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:l,onSelectionContextMenu:f,onSelectionStart:u,onSelectionEnd:h,connectionLineType:m,connectionLineStyle:p,connectionLineComponent:y,connectionLineContainerStyle:w,selectionKeyCode:E,selectionOnDrag:g,selectionMode:v,multiSelectionKeyCode:_,panActivationKeyCode:C,zoomActivationKeyCode:M,deleteKeyCode:N,onlyRenderVisibleElements:T,elementsSelectable:O,defaultViewport:R,translateExtent:P,minZoom:$,maxZoom:S,preventScrolling:k,defaultMarkerColor:A,zoomOnScroll:D,zoomOnPinch:L,panOnScroll:I,panOnScrollSpeed:j,panOnScrollMode:z,zoomOnDoubleClick:F,panOnDrag:V,onPaneClick:B,onPaneMouseEnter:W,onPaneMouseMove:X,onPaneMouseLeave:U,onPaneScroll:H,onPaneContextMenu:q,paneClickDistance:Y,nodeClickDistance:Q,onEdgeContextMenu:G,onEdgeMouseEnter:J,onEdgeMouseMove:Z,onEdgeMouseLeave:te,reconnectRadius:re,onReconnect:be,onReconnectStart:Be,onReconnectEnd:Ge,noDragClassName:ve,noWheelClassName:He,noPanClassName:Re,disableKeyboardA11y:Ke,nodeExtent:ht,rfId:gt,viewport:Ze,onViewportChange:Se}){return li(e),li(t),Yg(),Lg(n),zg(Ze),x.jsx(cg,{onPaneClick:B,onPaneMouseEnter:W,onPaneMouseMove:X,onPaneMouseLeave:U,onPaneContextMenu:q,onPaneScroll:H,paneClickDistance:Y,deleteKeyCode:N,selectionKeyCode:E,selectionOnDrag:g,selectionMode:v,onSelectionStart:u,onSelectionEnd:h,multiSelectionKeyCode:_,panActivationKeyCode:C,zoomActivationKeyCode:M,elementsSelectable:O,zoomOnScroll:D,zoomOnPinch:L,zoomOnDoubleClick:F,panOnScroll:I,panOnScrollSpeed:j,panOnScrollMode:z,panOnDrag:V,defaultViewport:R,translateExtent:P,minZoom:$,maxZoom:S,onSelectionContextMenu:f,preventScrolling:k,noDragClassName:ve,noWheelClassName:He,noPanClassName:Re,disableKeyboardA11y:Ke,onViewportChange:Se,isControlledViewport:!!Ze,children:x.jsxs($g,{children:[x.jsx(Tg,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:s,onReconnect:be,onReconnectStart:Be,onReconnectEnd:Ge,onlyRenderVisibleElements:T,onEdgeContextMenu:G,onEdgeMouseEnter:J,onEdgeMouseMove:Z,onEdgeMouseLeave:te,reconnectRadius:re,defaultMarkerColor:A,noPanClassName:Re,disableKeyboardA11y:Ke,rfId:gt}),x.jsx(Vg,{style:p,type:m,component:y,containerStyle:w}),x.jsx("div",{className:"react-flow__edgelabel-renderer"}),x.jsx(mg,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:l,nodeClickDistance:Q,onlyRenderVisibleElements:T,noPanClassName:Re,noDragClassName:ve,disableKeyboardA11y:Ke,nodeExtent:ht,rfId:gt}),x.jsx("div",{className:"react-flow__viewport-portal"})]})})}la.displayName="GraphView";const Wg=b.memo(la),ui=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c=.5,maxZoom:d=2,nodeOrigin:l,nodeExtent:f}={})=>{const u=new Map,h=new Map,m=new Map,p=new Map,y=r??t??[],w=n??e??[],E=l??[0,0],g=f??Ht;_s(m,p,y);const v=Ir(w,u,h,{nodeOrigin:E,nodeExtent:g,elevateNodesOnSelect:!1});let _=[0,0,1];if(s&&o&&i){const C=Jt(u,{filter:O=>!!((O.width||O.initialWidth)&&(O.height||O.initialHeight))}),{x:M,y:N,zoom:T}=Yr(C,o,i,c,d,(a==null?void 0:a.padding)??.1);_=[M,N,T]}return{rfId:"1",width:0,height:0,transform:_,nodes:w,nodesInitialized:v,nodeLookup:u,parentLookup:h,edges:y,edgeLookup:p,connectionLookup:m,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:d,translateExtent:Ht,nodeExtent:g,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:_t.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:E,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:a,fitViewResolver:null,connection:{...is},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:df,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:os}},Ug=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:d,nodeOrigin:l,nodeExtent:f})=>hh((u,h)=>{async function m(){const{nodeLookup:p,panZoom:y,fitViewOptions:w,fitViewResolver:E,width:g,height:v,minZoom:_,maxZoom:C}=h();y&&(await lf({nodes:p,width:g,height:v,panZoom:y,minZoom:_,maxZoom:C},w),E==null||E.resolve(!0),u({fitViewResolver:null}))}return{...ui({nodes:e,edges:t,width:o,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:d,nodeOrigin:l,nodeExtent:f,defaultNodes:n,defaultEdges:r}),setNodes:p=>{const{nodeLookup:y,parentLookup:w,nodeOrigin:E,elevateNodesOnSelect:g,fitViewQueued:v}=h(),_=Ir(p,y,w,{nodeOrigin:E,nodeExtent:f,elevateNodesOnSelect:g,checkEquality:!0});v&&_?(m(),u({nodes:p,nodesInitialized:_,fitViewQueued:!1,fitViewOptions:void 0})):u({nodes:p,nodesInitialized:_})},setEdges:p=>{const{connectionLookup:y,edgeLookup:w}=h();_s(y,w,p),u({edges:p})},setDefaultNodesAndEdges:(p,y)=>{if(p){const{setNodes:w}=h();w(p),u({hasDefaultNodes:!0})}if(y){const{setEdges:w}=h();w(y),u({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:y,nodeLookup:w,parentLookup:E,domNode:g,nodeOrigin:v,nodeExtent:_,debug:C,fitViewQueued:M}=h(),{changes:N,updatedInternals:T}=If(p,w,E,g,v,_);T&&(Nf(w,E,{nodeOrigin:v,nodeExtent:_}),M?(m(),u({fitViewQueued:!1,fitViewOptions:void 0})):u({}),(N==null?void 0:N.length)>0&&(C&&console.log("React Flow: trigger node changes",N),y==null||y(N)))},updateNodePositions:(p,y=!1)=>{const w=[],E=[],{nodeLookup:g,triggerNodeChanges:v}=h();for(const[_,C]of p){const M=g.get(_),N=!!(M!=null&&M.expandParent&&(M!=null&&M.parentId)&&(C!=null&&C.position)),T={id:_,type:"position",position:N?{x:Math.max(0,C.position.x),y:Math.max(0,C.position.y)}:C.position,dragging:y};N&&M.parentId&&w.push({id:_,parentId:M.parentId,rect:{...C.internals.positionAbsolute,width:C.measured.width??0,height:C.measured.height??0}}),E.push(T)}if(w.length>0){const{parentLookup:_,nodeOrigin:C}=h(),M=Kr(w,g,_,C);E.push(...M)}v(E)},triggerNodeChanges:p=>{const{onNodesChange:y,setNodes:w,nodes:E,hasDefaultNodes:g,debug:v}=h();if(p!=null&&p.length){if(g){const _=zs(p,E);w(_)}v&&console.log("React Flow: trigger node changes",p),y==null||y(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:y,setEdges:w,edges:E,hasDefaultEdges:g,debug:v}=h();if(p!=null&&p.length){if(g){const _=Os(p,E);w(_)}v&&console.log("React Flow: trigger edge changes",p),y==null||y(p)}},addSelectedNodes:p=>{const{multiSelectionActive:y,edgeLookup:w,nodeLookup:E,triggerNodeChanges:g,triggerEdgeChanges:v}=h();if(y){const _=p.map(C=>ut(C,!0));g(_);return}g(vt(E,new Set([...p]),!0)),v(vt(w))},addSelectedEdges:p=>{const{multiSelectionActive:y,edgeLookup:w,nodeLookup:E,triggerNodeChanges:g,triggerEdgeChanges:v}=h();if(y){const _=p.map(C=>ut(C,!0));v(_);return}v(vt(w,new Set([...p]))),g(vt(E,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:y}={})=>{const{edges:w,nodes:E,nodeLookup:g,triggerNodeChanges:v,triggerEdgeChanges:_}=h(),C=p||E,M=y||w,N=C.map(O=>{const R=g.get(O.id);return R&&(R.selected=!1),ut(O.id,!1)}),T=M.map(O=>ut(O.id,!1));v(N),_(T)},setMinZoom:p=>{const{panZoom:y,maxZoom:w}=h();y==null||y.setScaleExtent([p,w]),u({minZoom:p})},setMaxZoom:p=>{const{panZoom:y,minZoom:w}=h();y==null||y.setScaleExtent([w,p]),u({maxZoom:p})},setTranslateExtent:p=>{var y;(y=h().panZoom)==null||y.setTranslateExtent(p),u({translateExtent:p})},setPaneClickDistance:p=>{var y;(y=h().panZoom)==null||y.setClickDistance(p)},resetSelectedElements:()=>{const{edges:p,nodes:y,triggerNodeChanges:w,triggerEdgeChanges:E,elementsSelectable:g}=h();if(!g)return;const v=y.reduce((C,M)=>M.selected?[...C,ut(M.id,!1)]:C,[]),_=p.reduce((C,M)=>M.selected?[...C,ut(M.id,!1)]:C,[]);w(v),E(_)},setNodeExtent:p=>{const{nodes:y,nodeLookup:w,parentLookup:E,nodeOrigin:g,elevateNodesOnSelect:v,nodeExtent:_}=h();p[0][0]===_[0][0]&&p[0][1]===_[0][1]&&p[1][0]===_[1][0]&&p[1][1]===_[1][1]||(Ir(y,w,E,{nodeOrigin:g,nodeExtent:p,elevateNodesOnSelect:v,checkEquality:!1}),u({nodeExtent:p}))},panBy:p=>{const{transform:y,width:w,height:E,panZoom:g,translateExtent:v}=h();return kf({delta:p,panZoom:g,transform:y,translateExtent:v,width:w,height:E})},setCenter:async(p,y,w)=>{const{width:E,height:g,maxZoom:v,panZoom:_}=h();if(!_)return Promise.resolve(!1);const C=typeof(w==null?void 0:w.zoom)<"u"?w.zoom:v;return await _.setViewport({x:E/2-p*C,y:g/2-y*C,zoom:C},{duration:w==null?void 0:w.duration,ease:w==null?void 0:w.ease,interpolate:w==null?void 0:w.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{u({connection:{...is}})},updateConnection:p=>{u({connection:p})},reset:()=>u({...ui()})}},Object.is);function qg({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:r,initialWidth:o,initialHeight:i,initialMinZoom:s,initialMaxZoom:a,initialFitViewOptions:c,fitView:d,nodeOrigin:l,nodeExtent:f,children:u}){const[h]=b.useState(()=>Ug({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:o,height:i,fitView:d,minZoom:s,maxZoom:a,fitViewOptions:c,nodeOrigin:l,nodeExtent:f}));return x.jsx(gh,{value:h,children:x.jsx(jh,{children:u})})}function Gg({children:e,nodes:t,edges:n,defaultNodes:r,defaultEdges:o,width:i,height:s,fitView:a,fitViewOptions:c,minZoom:d,maxZoom:l,nodeOrigin:f,nodeExtent:u}){return b.useContext(Hn)?x.jsx(x.Fragment,{children:e}):x.jsx(qg,{initialNodes:t,initialEdges:n,defaultNodes:r,defaultEdges:o,initialWidth:i,initialHeight:s,fitView:a,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:l,nodeOrigin:f,nodeExtent:u,children:e})}const Kg={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Zg({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:i,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:d,onMove:l,onMoveStart:f,onMoveEnd:u,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:y,onClickConnectEnd:w,onNodeMouseEnter:E,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:_,onNodeDoubleClick:C,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:T,onNodesDelete:O,onEdgesDelete:R,onDelete:P,onSelectionChange:$,onSelectionDragStart:S,onSelectionDrag:k,onSelectionDragStop:A,onSelectionContextMenu:D,onSelectionStart:L,onSelectionEnd:I,onBeforeDelete:j,connectionMode:z,connectionLineType:F=rt.Bezier,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:W,deleteKeyCode:X="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:H=!1,selectionMode:q=Vt.Full,panActivationKeyCode:Y="Space",multiSelectionKeyCode:Q=An()?"Meta":"Control",zoomActivationKeyCode:G=An()?"Meta":"Control",snapToGrid:J,snapGrid:Z,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:re,nodesDraggable:be,autoPanOnNodeFocus:Be,nodesConnectable:Ge,nodesFocusable:ve,nodeOrigin:He=Ls,edgesFocusable:Re,edgesReconnectable:Ke,elementsSelectable:ht=!0,defaultViewport:gt=Nh,minZoom:Ze=.5,maxZoom:Se=2,translateExtent:Ve=Ht,preventScrolling:st=!0,nodeExtent:pt,defaultMarkerColor:Te="#b1b1b7",zoomOnScroll:rn=!0,zoomOnPinch:Gn=!0,panOnScroll:Kn=!1,panOnScrollSpeed:kt=.5,panOnScrollMode:on=dt.Free,zoomOnDoubleClick:Zn=!0,panOnDrag:sn=!0,onPaneClick:Jn,onPaneMouseEnter:Qn,onPaneMouseMove:er,onPaneMouseLeave:ue,onPaneScroll:he,onPaneContextMenu:ge,paneClickDistance:Me=0,nodeClickDistance:me=0,children:pe,onReconnect:_e,onReconnectStart:Je,onReconnectEnd:ae,onEdgeContextMenu:Pe,onEdgeDoubleClick:Ee,onEdgeMouseEnter:Ne,onEdgeMouseMove:at,onEdgeMouseLeave:ct,reconnectRadius:$e=10,onNodesChange:lt,onEdgesChange:Rt,noDragClassName:Ta="nodrag",noWheelClassName:Pa="nowheel",noPanClassName:co="nopan",fitView:lo,fitViewOptions:uo,connectOnClick:$a,attributionPosition:La,proOptions:ja,defaultEdgeOptions:za,elevateNodesOnSelect:Oa,elevateEdgesOnSelect:Fa,disableKeyboardA11y:fo=!1,autoPanOnConnect:Ba,autoPanOnNodeDrag:Ha,autoPanSpeed:Va,connectionRadius:Xa,isValidConnection:Ya,onError:Wa,style:Ua,id:ho,nodeDragThreshold:qa,connectionDragThreshold:Ga,viewport:Ka,onViewportChange:Za,width:Ja,height:Qa,colorMode:ec="light",debug:tc,onScroll:an,ariaLabelConfig:nc,...rc},oc){const tr=ho||"1",ic=kh(ec),sc=b.useCallback(go=>{go.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),an==null||an(go)},[an]);return x.jsx("div",{"data-testid":"rf__wrapper",...rc,onScroll:sc,style:{...Ua,...Kg},ref:oc,className:se(["react-flow",o,ic]),id:ho,role:"application",children:x.jsxs(Gg,{nodes:e,edges:t,width:Ja,height:Qa,fitView:lo,fitViewOptions:uo,minZoom:Ze,maxZoom:Se,nodeOrigin:He,nodeExtent:pt,children:[x.jsx(Wg,{onInit:d,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:E,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:_,onNodeDoubleClick:C,nodeTypes:i,edgeTypes:s,connectionLineType:F,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:W,selectionKeyCode:U,selectionOnDrag:H,selectionMode:q,deleteKeyCode:X,multiSelectionKeyCode:Q,panActivationKeyCode:Y,zoomActivationKeyCode:G,onlyRenderVisibleElements:te,defaultViewport:gt,translateExtent:Ve,minZoom:Ze,maxZoom:Se,preventScrolling:st,zoomOnScroll:rn,zoomOnPinch:Gn,zoomOnDoubleClick:Zn,panOnScroll:Kn,panOnScrollSpeed:kt,panOnScrollMode:on,panOnDrag:sn,onPaneClick:Jn,onPaneMouseEnter:Qn,onPaneMouseMove:er,onPaneMouseLeave:ue,onPaneScroll:he,onPaneContextMenu:ge,paneClickDistance:Me,nodeClickDistance:me,onSelectionContextMenu:D,onSelectionStart:L,onSelectionEnd:I,onReconnect:_e,onReconnectStart:Je,onReconnectEnd:ae,onEdgeContextMenu:Pe,onEdgeDoubleClick:Ee,onEdgeMouseEnter:Ne,onEdgeMouseMove:at,onEdgeMouseLeave:ct,reconnectRadius:$e,defaultMarkerColor:Te,noDragClassName:Ta,noWheelClassName:Pa,noPanClassName:co,rfId:tr,disableKeyboardA11y:fo,nodeExtent:pt,viewport:Ka,onViewportChange:Za}),x.jsx(Ih,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:h,onConnectStart:m,onConnectEnd:p,onClickConnectStart:y,onClickConnectEnd:w,nodesDraggable:be,autoPanOnNodeFocus:Be,nodesConnectable:Ge,nodesFocusable:ve,edgesFocusable:Re,edgesReconnectable:Ke,elementsSelectable:ht,elevateNodesOnSelect:Oa,elevateEdgesOnSelect:Fa,minZoom:Ze,maxZoom:Se,nodeExtent:pt,onNodesChange:lt,onEdgesChange:Rt,snapToGrid:J,snapGrid:Z,connectionMode:z,translateExtent:Ve,connectOnClick:$a,defaultEdgeOptions:za,fitView:lo,fitViewOptions:uo,onNodesDelete:O,onEdgesDelete:R,onDelete:P,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:T,onSelectionDrag:k,onSelectionDragStart:S,onSelectionDragStop:A,onMove:l,onMoveStart:f,onMoveEnd:u,noPanClassName:co,nodeOrigin:He,rfId:tr,autoPanOnConnect:Ba,autoPanOnNodeDrag:Ha,autoPanSpeed:Va,onError:Wa,connectionRadius:Xa,isValidConnection:Ya,selectNodesOnDrag:re,nodeDragThreshold:qa,connectionDragThreshold:Ga,onBeforeDelete:j,paneClickDistance:Me,debug:tc,ariaLabelConfig:nc}),x.jsx(Mh,{onSelectionChange:$}),pe,x.jsx(bh,{proOptions:ja,position:La}),x.jsx(wh,{rfId:tr,disableKeyboardA11y:fo})]})})}var Jg=Fs(Zg);function Qg({dimensions:e,lineWidth:t,variant:n,className:r}){return x.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:se(["react-flow__background-pattern",n,r])})}function ep({radius:e,className:t}){return x.jsx("circle",{cx:e,cy:e,r:e,className:se(["react-flow__background-pattern","dots",t])})}var ot;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ot||(ot={}));const tp={[ot.Dots]:1,[ot.Lines]:1,[ot.Cross]:6},np=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ua({id:e,variant:t=ot.Dots,gap:n=20,size:r,lineWidth:o=1,offset:i=0,color:s,bgColor:a,style:c,className:d,patternClassName:l}){const f=b.useRef(null),{transform:u,patternId:h}=ee(np,ie),m=r||tp[t],p=t===ot.Dots,y=t===ot.Cross,w=Array.isArray(n)?n:[n,n],E=[w[0]*u[2]||1,w[1]*u[2]||1],g=m*u[2],v=Array.isArray(i)?i:[i,i],_=y?[g,g]:E,C=[v[0]*u[2]||1+_[0]/2,v[1]*u[2]||1+_[1]/2],M=`${h}${e||""}`;return x.jsxs("svg",{className:se(["react-flow__background",d]),style:{...c,...Xn,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:f,"data-testid":"rf__background",children:[x.jsx("pattern",{id:M,x:u[0]%E[0],y:u[1]%E[1],width:E[0],height:E[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`,children:p?x.jsx(ep,{radius:g/2,className:l}):x.jsx(Qg,{dimensions:_,lineWidth:o,variant:t,className:l})}),x.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${M})`})]})}ua.displayName="Background";const rp=b.memo(ua);function op(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:x.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function ip(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:x.jsx("path",{d:"M0 0h32v4.2H0z"})})}function sp(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:x.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function ap(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:x.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function cp(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:x.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function gn({children:e,className:t,...n}){return x.jsx("button",{type:"button",className:se(["react-flow__controls-button",t]),...n,children:e})}const lp=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function da({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:i,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:d,children:l,position:f="bottom-left",orientation:u="vertical","aria-label":h}){const m=oe(),{isInteractive:p,minZoomReached:y,maxZoomReached:w,ariaLabelConfig:E}=ee(lp,ie),{zoomIn:g,zoomOut:v,fitView:_}=Zr(),C=()=>{g(),i==null||i()},M=()=>{v(),s==null||s()},N=()=>{_(o),a==null||a()},T=()=>{m.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),c==null||c(!p)},O=u==="horizontal"?"horizontal":"vertical";return x.jsxs(Vn,{className:se(["react-flow__controls",O,d]),position:f,style:e,"data-testid":"rf__controls","aria-label":h??E["controls.ariaLabel"],children:[t&&x.jsxs(x.Fragment,{children:[x.jsx(gn,{onClick:C,className:"react-flow__controls-zoomin",title:E["controls.zoomIn.ariaLabel"],"aria-label":E["controls.zoomIn.ariaLabel"],disabled:w,children:x.jsx(op,{})}),x.jsx(gn,{onClick:M,className:"react-flow__controls-zoomout",title:E["controls.zoomOut.ariaLabel"],"aria-label":E["controls.zoomOut.ariaLabel"],disabled:y,children:x.jsx(ip,{})})]}),n&&x.jsx(gn,{className:"react-flow__controls-fitview",onClick:N,title:E["controls.fitView.ariaLabel"],"aria-label":E["controls.fitView.ariaLabel"],children:x.jsx(sp,{})}),r&&x.jsx(gn,{className:"react-flow__controls-interactive",onClick:T,title:E["controls.interactive.ariaLabel"],"aria-label":E["controls.interactive.ariaLabel"],children:p?x.jsx(cp,{}):x.jsx(ap,{})}),l]})}da.displayName="Controls";const up=b.memo(da);function dp({id:e,x:t,y:n,width:r,height:o,style:i,color:s,strokeColor:a,strokeWidth:c,className:d,borderRadius:l,shapeRendering:f,selected:u,onClick:h}){const{background:m,backgroundColor:p}=i||{},y=s||m||p;return x.jsx("rect",{className:se(["react-flow__minimap-node",{selected:u},d]),x:t,y:n,rx:l,ry:l,width:r,height:o,style:{fill:y,stroke:a,strokeWidth:c},shapeRendering:f,onClick:h?w=>h(w,e):void 0})}const fp=b.memo(dp),hp=e=>e.nodes.map(t=>t.id),gr=e=>e instanceof Function?e:()=>e;function gp({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:i=fp,onClick:s}){const a=ee(hp,ie),c=gr(t),d=gr(e),l=gr(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return x.jsx(x.Fragment,{children:a.map(u=>x.jsx(mp,{id:u,nodeColorFunc:c,nodeStrokeColorFunc:d,nodeClassNameFunc:l,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:i,onClick:s,shapeRendering:f},u))})}function pp({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:i,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:d,x:l,y:f,width:u,height:h}=ee(m=>{const{internals:p}=m.nodeLookup.get(e),y=p.userNode,{x:w,y:E}=p.positionAbsolute,{width:g,height:v}=qe(y);return{node:y,x:w,y:E,width:g,height:v}},ie);return!d||d.hidden||!fs(d)?null:x.jsx(a,{x:l,y:f,width:u,height:h,style:d.style,selected:!!d.selected,className:r(d),color:t(d),borderRadius:o,strokeColor:n(d),strokeWidth:i,shapeRendering:s,onClick:c,id:d.id})}const mp=b.memo(pp);var yp=b.memo(gp);const vp=200,xp=150,wp=e=>!e.hidden,bp=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ds(Jt(e.nodeLookup,{filter:wp}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Sp="react-flow__minimap-desc";function fa({style:e,className:t,nodeStrokeColor:n,nodeColor:r,nodeClassName:o="",nodeBorderRadius:i=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:d,maskStrokeColor:l,maskStrokeWidth:f,position:u="bottom-right",onClick:h,onNodeClick:m,pannable:p=!1,zoomable:y=!1,ariaLabel:w,inversePan:E,zoomStep:g=10,offsetScale:v=5}){const _=oe(),C=b.useRef(null),{boundingRect:M,viewBB:N,rfId:T,panZoom:O,translateExtent:R,flowWidth:P,flowHeight:$,ariaLabelConfig:S}=ee(bp,ie),k=(e==null?void 0:e.width)??vp,A=(e==null?void 0:e.height)??xp,D=M.width/k,L=M.height/A,I=Math.max(D,L),j=I*k,z=I*A,F=v*I,V=M.x-(j-M.width)/2-F,B=M.y-(z-M.height)/2-F,W=j+F*2,X=z+F*2,U=`${Sp}-${T}`,H=b.useRef(0),q=b.useRef();H.current=I,b.useEffect(()=>{if(C.current&&O)return q.current=Of({domNode:C.current,panZoom:O,getTransform:()=>_.getState().transform,getViewScale:()=>H.current}),()=>{var J;(J=q.current)==null||J.destroy()}},[O]),b.useEffect(()=>{var J;(J=q.current)==null||J.update({translateExtent:R,width:P,height:$,inversePan:E,pannable:p,zoomStep:g,zoomable:y})},[p,y,E,g,R,P,$]);const Y=h?J=>{var re;const[Z,te]=((re=q.current)==null?void 0:re.pointer(J))||[0,0];h(J,{x:Z,y:te})}:void 0,Q=m?b.useCallback((J,Z)=>{const te=_.getState().nodeLookup.get(Z).internals.userNode;m(J,te)},[]):void 0,G=w??S["minimap.ariaLabel"];return x.jsx(Vn,{position:u,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*I:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="number"?s:void 0},className:se(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:x.jsxs("svg",{width:k,height:A,viewBox:`${V} ${B} ${W} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":U,ref:C,onClick:Y,children:[G&&x.jsx("title",{id:U,children:G}),x.jsx(yp,{onClick:Q,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:o,nodeStrokeWidth:s,nodeComponent:a}),x.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-F},${B-F}h${W+F*2}v${X+F*2}h${-W-F*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}fa.displayName="MiniMap";const _p=b.memo(fa),Ep=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Cp={[Nt.Line]:"right",[Nt.Handle]:"bottom-right"};function Mp({nodeId:e,position:t,variant:n=Nt.Handle,className:r,style:o=void 0,children:i,color:s,minWidth:a=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:l=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:u,autoScale:h=!0,shouldResize:m,onResizeStart:p,onResize:y,onResizeEnd:w}){const E=Xs(),g=typeof e=="string"?e:E,v=oe(),_=b.useRef(null),C=n===Nt.Handle,M=ee(b.useCallback(Ep(C&&h),[C,h]),ie),N=b.useRef(null),T=t??Cp[n];b.useEffect(()=>{if(!(!_.current||!g))return N.current||(N.current=th({domNode:_.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:R,transform:P,snapGrid:$,snapToGrid:S,nodeOrigin:k,domNode:A}=v.getState();return{nodeLookup:R,transform:P,snapGrid:$,snapToGrid:S,nodeOrigin:k,paneDomNode:A}},onChange:(R,P)=>{const{triggerNodeChanges:$,nodeLookup:S,parentLookup:k,nodeOrigin:A}=v.getState(),D=[],L={x:R.x,y:R.y},I=S.get(g);if(I&&I.expandParent&&I.parentId){const j=I.origin??A,z=R.width??I.measured.width??0,F=R.height??I.measured.height??0,V={id:I.id,parentId:I.parentId,rect:{width:z,height:F,...hs({x:R.x??I.position.x,y:R.y??I.position.y},{width:z,height:F},I.parentId,S,j)}},B=Kr([V],S,k,A);D.push(...B),L.x=R.x?Math.max(j[0]*z,R.x):void 0,L.y=R.y?Math.max(j[1]*F,R.y):void 0}if(L.x!==void 0&&L.y!==void 0){const j={id:g,type:"position",position:{...L}};D.push(j)}if(R.width!==void 0&&R.height!==void 0){const z={id:g,type:"dimensions",resizing:!0,setAttributes:u?u==="horizontal"?"width":"height":!0,dimensions:{width:R.width,height:R.height}};D.push(z)}for(const j of P){const z={...j,type:"position"};D.push(z)}$(D)},onEnd:({width:R,height:P})=>{const $={id:g,type:"dimensions",resizing:!1,dimensions:{width:R,height:P}};v.getState().triggerNodeChanges([$])}})),N.current.update({controlPosition:T,boundaries:{minWidth:a,minHeight:c,maxWidth:d,maxHeight:l},keepAspectRatio:f,resizeDirection:u,onResizeStart:p,onResize:y,onResizeEnd:w,shouldResize:m}),()=>{var R;(R=N.current)==null||R.destroy()}},[T,a,c,d,l,f,p,y,w,m]);const O=T.split("-");return x.jsx("div",{className:se(["react-flow__resize-control","nodrag",...O,n,r]),ref:_,style:{...o,scale:M,...s&&{[C?"backgroundColor":"borderColor"]:s}},children:i})}b.memo(Mp);const pr={width:10,height:10,bottom:-5};b.memo(({data:e,isConnectable:t})=>x.jsx(x.Fragment,{children:x.jsxs("div",{style:{padding:25},children:[x.jsx("div",{children:"Node"}),x.jsx(We,{type:"source",id:"red",position:K.Bottom,style:{...pr,left:"15%",background:"red"},onConnect:n=>console.log("handle onConnect",n),isConnectable:t}),x.jsx(We,{type:"source",position:K.Bottom,id:"blue",style:{...pr,left:"50%",background:"blue"},isConnectable:t}),x.jsx(We,{type:"target",position:K.Bottom,id:"orange",style:{...pr,left:"85%",background:"orange"},isConnectable:t})]})}));const Np={custom:Dp};function Ap({initialNodes:e,initialEdges:t,component:n}){const{messageApi:r}=it(),[o,i]=b.useState(e),[s,a]=b.useState(t);b.useEffect(()=>{i(e)},[e]);const c=b.useCallback(u=>i(h=>zs(u,h)),[]),d=b.useCallback(u=>a(h=>Os(u,h)),[]),l=b.useCallback(u=>a(h=>ws(u,h)),[]),f=async()=>{const u=o.map(p=>({component_id:p.id,position:p.position})),h={position:JSON.stringify(u),edges:JSON.stringify(s),component_id:n.component_id},m=await yc(h);console.log(m),r.success("保存成功")};return x.jsx(ki,{title:"流程图",extra:x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:f,children:"保存"}),bodyStyle:{padding:0},children:x.jsx("div",{style:{height:"40vh"},children:x.jsxs(Jg,{nodes:o,edges:s,nodeTypes:Np,onNodesChange:c,onEdgesChange:d,onConnect:l,fitView:!0,children:[x.jsx(up,{}),x.jsx(_p,{}),x.jsx(rp,{gap:12,size:1})]})})})}function Dp({data:e}){const t=e.inputs||[],n=e.outputs||[];return x.jsxs("div",{style:{background:e.color||"#1976d2",color:"white",padding:10,borderRadius:12,minWidth:150,position:"relative"},children:[x.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:e.label}),t.map((r,o)=>x.jsx(po,{content:x.jsx("div",{children:r.component_name}),children:x.jsx(We,{type:"target",position:K.Left,id:r.component_id,style:{top:30+o*20,background:"#555"}},r.component_id)})),n.map((r,o)=>x.jsx(po,{content:x.jsx("div",{children:r.component_name}),children:x.jsx(We,{type:"source",position:K.Right,id:r.component_id,style:{top:30+o*20,background:"#888"}},r.component_id)}))]})}function Ip(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const Wn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function At(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Qr(e){return"nodeType"in e}function ye(e){var t,n;return e?At(e)?e:Qr(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function eo(e){const{Document:t}=ye(e);return e instanceof t}function en(e){return At(e)?!1:e instanceof ye(e).HTMLElement}function ha(e){return e instanceof ye(e).SVGElement}function Dt(e){return e?At(e)?e.document:Qr(e)?eo(e)?e:en(e)||ha(e)?e.ownerDocument:document:document:document}const Oe=Wn?b.useLayoutEffect:b.useEffect;function to(e){const t=b.useRef(e);return Oe(()=>{t.current=e}),b.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function kp(){const e=b.useRef(null),t=b.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=b.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ut(e,t){t===void 0&&(t=[e]);const n=b.useRef(e);return Oe(()=>{n.current!==e&&(n.current=e)},t),n}function tn(e,t){const n=b.useRef();return b.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function In(e){const t=to(e),n=b.useRef(null),r=b.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function Tr(e){const t=b.useRef();return b.useEffect(()=>{t.current=e},[e]),t.current}let mr={};function nn(e,t){return b.useMemo(()=>{if(t)return t;const n=mr[e]==null?0:mr[e]+1;return mr[e]=n,e+"-"+n},[e,t])}function ga(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((i,s)=>{const a=Object.entries(s);for(const[c,d]of a){const l=i[c];l!=null&&(i[c]=l+e*d)}return i},{...t})}}const wt=ga(1),kn=ga(-1);function Rp(e){return"clientX"in e&&"clientY"in e}function no(e){if(!e)return!1;const{KeyboardEvent:t}=ye(e.target);return t&&e instanceof t}function Tp(e){if(!e)return!1;const{TouchEvent:t}=ye(e.target);return t&&e instanceof t}function Pr(e){if(Tp(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Rp(e)?{x:e.clientX,y:e.clientY}:null}const qt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[qt.Translate.toString(e),qt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),di="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Pp(e){return e.matches(di)?e:e.querySelector(di)}const $p={display:"none"};function Lp(e){let{id:t,value:n}=e;return fe.createElement("div",{id:t,style:$p},n)}function jp(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return fe.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function zp(){const[e,t]=b.useState("");return{announce:b.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const pa=b.createContext(null);function Op(e){const t=b.useContext(pa);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Fp(){const[e]=b.useState(()=>new Set),t=b.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[b.useCallback(r=>{let{type:o,event:i}=r;e.forEach(s=>{var a;return(a=s[o])==null?void 0:a.call(s,i)})},[e]),t]}const Bp={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Hp={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Vp(e){let{announcements:t=Hp,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=Bp}=e;const{announce:i,announcement:s}=zp(),a=nn("DndLiveRegion"),[c,d]=b.useState(!1);if(b.useEffect(()=>{d(!0)},[]),Op(b.useMemo(()=>({onDragStart(f){let{active:u}=f;i(t.onDragStart({active:u}))},onDragMove(f){let{active:u,over:h}=f;t.onDragMove&&i(t.onDragMove({active:u,over:h}))},onDragOver(f){let{active:u,over:h}=f;i(t.onDragOver({active:u,over:h}))},onDragEnd(f){let{active:u,over:h}=f;i(t.onDragEnd({active:u,over:h}))},onDragCancel(f){let{active:u,over:h}=f;i(t.onDragCancel({active:u,over:h}))}}),[i,t])),!c)return null;const l=fe.createElement(fe.Fragment,null,fe.createElement(Lp,{id:r,value:o.draggable}),fe.createElement(jp,{id:a,announcement:s}));return n?Pt.createPortal(l,n):l}var ce;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ce||(ce={}));function Rn(){}function Xp(e,t){return b.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Yp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return b.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const Ie=Object.freeze({x:0,y:0});function Wp(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Up(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function qp(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),s=o-r,a=i-n;if(r<o&&n<i){const c=t.width*t.height,d=e.width*e.height,l=s*a,f=l/(c+d-l);return Number(f.toFixed(4))}return 0}const Gp=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const i of r){const{id:s}=i,a=n.get(s);if(a){const c=qp(a,t);c>0&&o.push({id:s,data:{droppableContainer:i,value:c}})}}return o.sort(Wp)};function Kp(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function ma(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Ie}function Zp(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o.reduce((s,a)=>({...s,top:s.top+e*a.y,bottom:s.bottom+e*a.y,left:s.left+e*a.x,right:s.right+e*a.x}),{...n})}}const Jp=Zp(1);function Qp(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function em(e,t,n){const r=Qp(t);if(!r)return e;const{scaleX:o,scaleY:i,x:s,y:a}=r,c=e.left-s-(1-o)*parseFloat(n),d=e.top-a-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),l=o?e.width/o:e.width,f=i?e.height/i:e.height;return{width:l,height:f,top:d,right:c+l,bottom:d+f,left:c}}const tm={ignoreTransform:!1};function It(e,t){t===void 0&&(t=tm);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:l}=ye(e).getComputedStyle(e);d&&(n=em(n,d,l))}const{top:r,left:o,width:i,height:s,bottom:a,right:c}=n;return{top:r,left:o,width:i,height:s,bottom:a,right:c}}function fi(e){return It(e,{ignoreTransform:!0})}function nm(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function rm(e,t){return t===void 0&&(t=ye(e).getComputedStyle(e)),t.position==="fixed"}function om(e,t){t===void 0&&(t=ye(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const i=t[o];return typeof i=="string"?n.test(i):!1})}function ro(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(eo(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!en(o)||ha(o)||n.includes(o))return n;const i=ye(e).getComputedStyle(o);return o!==e&&om(o,i)&&n.push(o),rm(o,i)?n:r(o.parentNode)}return e?r(e):n}function ya(e){const[t]=ro(e,1);return t??null}function yr(e){return!Wn||!e?null:At(e)?e:Qr(e)?eo(e)||e===Dt(e).scrollingElement?window:en(e)?e:null:null}function va(e){return At(e)?e.scrollX:e.scrollLeft}function xa(e){return At(e)?e.scrollY:e.scrollTop}function $r(e){return{x:va(e),y:xa(e)}}var de;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(de||(de={}));function wa(e){return!Wn||!e?!1:e===document.scrollingElement}function ba(e){const t={x:0,y:0},n=wa(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,s=e.scrollTop>=r.y,a=e.scrollLeft>=r.x;return{isTop:o,isLeft:i,isBottom:s,isRight:a,maxScroll:r,minScroll:t}}const im={x:.2,y:.2};function sm(e,t,n,r,o){let{top:i,left:s,right:a,bottom:c}=n;r===void 0&&(r=10),o===void 0&&(o=im);const{isTop:d,isBottom:l,isLeft:f,isRight:u}=ba(e),h={x:0,y:0},m={x:0,y:0},p={height:t.height*o.y,width:t.width*o.x};return!d&&i<=t.top+p.height?(h.y=de.Backward,m.y=r*Math.abs((t.top+p.height-i)/p.height)):!l&&c>=t.bottom-p.height&&(h.y=de.Forward,m.y=r*Math.abs((t.bottom-p.height-c)/p.height)),!u&&a>=t.right-p.width?(h.x=de.Forward,m.x=r*Math.abs((t.right-p.width-a)/p.width)):!f&&s<=t.left+p.width&&(h.x=de.Backward,m.x=r*Math.abs((t.left+p.width-s)/p.width)),{direction:h,speed:m}}function am(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:s}=window;return{top:0,left:0,right:i,bottom:s,width:i,height:s}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Sa(e){return e.reduce((t,n)=>wt(t,$r(n)),Ie)}function cm(e){return e.reduce((t,n)=>t+va(n),0)}function lm(e){return e.reduce((t,n)=>t+xa(n),0)}function um(e,t){if(t===void 0&&(t=It),!e)return;const{top:n,left:r,bottom:o,right:i}=t(e);ya(e)&&(o<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const dm=[["x",["left","right"],cm],["y",["top","bottom"],lm]];class oo{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=ro(n),o=Sa(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,s,a]of dm)for(const c of s)Object.defineProperty(this,c,{get:()=>{const d=a(r),l=o[i]-d;return this.rect[c]+l},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class jt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function fm(e){const{EventTarget:t}=ye(e);return e instanceof t?e:Dt(e)}function vr(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var Ce;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Ce||(Ce={}));function hi(e){e.preventDefault()}function hm(e){e.stopPropagation()}var ne;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ne||(ne={}));const _a={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},gm=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class Ea{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new jt(Dt(n)),this.windowListeners=new jt(ye(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ce.Resize,this.handleCancel),this.windowListeners.add(Ce.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ce.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&um(r),n(Ie)}handleKeyDown(t){if(no(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:i=_a,coordinateGetter:s=gm,scrollBehavior:a="smooth"}=o,{code:c}=t;if(i.end.includes(c)){this.handleEnd(t);return}if(i.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:d}=r.current,l=d?{x:d.left,y:d.top}:Ie;this.referenceCoordinates||(this.referenceCoordinates=l);const f=s(t,{active:n,context:r.current,currentCoordinates:l});if(f){const u=kn(f,l),h={x:0,y:0},{scrollableAncestors:m}=r.current;for(const p of m){const y=t.code,{isTop:w,isRight:E,isLeft:g,isBottom:v,maxScroll:_,minScroll:C}=ba(p),M=am(p),N={x:Math.min(y===ne.Right?M.right-M.width/2:M.right,Math.max(y===ne.Right?M.left:M.left+M.width/2,f.x)),y:Math.min(y===ne.Down?M.bottom-M.height/2:M.bottom,Math.max(y===ne.Down?M.top:M.top+M.height/2,f.y))},T=y===ne.Right&&!E||y===ne.Left&&!g,O=y===ne.Down&&!v||y===ne.Up&&!w;if(T&&N.x!==f.x){const R=p.scrollLeft+u.x,P=y===ne.Right&&R<=_.x||y===ne.Left&&R>=C.x;if(P&&!u.y){p.scrollTo({left:R,behavior:a});return}P?h.x=p.scrollLeft-R:h.x=y===ne.Right?p.scrollLeft-_.x:p.scrollLeft-C.x,h.x&&p.scrollBy({left:-h.x,behavior:a});break}else if(O&&N.y!==f.y){const R=p.scrollTop+u.y,P=y===ne.Down&&R<=_.y||y===ne.Up&&R>=C.y;if(P&&!u.x){p.scrollTo({top:R,behavior:a});return}P?h.y=p.scrollTop-R:h.y=y===ne.Down?p.scrollTop-_.y:p.scrollTop-C.y,h.y&&p.scrollBy({top:-h.y,behavior:a});break}}this.handleMove(t,wt(kn(f,this.referenceCoordinates),h))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ea.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=_a,onActivation:o}=t,{active:i}=n;const{code:s}=e.nativeEvent;if(r.start.includes(s)){const a=i.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function gi(e){return!!(e&&"distance"in e)}function pi(e){return!!(e&&"delay"in e)}class io{constructor(t,n,r){var o;r===void 0&&(r=fm(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:s}=i;this.props=t,this.events=n,this.document=Dt(s),this.documentListeners=new jt(this.document),this.listeners=new jt(r),this.windowListeners=new jt(ye(s)),this.initialCoordinates=(o=Pr(i))!=null?o:Ie,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ce.Resize,this.handleCancel),this.windowListeners.add(Ce.DragStart,hi),this.windowListeners.add(Ce.VisibilityChange,this.handleCancel),this.windowListeners.add(Ce.ContextMenu,hi),this.documentListeners.add(Ce.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(pi(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(gi(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ce.Click,hm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ce.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:i}=this,{onMove:s,options:{activationConstraint:a}}=i;if(!o)return;const c=(n=Pr(t))!=null?n:Ie,d=kn(o,c);if(!r&&a){if(gi(a)){if(a.tolerance!=null&&vr(d,a.tolerance))return this.handleCancel();if(vr(d,a.distance))return this.handleStart()}if(pi(a)&&vr(d,a.tolerance))return this.handleCancel();this.handlePending(a,d);return}t.cancelable&&t.preventDefault(),s(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const pm={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class so extends io{constructor(t){const{event:n}=t,r=Dt(n.target);super(t,pm,r)}}so.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const mm={move:{name:"mousemove"},end:{name:"mouseup"}};var Lr;(function(e){e[e.RightClick=2]="RightClick"})(Lr||(Lr={}));class ym extends io{constructor(t){super(t,mm,Dt(t.event.target))}}ym.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===Lr.RightClick?!1:(r==null||r({event:n}),!0)}}];const xr={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class vm extends io{constructor(t){super(t,xr)}static setup(){return window.addEventListener(xr.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(xr.move.name,t)};function t(){}}}vm.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var zt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(zt||(zt={}));var Tn;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Tn||(Tn={}));function xm(e){let{acceleration:t,activator:n=zt.Pointer,canScroll:r,draggingRect:o,enabled:i,interval:s=5,order:a=Tn.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:l,delta:f,threshold:u}=e;const h=bm({delta:f,disabled:!i}),[m,p]=kp(),y=b.useRef({x:0,y:0}),w=b.useRef({x:0,y:0}),E=b.useMemo(()=>{switch(n){case zt.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case zt.DraggableRect:return o}},[n,o,c]),g=b.useRef(null),v=b.useCallback(()=>{const C=g.current;if(!C)return;const M=y.current.x*w.current.x,N=y.current.y*w.current.y;C.scrollBy(M,N)},[]),_=b.useMemo(()=>a===Tn.TreeOrder?[...d].reverse():d,[a,d]);b.useEffect(()=>{if(!i||!d.length||!E){p();return}for(const C of _){if((r==null?void 0:r(C))===!1)continue;const M=d.indexOf(C),N=l[M];if(!N)continue;const{direction:T,speed:O}=sm(C,N,E,t,u);for(const R of["x","y"])h[R][T[R]]||(O[R]=0,T[R]=0);if(O.x>0||O.y>0){p(),g.current=C,m(v,s),y.current=O,w.current=T;return}}y.current={x:0,y:0},w.current={x:0,y:0},p()},[t,v,r,p,i,s,JSON.stringify(E),JSON.stringify(h),m,d,_,l,JSON.stringify(u)])}const wm={x:{[de.Backward]:!1,[de.Forward]:!1},y:{[de.Backward]:!1,[de.Forward]:!1}};function bm(e){let{delta:t,disabled:n}=e;const r=Tr(t);return tn(o=>{if(n||!r||!o)return wm;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[de.Backward]:o.x[de.Backward]||i.x===-1,[de.Forward]:o.x[de.Forward]||i.x===1},y:{[de.Backward]:o.y[de.Backward]||i.y===-1,[de.Forward]:o.y[de.Forward]||i.y===1}}},[n,t,r])}function Sm(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return tn(o=>{var i;return t==null?null:(i=r??o)!=null?i:null},[r,t])}function _m(e,t){return b.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,i=o.activators.map(s=>({eventName:s.eventName,handler:t(s.handler,r)}));return[...n,...i]},[]),[e,t])}var Gt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Gt||(Gt={}));var jr;(function(e){e.Optimized="optimized"})(jr||(jr={}));const mi=new Map;function Em(e,t){let{dragging:n,dependencies:r,config:o}=t;const[i,s]=b.useState(null),{frequency:a,measure:c,strategy:d}=o,l=b.useRef(e),f=y(),u=Ut(f),h=b.useCallback(function(w){w===void 0&&(w=[]),!u.current&&s(E=>E===null?w:E.concat(w.filter(g=>!E.includes(g))))},[u]),m=b.useRef(null),p=tn(w=>{if(f&&!n)return mi;if(!w||w===mi||l.current!==e||i!=null){const E=new Map;for(let g of e){if(!g)continue;if(i&&i.length>0&&!i.includes(g.id)&&g.rect.current){E.set(g.id,g.rect.current);continue}const v=g.node.current,_=v?new oo(c(v),v):null;g.rect.current=_,_&&E.set(g.id,_)}return E}return w},[e,i,n,f,c]);return b.useEffect(()=>{l.current=e},[e]),b.useEffect(()=>{f||h()},[n,f]),b.useEffect(()=>{i&&i.length>0&&s(null)},[JSON.stringify(i)]),b.useEffect(()=>{f||typeof a!="number"||m.current!==null||(m.current=setTimeout(()=>{h(),m.current=null},a))},[a,f,h,...r]),{droppableRects:p,measureDroppableContainers:h,measuringScheduled:i!=null};function y(){switch(d){case Gt.Always:return!1;case Gt.BeforeDragging:return n;default:return!n}}}function Ca(e,t){return tn(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Cm(e,t){return Ca(e,t)}function Mm(e){let{callback:t,disabled:n}=e;const r=to(t),o=b.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return b.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function Un(e){let{callback:t,disabled:n}=e;const r=to(t),o=b.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return b.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function Nm(e){return new oo(It(e),e)}function yi(e,t,n){t===void 0&&(t=Nm);const[r,o]=b.useState(null);function i(){o(c=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=c??n)!=null?d:null}const l=t(e);return JSON.stringify(c)===JSON.stringify(l)?c:l})}const s=Mm({callback(c){if(e)for(const d of c){const{type:l,target:f}=d;if(l==="childList"&&f instanceof HTMLElement&&f.contains(e)){i();break}}}}),a=Un({callback:i});return Oe(()=>{i(),e?(a==null||a.observe(e),s==null||s.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),s==null||s.disconnect())},[e]),r}function Am(e){const t=Ca(e);return ma(e,t)}const vi=[];function Dm(e){const t=b.useRef(e),n=tn(r=>e?r&&r!==vi&&e&&t.current&&e.parentNode===t.current.parentNode?r:ro(e):vi,[e]);return b.useEffect(()=>{t.current=e},[e]),n}function Im(e){const[t,n]=b.useState(null),r=b.useRef(e),o=b.useCallback(i=>{const s=yr(i.target);s&&n(a=>a?(a.set(s,$r(s)),new Map(a)):null)},[]);return b.useEffect(()=>{const i=r.current;if(e!==i){s(i);const a=e.map(c=>{const d=yr(c);return d?(d.addEventListener("scroll",o,{passive:!0}),[d,$r(d)]):null}).filter(c=>c!=null);n(a.length?new Map(a):null),r.current=e}return()=>{s(e),s(i)};function s(a){a.forEach(c=>{const d=yr(c);d==null||d.removeEventListener("scroll",o)})}},[o,e]),b.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,s)=>wt(i,s),Ie):Sa(e):Ie,[e,t])}function xi(e,t){t===void 0&&(t=[]);const n=b.useRef(null);return b.useEffect(()=>{n.current=null},t),b.useEffect(()=>{const r=e!==Ie;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?kn(e,n.current):Ie}function km(e){b.useEffect(()=>{if(!Wn)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Rm(e,t){return b.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:i}=r;return n[o]=s=>{i(s,t)},n},{}),[e,t])}function Ma(e){return b.useMemo(()=>e?nm(e):null,[e])}const wi=[];function Tm(e,t){t===void 0&&(t=It);const[n]=e,r=Ma(n?ye(n):null),[o,i]=b.useState(wi);function s(){i(()=>e.length?e.map(c=>wa(c)?r:new oo(t(c),c)):wi)}const a=Un({callback:s});return Oe(()=>{a==null||a.disconnect(),s(),e.forEach(c=>a==null?void 0:a.observe(c))},[e]),o}function Pm(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return en(t)?t:e}function $m(e){let{measure:t}=e;const[n,r]=b.useState(null),o=b.useCallback(d=>{for(const{target:l}of d)if(en(l)){r(f=>{const u=t(l);return f?{...f,width:u.width,height:u.height}:u});break}},[t]),i=Un({callback:o}),s=b.useCallback(d=>{const l=Pm(d);i==null||i.disconnect(),l&&(i==null||i.observe(l)),r(l?t(l):null)},[t,i]),[a,c]=In(s);return b.useMemo(()=>({nodeRef:a,rect:n,setRef:c}),[n,a,c])}const Lm=[{sensor:so,options:{}},{sensor:Ea,options:{}}],jm={current:{}},bn={draggable:{measure:fi},droppable:{measure:fi,strategy:Gt.WhileDragging,frequency:jr.Optimized},dragOverlay:{measure:It}};class Ot extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const zm={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ot,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Rn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:bn,measureDroppableContainers:Rn,windowRect:null,measuringScheduled:!1},Om={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Rn,draggableNodes:new Map,over:null,measureDroppableContainers:Rn},qn=b.createContext(Om),Na=b.createContext(zm);function Fm(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ot}}}function Bm(e,t){switch(t.type){case ce.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ce.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ce.DragEnd:case ce.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ce.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new Ot(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case ce.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const s=new Ot(e.droppable.containers);return s.set(n,{...i,disabled:o}),{...e,droppable:{...e.droppable,containers:s}}}case ce.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new Ot(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function Hm(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=b.useContext(qn),i=Tr(r),s=Tr(n==null?void 0:n.id);return b.useEffect(()=>{if(!t&&!r&&i&&s!=null){if(!no(i)||document.activeElement===i.target)return;const a=o.get(s);if(!a)return;const{activatorNode:c,node:d}=a;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const l of[c.current,d.current]){if(!l)continue;const f=Pp(l);if(f){f.focus();break}}})}},[r,t,o,s,i]),null}function Vm(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,i)=>i({transform:o,...r}),n):n}function Xm(e){return b.useMemo(()=>({draggable:{...bn.draggable,...e==null?void 0:e.draggable},droppable:{...bn.droppable,...e==null?void 0:e.droppable},dragOverlay:{...bn.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Ym(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const i=b.useRef(!1),{x:s,y:a}=typeof o=="boolean"?{x:o,y:o}:o;Oe(()=>{if(!s&&!a||!t){i.current=!1;return}if(i.current||!r)return;const d=t==null?void 0:t.node.current;if(!d||d.isConnected===!1)return;const l=n(d),f=ma(l,r);if(s||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const u=ya(d);u&&u.scrollBy({top:f.y,left:f.x})}},[t,s,a,r,n])}const Aa=b.createContext({...Ie,scaleX:1,scaleY:1});var tt;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(tt||(tt={}));const Wm=b.memo(function(t){var n,r,o,i;let{id:s,accessibility:a,autoScroll:c=!0,children:d,sensors:l=Lm,collisionDetection:f=Gp,measuring:u,modifiers:h,...m}=t;const p=b.useReducer(Bm,void 0,Fm),[y,w]=p,[E,g]=Fp(),[v,_]=b.useState(tt.Uninitialized),C=v===tt.Initialized,{draggable:{active:M,nodes:N,translate:T},droppable:{containers:O}}=y,R=M!=null?N.get(M):null,P=b.useRef({initial:null,translated:null}),$=b.useMemo(()=>{var ue;return M!=null?{id:M,data:(ue=R==null?void 0:R.data)!=null?ue:jm,rect:P}:null},[M,R]),S=b.useRef(null),[k,A]=b.useState(null),[D,L]=b.useState(null),I=Ut(m,Object.values(m)),j=nn("DndDescribedBy",s),z=b.useMemo(()=>O.getEnabled(),[O]),F=Xm(u),{droppableRects:V,measureDroppableContainers:B,measuringScheduled:W}=Em(z,{dragging:C,dependencies:[T.x,T.y],config:F.droppable}),X=Sm(N,M),U=b.useMemo(()=>D?Pr(D):null,[D]),H=er(),q=Cm(X,F.draggable.measure);Ym({activeNode:M!=null?N.get(M):null,config:H.layoutShiftCompensation,initialRect:q,measure:F.draggable.measure});const Y=yi(X,F.draggable.measure,q),Q=yi(X?X.parentElement:null),G=b.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=O.getNodeFor((n=G.current.over)==null?void 0:n.id),Z=$m({measure:F.dragOverlay.measure}),te=(r=Z.nodeRef.current)!=null?r:X,re=C?(o=Z.rect)!=null?o:Y:null,be=!!(Z.nodeRef.current&&Z.rect),Be=Am(be?null:Y),Ge=Ma(te?ye(te):null),ve=Dm(C?J??X:null),He=Tm(ve),Re=Vm(h,{transform:{x:T.x-Be.x,y:T.y-Be.y,scaleX:1,scaleY:1},activatorEvent:D,active:$,activeNodeRect:Y,containerNodeRect:Q,draggingNodeRect:re,over:G.current.over,overlayNodeRect:Z.rect,scrollableAncestors:ve,scrollableAncestorRects:He,windowRect:Ge}),Ke=U?wt(U,T):null,ht=Im(ve),gt=xi(ht),Ze=xi(ht,[Y]),Se=wt(Re,gt),Ve=re?Jp(re,Re):null,st=$&&Ve?f({active:$,collisionRect:Ve,droppableRects:V,droppableContainers:z,pointerCoordinates:Ke}):null,pt=Up(st,"id"),[Te,rn]=b.useState(null),Gn=be?Re:wt(Re,Ze),Kn=Kp(Gn,(i=Te==null?void 0:Te.rect)!=null?i:null,Y),kt=b.useRef(null),on=b.useCallback((ue,he)=>{let{sensor:ge,options:Me}=he;if(S.current==null)return;const me=N.get(S.current);if(!me)return;const pe=ue.nativeEvent,_e=new ge({active:S.current,activeNode:me,event:pe,options:Me,context:G,onAbort(ae){if(!N.get(ae))return;const{onDragAbort:Ee}=I.current,Ne={id:ae};Ee==null||Ee(Ne),E({type:"onDragAbort",event:Ne})},onPending(ae,Pe,Ee,Ne){if(!N.get(ae))return;const{onDragPending:ct}=I.current,$e={id:ae,constraint:Pe,initialCoordinates:Ee,offset:Ne};ct==null||ct($e),E({type:"onDragPending",event:$e})},onStart(ae){const Pe=S.current;if(Pe==null)return;const Ee=N.get(Pe);if(!Ee)return;const{onDragStart:Ne}=I.current,at={activatorEvent:pe,active:{id:Pe,data:Ee.data,rect:P}};Pt.unstable_batchedUpdates(()=>{Ne==null||Ne(at),_(tt.Initializing),w({type:ce.DragStart,initialCoordinates:ae,active:Pe}),E({type:"onDragStart",event:at}),A(kt.current),L(pe)})},onMove(ae){w({type:ce.DragMove,coordinates:ae})},onEnd:Je(ce.DragEnd),onCancel:Je(ce.DragCancel)});kt.current=_e;function Je(ae){return async function(){const{active:Ee,collisions:Ne,over:at,scrollAdjustedTranslate:ct}=G.current;let $e=null;if(Ee&&ct){const{cancelDrop:lt}=I.current;$e={activatorEvent:pe,active:Ee,collisions:Ne,delta:ct,over:at},ae===ce.DragEnd&&typeof lt=="function"&&await Promise.resolve(lt($e))&&(ae=ce.DragCancel)}S.current=null,Pt.unstable_batchedUpdates(()=>{w({type:ae}),_(tt.Uninitialized),rn(null),A(null),L(null),kt.current=null;const lt=ae===ce.DragEnd?"onDragEnd":"onDragCancel";if($e){const Rt=I.current[lt];Rt==null||Rt($e),E({type:lt,event:$e})}})}}},[N]),Zn=b.useCallback((ue,he)=>(ge,Me)=>{const me=ge.nativeEvent,pe=N.get(Me);if(S.current!==null||!pe||me.dndKit||me.defaultPrevented)return;const _e={active:pe};ue(ge,he.options,_e)===!0&&(me.dndKit={capturedBy:he.sensor},S.current=Me,on(ge,he))},[N,on]),sn=_m(l,Zn);km(l),Oe(()=>{Y&&v===tt.Initializing&&_(tt.Initialized)},[Y,v]),b.useEffect(()=>{const{onDragMove:ue}=I.current,{active:he,activatorEvent:ge,collisions:Me,over:me}=G.current;if(!he||!ge)return;const pe={active:he,activatorEvent:ge,collisions:Me,delta:{x:Se.x,y:Se.y},over:me};Pt.unstable_batchedUpdates(()=>{ue==null||ue(pe),E({type:"onDragMove",event:pe})})},[Se.x,Se.y]),b.useEffect(()=>{const{active:ue,activatorEvent:he,collisions:ge,droppableContainers:Me,scrollAdjustedTranslate:me}=G.current;if(!ue||S.current==null||!he||!me)return;const{onDragOver:pe}=I.current,_e=Me.get(pt),Je=_e&&_e.rect.current?{id:_e.id,rect:_e.rect.current,data:_e.data,disabled:_e.disabled}:null,ae={active:ue,activatorEvent:he,collisions:ge,delta:{x:me.x,y:me.y},over:Je};Pt.unstable_batchedUpdates(()=>{rn(Je),pe==null||pe(ae),E({type:"onDragOver",event:ae})})},[pt]),Oe(()=>{G.current={activatorEvent:D,active:$,activeNode:X,collisionRect:Ve,collisions:st,droppableRects:V,draggableNodes:N,draggingNode:te,draggingNodeRect:re,droppableContainers:O,over:Te,scrollableAncestors:ve,scrollAdjustedTranslate:Se},P.current={initial:re,translated:Ve}},[$,X,st,Ve,N,te,re,V,O,Te,ve,Se]),xm({...H,delta:T,draggingRect:Ve,pointerCoordinates:Ke,scrollableAncestors:ve,scrollableAncestorRects:He});const Jn=b.useMemo(()=>({active:$,activeNode:X,activeNodeRect:Y,activatorEvent:D,collisions:st,containerNodeRect:Q,dragOverlay:Z,draggableNodes:N,droppableContainers:O,droppableRects:V,over:Te,measureDroppableContainers:B,scrollableAncestors:ve,scrollableAncestorRects:He,measuringConfiguration:F,measuringScheduled:W,windowRect:Ge}),[$,X,Y,D,st,Q,Z,N,O,V,Te,B,ve,He,F,W,Ge]),Qn=b.useMemo(()=>({activatorEvent:D,activators:sn,active:$,activeNodeRect:Y,ariaDescribedById:{draggable:j},dispatch:w,draggableNodes:N,over:Te,measureDroppableContainers:B}),[D,sn,$,Y,w,j,N,Te,B]);return fe.createElement(pa.Provider,{value:g},fe.createElement(qn.Provider,{value:Qn},fe.createElement(Na.Provider,{value:Jn},fe.createElement(Aa.Provider,{value:Kn},d)),fe.createElement(Hm,{disabled:(a==null?void 0:a.restoreFocus)===!1})),fe.createElement(Vp,{...a,hiddenTextDescribedById:j}));function er(){const ue=(k==null?void 0:k.autoScrollEnabled)===!1,he=typeof c=="object"?c.enabled===!1:c===!1,ge=C&&!ue&&!he;return typeof c=="object"?{...c,enabled:ge}:{enabled:ge}}}),Um=b.createContext(null),bi="button",qm="Draggable";function Gm(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const i=nn(qm),{activators:s,activatorEvent:a,active:c,activeNodeRect:d,ariaDescribedById:l,draggableNodes:f,over:u}=b.useContext(qn),{role:h=bi,roleDescription:m="draggable",tabIndex:p=0}=o??{},y=(c==null?void 0:c.id)===t,w=b.useContext(y?Aa:Um),[E,g]=In(),[v,_]=In(),C=Rm(s,t),M=Ut(n);Oe(()=>(f.set(t,{id:t,key:i,node:E,activatorNode:v,data:M}),()=>{const T=f.get(t);T&&T.key===i&&f.delete(t)}),[f,t]);const N=b.useMemo(()=>({role:h,tabIndex:p,"aria-disabled":r,"aria-pressed":y&&h===bi?!0:void 0,"aria-roledescription":m,"aria-describedby":l.draggable}),[r,h,p,y,m,l.draggable]);return{active:c,activatorEvent:a,activeNodeRect:d,attributes:N,isDragging:y,listeners:r?void 0:C,node:E,over:u,setNodeRef:g,setActivatorNodeRef:_,transform:w}}function Km(){return b.useContext(Na)}const Zm="Droppable",Jm={timeout:25};function Qm(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const i=nn(Zm),{active:s,dispatch:a,over:c,measureDroppableContainers:d}=b.useContext(qn),l=b.useRef({disabled:n}),f=b.useRef(!1),u=b.useRef(null),h=b.useRef(null),{disabled:m,updateMeasurementsFor:p,timeout:y}={...Jm,...o},w=Ut(p??r),E=b.useCallback(()=>{if(!f.current){f.current=!0;return}h.current!=null&&clearTimeout(h.current),h.current=setTimeout(()=>{d(Array.isArray(w.current)?w.current:[w.current]),h.current=null},y)},[y]),g=Un({callback:E,disabled:m||!s}),v=b.useCallback((N,T)=>{g&&(T&&(g.unobserve(T),f.current=!1),N&&g.observe(N))},[g]),[_,C]=In(v),M=Ut(t);return b.useEffect(()=>{!g||!_.current||(g.disconnect(),f.current=!1,g.observe(_.current))},[_,g]),b.useEffect(()=>(a({type:ce.RegisterDroppable,element:{id:r,key:i,disabled:n,node:_,rect:u,data:M}}),()=>a({type:ce.UnregisterDroppable,key:i,id:r})),[r]),b.useEffect(()=>{n!==l.current.disabled&&(a({type:ce.SetDroppableDisabled,id:r,key:i,disabled:n}),l.current.disabled=n)},[r,i,n,a]),{active:s,rect:u,isOver:(c==null?void 0:c.id)===r,node:_,over:c,setNodeRef:C}}const ey=e=>{let{transform:t}=e;return{...t,x:0}};function ao(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function ty(e,t){return e.reduce((n,r,o)=>{const i=t.get(r);return i&&(n[o]=i),n},Array(e.length))}function pn(e){return e!==null&&e>=0}function ny(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ry(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Da=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const i=ao(t,r,n),s=t[o],a=i[o];return!a||!s?null:{x:a.left-s.left,y:a.top-s.top,scaleX:a.width/s.width,scaleY:a.height/s.height}},mn={scaleX:1,scaleY:1},oy=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:i,overIndex:s}=e;const a=(t=i[n])!=null?t:r;if(!a)return null;if(o===n){const d=i[s];return d?{x:0,y:n<s?d.top+d.height-(a.top+a.height):d.top-a.top,...mn}:null}const c=iy(i,o,n);return o>n&&o<=s?{x:0,y:-a.height-c,...mn}:o<n&&o>=s?{x:0,y:a.height+c,...mn}:{x:0,y:0,...mn}};function iy(e,t,n){const r=e[t],o=e[t-1],i=e[t+1];return r?n<t?o?r.top-(o.top+o.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Ia="Sortable",ka=fe.createContext({activeIndex:-1,containerId:Ia,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Da,disabled:{draggable:!1,droppable:!1}});function sy(e){let{children:t,id:n,items:r,strategy:o=Da,disabled:i=!1}=e;const{active:s,dragOverlay:a,droppableRects:c,over:d,measureDroppableContainers:l}=Km(),f=nn(Ia,n),u=a.rect!==null,h=b.useMemo(()=>r.map(C=>typeof C=="object"&&"id"in C?C.id:C),[r]),m=s!=null,p=s?h.indexOf(s.id):-1,y=d?h.indexOf(d.id):-1,w=b.useRef(h),E=!ny(h,w.current),g=y!==-1&&p===-1||E,v=ry(i);Oe(()=>{E&&m&&l(h)},[E,h,m,l]),b.useEffect(()=>{w.current=h},[h]);const _=b.useMemo(()=>({activeIndex:p,containerId:f,disabled:v,disableTransforms:g,items:h,overIndex:y,useDragOverlay:u,sortedRects:ty(h,c),strategy:o}),[p,f,v.draggable,v.droppable,g,h,y,c,u,o]);return fe.createElement(ka.Provider,{value:_},t)}const ay=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return ao(n,r,o).indexOf(t)},cy=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:i,newIndex:s,previousItems:a,previousContainerId:c,transition:d}=e;return!d||!r||a!==i&&o===s?!1:n?!0:s!==o&&t===c},ly={duration:200,easing:"ease"},Ra="transform",uy=qt.Transition.toString({property:Ra,duration:0,easing:"linear"}),dy={roleDescription:"sortable"};function fy(e){let{disabled:t,index:n,node:r,rect:o}=e;const[i,s]=b.useState(null),a=b.useRef(n);return Oe(()=>{if(!t&&n!==a.current&&r.current){const c=o.current;if(c){const d=It(r.current,{ignoreTransform:!0}),l={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(l.x||l.y)&&s(l)}}n!==a.current&&(a.current=n)},[t,n,r,o]),b.useEffect(()=>{i&&s(null)},[i]),i}function hy(e){let{animateLayoutChanges:t=cy,attributes:n,disabled:r,data:o,getNewIndex:i=ay,id:s,strategy:a,resizeObserverConfig:c,transition:d=ly}=e;const{items:l,containerId:f,activeIndex:u,disabled:h,disableTransforms:m,sortedRects:p,overIndex:y,useDragOverlay:w,strategy:E}=b.useContext(ka),g=gy(r,h),v=l.indexOf(s),_=b.useMemo(()=>({sortable:{containerId:f,index:v,items:l},...o}),[f,o,v,l]),C=b.useMemo(()=>l.slice(l.indexOf(s)),[l,s]),{rect:M,node:N,isOver:T,setNodeRef:O}=Qm({id:s,data:_,disabled:g.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...c}}),{active:R,activatorEvent:P,activeNodeRect:$,attributes:S,setNodeRef:k,listeners:A,isDragging:D,over:L,setActivatorNodeRef:I,transform:j}=Gm({id:s,data:_,attributes:{...dy,...n},disabled:g.draggable}),z=Ip(O,k),F=!!R,V=F&&!m&&pn(u)&&pn(y),B=!w&&D,W=B&&V?j:null,U=V?W??(a??E)({rects:p,activeNodeRect:$,activeIndex:u,overIndex:y,index:v}):null,H=pn(u)&&pn(y)?i({id:s,items:l,activeIndex:u,overIndex:y}):v,q=R==null?void 0:R.id,Y=b.useRef({activeId:q,items:l,newIndex:H,containerId:f}),Q=l!==Y.current.items,G=t({active:R,containerId:f,isDragging:D,isSorting:F,id:s,index:v,items:l,newIndex:Y.current.newIndex,previousItems:Y.current.items,previousContainerId:Y.current.containerId,transition:d,wasDragging:Y.current.activeId!=null}),J=fy({disabled:!G,index:v,node:N,rect:M});return b.useEffect(()=>{F&&Y.current.newIndex!==H&&(Y.current.newIndex=H),f!==Y.current.containerId&&(Y.current.containerId=f),l!==Y.current.items&&(Y.current.items=l)},[F,H,f,l]),b.useEffect(()=>{if(q===Y.current.activeId)return;if(q!=null&&Y.current.activeId==null){Y.current.activeId=q;return}const te=setTimeout(()=>{Y.current.activeId=q},50);return()=>clearTimeout(te)},[q]),{active:R,activeIndex:u,attributes:S,data:_,rect:M,index:v,newIndex:H,items:l,isOver:T,isSorting:F,isDragging:D,listeners:A,node:N,overIndex:y,over:L,setNodeRef:z,setActivatorNodeRef:I,setDroppableNodeRef:O,setDraggableNodeRef:k,transform:J??U,transition:Z()};function Z(){if(J||Q&&Y.current.newIndex===v)return uy;if(!(B&&!no(P)||!d)&&(F||G))return qt.Transition.toString({...d,property:Ra})}}function gy(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}ne.Down,ne.Right,ne.Up,ne.Left;const py=[{title:"component_name",dataIndex:"component_name",render:(e,t)=>x.jsx(Ni,{placement:"right",title:x.jsx(x.Fragment,{children:x.jsxs("ul",{children:[x.jsxs("li",{children:["component_id: ",t.component_id]}),x.jsxs("li",{children:["relation_id: ",t.relation_id]})]})}),children:t.component_name})}],my=e=>{const{attributes:t,listeners:n,setNodeRef:r,transform:o,transition:i,isDragging:s}=hy({id:e["data-row-key"]}),a={...e.style,transform:qt.Translate.toString(o),transition:i,cursor:"move",...s?{position:"relative",zIndex:9999}:{}};return x.jsx("tr",{...e,ref:r,style:a,...t,...n})},yy=({data:e,callback:t})=>{const[n,r]=b.useState(e),{messageApi:o}=it(),i=Yp(Xp(so,{activationConstraint:{distance:1}})),s=async()=>{const c=n.map((d,l)=>({order_index:l,relation_id:d.relation_id}));await vc(c),o.success("保存成功"),t&&t()},a=({active:c,over:d})=>{c.id!==(d==null?void 0:d.id)&&r(l=>{const f=l.findIndex(h=>h.key===c.id),u=l.findIndex(h=>h.key===(d==null?void 0:d.id));return ao(l,f,u)})};return x.jsx(Wm,{sensors:i,modifiers:[ey],onDragEnd:a,children:x.jsx(sy,{items:n.map(c=>c.key),strategy:oy,children:x.jsx(Ri,{pagination:!1,size:"small",components:{body:{row:my}},rowKey:"key",columns:py,dataSource:n,footer:()=>x.jsx(bt,{justify:"end",children:x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:s,children:"保存"})})})})})},vy=({visible:e,onClose:t,params:n,callback:r})=>e?x.jsx(Pn,{footer:null,open:e,onCancel:t,title:"更新排序",children:x.jsx(yy,{data:n.software.map(o=>({...o,key:o.component_id})),callback:r})}):null,xy=({visible:e,onClose:t,params:n,callback:r})=>e?x.jsx(Pn,{title:"说明",width:"50%",onCancel:t,onClose:t,open:e,footer:!1,children:x.jsx(Oc,{data:n})}):null,qy=({})=>{console.log("Pipeline");const{component_type:e,component_id:t}=uc(),[n,r]=b.useState(),o=dc(),[i,s]=b.useState(!0),[a,c]=Si.useMessage(),d={inputFile:b.useRef(null),outputFile:b.useRef(null)},{modal:l,openModal:f,closeModal:u}=fc(),{modals:h,openModals:m,closeModals:p}=hc(["modalD","metadataModal","bindSample"]),y=async()=>{let g=`/get-pipeline-v2/${t}?component_type=${e}`;e=="script"&&(g=`/get-component-parent/${t}?component_type=${e}`);let _=(await Ft.get(g)).data;"content"in _&&(_={...JSON.parse(_.content),..._}),_.tags&&(_.tags=JSON.parse(_.tags)),r(_),console.log(_)},E={deletePipelineRelation:async g=>{try{const v=await bc(g);a.success("删除成功!"),y()}catch(v){console.log(v),a.error(`删除失败!${v.response.data.detail}`)}},openModal:f,openModals:m};return b.useEffect(()=>{y()},[]),x.jsxs("div",{style:{maxWidth:"1500px",margin:"0 auto"},children:[c,x.jsxs(bt,{style:{marginBottom:"1rem"},justify:"space-between",align:"center",gap:"small",children:[x.jsx("div",{children:n?x.jsxs(x.Fragment,{children:[x.jsxs("h2",{style:{margin:0},children:[n==null?void 0:n.component_name,x.jsx(Ni,{title:n==null?void 0:n.namespace,children:x.jsxs("span",{style:{margin:"0",color:"rgba(0, 0, 0, 0.45)",fontSize:"1rem"},children:[" ",n==null?void 0:n.namespace_name]})})]}),!1,n.tags&&Array.isArray(n.tags)&&n.tags.map((g,v)=>x.jsx(Fc,{style:{marginTop:"0.5rem"},color:mc[v],children:g},v))]}):x.jsx(gc,{active:!0})}),x.jsxs(bt,{gap:"small",wrap:!0,children:[e=="pipeline"&&x.jsx(x.Fragment,{children:x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f("sortSoftware",{software:n.software})},children:"更新排序"})}),x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{E.openModal("modalG",n)},children:"查看依赖"}),x.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m("metadataModal",{...n,operatePipeline:E})},children:"metadata"}),x.jsxs(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f("modalC",{data:n,structure:{component_type:e}})},children:["更新",e]}),x.jsx(le,{size:"small",color:"primary",variant:"solid",onClick:y,children:"刷新"}),x.jsx(le,{size:"small",color:"primary",variant:"solid",onClick:()=>o(`/${e}-card`),children:"返回"})]})]}),x.jsx(by,{component_type:e||"",component:n,tableRef:d,operatePipeline:E}),x.jsx(tl,{visible:l.key=="modalB"&&l.visible,onClose:u,callback:y,params:l.params}),x.jsx(xc,{callback:y,visible:l.key=="modalA"&&l.visible,onClose:u,params:{...l.params,namespace:n==null?void 0:n.namespace}}),x.jsx(wc,{callback:y,visible:l.key=="modalC"&&l.visible,onClose:u,params:l.params}),x.jsx(rl,{visible:h.modalD.visible,params:h.modalD.params,onClose:()=>p("modalD")}),x.jsx(Mc,{visible:l.key=="modalE"&&l.visible,onClose:u,params:l.params}),x.jsx(Nc,{visible:l.key=="modalF"&&l.visible,onClose:u,params:l.params}),x.jsx(Ac,{visible:l.key=="modalG"&&l.visible,onClose:u,callback:y,params:l.params}),x.jsx(_c,{visible:l.key=="modalH"&&l.visible,onClose:u,value:l.params}),x.jsx(Rc,{visible:h.metadataModal.visible,onClose:()=>p("metadataModal"),params:h.metadataModal.params}),x.jsx(sl,{visible:l.key=="metadataForm"&&l.visible,onClose:u,params:l.params}),x.jsx(Tc,{visible:h.bindSample.visible,onClose:()=>p("bindSample"),operatePipeline:E,params:h.bindSample.params}),x.jsx(Pc,{visible:l.key=="openFile"&&l.visible,onClose:u,params:l.params}),x.jsx(vy,{visible:l.key=="sortSoftware"&&l.visible,onClose:u,params:l.params,callback:y}),x.jsx(xy,{visible:l.key=="descriptionModal"&&l.visible,onClose:u,params:l.params,callback:y})]})},wy=({component_type:e,operatePipeline:t,component:n,...r})=>{if(!e||!n)return null;const i={pipeline:Cy,software:Sy,file:_y,script:Ey,module:"module-card"}[e];return i?x.jsx(i,{operatePipeline:t,component:n,...r}):null},by=fe.memo(wy,(e,t)=>JSON.stringify(e)===JSON.stringify(t)),Sy=({operatePipeline:e,component:t,...n})=>x.jsx(x.Fragment,{children:x.jsx(Di,{...t,operatePipeline:e})}),_y=({operatePipeline:e,component:t,...n})=>{const{project:r}=it();return x.jsx(x.Fragment,{children:x.jsx(Ai,{...t,analysisMethod:[t],operatePipeline:e,project:r})})},Ey=({operatePipeline:e,component:t,...n})=>{const{project:r}=it();return x.jsx(x.Fragment,{children:x.jsx(Ai,{component_type:t.component_type,script:t,analysisMethod:t.parent||[],operatePipeline:e,project:r})})},Cy=({operatePipeline:e,component:t,...n})=>{const[r,o]=b.useState([]),{project:i}=it(),s=d=>{const l=d.software;return l?l.map((f,u)=>({key:f.component_id,label:f.component_name||f.component_id,children:x.jsx(Di,{...n,...f,hiddenUpstreamAnalysis:!0,pipeline:{component_id:d.component_id},operatePipeline:e})})):[]},a=d=>{const l=d.software;if(!l)return[];const u=(JSON.parse(d.position)||[]).reduce((m,p)=>(m[p.component_id]=p.position,m),{});return l.map((m,p)=>{const y=m.component_name,w=(m.inputFile||[]).map(g=>g),E=(m.outputFile||[]).map(g=>g);return{id:m.component_id,type:"custom",position:u[m.component_id]||{x:p*300,y:100},data:{label:y,color:"#"+((1<<24)*Math.random()|0).toString(16),inputs:w,outputs:E}}})||[]},c=d=>JSON.parse(d.edges)||[];return b.useEffect(()=>{t&&o(s(t))},[JSON.stringify(t)]),console.log("--->PipelineComponent渲染"),x.jsxs(x.Fragment,{children:[x.jsx(Ap,{initialEdges:c(t),initialNodes:a(t),component:t}),x.jsx("div",{style:{marginTop:"1rem"}}),x.jsx(pc,{...t,project:i,operatePipeline:e,inputAnalysisMethod:t.inputFile}),t&&Array.isArray(t==null?void 0:t.software)?x.jsx(Ii,{destroyInactiveTabPane:!0,items:r}):x.jsxs(_i,{children:[x.jsx(le,{style:{marginRight:"0.5rem"},color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalC",{data:void 0,structure:{component_type:"software",relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"新增软件"}),x.jsx(le,{color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"添加软件"})]})]})};export{qy as default};

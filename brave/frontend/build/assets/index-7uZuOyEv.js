import{r as a,u as H,Y as Q,aQ as W,b as Y,aR as q,c as D,j as e,R as G,C as b,E as A,F as J,B,x as N,a as V,$ as X}from"./main-qdx71IeZ.js";import{d as Z}from"./index-RAPlm8xH.js";import O from"./index-DnAAkqW2.js";import{C as v}from"./index-EOZAs8C8.js";import{T as ee}from"./index-CssIxjBA.js";import{T as se}from"./Table-BlsL6kCC.js";import"./index-enAFolCN.js";import"./index-B59g6Chu.js";import"./index-DypQT-Hh.js";import"./UpOutlined-W4L3zuBA.js";import"./index-DcRhgt6q.js";import"./index-CmvvgrfA.js";import"./study-page-Do4EjIyk.js";import"./usePagination-B91F5N18.js";import"./index-DzNw07ei.js";import"./RedoOutlined-CpHCHwbd.js";import"./index-C_udHuuV.js";import"./index-Bz6urQ5j.js";import"./callSuper-D6RVTDYQ.js";import"./index-BTiKGIIu.js";import"./addEventListener-gnMpRr3K.js";import"./DownloadOutlined-lpdqma_y.js";import"./Dropdown-DsoEvqJ1.js";const Fe=()=>{const[m,n]=a.useState(!1),{project:o,projectObj:r}=H(s=>s.user),[h,E]=a.useState(),[g,p]=a.useState(),P=Q(),j=new URLSearchParams(P.search),t=j.get("key"),i=j.get("project"),y=W(),{modal:c,openModal:k,closeModal:K}=Y(),[F,$]=a.useState(t);a.useEffect(()=>{i&&i!=o&&y(q({project:i}))},[i]),a.useRef(null),D();const R=(s,l)=>{const{pathname:d,search:w,hash:x}=window.location,f=new URLSearchParams(w||"");f.set(s,l);const S=x.startsWith("#/");let u="";if(S){const[_,I=""]=x.replace(/^#/,"").split("?"),U=new URLSearchParams(I);U.set(s,l),u=`#${_}?${U.toString()}`}else u=`${d}?${f.toString()}`;window.history.pushState({},"",u)},C=a.useRef(null),[T,M]=a.useState(null),L=()=>{if(C.current){const s=C.current.getBoundingClientRect().top;M(s)}};a.useEffect(()=>(L(),window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L)}),[]);const z=async()=>{var l,d,w,x,f,S,u;n(!0);let s=await V.post("/list-analysis-tree",{is_report:!0,project:o});E(s.data),!t&&s.data.length>0&&(l=s.data[0])!=null&&l.children&&((d=s.data[0])==null?void 0:d.children.length)>0&&(p((w=s.data[0])==null?void 0:w.children[0]),$((f=(x=s.data[0])==null?void 0:x.children[0])==null?void 0:f.key),R("project",o),R("key",(u=(S=s.data[0])==null?void 0:S.children[0])==null?void 0:u.key)),n(!1)};return a.useEffect(()=>{z()},[o]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"0 auto"},children:[e.jsxs(G,{style:{marginTop:"1rem"},children:[e.jsx(b,{lg:6,sm:6,xs:24,ref:C,style:{position:"sticky",top:`${T}px`,alignSelf:"flex-start",height:`calc(100vh - ${T}px - 1rem )`},children:e.jsx(v,{loading:m,title:r==null?void 0:r.project_name,size:"small",style:{height:"100%"},styles:{body:{height:"90%",overflowY:"auto"}},extra:e.jsx(J,{gap:"small",children:e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:z,children:"Refresh"})}),children:Array.isArray(h)&&h.length!=0?e.jsx(e.Fragment,{children:e.jsx(te,{onSelect:s=>{var l,d;((l=s.node)==null?void 0:l.type)=="analysis"?(p(s.node),$(s.node.key),R("project",o),R("key",s.node.key)):((d=s.node)==null?void 0:d.type)=="components"&&console.log(s.node)},defaultSelectKey:F,treeData:h})}):e.jsx(e.Fragment,{children:e.jsx(A,{})})})}),e.jsx(b,{lg:18,sm:18,xs:24,style:{paddingLeft:"1rem"},children:e.jsx(ee,{type:"card",size:"small",tabPosition:"right",items:[{key:"1",label:"Analysis Result",children:e.jsx(e.Fragment,{children:F?e.jsx(e.Fragment,{children:e.jsx(Z,{cancalReportCallback:()=>{z()},analysis_id:F})}):e.jsx(e.Fragment,{children:e.jsx(v,{size:"small",children:e.jsx(A,{})})})})},{key:"2",label:"Records",children:e.jsx(e.Fragment,{children:e.jsx(v,{size:"small",style:{marginBottom:"1rem"},extra:e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k("projectForm",{project_id:o})},children:"Edit"}),children:r!=null&&r.description?e.jsx(O,{data:r==null?void 0:r.description}):e.jsx(A,{})})})}],defaultActiveKey:"1"})})]}),e.jsx(N,{research:!0,params:c.params,visible:c.key=="projectForm"&&c.visible,onClose:K})]})},te=({treeData:m,defaultSelectKey:n,onSelect:o})=>{const[r,h]=a.useState(n),[E,g]=a.useState([]),p=(t,i,y=[])=>{for(const c of i){if(c.key===t)return y;if(c.children){const k=p(t,c.children,[...y,c.key]);if(k.length)return k}}return[]};a.useEffect(()=>{if(n){const t=p(n,m);g(t),h(n)}},[n,m]);const P=(t,i)=>{if(t.length>0){o(i),h(t[0]);const y=p(t[0],m);g(y)}},j=t=>{g(t)};return e.jsx(e.Fragment,{children:e.jsx(se,{selectedKeys:[r],showLine:!0,expandedKeys:E,onExpand:j,autoExpandParent:!0,switcherIcon:e.jsx(X,{}),onSelect:P,treeData:m})})};export{Fe as default};

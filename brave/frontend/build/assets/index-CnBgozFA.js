const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./graph-view-Cj9PEsBO.js","./main-gLSsR9RJ.js","./main-DLoYsyAm.css","./zoom-BGsqVsDF.js","./rgb-BwIoVOhg.js","./index-C0N-NGLH.js","./index-CZkDjHh0.js","./Dropdown-_lWu8YLp.js","./index-BKkflL4l.js","./index-DoeMV2fv.js","./index-CaXusF4h.js","./index-C11mV772.js"])))=>i.map(i=>d[i]);
import{r,ad as A,aN as Me,aj as Fe,ac as Y,O as G,ak as me,ag as Ne,ar as Pe,aO as De,_ as se,ae as k,aB as he,Z as Ee,$ as He,a0 as Te,a2 as ze,a1 as T,aP as Ve,aF as Ae,aQ as Be,a5 as Le,a6 as ke,j as a,F as P,I as ee,q as ge,S as U,a as B,t as fe,o as Q,g as ve,B as K,d as ye,M as be,i as Ke,c as We,f as qe,P as le,aR as Xe}from"./main-gLSsR9RJ.js";import{u as Ue}from"./usePagination-Cdr2dVUM.js";import{T as Ge,F as Ye}from"./Table-CR7g3HiW.js";import{S as Ze}from"./index-BKkflL4l.js";import{T as Je}from"./index-CZkDjHh0.js";import{S as Qe}from"./index-CaXusF4h.js";import{P as et}from"./Pagination-C_9v4VMr.js";import{D as tt}from"./index-C11mV772.js";import"./addEventListener-CTJtiein.js";import"./Dropdown-_lWu8YLp.js";var oe=function(t,n){if(!t)return null;var i={left:t.offsetLeft,right:t.parentElement.clientWidth-t.clientWidth-t.offsetLeft,width:t.clientWidth,top:t.offsetTop,bottom:t.parentElement.clientHeight-t.clientHeight-t.offsetTop,height:t.clientHeight};return n?{left:0,right:0,width:0,top:i.top,bottom:i.bottom,height:i.height}:{left:i.left,right:i.right,width:i.width,top:0,bottom:0,height:0}},N=function(t){return t!==void 0?"".concat(t,"px"):void 0};function at(e){var t=e.prefixCls,n=e.containerRef,i=e.value,s=e.getValueIndex,o=e.motionName,m=e.onMotionStart,v=e.onMotionEnd,p=e.direction,b=e.vertical,h=b===void 0?!1:b,w=r.useRef(null),S=r.useState(i),g=A(S,2),y=g[0],d=g[1],_=function(H){var D,V=s(H),E=(D=n.current)===null||D===void 0?void 0:D.querySelectorAll(".".concat(t,"-item"))[V];return(E==null?void 0:E.offsetParent)&&E},$=r.useState(null),l=A($,2),c=l[0],C=l[1],f=r.useState(null),R=A(f,2),x=R[0],F=R[1];Me(function(){if(y!==i){var j=_(y),H=_(i),D=oe(j,h),V=oe(H,h);d(i),C(D),F(V),j&&H?m():v()}},[i]);var I=r.useMemo(function(){if(h){var j;return N((j=c==null?void 0:c.top)!==null&&j!==void 0?j:0)}return N(p==="rtl"?-(c==null?void 0:c.right):c==null?void 0:c.left)},[h,p,c]),u=r.useMemo(function(){if(h){var j;return N((j=x==null?void 0:x.top)!==null&&j!==void 0?j:0)}return N(p==="rtl"?-(x==null?void 0:x.right):x==null?void 0:x.left)},[h,p,x]),W=function(){return h?{transform:"translateY(var(--thumb-start-top))",height:"var(--thumb-start-height)"}:{transform:"translateX(var(--thumb-start-left))",width:"var(--thumb-start-width)"}},z=function(){return h?{transform:"translateY(var(--thumb-active-top))",height:"var(--thumb-active-height)"}:{transform:"translateX(var(--thumb-active-left))",width:"var(--thumb-active-width)"}},q=function(){C(null),F(null),v()};return!c||!x?null:r.createElement(Fe,{visible:!0,motionName:o,motionAppear:!0,onAppearStart:W,onAppearActive:z,onVisibleChanged:q},function(j,H){var D=j.className,V=j.style,E=Y(Y({},V),{},{"--thumb-start-left":I,"--thumb-start-width":N(c==null?void 0:c.width),"--thumb-active-left":u,"--thumb-active-width":N(x==null?void 0:x.width),"--thumb-start-top":I,"--thumb-start-height":N(c==null?void 0:c.height),"--thumb-active-top":u,"--thumb-active-height":N(x==null?void 0:x.height)}),Z={ref:me(w,H),style:E,className:G("".concat(t,"-thumb"),D)};return r.createElement("div",Z)})}var nt=["prefixCls","direction","vertical","options","disabled","defaultValue","value","name","onChange","className","motionName"];function it(e){if(typeof e.title<"u")return e.title;if(he(e.label)!=="object"){var t;return(t=e.label)===null||t===void 0?void 0:t.toString()}}function rt(e){return e.map(function(t){if(he(t)==="object"&&t!==null){var n=it(t);return Y(Y({},t),{},{title:n})}return{label:t==null?void 0:t.toString(),title:t==null?void 0:t.toString(),value:t}})}var st=function(t){var n=t.prefixCls,i=t.className,s=t.disabled,o=t.checked,m=t.label,v=t.title,p=t.value,b=t.name,h=t.onChange,w=t.onFocus,S=t.onBlur,g=t.onKeyDown,y=t.onKeyUp,d=t.onMouseDown,_=function(l){s||h(l,p)};return r.createElement("label",{className:G(i,k({},"".concat(n,"-item-disabled"),s)),onMouseDown:d},r.createElement("input",{name:b,className:"".concat(n,"-item-input"),type:"radio",disabled:s,checked:o,onChange:_,onFocus:w,onBlur:S,onKeyDown:g,onKeyUp:y}),r.createElement("div",{className:"".concat(n,"-item-label"),title:v,"aria-selected":o},m))},lt=r.forwardRef(function(e,t){var n,i,s=e.prefixCls,o=s===void 0?"rc-segmented":s,m=e.direction,v=e.vertical,p=e.options,b=p===void 0?[]:p,h=e.disabled,w=e.defaultValue,S=e.value,g=e.name,y=e.onChange,d=e.className,_=d===void 0?"":d,$=e.motionName,l=$===void 0?"thumb-motion":$,c=Ne(e,nt),C=r.useRef(null),f=r.useMemo(function(){return me(C,t)},[C,t]),R=r.useMemo(function(){return rt(b)},[b]),x=Pe((n=R[0])===null||n===void 0?void 0:n.value,{value:S,defaultValue:w}),F=A(x,2),I=F[0],u=F[1],W=r.useState(!1),z=A(W,2),q=z[0],j=z[1],H=function(M,L){u(L),y==null||y(L)},D=De(c,["children"]),V=r.useState(!1),E=A(V,2),Z=E[0],te=E[1],Se=r.useState(!1),ae=A(Se,2),_e=ae[0],ne=ae[1],je=function(){ne(!0)},we=function(){ne(!1)},$e=function(){te(!1)},Ie=function(M){M.key==="Tab"&&te(!0)},ie=function(M){var L=R.findIndex(function(Oe){return Oe.value===I}),re=R.length,Re=(L+M+re)%re,J=R[Re];J&&(u(J.value),y==null||y(J.value))},Ce=function(M){switch(M.key){case"ArrowLeft":case"ArrowUp":ie(-1);break;case"ArrowRight":case"ArrowDown":ie(1);break}};return r.createElement("div",se({role:"radiogroup","aria-label":"segmented control",tabIndex:h?void 0:0},D,{className:G(o,(i={},k(i,"".concat(o,"-rtl"),m==="rtl"),k(i,"".concat(o,"-disabled"),h),k(i,"".concat(o,"-vertical"),v),i),_),ref:f}),r.createElement("div",{className:"".concat(o,"-group")},r.createElement(at,{vertical:v,prefixCls:o,value:I,containerRef:C,motionName:"".concat(o,"-").concat(l),direction:m,getValueIndex:function(M){return R.findIndex(function(L){return L.value===M})},onMotionStart:function(){j(!0)},onMotionEnd:function(){j(!1)}}),R.map(function(O){var M;return r.createElement(st,se({},O,{name:g,key:O.value,prefixCls:o,className:G(O.className,"".concat(o,"-item"),(M={},k(M,"".concat(o,"-item-selected"),O.value===I&&!q),k(M,"".concat(o,"-item-focused"),_e&&Z&&O.value===I),M)),checked:O.value===I,onChange:H,onFocus:je,onBlur:we,onKeyDown:Ce,onKeyUp:Ie,onMouseDown:$e,disabled:!!h||!!O.disabled}))})))}),ot=lt;function de(e,t){return{[`${e}, ${e}:hover, ${e}:focus`]:{color:t.colorTextDisabled,cursor:"not-allowed"}}}function ce(e){return{backgroundColor:e.itemSelectedBg,boxShadow:e.boxShadowTertiary}}const dt=Object.assign({overflow:"hidden"},Ae),ct=e=>{const{componentCls:t}=e,n=e.calc(e.controlHeight).sub(e.calc(e.trackPadding).mul(2)).equal(),i=e.calc(e.controlHeightLG).sub(e.calc(e.trackPadding).mul(2)).equal(),s=e.calc(e.controlHeightSM).sub(e.calc(e.trackPadding).mul(2)).equal();return{[t]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Te(e)),{display:"inline-block",padding:e.trackPadding,color:e.itemColor,background:e.trackBg,borderRadius:e.borderRadius,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`}),ze(e)),{[`${t}-group`]:{position:"relative",display:"flex",alignItems:"stretch",justifyItems:"flex-start",flexDirection:"row",width:"100%"},[`&${t}-rtl`]:{direction:"rtl"},[`&${t}-vertical`]:{[`${t}-group`]:{flexDirection:"column"},[`${t}-thumb`]:{width:"100%",height:0,padding:`0 ${T(e.paddingXXS)}`}},[`&${t}-block`]:{display:"flex"},[`&${t}-block ${t}-item`]:{flex:1,minWidth:0},[`${t}-item`]:{position:"relative",textAlign:"center",cursor:"pointer",transition:`color ${e.motionDurationMid} ${e.motionEaseInOut}`,borderRadius:e.borderRadiusSM,transform:"translateZ(0)","&-selected":Object.assign(Object.assign({},ce(e)),{color:e.itemSelectedColor}),"&-focused":Object.assign({},Ve(e)),"&::after":{content:'""',position:"absolute",zIndex:-1,width:"100%",height:"100%",top:0,insetInlineStart:0,borderRadius:"inherit",opacity:0,transition:`opacity ${e.motionDurationMid}`,pointerEvents:"none"},[`&:hover:not(${t}-item-selected):not(${t}-item-disabled)`]:{color:e.itemHoverColor,"&::after":{opacity:1,backgroundColor:e.itemHoverBg}},[`&:active:not(${t}-item-selected):not(${t}-item-disabled)`]:{color:e.itemHoverColor,"&::after":{opacity:1,backgroundColor:e.itemActiveBg}},"&-label":Object.assign({minHeight:n,lineHeight:T(n),padding:`0 ${T(e.segmentedPaddingHorizontal)}`},dt),"&-icon + *":{marginInlineStart:e.calc(e.marginSM).div(2).equal()},"&-input":{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:0,height:0,opacity:0,pointerEvents:"none"}},[`${t}-thumb`]:Object.assign(Object.assign({},ce(e)),{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:0,height:"100%",padding:`${T(e.paddingXXS)} 0`,borderRadius:e.borderRadiusSM,transition:`transform ${e.motionDurationSlow} ${e.motionEaseInOut}, height ${e.motionDurationSlow} ${e.motionEaseInOut}`,[`& ~ ${t}-item:not(${t}-item-selected):not(${t}-item-disabled)::after`]:{backgroundColor:"transparent"}}),[`&${t}-lg`]:{borderRadius:e.borderRadiusLG,[`${t}-item-label`]:{minHeight:i,lineHeight:T(i),padding:`0 ${T(e.segmentedPaddingHorizontal)}`,fontSize:e.fontSizeLG},[`${t}-item, ${t}-thumb`]:{borderRadius:e.borderRadius}},[`&${t}-sm`]:{borderRadius:e.borderRadiusSM,[`${t}-item-label`]:{minHeight:s,lineHeight:T(s),padding:`0 ${T(e.segmentedPaddingHorizontalSM)}`},[`${t}-item, ${t}-thumb`]:{borderRadius:e.borderRadiusXS}}}),de(`&-disabled ${t}-item`,e)),de(`${t}-item-disabled`,e)),{[`${t}-thumb-motion-appear-active`]:{transition:`transform ${e.motionDurationSlow} ${e.motionEaseInOut}, width ${e.motionDurationSlow} ${e.motionEaseInOut}`,willChange:"transform, width"},[`&${t}-shape-round`]:{borderRadius:9999,[`${t}-item, ${t}-thumb`]:{borderRadius:9999}}})}},ut=e=>{const{colorTextLabel:t,colorText:n,colorFillSecondary:i,colorBgElevated:s,colorFill:o,lineWidthBold:m,colorBgLayout:v}=e;return{trackPadding:m,trackBg:v,itemColor:t,itemHoverColor:n,itemHoverBg:i,itemSelectedBg:s,itemActiveBg:o,itemSelectedColor:n}},mt=Ee("Segmented",e=>{const{lineWidth:t,calc:n}=e,i=He(e,{segmentedPaddingHorizontal:n(e.controlPaddingHorizontal).sub(t).equal(),segmentedPaddingHorizontalSM:n(e.controlPaddingHorizontalSM).sub(t).equal()});return[ct(i)]},ut);var ue=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n};function ht(e){return typeof e=="object"&&!!(e!=null&&e.icon)}const gt=r.forwardRef((e,t)=>{const n=Be(),{prefixCls:i,className:s,rootClassName:o,block:m,options:v=[],size:p="middle",style:b,vertical:h,shape:w="default",name:S=n}=e,g=ue(e,["prefixCls","className","rootClassName","block","options","size","style","vertical","shape","name"]),{getPrefixCls:y,direction:d,className:_,style:$}=Le("segmented"),l=y("segmented",i),[c,C,f]=mt(l),R=ke(p),x=r.useMemo(()=>v.map(u=>{if(ht(u)){const{icon:W,label:z}=u,q=ue(u,["icon","label"]);return Object.assign(Object.assign({},q),{label:r.createElement(r.Fragment,null,r.createElement("span",{className:`${l}-item-icon`},W),z&&r.createElement("span",null,z))})}return u}),[v,l]),F=G(s,o,_,{[`${l}-block`]:m,[`${l}-sm`]:R==="small",[`${l}-lg`]:R==="large",[`${l}-vertical`]:h,[`${l}-shape-${w}`]:w==="round"},C,f),I=Object.assign(Object.assign({},$),b);return c(r.createElement(ot,Object.assign({},g,{name:S,className:F,style:I,options:x,ref:t,prefixCls:l,direction:d,vertical:h})))}),ft=gt,vt=e=>{let t=[];switch(e){case"taxonomy":t=[...t,{title:"rank",dataIndex:"rank",key:"rank"},{title:"division_name",dataIndex:"division_name",key:"division_name"},{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id"},{title:"entity_name",dataIndex:"entity_name",key:"entity_name"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(n,i)=>n?"存在":"不存在"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(n,i)=>n?"存在":"不存在"}];break;case"disease":t=[...t,{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id"},{title:"mesh_id",dataIndex:"mesh_id",key:"mesh_id",render:(n,i)=>a.jsx("a",{href:`https://meshb.nlm.nih.gov/record/ui?ui=${n}`,target:"_blank",children:n})},{title:"entity_name",dataIndex:"entity_name",key:"entity_name"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(n,i)=>n?"存在":"不存在"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(n,i)=>n?"存在":"不存在"}];break;case"association":t=[{title:"entity_id",dataIndex:"entity_id",key:"entity_id"},{title:"subject_id",dataIndex:"subject_id",key:"subject_id"},{title:"object_id",dataIndex:"object_id",key:"object_id"},{title:"observed_id",dataIndex:"observed_id",key:"observed_id"},{title:"evidenced_id",dataIndex:"evidenced_id",key:"evidenced_id"}];break;default:t=[{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id"},{title:"entity_name",dataIndex:"entity_name",key:"entity_name"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(n,i)=>n?"存在":"不存在"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(n,i)=>n?"存在":"不存在"}]}return t},yt=()=>a.jsx(a.Fragment,{children:a.jsx(P.Item,{name:"entity_name",label:"实体名称",children:a.jsx(ee,{})})}),{Option:X}=U,bt=({})=>{const[e,t]=r.useState("study"),[n,i]=r.useState("disease"),s=P.useFormInstance(),[o,m]=r.useState([]),[v,p]=r.useState([]),{modals:b,openModals:h,closeModals:w}=ge(["entityDrawer"]),[S,g]=r.useState(),y=async(d,_,$)=>{if(_)try{const l=await B.get(`/entity/find-by-name/${d}/${_}`);$(l.data||[])}catch(l){console.error(l)}};return a.jsxs(a.Fragment,{children:[a.jsx(P.Item,{label:"Subject",name:"subject",children:a.jsx(ee,{onClick:()=>h("entityDrawer",{name:"subject"})})}),a.jsx(P.Item,{name:"from_entity",label:"选择 From 实体",rules:[{required:!0}],children:a.jsx(U,{showSearch:!0,placeholder:"输入关键词搜索实体",filterOption:!1,onSearch:d=>y(e,d,m),children:o.map(d=>a.jsx(X,{value:d.entity_id,children:d.entity_name||d.title||d.rank||d.entity_id},d.entity_id))})}),a.jsx(P.Item,{label:"To 实体类型",children:a.jsxs(U,{value:n,onChange:i,children:[a.jsx(X,{value:"study",children:"Study"}),a.jsx(X,{value:"disease",children:"Disease"}),a.jsx(X,{value:"taxonomy",children:"Taxonomy"})]})}),a.jsx(P.Item,{name:"to_entity",label:"选择 To 实体",rules:[{required:!0}],children:a.jsx(U,{showSearch:!0,placeholder:"输入关键词搜索实体",filterOption:!1,onSearch:d=>y(n,d,p),children:v.map(d=>a.jsx(X,{value:d.entity_id,children:d.entity_name||d.title||d.rank||d.entity_id},d.entity_id))})}),a.jsx(P.Item,{name:"relation_type",label:"关系类型",rules:[{required:!0,message:"请输入关系类型"}],children:a.jsx(U,{options:[{value:"ASSOCIATED_WITH",label:"ASSOCIATED_WITH"}]})}),a.jsx(xt,{form:s,setRecord:g,visible:b.entityDrawer.visible,params:b.entityDrawer.params,onClose:()=>w("entityDrawer")})]})},xt=({visible:e,setRecord:t,form:n,params:i,onClose:s,callback:o})=>a.jsx(a.Fragment,{children:a.jsx(tt,{open:e,onClose:s,width:"50%",children:a.jsx(pe,{hiddenAssociation:!0,rowSelection:{onChange:(m,v)=>{n.setFieldValue(i.name,v[0].entity_id),s()},type:"radio"}})})}),pt={taxonomy:yt,association:bt},St=({type:e,openModals:t,record:n})=>{const i=pt[e]||(()=>a.jsx("div",{}));return a.jsx(i,{openModals:t,record:n})},xe=(e,t,n)=>e.map(i=>i.key===t?{...i,children:n}:i.children?{...i,children:xe(i.children,t,n)}:i),_t=r.forwardRef(({entityType:e,params:t},n)=>{const[i,s]=r.useState(),[o,m]=r.useState(new Set),[v,p]=r.useState(),[b,h]=r.useState("default"),w=async(l,c,C,f="")=>{const R=await B.post(`/entity/page/${e}`,{page_number:c,page_size:C,parent_id:String(l),keyword:f,...t}),{items:x,total:F}=R.data;if(e=="taxonomy"){const I=x.map(u=>({title:a.jsx(a.Fragment,{children:a.jsxs(Q,{title:`${u.entity_name}(${u.rank})(${u.tax_id})`,children:[u.entity_name," (",u.rank,")"]})}),key:u.tax_id,isLeaf:!u.has_children}));return p(I),{children:I,total:F}}else if(e=="mesh"){const I=x.map(u=>({title:a.jsx(a.Fragment,{children:a.jsxs(Q,{title:`${u.entity_name}`,children:[u.entity_name,"(",u.entity_id,")"]})}),key:u.tree_number,isLeaf:!u.has_children}));return p(I),{children:I,total:F}}else{const I=x.map(u=>({title:a.jsx(a.Fragment,{children:a.jsx(Q,{title:`${u.entity_name}`,children:u.entity_name})}),key:u.entity_id,isLeaf:!u.has_children}));return p(I),{children:I,total:F}}},S=async()=>{const{children:l}=await w(b,1,-1);s(l)};r.useImperativeHandle(n,()=>({reload:S})),r.useEffect(()=>{S()},[e]);const g=async({key:l,children:c})=>{if(c)return;m(f=>new Set(f).add(l));const{children:C}=await w(l,1,-1);s(f=>xe(f,l,[...C])),m(f=>{const R=new Set(f);return R.delete(l),R})},y=r.useRef(null),[d,_]=r.useState(null),$=()=>{if(y.current){const l=y.current.getBoundingClientRect().top;_(window.innerHeight-l)}};return r.useEffect(()=>($(),window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$)}),[]),a.jsx("div",{ref:y,children:i?a.jsx(a.Fragment,{children:a.jsx(Ge,{height:d,loadData:g,treeData:i,showLine:!0,titleRender:l=>o.has(Number(l.key))?a.jsx(Ze,{size:"small"}):l.title})}):a.jsx(fe,{active:!0})})}),jt=r.lazy(()=>Xe(()=>import("./graph-view-Cj9PEsBO.js").then(e=>e.g),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),wt=r.forwardRef(({rowSelection:e,openModal:t,entityType:n,params:i},s)=>{const{data:o,pageNumber:m,totalPage:v,loading:p,reload:b,pageSize:h,setPageNumber:w,search:S}=Ue({url:`/entity/page/${n}`,params:{...i}});r.useImperativeHandle(s,()=>({reload:b})),qe();const{messageApi:g}=ye(),y=[...vt(n),{title:"操作",key:"action",fixed:"right",width:200,render:(d,_)=>a.jsx(Qe,{size:"middle",children:t&&a.jsxs(a.Fragment,{children:[a.jsx(K,{size:"small",color:"cyan",variant:"solid",onClick:()=>{t("modalA",{entityType:n,entityId:_.entity_id})},children:"更新"}),_.is_exist_graph?a.jsxs(a.Fragment,{children:[a.jsx(K,{size:"small",color:"cyan",variant:"solid",onClick:()=>{t("graphView",{entityType:n,entityId:_.entity_id,entityName:_.entity_name})},children:"网络"}),a.jsx(le,{title:"确认删除节点?",onConfirm:async()=>{var $,l,c,C;try{await B.delete(`/entity/delete-node/${n}/${_.entity_id}`),g.success("删除成功!"),b()}catch(f){console.log((l=($=f==null?void 0:f.response)==null?void 0:$.data)==null?void 0:l.detail),g.error((C=(c=f==null?void 0:f.response)==null?void 0:c.data)==null?void 0:C.detail)}},children:a.jsx(K,{size:"small",danger:!0,variant:"solid",children:"删除节点"})})]}):a.jsx(le,{title:"确认删除?",onConfirm:async()=>{var $,l,c,C;try{await B.delete(`/entity/delete/${n}/${_.entity_id}`),g.success("删除成功!"),b()}catch(f){console.log((l=($=f==null?void 0:f.response)==null?void 0:$.data)==null?void 0:l.detail),g.error((C=(c=f==null?void 0:f.response)==null?void 0:c.data)==null?void 0:C.detail)}},children:a.jsx(K,{size:"small",danger:!0,variant:"solid",children:"删除"})})]})})}];return a.jsx("div",{children:a.jsx(Ye,{title:()=>a.jsx(ee.Search,{size:"small",placeholder:"搜索...",allowClear:!0,enterButton:!0,onSearch:d=>{S(d)},style:{width:300}}),rowSelection:e,rowKey:d=>d.entity_id,size:"small",bordered:!0,pagination:!1,loading:p,columns:y,dataSource:o,footer:()=>a.jsx(a.Fragment,{children:v!=0&&a.jsxs(ve,{style:{marginTop:"1rem"},align:"center",children:["一共",v,"条数据  ",a.jsx(et,{size:"small",current:m,pageSize:h,total:v,onChange:d=>w(d),showSizeChanger:!1})]})})})})}),Tt=()=>{const{modals:e,openModals:t,closeModals:n}=ge(["entityPage","entityModal","graphView","entityDrawer"]),i=r.useRef(null),s=()=>{var o;(o=i.current)==null||o.reload()};return a.jsxs(a.Fragment,{children:[a.jsx(pe,{ref:i,openModals:t}),a.jsx(It,{openModals:t,callback:s,visible:e.entityModal.visible,params:e.entityModal.params,onClose:()=>n("entityModal")}),a.jsx($t,{callback:s,visible:e.graphView.visible,params:e.graphView.params,onClose:()=>n("graphView")})]})},pe=r.forwardRef(({openModals:e,rowSelection:t,hiddenAssociation:n=!1},i)=>{const s=[{key:"mesh-F03",label:"Mental Disorders"},{key:"mmesh-B",label:"Organisms"},{key:"taxonomy",label:"Microbiota"},{key:"study",label:"Study"},{key:"chemicals_and_drugs",label:"chemicals_and_drugs"},{key:"diet_and_food",label:"diet_and_food"}];n||s.unshift({key:"association",label:"association"});const[o,m]=r.useState(s[0].key),[v,p]=r.useState(),b=r.useRef(null),[h,w]=r.useState("table"),S=()=>{var g;(g=b.current)==null||g.reload()};return r.useImperativeHandle(i,()=>({reload:S})),a.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[a.jsxs(ve,{justify:"flex-end",gap:"small",children:[e&&a.jsx(a.Fragment,{children:a.jsx(K,{size:"small",color:"cyan",variant:"solid",onClick:()=>{e("entityModal",{entityType:o})},children:"新增"})}),a.jsx(K,{size:"small",color:"cyan",variant:"solid",onClick:S,children:"刷新"})]}),a.jsx("div",{style:{marginBottom:"1rem"},children:" "}),a.jsx(Je,{size:"small",onChange:g=>{if(g.startsWith("mesh")){m("mesh");const y=g.split("-")[1];p({category:y})}else if(g.startsWith("mmesh")){m("mesh");const y=g.split("-")[1];p({major_category:y})}else m(g)},tabBarExtraContent:a.jsx(a.Fragment,{children:a.jsx(ft,{size:"small",value:h,onChange:g=>w(g),options:[{label:"table",value:"table"},{label:"tree",value:"tree"}]})}),items:s}),h=="table"&&a.jsx(a.Fragment,{children:a.jsx(wt,{rowSelection:t,ref:b,openModal:e,params:v,entityType:o})}),h=="tree"&&a.jsx(a.Fragment,{children:a.jsx(_t,{ref:b,entityType:o,params:v})})]})}),$t=({visible:e,params:t,onClose:n,callback:i})=>a.jsx(be,{title:t==null?void 0:t.entityName,width:"60%",footer:null,open:e,onClose:n,onCancel:n,children:a.jsx(r.Suspense,{fallback:a.jsx(fe,{active:!0}),children:a.jsx(jt,{entity_id:t==null?void 0:t.entityId})})}),It=({visible:e,params:t,onClose:n,openModals:i,record:s,callback:o})=>{const[m]=P.useForm(),{messageApi:v}=ye(),[p,b]=r.useState(!1);r.useEffect(()=>{e&&(t!=null&&t.entityId)?h():m.resetFields()},[e]);const h=async()=>{b(!0);const S=await B.get(`/entity/get/${t.entityType}/${t.entityId}`);m.setFieldsValue(S.data),b(!1)},w=async()=>{const S=await m.validateFields();t!=null&&t.entityId?await B.put(`/entity/update/${t.entityType}/${t.entityId}`,S):await B.post(`/entity/add/${t.entityType}`,S),n(),o&&o(),v.success("操作成功!")};return a.jsx(be,{loading:p,title:t!=null&&t.entityId?"编辑实体":"创建实体",onOk:w,width:"50%",open:e,onClose:n,onCancel:n,children:a.jsxs(P,{form:m,children:[a.jsx(St,{type:t==null?void 0:t.entityType,openModals:i,record:s}),a.jsx(Ke,{ghost:!0,items:[{key:"1",label:"更多",children:a.jsx(a.Fragment,{children:a.jsx(P.Item,{noStyle:!0,shouldUpdate:!0,children:()=>a.jsx(We,{children:a.jsx("pre",{children:JSON.stringify(m.getFieldsValue(),null,2)})})})})}]})]})})};export{pe as EntityView,Tt as default};

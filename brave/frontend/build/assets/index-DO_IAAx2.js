import{r as m,ai as xe,al as Q,af as be,O as Z,ag as R,_ as Se,am as q,Z as ye,$ as ve,a0 as je,a1 as M,a2 as we,an as Ce,X as Ie,ao as Fe,a6 as $e,ap as Ee,aq as ke,c as N,j as n,F as j,S as P,I as A,T as Me,B as F,a as E,f as z,m as ze,b as L,M as ee,P as V,p as te,h as Oe,e as ne,U as _e,q as De,R as Ae,C as Te,l as se}from"./index-D-dSUqcW.js";import{M as Ne}from"./index-qGnf6g8z.js";import{C as ie,T as re}from"./index-Dkbp6E_w.js";import{T as k}from"./index-BA4ILsN5.js";import{T as Pe,M as ae}from"./index-B_NoN8nS.js";import{F as le}from"./Table-Dtf-w5DZ.js";import{D as Le}from"./index-GCalpkan.js";import{S as oe}from"./index-Dq5A-FeG.js";import{I as We}from"./index-SaZqb6NX.js";var Ve=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],ce=m.forwardRef(function(t,r){var s,i=t.prefixCls,e=i===void 0?"rc-switch":i,a=t.className,c=t.checked,l=t.defaultChecked,o=t.disabled,h=t.loadingIcon,d=t.checkedChildren,u=t.unCheckedChildren,g=t.onClick,p=t.onChange,S=t.onKeyDown,x=xe(t,Ve),y=Q(!1,{value:c,defaultValue:l}),C=be(y,2),w=C[0],v=C[1];function f(I,T){var _=w;return o||(_=I,v(_),p==null||p(_,T)),_}function b(I){I.which===q.LEFT?f(!1,I):I.which===q.RIGHT&&f(!0,I),S==null||S(I)}function $(I){var T=f(!w,I);g==null||g(T,I)}var O=Z(e,a,(s={},R(s,"".concat(e,"-checked"),w),R(s,"".concat(e,"-disabled"),o),s));return m.createElement("button",Se({},x,{type:"button",role:"switch","aria-checked":w,disabled:o,className:O,ref:r,onKeyDown:b,onClick:$}),h,m.createElement("span",{className:"".concat(e,"-inner")},m.createElement("span",{className:"".concat(e,"-inner-checked")},d),m.createElement("span",{className:"".concat(e,"-inner-unchecked")},u)))});ce.displayName="Switch";const Be=t=>{const{componentCls:r,trackHeightSM:s,trackPadding:i,trackMinWidthSM:e,innerMinMarginSM:a,innerMaxMarginSM:c,handleSizeSM:l,calc:o}=t,h=`${r}-inner`,d=M(o(l).add(o(i).mul(2)).equal()),u=M(o(c).mul(2).equal());return{[r]:{[`&${r}-small`]:{minWidth:e,height:s,lineHeight:M(s),[`${r}-inner`]:{paddingInlineStart:c,paddingInlineEnd:a,[`${h}-checked, ${h}-unchecked`]:{minHeight:s},[`${h}-checked`]:{marginInlineStart:`calc(-100% + ${d} - ${u})`,marginInlineEnd:`calc(100% - ${d} + ${u})`},[`${h}-unchecked`]:{marginTop:o(s).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${r}-handle`]:{width:l,height:l},[`${r}-loading-icon`]:{top:o(o(l).sub(t.switchLoadingIconSize)).div(2).equal(),fontSize:t.switchLoadingIconSize},[`&${r}-checked`]:{[`${r}-inner`]:{paddingInlineStart:a,paddingInlineEnd:c,[`${h}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${h}-unchecked`]:{marginInlineStart:`calc(100% - ${d} + ${u})`,marginInlineEnd:`calc(-100% + ${d} - ${u})`}},[`${r}-handle`]:{insetInlineStart:`calc(100% - ${M(o(l).add(i).equal())})`}},[`&:not(${r}-disabled):active`]:{[`&:not(${r}-checked) ${h}`]:{[`${h}-unchecked`]:{marginInlineStart:o(t.marginXXS).div(2).equal(),marginInlineEnd:o(t.marginXXS).mul(-1).div(2).equal()}},[`&${r}-checked ${h}`]:{[`${h}-checked`]:{marginInlineStart:o(t.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:o(t.marginXXS).div(2).equal()}}}}}}},Re=t=>{const{componentCls:r,handleSize:s,calc:i}=t;return{[r]:{[`${r}-loading-icon${t.iconCls}`]:{position:"relative",top:i(i(s).sub(t.fontSize)).div(2).equal(),color:t.switchLoadingIconColor,verticalAlign:"top"},[`&${r}-checked ${r}-loading-icon`]:{color:t.switchColor}}}},qe=t=>{const{componentCls:r,trackPadding:s,handleBg:i,handleShadow:e,handleSize:a,calc:c}=t,l=`${r}-handle`;return{[r]:{[l]:{position:"absolute",top:s,insetInlineStart:s,width:a,height:a,transition:`all ${t.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:c(a).div(2).equal(),boxShadow:e,transition:`all ${t.switchDuration} ease-in-out`,content:'""'}},[`&${r}-checked ${l}`]:{insetInlineStart:`calc(100% - ${M(c(a).add(s).equal())})`},[`&:not(${r}-disabled):active`]:{[`${l}::before`]:{insetInlineEnd:t.switchHandleActiveInset,insetInlineStart:0},[`&${r}-checked ${l}::before`]:{insetInlineEnd:0,insetInlineStart:t.switchHandleActiveInset}}}}},He=t=>{const{componentCls:r,trackHeight:s,trackPadding:i,innerMinMargin:e,innerMaxMargin:a,handleSize:c,calc:l}=t,o=`${r}-inner`,h=M(l(c).add(l(i).mul(2)).equal()),d=M(l(a).mul(2).equal());return{[r]:{[o]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:a,paddingInlineEnd:e,transition:`padding-inline-start ${t.switchDuration} ease-in-out, padding-inline-end ${t.switchDuration} ease-in-out`,[`${o}-checked, ${o}-unchecked`]:{display:"block",color:t.colorTextLightSolid,fontSize:t.fontSizeSM,transition:`margin-inline-start ${t.switchDuration} ease-in-out, margin-inline-end ${t.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:s},[`${o}-checked`]:{marginInlineStart:`calc(-100% + ${h} - ${d})`,marginInlineEnd:`calc(100% - ${h} + ${d})`},[`${o}-unchecked`]:{marginTop:l(s).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${r}-checked ${o}`]:{paddingInlineStart:e,paddingInlineEnd:a,[`${o}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${o}-unchecked`]:{marginInlineStart:`calc(100% - ${h} + ${d})`,marginInlineEnd:`calc(-100% + ${h} - ${d})`}},[`&:not(${r}-disabled):active`]:{[`&:not(${r}-checked) ${o}`]:{[`${o}-unchecked`]:{marginInlineStart:l(i).mul(2).equal(),marginInlineEnd:l(i).mul(-1).mul(2).equal()}},[`&${r}-checked ${o}`]:{[`${o}-checked`]:{marginInlineStart:l(i).mul(-1).mul(2).equal(),marginInlineEnd:l(i).mul(2).equal()}}}}}},Ke=t=>{const{componentCls:r,trackHeight:s,trackMinWidth:i}=t;return{[r]:Object.assign(Object.assign(Object.assign(Object.assign({},je(t)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:s,lineHeight:M(s),verticalAlign:"middle",background:t.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${t.motionDurationMid}`,userSelect:"none",[`&:hover:not(${r}-disabled)`]:{background:t.colorTextTertiary}}),we(t)),{[`&${r}-checked`]:{background:t.switchColor,[`&:hover:not(${r}-disabled)`]:{background:t.colorPrimaryHover}},[`&${r}-loading, &${r}-disabled`]:{cursor:"not-allowed",opacity:t.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${r}-rtl`]:{direction:"rtl"}})}},Ge=t=>{const{fontSize:r,lineHeight:s,controlHeight:i,colorWhite:e}=t,a=r*s,c=i/2,l=2,o=a-l*2,h=c-l*2;return{trackHeight:a,trackHeightSM:c,trackMinWidth:o*2+l*4,trackMinWidthSM:h*2+l*2,trackPadding:l,handleBg:e,handleSize:o,handleSizeSM:h,handleShadow:`0 2px 4px 0 ${new Ce("#00230b").setA(.2).toRgbString()}`,innerMinMargin:o/2,innerMaxMargin:o+l+l*2,innerMinMarginSM:h/2,innerMaxMarginSM:h+l+l*2}},Je=ye("Switch",t=>{const r=ve(t,{switchDuration:t.motionDurationMid,switchColor:t.colorPrimary,switchDisabledOpacity:t.opacityLoading,switchLoadingIconSize:t.calc(t.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${t.opacityLoading})`,switchHandleActiveInset:"-30%"});return[Ke(r),He(r),qe(r),Re(r),Be(r)]},Ge);var Ue=function(t,r){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&r.indexOf(i)<0&&(s[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,i=Object.getOwnPropertySymbols(t);e<i.length;e++)r.indexOf(i[e])<0&&Object.prototype.propertyIsEnumerable.call(t,i[e])&&(s[i[e]]=t[i[e]]);return s};const Xe=m.forwardRef((t,r)=>{const{prefixCls:s,size:i,disabled:e,loading:a,className:c,rootClassName:l,style:o,checked:h,value:d,defaultChecked:u,defaultValue:g,onChange:p}=t,S=Ue(t,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[x,y]=Q(!1,{value:h??d,defaultValue:u??g}),{getPrefixCls:C,direction:w,switch:v}=m.useContext(Ie),f=m.useContext(Fe),b=(e??f)||a,$=C("switch",s),O=m.createElement("div",{className:`${$}-handle`},a&&m.createElement(ke,{className:`${$}-loading-icon`})),[I,T,_]=Je($),me=$e(i),ge=Z(v==null?void 0:v.className,{[`${$}-small`]:me==="small",[`${$}-loading`]:a,[`${$}-rtl`]:w==="rtl"},c,l,T,_),fe=Object.assign(Object.assign({},v==null?void 0:v.style),o),pe=function(){y(arguments.length<=0?void 0:arguments[0]),p==null||p.apply(void 0,arguments)};return I(m.createElement(Ee,{component:"Switch"},m.createElement(ce,Object.assign({},S,{checked:x,onChange:pe,prefixCls:$,className:ge,style:fe,disabled:b,ref:r,loadingIcon:O}))))}),de=Xe;de.__ANT_SWITCH=!0;const Ye=({type:t,dataMap:r,constDataMap:s,componentMap:i,inputAnalysisMethod:e,dataKey:a,data:c,name:l,component_id:o,inputKey:h,...d})=>{if(!r)return n.jsx("div",{children:"加载中...."});r={...r,...s};const u=i[t];if(!u)return n.jsxs("div",{children:["未知类型 ",t]});const{Component:g,dataKey:p,...S}=u;console.log(S);let x=[];return c?x=c:e?x=r[e]:a?a in r&&(x=r[a]):p?p in r&&(x=r[p]):"first_data_key"in r?x=r[r.first_data_key]:o in r&&(x=r[o]),n.jsx(g,{...d,...S,data:x,name:l})},B=m.memo(({formJson:t,dataMap:r})=>{if(!t)return null;const{projectObj:s}=N(),a={rank:[{label:"SGB",value:"SGB"},{label:"SPECIES",value:"SPECIES"},{label:"GENUS",value:"GENUS"},{label:"FAMILY",value:"FAMILY"},{label:"ORDER",value:"ORDER"},{label:"CLASS",value:"CLASS"},{label:"PHYLUM",value:"PHYLUM"}],group_field:s!=null&&s.metadata_form?s==null?void 0:s.metadata_form.map(l=>({label:l.label,value:l.name})):[]},c={GroupSelect:{Component:W,dataKey:"sample_group_list"},Input:{Component:tt},GroupCompareSelect:{Component:et},BaseSelect:{Component:W},BaseInputNumber:{Component:it},BaseInput:{Component:nt},BaseSwitch:{Component:st},RankSelect:{Component:W,dataKey:"rank",mode:void 0,initialValue:"SPECIES"},GroupFieldSelect:{Component:W,dataKey:"group_field",mode:void 0,initialValue:"group"},FilterFieldSelect:{Component:Qe,dataKey:"sample_group_list",mode:void 0},GroupSelectSampleButton:{Component:rt},MetaphlanCladeSelect:{Component:Ze},SelectAll:{Component:at,dataKey:"sample_group_list"}};return n.jsx(n.Fragment,{children:t.map((l,o)=>n.jsx(Ye,{...l,dataMap:r,componentMap:c,constDataMap:a},o))})},(t,r)=>(console.log(JSON.stringify(t)===JSON.stringify(r)),JSON.stringify(t)===JSON.stringify(r))),Qe=({label:t,name:r,data:s,rules:i,field:e,...a})=>{const[c,l]=m.useState(),o=j.useFormInstance();return m.useEffect(()=>{if(s&&e){const h=[...new Set(s.map(e))],d=h.map(u=>({label:u,value:u}));l(d),o.setFieldValue(r,h[0])}},[s]),n.jsx(n.Fragment,{children:n.jsx(j.Item,{label:t,name:r,rules:i,children:n.jsx(he,{...a,options:c})})})},he=({options:t,clear:r,value:s,onChange:i,...e})=>{const a=j.useFormInstance(),c=l=>{i(l),r&&a.resetFields(r)};return n.jsx(P,{showSearch:!0,filterOption:(l,o)=>((o==null?void 0:o.label)??"").toLowerCase().includes(l.toLowerCase()),...e,options:t,value:s,onChange:c})},Ze=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>{const[c,l]=m.useState(),o=async()=>{let d=(await E.get("/fast-api/get_metaphlan_clade")).data.map(u=>({label:`${u.taxon.replaceAll(" ","_")}_${u.clade}`,value:u.clade}));l(d)};return m.useEffect(()=>{o()},[]),n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(P,{...a,options:c,showSearch:!0,filterOption:(h,d)=>((d==null?void 0:d.label)??"").toLowerCase().includes(h.toLowerCase())})})})},et=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>{const c=j.useFormInstance(),l=j.useWatch(["sites1","group"],c),o=j.useWatch(["sites2","group"],c),[h,d]=m.useState();return m.useEffect(()=>{l&&o&&d([{label:"Prevalent in both sites",value:"Prevalent in both sites"},{label:`Prevalent in ${o.join("-")}`,value:`Prevalent in ${o.join("-")}`},{label:`Prevalent in ${l.join("-")}`,value:`Prevalent in ${l.join("-")}`},{label:"Not prevalent in either sites",value:"Not prevalent in either sites"}])},[l,o]),n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(P,{showSearch:!0,filterOption:(u,g)=>((g==null?void 0:g.label)??"").toLowerCase().includes(u.toLowerCase()),...a,options:h})})})},tt=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(Me,{...a})})}),nt=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(A,{...a})})}),st=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(de,{...a})})}),it=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(Pe,{...a})})}),W=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(he,{...a,options:s})})}),rt=({label:t,name:r,rules:s,data:i,filter:e,group:a,groupField:c})=>{const[l,o]=m.useState(),[h,d]=m.useState([]),u=j.useFormInstance();let g=[];e&&(g=e.map(y=>y.name));const p=j.useWatch(y=>{const C=Object.entries(y).filter(([w])=>g.includes(w));return Object.fromEntries(C)},u),S=j.useWatch(a,u),x=(y,C)=>{const w=y.reduce((v,f)=>{const b=f[C];return v[b]||(v[b]=[]),v[b].push(f.value),v},{});o(w)};return m.useEffect(()=>{e&&p&&(i=e.reduce((y,C)=>y.filter(w=>C.method(w)===p[C.name]),i),i=i.map(y=>{const{label:C,id:w,value:v,...f}=y;return{label:`${y.label}(${e[0].method(y)})`,value:y.value,...f}})),i&&c?x(i,c):i&&S&&x(i,S),d(i)},[i,S,p]),n.jsxs(n.Fragment,{children:[n.jsx(j.Item,{label:t,name:[r,"sample"],rules:s,children:n.jsx(ot,{sampleGrouped:l,sampleGroup:h,watch:[r,"group"]})}),n.jsx(j.Item,{label:t,name:[r,"group"],children:n.jsx(ct,{sampleGrouped:l})})]})},at=({label:t,name:r,data:s,initialValue:i,rules:e,...a})=>n.jsx(n.Fragment,{children:n.jsx(j.Item,{initialValue:i,label:t,name:r,rules:e,children:n.jsx(lt,{data:s,...a})})}),lt=({data:t,value:r,onChange:s,mode:i,...e})=>{const[a,c]=m.useState(r),l=o=>{console.log(o),s(o),c(o)};return n.jsxs(n.Fragment,{children:[n.jsx(P,{...e,mode:i,value:a,onChange:l,allowClear:!0,options:t}),i=="multiple"&&n.jsxs(F,{onClick:()=>{const o=t.map(h=>h.value);c(o),s(o)},children:["选择全部",a&&n.jsxs(n.Fragment,{children:["(",a.length,")"]})]})]})},ot=({value:t,onChange:r,sampleGroup:s,watch:i,sampleGrouped:e})=>{const[a,c]=m.useState(),l=j.useFormInstance(),o=j.useWatch(i,l);m.useEffect(()=>{c(o)},[o]);const h=d=>{const u=Object.entries(e||{}).filter(([g])=>d.includes(g)).flatMap(([,g])=>g);r(u)};return m.useEffect(()=>{a&&h(a)},[a]),n.jsxs(n.Fragment,{children:[n.jsx(P,{showSearch:!0,filterOption:(d,u)=>((u==null?void 0:u.label)??"").toLowerCase().includes(d.toLowerCase()),mode:"multiple",value:t,onChange:r,options:s}),t&&n.jsxs(n.Fragment,{children:["一共选择",t.length,"个样本"]})]})},ct=({value:t,onChange:r,sampleGrouped:s})=>{const i=e=>{if((t||[]).includes(e)){const a=(t||[]).filter(c=>!c.includes(e));r(a)}else{const a=[...t||[],e];r(a)}};return n.jsx(n.Fragment,{children:n.jsx(z,{gap:"small",wrap:!0,children:Object.entries(s||{}).map(([e,a])=>n.jsx("span",{children:n.jsxs(F,{size:"small",type:(t||[]).includes(e)?"primary":"dashed",onClick:()=>i(e),children:[e,"(",a.length,")"]})},e))})})},Ut=async t=>await E.get("/file-operation/read-file",{params:{file_path:t}}),dt=async(t,r=0)=>await E.get("/file-operation/read-log-file",{params:{file_path:t,offset:r}}),Xt=async(t,r)=>await E.post("/file-operation/write-file",{file_path:t,content:r}),Yt=async t=>await E.get(`/find-analysis-by-id/${t}`),ht=async(t,r)=>await E.post(`/run-analysis-v2/${t}?run_type=${r}`),ut=async t=>await E.post(`/analysis/stop-analysis/${t}`);function D(t,r,s){let i=s.initialDeps??[],e;function a(){var c,l,o,h;let d;s.key&&((c=s.debug)!=null&&c.call(s))&&(d=Date.now());const u=t();if(!(u.length!==i.length||u.some((S,x)=>i[x]!==S)))return e;i=u;let p;if(s.key&&((l=s.debug)!=null&&l.call(s))&&(p=Date.now()),e=r(...u),s.key&&((o=s.debug)!=null&&o.call(s))){const S=Math.round((Date.now()-d)*100)/100,x=Math.round((Date.now()-p)*100)/100,y=x/16,C=(w,v)=>{for(w=String(w);w.length<v;)w=" "+w;return w};console.info(`%c⏱ ${C(x,5)} /${C(S,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,s==null?void 0:s.key)}return(h=s==null?void 0:s.onChange)==null||h.call(s,e),e}return a.updateDeps=c=>{i=c},a}function H(t,r){if(t===void 0)throw new Error("Unexpected undefined");return t}const mt=(t,r)=>Math.abs(t-r)<1.01,gt=(t,r,s)=>{let i;return function(...e){t.clearTimeout(i),i=t.setTimeout(()=>r.apply(this,e),s)}},K=t=>{const{offsetWidth:r,offsetHeight:s}=t;return{width:r,height:s}},ft=t=>t,pt=t=>{const r=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),i=[];for(let e=r;e<=s;e++)i.push(e);return i},xt=(t,r)=>{const s=t.scrollElement;if(!s)return;const i=t.targetWindow;if(!i)return;const e=c=>{const{width:l,height:o}=c;r({width:Math.round(l),height:Math.round(o)})};if(e(K(s)),!i.ResizeObserver)return()=>{};const a=new i.ResizeObserver(c=>{const l=()=>{const o=c[0];if(o!=null&&o.borderBoxSize){const h=o.borderBoxSize[0];if(h){e({width:h.inlineSize,height:h.blockSize});return}}e(K(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return a.observe(s,{box:"border-box"}),()=>{a.unobserve(s)}},G={passive:!0},J=typeof window>"u"?!0:"onscrollend"in window,bt=(t,r)=>{const s=t.scrollElement;if(!s)return;const i=t.targetWindow;if(!i)return;let e=0;const a=t.options.useScrollendEvent&&J?()=>{}:gt(i,()=>{r(e,!1)},t.options.isScrollingResetDelay),c=d=>()=>{const{horizontal:u,isRtl:g}=t.options;e=u?s.scrollLeft*(g&&-1||1):s.scrollTop,a(),r(e,d)},l=c(!0),o=c(!1);o(),s.addEventListener("scroll",l,G);const h=t.options.useScrollendEvent&&J;return h&&s.addEventListener("scrollend",o,G),()=>{s.removeEventListener("scroll",l),h&&s.removeEventListener("scrollend",o)}},St=(t,r,s)=>{if(r!=null&&r.borderBoxSize){const i=r.borderBoxSize[0];if(i)return Math.round(i[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},yt=(t,{adjustments:r=0,behavior:s},i)=>{var e,a;const c=t+r;(a=(e=i.scrollElement)==null?void 0:e.scrollTo)==null||a.call(e,{[i.options.horizontal?"left":"top"]:c,behavior:s})};class vt{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const i=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(e=>{e.forEach(a=>{const c=()=>{this._measureElement(a.target,a)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()})}));return{disconnect:()=>{var e;(e=i())==null||e.disconnect(),s=null},observe:e=>{var a;return(a=i())==null?void 0:a.observe(e,{box:"border-box"})},unobserve:e=>{var a;return(a=i())==null?void 0:a.unobserve(e)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([i,e])=>{typeof e>"u"&&delete s[i]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ft,rangeExtractor:pt,onChange:()=>{},measureElement:St,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var i,e;(e=(i=this.options).onChange)==null||e.call(i,this,s)},this.maybeNotify=D(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const i=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==i){if(this.cleanup(),!i){this.maybeNotify();return}this.scrollElement=i,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,a)=>{this.scrollAdjustments=0,this.scrollDirection=a?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=a,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,i)=>{const e=new Map,a=new Map;for(let c=i-1;c>=0;c--){const l=s[c];if(e.has(l.lane))continue;const o=a.get(l.lane);if(o==null||l.end>o.end?a.set(l.lane,l):l.end<o.end&&e.set(l.lane,!0),e.size===this.options.lanes)break}return a.size===this.options.lanes?Array.from(a.values()).sort((c,l)=>c.end===l.end?c.index-l.index:c.end-l.end)[0]:void 0},this.getMeasurementOptions=D(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(s,i,e,a,c)=>(this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:i,scrollMargin:e,getItemKey:a,enabled:c}),{key:!1}),this.getMeasurements=D(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:i,scrollMargin:e,getItemKey:a,enabled:c},l)=>{if(!c)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(d=>{this.itemSizeCache.set(d.key,d.size)}));const o=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const h=this.measurementsCache.slice(0,o);for(let d=o;d<s;d++){const u=a(d),g=this.options.lanes===1?h[d-1]:this.getFurthestMeasurement(h,d),p=g?g.end+this.options.gap:i+e,S=l.get(u),x=typeof S=="number"?S:this.options.estimateSize(d),y=p+x,C=g?g.lane:d%this.options.lanes;h[d]={index:d,start:p,size:x,end:y,key:u,lane:C}}return this.measurementsCache=h,h},{key:!1,debug:()=>this.options.debug}),this.calculateRange=D(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,i,e,a)=>this.range=s.length>0&&i>0?jt({measurements:s,outerSize:i,scrollOffset:e,lanes:a}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=D(()=>{let s=null,i=null;const e=this.calculateRange();return e&&(s=e.startIndex,i=e.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,i]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,i]},(s,i,e,a,c)=>a===null||c===null?[]:s({startIndex:a,endIndex:c,overscan:i,count:e}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const i=this.options.indexAttribute,e=s.getAttribute(i);return e?parseInt(e,10):(console.warn(`Missing attribute name '${i}={index}' on measured element.`),-1)},this._measureElement=(s,i)=>{const e=this.indexFromElement(s),a=this.measurementsCache[e];if(!a)return;const c=a.key,l=this.elementsCache.get(c);l!==s&&(l&&this.observer.unobserve(l),this.observer.observe(s),this.elementsCache.set(c,s)),s.isConnected&&this.resizeItem(e,this.options.measureElement(s,i,this))},this.resizeItem=(s,i)=>{const e=this.measurementsCache[s];if(!e)return;const a=this.itemSizeCache.get(e.key)??e.size,c=i-a;c!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(e,c,this):e.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=c,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,i)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((i,e)=>{i.isConnected||(this.observer.unobserve(i),this.elementsCache.delete(e))});return}this._measureElement(s,void 0)},this.getVirtualItems=D(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,i)=>{const e=[];for(let a=0,c=s.length;a<c;a++){const l=s[a],o=i[l];e.push(o)}return e},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const i=this.getMeasurements();if(i.length!==0)return H(i[ue(0,i.length-1,e=>H(i[e]).start,s)])},this.getOffsetForAlignment=(s,i,e=0)=>{const a=this.getSize(),c=this.getScrollOffset();i==="auto"&&(i=s>=c+a?"end":"start"),i==="center"?s+=(e-a)/2:i==="end"&&(s-=a);const l=this.getTotalSize()+this.options.scrollMargin-a;return Math.max(Math.min(l,s),0)},this.getOffsetForIndex=(s,i="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const e=this.measurementsCache[s];if(!e)return;const a=this.getSize(),c=this.getScrollOffset();if(i==="auto")if(e.end>=c+a-this.options.scrollPaddingEnd)i="end";else if(e.start<=c+this.options.scrollPaddingStart)i="start";else return[c,i];const l=i==="end"?e.end+this.options.scrollPaddingEnd:e.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,i,e.size),i]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:i="start",behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,i),{adjustments:void 0,behavior:e})},this.scrollToIndex=(s,{align:i="auto",behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let a=0;const c=10,l=h=>{if(!this.targetWindow)return;const d=this.getOffsetForIndex(s,h);if(!d){console.warn("Failed to get offset for index:",s);return}const[u,g]=d;this._scrollToOffset(u,{adjustments:void 0,behavior:e}),this.targetWindow.requestAnimationFrame(()=>{const p=this.getScrollOffset(),S=this.getOffsetForIndex(s,g);if(!S){console.warn("Failed to get offset for index:",s);return}mt(S[0],p)||o(g)})},o=h=>{this.targetWindow&&(a++,a<c?this.targetWindow.requestAnimationFrame(()=>l(h)):console.warn(`Failed to scroll to index ${s} after ${c} attempts.`))};l(i)},this.scrollBy=(s,{behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:i})},this.getTotalSize=()=>{var s;const i=this.getMeasurements();let e;if(i.length===0)e=this.options.paddingStart;else if(this.options.lanes===1)e=((s=i[i.length-1])==null?void 0:s.end)??0;else{const a=Array(this.options.lanes).fill(null);let c=i.length-1;for(;c>=0&&a.some(l=>l===null);){const l=i[c];a[l.lane]===null&&(a[l.lane]=l.end),c--}e=Math.max(...a.filter(l=>l!==null))}return Math.max(e-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:i,behavior:e})=>{this.options.scrollToFn(s,{behavior:e,adjustments:i},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(r)}}const ue=(t,r,s,i)=>{for(;t<=r;){const e=(t+r)/2|0,a=s(e);if(a<i)t=e+1;else if(a>i)r=e-1;else return e}return t>0?t-1:0};function jt({measurements:t,outerSize:r,scrollOffset:s,lanes:i}){const e=t.length-1,a=o=>t[o].start;if(t.length<=i)return{startIndex:0,endIndex:e};let c=ue(0,e,a,s),l=c;if(i===1)for(;l<e&&t[l].end<s+r;)l++;else if(i>1){const o=Array(i).fill(0);for(;l<e&&o.some(d=>d<s+r);){const d=t[l];o[d.lane]=d.end,l++}const h=Array(i).fill(s+r);for(;c>=0&&h.some(d=>d>=s);){const d=t[c];h[d.lane]=d.start,c--}c=Math.max(0,c-c%i),l=Math.min(e,l+(i-1-l%i))}return{startIndex:c,endIndex:l}}const U=typeof document<"u"?m.useLayoutEffect:m.useEffect;function wt(t){const r=m.useReducer(()=>({}),{})[1],s={...t,onChange:(e,a)=>{var c;a?ze.flushSync(r):r(),(c=t.onChange)==null||c.call(t,e,a)}},[i]=m.useState(()=>new vt(s));return i.setOptions(s),U(()=>i._didMount(),[]),U(()=>i._willUpdate()),i}function Ct(t){return wt({observeElementRect:xt,observeElementOffset:bt,scrollToFn:yt,...t})}const{Text:X}=L,It=({file_path:t})=>{var h;m.useEffect(()=>{console.log("fileKey",t),t&&a(t)},[t]);const{messageApi:r}=N(),s=m.useRef(0),[i,e]=m.useState([]),a=async(d,u=!1)=>{const g=await dt(d);s.current=g.data.offset,e(g.data.content),u&&r.success(`日志加载成功: ${d}`)},c=m.useRef(null),l=Ct({count:i.length,getScrollElement:()=>c.current,estimateSize:()=>30,overscan:10});m.useEffect(()=>{(i==null?void 0:i.length)>0&&l.scrollToIndex(i.length-1,{align:"end",behavior:"smooth"})},[i==null?void 0:i.length]);const o=l.getVirtualItems();return n.jsx(ie,{size:"small",extra:n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>{a(t)},children:"刷新日志"}),title:n.jsxs(z,{gap:"small",wrap:"wrap",children:[n.jsxs(k,{color:"blue",children:["文件: ",t]}),n.jsxs(k,{color:"purple",children:["偏移量: ",s.current]})]}),bodyStyle:{padding:0},children:n.jsx("div",{ref:c,style:{height:400,overflowY:"auto",fontFamily:"monospace",backgroundColor:"#1e1e1e",color:"#d4d4d4",padding:"0 12px"},children:n.jsx("div",{style:{height:l.getTotalSize(),width:"100%",position:"relative"},children:n.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${((h=o[0])==null?void 0:h.start)??0}px)`},children:o.map(d=>n.jsx("div",{"data-index":d.index,ref:l.measureElement,style:{padding:"4px 0",borderBottom:"1px solid #333"},children:n.jsxs(z,{gap:"middle",children:[n.jsxs(X,{type:"secondary",style:{width:60,color:"#d4d4d4"},children:["#",d.index+1]}),n.jsx(X,{style:{whiteSpace:"pre-wrap",color:"#d4d4d4"},children:i[d.index]})]})},d.key))})})})})},Ft=({visible:t,onClose:r,params:s})=>n.jsx(ee,{footer:null,title:"参数",width:"50%",open:t,onCancel:r,children:n.jsx(L,{children:n.jsx("pre",{children:JSON.stringify(s,null,2)})})}),$t=({formJson:t,openModal:r})=>{if(!t)return null;const[s,i]=m.useState([]),e=async()=>{const a=t.map(o=>o.dataKey),l=((await E.post("/list-bio-database",{type_list:a})).data||[]).reduce((o,h)=>{const d=h.type;o[d]||(o[d]=[]);const{name:u,database_id:g,...p}=h;return o[d].push({label:u,value:g,...p}),o},{});i(l),console.log(l)};return m.useEffect(()=>{e()},[t]),n.jsx(n.Fragment,{children:n.jsxs(z,{gap:"small",children:[n.jsx("div",{style:{flex:1},children:n.jsx(B,{formJson:t,dataMap:s})}),n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:r,children:"配置数据库"}),n.jsx(F,{onClick:e,size:"small",type:"primary",children:"刷新"})]})})},Et=({visible:t,onClose:r,params:s,callback:i})=>{if(!t)return null;const[e,a]=m.useState([]),[c,l]=m.useState(!1),[o]=j.useForm(),[h,d]=m.useState(s[0].dataKey),[u,g]=m.useState(null),p=async f=>{l(!0);const b=await E.post("/list-bio-database",f);a(b.data),l(!1)},S=async()=>({...await o.validateFields(),type:h}),x=async()=>{const f=await S();u?await E.post("/update-bio-database",{...f,database_id:u.database_id}):await E.post("/add-bio-database",f),y(),g(void 0),o.resetFields()},y=()=>{p({type:h})};m.useEffect(()=>{p({type:h})},[s]);const C=f=>{d(f),p({type:f})},w=async f=>{await E.delete(`/delete-bio-database/${f.id}`),y()},v=f=>{o.setFieldsValue(f),g(f)};return n.jsxs(ee,{title:"数据库操作",open:t,onCancel:r,width:"50%",footer:null,children:[n.jsx(re,{tabBarExtraContent:n.jsxs(n.Fragment,{children:[n.jsx(F,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:y,children:" 刷新"}),n.jsxs(F,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{g(void 0),x()},children:[" ",u?"更新":"添加"]})]}),activeKey:h,onChange:C,items:s.map(f=>({key:f.name,label:f.label,children:n.jsx("div",{})}))}),n.jsxs(j,{form:o,style:{maxWidth:600},labelCol:{span:3},children:[n.jsx(j.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:n.jsx(A,{})}),n.jsx(j.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:n.jsx(A,{})}),n.jsx(j.Item,{name:"db_index",label:"索引",children:n.jsx(A,{})})]}),n.jsx(le,{dataSource:e,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(f,b)=>n.jsxs(z,{gap:"small",children:[n.jsx(V,{title:"确定删除吗？",onConfirm:()=>{w(b)},children:n.jsx(F,{size:"small",type:"primary",danger:!0,children:"删除"})}),n.jsx(F,{size:"small",type:"primary",onClick:()=>{v(b)},children:"编辑"})]})}],loading:c,pagination:!1})]})},kt=({visible:t,params:r,onClose:s,callback:i})=>{m.useEffect(()=>{t&&p()},[r]);const[e,a]=m.useState(),[c,l]=m.useState();ne();const[o,h]=m.useState(),[d]=j.useForm(),{messageApi:u,project:g}=N(),p=async()=>{h(!0);const x=await E.get(`/analysis/edit-params/${r}`);a(x.data),l(x.data.analysis_result),d.setFieldsValue(x.data.request_param),h(!1)},S=x=>{if(x&&Object.keys(x).length>0)return Object.keys(x)[0]};return n.jsx(n.Fragment,{children:n.jsx(Le,{size:"default",loading:o,title:n.jsx(n.Fragment,{children:e&&n.jsxs(n.Fragment,{children:[n.jsx(k,{children:e==null?void 0:e.component_name}),n.jsx(k,{children:e==null?void 0:e.analysis_name}),n.jsx(k,{children:String(e==null?void 0:e.analysis_id).slice(0,8)})]})}),width:"50%",open:t,onClose:s,children:e&&n.jsx(n.Fragment,{children:n.jsx(Mt,{form:d,requestParam:{...e.request_param,analysis_id:e==null?void 0:e.analysis_id},dataMap:{...c,first_data_key:S(c)},formJson:e.content.formJson,databases:e.content.databases,callback:i})})})})},Mt=({form:t,requestParam:r,dataMap:s,formJson:i,databases:e,callback:a,showCancal:c=!1})=>{const{modals:l,openModals:o,closeModals:h}=te(["paramsView","bioDatabases"]),[d,u]=m.useState([]),[g,p]=m.useState([]),{messageApi:S,project:x}=N(),y=()=>{if(Array.isArray(i)){const v=i.filter(b=>!(b!=null&&b.required)&&!(b!=null&&b.db)),f=i.filter(b=>(b==null?void 0:b.required)||(b==null?void 0:b.db));u(f),p(v)}};m.useEffect(()=>{y()},[]);const C=v=>({...r,...v}),w=async(v,f=!1)=>{var O;const b=await t.validateFields(),$=C(b);try{const I=await E.post(`/fast-api/analysis-controller?save=${v}&is_submit=${f}`,$);console.log(I),v?(S.success("执行成功!"),a&&a()):o("paramsView",I.data)}catch(I){console.log(I),(O=I.response)!=null&&O.data&&S.error(I.response.data.detail)}};return n.jsxs(n.Fragment,{children:[n.jsxs(j,{form:t,children:[JSON.stringify(r),n.jsx(re,{items:[{key:"1",label:"必填参数",forceRender:!0,children:n.jsxs(n.Fragment,{children:[n.jsx(B,{formJson:[{name:"group_field",label:"分组列",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"},...d],dataMap:s}),e&&n.jsx($t,{openModal:()=>{o("bioDatabases",e)},formJson:e})]})},{key:"2",label:"可选参数",forceRender:!0,children:n.jsx(n.Fragment,{children:n.jsx(B,{formJson:g,dataMap:{}})})}]}),n.jsx(j.Item,{label:"分析名称",name:"analysis_name",style:{maxWidth:600},rules:[{required:!0,message:"该字段不能为空!"}],children:n.jsx(A,{})}),n.jsxs(z,{gap:"small",children:[n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>{w(!1)},children:"查看参数"}),n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>w(!0),children:r!=null&&r.analysis_id?n.jsxs(n.Fragment,{children:["更新分析(",r.analysis_name,")(",String(r.analysis_id).slice(0,8),")"]}):n.jsx(n.Fragment,{children:"保存分析"})}),(r==null?void 0:r.analysis_id)&&c&&n.jsx(F,{size:"small",color:"cyan",onClick:()=>t.setFieldValue("analysis_id",void 0),children:"取消更新"})]}),n.jsx(Oe,{ghost:!0,items:[{key:"1",label:"更多",children:n.jsx(n.Fragment,{children:n.jsx(j.Item,{noStyle:!0,shouldUpdate:!0,children:()=>n.jsx(L,{children:n.jsx("pre",{children:JSON.stringify(C(t.getFieldsValue()),null,2)})})})})}]})]}),n.jsx(Ft,{visible:l.paramsView.visible,onClose:()=>h("paramsView"),params:l.paramsView.params}),n.jsx(Et,{visible:l.bioDatabases.visible,onClose:()=>h("bioDatabases"),params:l.bioDatabases.params})]})},zt=({data:t,url:r,filename:s})=>{const{Search:i}=A,[e,a]=m.useState([]),c=l=>l?Object.keys(l).map(o=>({title:o,dataIndex:o,key:o,ellipsis:!0,width:150})):[];return m.useEffect(()=>{if(t){const l=t.map((o,h)=>({...o,key:h}));a(l)}},[t]),n.jsx(n.Fragment,{children:Array.isArray(e)&&n.jsx(n.Fragment,{children:n.jsx(le,{size:"small",title:()=>n.jsxs(z,{gap:"small",children:[n.jsx(i,{size:"small",placeholder:"input search text",allowClear:!0,onSearch:l=>{const o=t.filter(h=>Object.values(h).some(d=>typeof d=="string"&&d.includes(l)));a(o)},style:{width:304}}),r&&n.jsx(se,{title:`${window.location.origin}${r}`,children:n.jsx(F,{size:"small",onClick:()=>{window.open(`${r}?t=${Date.now()}`,"_blank")},type:"primary",children:"下载"})}),n.jsx("span",{children:s})]}),scroll:{x:"max-content",y:55*5},dataSource:e,pagination:!1,virtual:!0,columns:c(t[0]),footer:()=>`一共${t.length}条记录`})})})},Y=({data:t,url:r,filename:s})=>n.jsx("div",{children:n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx(We,{src:s!=null&&s.endsWith("pdf")?t:`${t}?t=${Date.now()}`,style:{maxWidth:"20rem",marginRight:"0.5rem"}}),r&&n.jsxs("div",{children:[n.jsx(se,{title:`${window.location.origin}${r}`,children:n.jsx(F,{size:"small",onClick:()=>{window.open(`${r}?t=${Date.now()}`,"_blank")},type:"primary",children:"下载"})}),s]})]})}),{Paragraph:Qt}=L,Ot=({data:t})=>n.jsx(n.Fragment,{children:n.jsx(ae,{value:t})}),_t=({data:t})=>n.jsx(n.Fragment,{children:n.jsx(L,{children:n.jsx("pre",{style:{margin:0},children:t})})}),Dt=({data:t})=>n.jsx(n.Fragment,{children:n.jsx(ae,{value:t,defaultLanguage:"json"})}),At=({data:t})=>n.jsx(n.Fragment,{children:t&&t.startsWith("/brave")?n.jsx(n.Fragment,{children:n.jsx("iframe",{src:t,width:"100%",style:{height:"80vh",border:"none"}})}):n.jsx(n.Fragment,{children:t})}),Tt={table:zt,string:Ot,html:At,json:Dt,text:_t},Nt=({type:t,...r})=>{const s=Tt[t]||(()=>n.jsxs("div",{children:["未知类型 ",t]}));return n.jsx(s,{...r})},Zt=m.forwardRef(({params:t,visible:r,onClose:s},i)=>{const{output_dir:e,analysis_id:a}=t||{};return r?n.jsx(n.Fragment,{children:a&&n.jsx(Pt,{onClose:s,analysis_id:a})}):null}),Pt=({analysis_id:t,onClose:r})=>{var C,w;const[s,i]=m.useState(!1),[e,a]=m.useState(null),c=ne(),{eventSourceRef:l,status:o,reconnect:h}=_e(),d=m.useRef(null),u=m.useRef(null),{messageApi:g}=N(),{modals:p,openModals:S,closeModals:x}=te(["editParams"]),y=async v=>{i(!0);const f=await E.get(`/analysis/visualization-results/${v}`);a(f.data),d.current=v,i(!1)};return m.useEffect(()=>{y(t)},[t]),m.useEffect(()=>{var v;if(l){const f=b=>{const $=JSON.parse(b.data);u.current=$,d.current==$.analysis_id&&($.event=="analysis_complete"||$.event=="analysis_failed"||$.event=="analysis_started")&&y(d.current)};return(v=l.current)==null||v.addEventListener("message",f),()=>{var b;console.log("removeEventListener"),(b=l.current)==null||b.removeEventListener("message",f)}}},[l.current]),n.jsx(n.Fragment,{children:n.jsxs(ie,{size:"small",title:n.jsx(n.Fragment,{children:e?n.jsxs(n.Fragment,{children:[n.jsx(k,{style:{cursor:"pointer"},onClick:()=>{c(`/component/${e==null?void 0:e.component_type}/${e==null?void 0:e.component_id}`)},children:e==null?void 0:e.component_name}),n.jsx(k,{children:e==null?void 0:e.analysis_name}),n.jsx(k,{children:String(e==null?void 0:e.analysis_id).slice(0,8)}),n.jsx(k,{children:e==null?void 0:e.analysis_status}),d.current==((C=u.current)==null?void 0:C.analysis_id)&&n.jsxs(k,{children:[" ",n.jsx(n.Fragment,{children:(w=u.current)==null?void 0:w.event})]})]}):n.jsx(n.Fragment,{children:n.jsx(oe,{spinning:!0})})}),extra:n.jsxs(z,{gap:"small",children:[r&&n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>r(),children:"关闭"}),e&&n.jsxs(n.Fragment,{children:[n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>{S("editParams",e.analysis_id)},children:"编辑参数"}),(e==null?void 0:e.analysis_status)=="running"?n.jsx(n.Fragment,{children:n.jsx(V,{title:"是否停止!",onConfirm:async()=>{await ut(e.analysis_id),g.success("停止成功")},children:n.jsx(F,{size:"small",color:"cyan",variant:"solid",children:"停止"})})}):n.jsx(n.Fragment,{children:n.jsx(V,{title:"是否运行!",onConfirm:async()=>{await ht(e.analysis_id,"job"),g.success("运行成功")},children:n.jsx(F,{size:"small",color:"cyan",variant:"solid",children:e.analysis_status=="created"?"运行":"重新运行"})})})]}),n.jsx(F,{size:"small",color:"cyan",variant:"solid",onClick:()=>y(t),children:"刷新"})]}),children:[(e==null?void 0:e.analysis_status)=="failed"?n.jsx("div",{style:{textAlign:"center"},children:n.jsx(It,{file_path:e==null?void 0:e.command_log_path})}):n.jsx(n.Fragment,{children:(e==null?void 0:e.analysis_status)=="running"&&(e==null?void 0:e.run_type)!="server"?n.jsx(De,{active:!0}):n.jsx(n.Fragment,{children:t&&n.jsx(Lt,{analsyisResult:e,loading:s})})}),n.jsx(kt,{callback:()=>y(t),visible:p.editParams.visible,params:p.editParams.params,onClose:()=>x("editParams")})]})})},Lt=({analsyisResult:t,loading:r})=>n.jsxs(oe,{spinning:r,children:[t&&n.jsxs(n.Fragment,{children:[t.images&&n.jsx("div",{children:Array.isArray(t.images)?n.jsx(Ae,{gutter:{xs:8,sm:16,md:24,lg:32},children:t.images.map((s,i)=>n.jsx(Te,{span:4,children:n.jsx(Y,{...s})},i))}):n.jsx(n.Fragment,{children:n.jsx(Y,{...t.images})})}),t.tables&&Array.isArray(t.tables)&&n.jsx(n.Fragment,{children:t.tables.map((s,i)=>n.jsx(Nt,{...s},i))})]}),n.jsx(Ne,{data:t==null?void 0:t.description})]});export{Zt as A,Et as B,Mt as C,kt as E,B as F,It as L,Ft as P,$t as a,Ut as b,Nt as c,Pt as d,Yt as f,ht as r,ut as s,Xt as w};

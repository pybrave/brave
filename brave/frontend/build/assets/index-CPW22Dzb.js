import{d as bt,k as tt,r as x,j as b,M as to,I as Fn,m as Fi,i as Vi,n as kr,o as Yi,f as de,B as Me,p as Io,q as wt,F as Vn,t as Pr,g as Xi,c as Wi,s as Ui,b as Gi,v as qi,u as Ki,l as Zi,S as Qi,w as Ji,x as ea,a as ta,E as na}from"./main-DXywrSBF.js";import{U as jr,A as _r,a as oa}from"./index-DN1I0-xZ.js";import{c as ra}from"./utils-D2B0dIuM.js";import{s as sa,a as ia,C as aa,b as ca,d as la}from"./index-CcKUnay2.js";import{M as ua,B as da,P as fa}from"./index-CqFY2fF-.js";import{D as ga}from"./index-CfC5eblh.js";import{f as ha,u as pa,a as ma,M as ya,B as xa}from"./index-DLkoATFV.js";import{O as va}from"./index-D7hxl_LK.js";import{i as Ao,a as ba,s as cn,p as Lr,z as Tr,b as wa,d as $r,c as Dn,t as Sa}from"./zoom-BGsqVsDF.js";import{c as Ea,i as Ro,a as ko}from"./rgb-BwIoVOhg.js";import{C as Ca}from"./index-BwawJwES.js";import{F as Ma}from"./Table-DFI76zEx.js";import Na from"./index-DKfe01fJ.js";import{T as Da}from"./index-qwSUrHIR.js";import"./index-BUctlgPj.js";import"./index-DjoHMCCX.js";import"./index-C4p1iVpj.js";import"./index-K-Wj2x7K.js";import"./UpOutlined-7MciF88_.js";import"./index-Bs08SC_0.js";import"./index-bhQSPbmK.js";import"./usePagination-D0YIndB3.js";import"./index-CWc1_CU5.js";import"./index-oPzbxqGz.js";import"./DeleteOutlined-B1cYCZg-.js";import"./DownloadOutlined-CSSEbxCr.js";import"./index-BT58XBAc.js";import"./index-gpGOOqTj.js";import"./study-page-BYtG-saP.js";import"./RedoOutlined-CU0rkWuz.js";import"./index-CGxiMSah.js";import"./callSuper-DcWcRBJA.js";import"./index-Bc2PCwt1.js";import"./addEventListener-DnTxgold.js";import"./index-D6JX2Tsl.js";import"./index-CM-5c5Hl.js";import"./Dropdown-CgdcCv_B.js";function Ia(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,o=t.slice(),r;return function(s){for(r=0;r<n;++r)o[r]=e[r]*(1-s)+t[r]*s;return o}}function Aa(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Ra(e,t){var n=t?t.length:0,o=e?Math.min(n,e.length):0,r=new Array(o),s=new Array(n),i;for(i=0;i<o;++i)r[i]=St(e[i],t[i]);for(;i<n;++i)s[i]=t[i];return function(a){for(i=0;i<o;++i)s[i]=r[i](a);return s}}function ka(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function Pa(e,t){var n={},o={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=St(e[r],t[r]):o[r]=t[r];return function(s){for(r in n)o[r]=n[r](s);return o}}function St(e,t){var n=typeof t,o;return t==null||n==="boolean"?Ea(t):(n==="number"?Ao:n==="string"?(o=ko(t))?(t=o,Ro):ba:t instanceof ko?Ro:t instanceof Date?ka:Aa(t)?Ia:Array.isArray(t)?Ra:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Pa:Ao)(e,t)}Fn.TextArea;const ja=({visible:e,onClose:t,params:n})=>{var d;if(!e)return null;const[o]=bt.useForm(),{callback:r}=n,{messageApi:s}=tt(),{project:i,projectObj:a}=tt(),u=c=>{const g=c.metadata;return delete c.metadata,{...c,sample_id:n.sample_id,project:i,analysis_result_id:n.analysis_result_id,metadata:JSON.stringify(g)}},f=async()=>{const c=await ha(n.sample_id);o.setFieldsValue(c.data)};x.useEffect(()=>{n.sample_id&&f()},[n==null?void 0:n.sample_id]);const l=async()=>{const c=await o.validateFields(),g=u(c);g.sample_id?(await pa(g),s.success("update successfully")):(await ma(g),s.success("add successfully")),r==null||r(),t()};return b.jsx(to,{onOk:l,open:e,onClose:t,onCancel:t,title:`${n.sample_id?"Edit":"Add "} Metadata`,children:b.jsxs(bt,{form:o,children:[b.jsx(bt.Item,{label:"Sample Name",name:"sample_name",children:b.jsx(Fn,{})}),(a==null?void 0:a.metadata_form)&&Array.isArray(a==null?void 0:a.metadata_form)&&((d=a==null?void 0:a.metadata_form)==null?void 0:d.map(c=>b.jsx(bt.Item,{label:c.label,name:["metadata",c.name],children:b.jsx(Fn,{})},c.name))),b.jsx(Fi,{ghost:!0,items:[{key:"1",label:"More",children:b.jsx(b.Fragment,{children:b.jsx(bt.Item,{noStyle:!0,shouldUpdate:!0,children:()=>b.jsx(Vi,{children:b.jsx("pre",{children:JSON.stringify(u(o.getFieldsValue()),null,2)})})})})}]})]})})};function ie(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,o;n<e.length;n++)(o=ie(e[n]))!==""&&(t+=(t&&" ")+o);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const je={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:o}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Dt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Or=["Enter"," ","Escape"],zr={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ut;(function(e){e.Strict="strict",e.Loose="loose"})(ut||(ut={}));var et;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(et||(et={}));var It;(function(e){e.Partial="partial",e.Full="full"})(It||(It={}));const Hr={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var Ue;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ue||(Ue={}));var Qt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Qt||(Qt={}));var X;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(X||(X={}));const Po={[X.Left]:X.Right,[X.Right]:X.Left,[X.Top]:X.Bottom,[X.Bottom]:X.Top};function Br(e){return e===null?null:e?"valid":"invalid"}const Fr=e=>"id"in e&&"source"in e&&"target"in e,_a=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),no=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Lt=(e,t=[0,0])=>{const{width:n,height:o}=ze(e),r=e.origin??t,s=n*r[0],i=o*r[1];return{x:e.position.x-s,y:e.position.y-i}},La=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((o,r)=>{const s=typeof r=="string";let i=!t.nodeLookup&&!s?r:void 0;t.nodeLookup&&(i=s?t.nodeLookup.get(r):no(r)?r:t.nodeLookup.get(r.id));const a=i?Jt(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return ln(o,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return un(n)},Tt=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(o=>{if(t.filter===void 0||t.filter(o)){const r=Jt(o);n=ln(n,r)}}),un(n)},oo=(e,t,[n,o,r]=[0,0,1],s=!1,i=!1)=>{const a={...$t(t,[n,o,r]),width:t.width/r,height:t.height/r},u=[];for(const f of e.values()){const{measured:l,selectable:d=!0,hidden:c=!1}=f;if(i&&!d||c)continue;const g=l.width??f.width??f.initialWidth??null,m=l.height??f.height??f.initialHeight??null,p=At(a,ft(f)),y=(g??0)*(m??0),v=s&&p>0;(!f.internals.handleBounds||v||p>=y||f.dragging)&&u.push(f)}return u},Ta=(e,t)=>{const n=new Set;return e.forEach(o=>{n.add(o.id)}),t.filter(o=>n.has(o.source)||n.has(o.target))};function $a(e,t){const n=new Map,o=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!o||o.has(r.id))&&n.set(r.id,r)}),n}async function Oa({nodes:e,width:t,height:n,panZoom:o,minZoom:r,maxZoom:s},i){if(e.size===0)return Promise.resolve(!0);const a=$a(e,i),u=Tt(a),f=ro(u,t,n,(i==null?void 0:i.minZoom)??r,(i==null?void 0:i.maxZoom)??s,(i==null?void 0:i.padding)??.1);return await o.setViewport(f,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function Vr({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:r,onError:s}){const i=n.get(e),a=i.parentId?n.get(i.parentId):void 0,{x:u,y:f}=a?a.internals.positionAbsolute:{x:0,y:0},l=i.origin??o;let d=i.extent||r;if(i.extent==="parent"&&!i.expandParent)if(!a)s==null||s("005",je.error005());else{const g=a.measured.width,m=a.measured.height;g&&m&&(d=[[u,f],[u+g,f+m]])}else a&&gt(i.extent)&&(d=[[i.extent[0][0]+u,i.extent[0][1]+f],[i.extent[1][0]+u,i.extent[1][1]+f]]);const c=gt(d)?nt(t,d,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&(s==null||s("015",je.error015())),{position:{x:c.x-u+(i.measured.width??0)*l[0],y:c.y-f+(i.measured.height??0)*l[1]},positionAbsolute:c}}async function za({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:r}){const s=new Set(e.map(c=>c.id)),i=[];for(const c of n){if(c.deletable===!1)continue;const g=s.has(c.id),m=!g&&c.parentId&&i.find(p=>p.id===c.parentId);(g||m)&&i.push(c)}const a=new Set(t.map(c=>c.id)),u=o.filter(c=>c.deletable!==!1),l=Ta(i,u);for(const c of u)a.has(c.id)&&!l.find(m=>m.id===c.id)&&l.push(c);if(!r)return{edges:l,nodes:i};const d=await r({nodes:i,edges:l});return typeof d=="boolean"?d?{edges:l,nodes:i}:{edges:[],nodes:[]}:d}const dt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),nt=(e={x:0,y:0},t,n)=>({x:dt(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:dt(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function Yr(e,t,n){const{width:o,height:r}=ze(n),{x:s,y:i}=n.internals.positionAbsolute;return nt(e,[[s,i],[s+o,i+r]],t)}const jo=(e,t,n)=>e<t?dt(Math.abs(e-t),1,t)/t:e>n?-dt(Math.abs(e-n),1,t)/t:0,Xr=(e,t,n=15,o=40)=>{const r=jo(e.x,o,t.width-o)*n,s=jo(e.y,o,t.height-o)*n;return[r,s]},ln=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Yn=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),un=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),ft=(e,t=[0,0])=>{var r,s;const{x:n,y:o}=no(e)?e.internals.positionAbsolute:Lt(e,t);return{x:n,y:o,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0}},Jt=(e,t=[0,0])=>{var r,s;const{x:n,y:o}=no(e)?e.internals.positionAbsolute:Lt(e,t);return{x:n,y:o,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:o+(((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0)}},Wr=(e,t)=>un(ln(Yn(e),Yn(t))),At=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},_o=e=>Ne(e.width)&&Ne(e.height)&&Ne(e.x)&&Ne(e.y),Ne=e=>!isNaN(e)&&isFinite(e),Ha=(e,t)=>{},dn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),$t=({x:e,y:t},[n,o,r],s=!1,i=[1,1])=>{const a={x:(e-n)/r,y:(t-o)/r};return s?dn(a,i):a},en=({x:e,y:t},[n,o,r])=>({x:e*r+n,y:t*r+o});function it(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Ba(e,t,n){if(typeof e=="string"||typeof e=="number"){const o=it(e,n),r=it(e,t);return{top:o,right:r,bottom:o,left:r,x:r*2,y:o*2}}if(typeof e=="object"){const o=it(e.top??e.y??0,n),r=it(e.bottom??e.y??0,n),s=it(e.left??e.x??0,t),i=it(e.right??e.x??0,t);return{top:o,right:i,bottom:r,left:s,x:s+i,y:o+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Fa(e,t,n,o,r,s){const{x:i,y:a}=en(e,[t,n,o]),{x:u,y:f}=en({x:e.x+e.width,y:e.y+e.height},[t,n,o]),l=r-u,d=s-f;return{left:Math.floor(i),top:Math.floor(a),right:Math.floor(l),bottom:Math.floor(d)}}const ro=(e,t,n,o,r,s)=>{const i=Ba(s,t,n),a=(t-i.x)/e.width,u=(n-i.y)/e.height,f=Math.min(a,u),l=dt(f,o,r),d=e.x+e.width/2,c=e.y+e.height/2,g=t/2-d*l,m=n/2-c*l,p=Fa(e,g,m,l,t,n),y={left:Math.min(p.left-i.left,0),top:Math.min(p.top-i.top,0),right:Math.min(p.right-i.right,0),bottom:Math.min(p.bottom-i.bottom,0)};return{x:g-y.left+y.right,y:m-y.top+y.bottom,zoom:l}},tn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function gt(e){return e!==void 0&&e!=="parent"}function ze(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function Ur(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function Gr(e,t={width:0,height:0},n,o,r){const s={...e},i=o.get(n);if(i){const a=i.origin||r;s.x+=i.internals.positionAbsolute.x-(t.width??0)*a[0],s.y+=i.internals.positionAbsolute.y-(t.height??0)*a[1]}return s}function Lo(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Va(){let e,t;return{promise:new Promise((o,r)=>{e=o,t=r}),resolve:e,reject:t}}function Ya(e){return{...zr,...e||{}}}function Et(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:r}){const{x:s,y:i}=Pe(e),a=$t({x:s-((r==null?void 0:r.left)??0),y:i-((r==null?void 0:r.top)??0)},o),{x:u,y:f}=n?dn(a,t):a;return{xSnapped:u,ySnapped:f,...a}}const so=e=>({width:e.offsetWidth,height:e.offsetHeight}),qr=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},Xa=["INPUT","SELECT","TEXTAREA"];function Kr(e){var o,r;const t=((r=(o=e.composedPath)==null?void 0:o.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:Xa.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const Zr=e=>"clientX"in e,Pe=(e,t)=>{var s,i;const n=Zr(e),o=n?e.clientX:(s=e.touches)==null?void 0:s[0].clientX,r=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:o-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},To=(e,t,n,o,r)=>{const s=t.querySelectorAll(`.${e}`);return!s||!s.length?null:Array.from(s).map(i=>{const a=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:r,position:i.getAttribute("data-handlepos"),x:(a.left-n.left)/o,y:(a.top-n.top)/o,...so(i)}})};function Qr({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:r,sourceControlY:s,targetControlX:i,targetControlY:a}){const u=e*.125+r*.375+i*.375+n*.125,f=t*.125+s*.375+a*.375+o*.125,l=Math.abs(u-e),d=Math.abs(f-t);return[u,f,l,d]}function Xt(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function $o({pos:e,x1:t,y1:n,x2:o,y2:r,c:s}){switch(e){case X.Left:return[t-Xt(t-o,s),n];case X.Right:return[t+Xt(o-t,s),n];case X.Top:return[t,n-Xt(n-r,s)];case X.Bottom:return[t,n+Xt(r-n,s)]}}function Jr({sourceX:e,sourceY:t,sourcePosition:n=X.Bottom,targetX:o,targetY:r,targetPosition:s=X.Top,curvature:i=.25}){const[a,u]=$o({pos:n,x1:e,y1:t,x2:o,y2:r,c:i}),[f,l]=$o({pos:s,x1:o,y1:r,x2:e,y2:t,c:i}),[d,c,g,m]=Qr({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:a,sourceControlY:u,targetControlX:f,targetControlY:l});return[`M${e},${t} C${a},${u} ${f},${l} ${o},${r}`,d,c,g,m]}function es({sourceX:e,sourceY:t,targetX:n,targetY:o}){const r=Math.abs(n-e)/2,s=n<e?n+r:n-r,i=Math.abs(o-t)/2,a=o<t?o+i:o-i;return[s,a,r,i]}function Wa({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:r=!1}){if(o!==void 0)return o;const s=r&&n?1e3:0,i=Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0);return s+i}function Ua({sourceNode:e,targetNode:t,width:n,height:o,transform:r}){const s=ln(Jt(e),Jt(t));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const i={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:o/r[2]};return At(i,un(s))>0}const Ga=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,qa=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),ts=(e,t)=>{if(!e.source||!e.target)return t;let n;return Fr(e)?n={...e}:n={...e,id:Ga(e)},qa(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function ns({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[r,s,i,a]=es({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,r,s,i,a]}const Oo={[X.Left]:{x:-1,y:0},[X.Right]:{x:1,y:0},[X.Top]:{x:0,y:-1},[X.Bottom]:{x:0,y:1}},Ka=({source:e,sourcePosition:t=X.Bottom,target:n})=>t===X.Left||t===X.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},zo=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Za({source:e,sourcePosition:t=X.Bottom,target:n,targetPosition:o=X.Top,center:r,offset:s,stepPosition:i}){const a=Oo[t],u=Oo[o],f={x:e.x+a.x*s,y:e.y+a.y*s},l={x:n.x+u.x*s,y:n.y+u.y*s},d=Ka({source:f,sourcePosition:t,target:l}),c=d.x!==0?"x":"y",g=d[c];let m=[],p,y;const v={x:0,y:0},S={x:0,y:0},[,,h,w]=es({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[c]*u[c]===-1){c==="x"?(p=r.x??f.x+(l.x-f.x)*i,y=r.y??(f.y+l.y)/2):(p=r.x??(f.x+l.x)/2,y=r.y??f.y+(l.y-f.y)*i);const C=[{x:p,y:f.y},{x:p,y:l.y}],M=[{x:f.x,y},{x:l.x,y}];a[c]===g?m=c==="x"?C:M:m=c==="x"?M:C}else{const C=[{x:f.x,y:l.y}],M=[{x:l.x,y:f.y}];if(c==="x"?m=a.x===g?M:C:m=a.y===g?C:M,t===o){const R=Math.abs(e[c]-n[c]);if(R<=s){const k=Math.min(s-1,s-R);a[c]===g?v[c]=(f[c]>e[c]?-1:1)*k:S[c]=(l[c]>n[c]?-1:1)*k}}if(t!==o){const R=c==="x"?"y":"x",k=a[c]===u[R],j=f[R]>l[R],_=f[R]<l[R];(a[c]===1&&(!k&&j||k&&_)||a[c]!==1&&(!k&&_||k&&j))&&(m=c==="x"?C:M)}const N={x:f.x+v.x,y:f.y+v.y},A={x:l.x+S.x,y:l.y+S.y},L=Math.max(Math.abs(N.x-m[0].x),Math.abs(A.x-m[0].x)),D=Math.max(Math.abs(N.y-m[0].y),Math.abs(A.y-m[0].y));L>=D?(p=(N.x+A.x)/2,y=m[0].y):(p=m[0].x,y=(N.y+A.y)/2)}return[[e,{x:f.x+v.x,y:f.y+v.y},...m,{x:l.x+S.x,y:l.y+S.y},n],p,y,h,w]}function Qa(e,t,n,o){const r=Math.min(zo(e,t)/2,zo(t,n)/2,o),{x:s,y:i}=t;if(e.x===s&&s===n.x||e.y===i&&i===n.y)return`L${s} ${i}`;if(e.y===i){const f=e.x<n.x?-1:1,l=e.y<n.y?1:-1;return`L ${s+r*f},${i}Q ${s},${i} ${s},${i+r*l}`}const a=e.x<n.x?1:-1,u=e.y<n.y?-1:1;return`L ${s},${i+r*u}Q ${s},${i} ${s+r*a},${i}`}function Xn({sourceX:e,sourceY:t,sourcePosition:n=X.Bottom,targetX:o,targetY:r,targetPosition:s=X.Top,borderRadius:i=5,centerX:a,centerY:u,offset:f=20,stepPosition:l=.5}){const[d,c,g,m,p]=Za({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:r},targetPosition:s,center:{x:a,y:u},offset:f,stepPosition:l});return[d.reduce((v,S,h)=>{let w="";return h>0&&h<d.length-1?w=Qa(d[h-1],S,d[h+1],i):w=`${h===0?"M":"L"}${S.x} ${S.y}`,v+=w,v},""),c,g,m,p]}function Ho(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Ja(e){var d;const{sourceNode:t,targetNode:n}=e;if(!Ho(t)||!Ho(n))return null;const o=t.internals.handleBounds||Bo(t.handles),r=n.internals.handleBounds||Bo(n.handles),s=Fo((o==null?void 0:o.source)??[],e.sourceHandle),i=Fo(e.connectionMode===ut.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!s||!i)return(d=e.onError)==null||d.call(e,"008",je.error008(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(s==null?void 0:s.position)||X.Bottom,u=(i==null?void 0:i.position)||X.Top,f=Rt(t,s,a),l=Rt(n,i,u);return{sourceX:f.x,sourceY:f.y,targetX:l.x,targetY:l.y,sourcePosition:a,targetPosition:u}}function Bo(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,o.type==="source"?t.push(o):o.type==="target"&&n.push(o);return{source:t,target:n}}function Rt(e,t,n=X.Left,o=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,s=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:i,height:a}=t??ze(e);if(o)return{x:r+i/2,y:s+a/2};switch((t==null?void 0:t.position)??n){case X.Top:return{x:r+i/2,y:s};case X.Right:return{x:r+i,y:s+a/2};case X.Bottom:return{x:r+i/2,y:s+a};case X.Left:return{x:r,y:s+a/2}}}function Fo(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Wn(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(o=>`${o}=${e[o]}`).join("&")}`:""}function ec(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:r}){const s=new Set;return e.reduce((i,a)=>([a.markerStart||o,a.markerEnd||r].forEach(u=>{if(u&&typeof u=="object"){const f=Wn(u,t);s.has(f)||(i.push({id:f,color:u.color||n,...u}),s.add(f))}}),i),[]).sort((i,a)=>i.id.localeCompare(a.id))}const io={nodeOrigin:[0,0],nodeExtent:Dt,elevateNodesOnSelect:!0,defaults:{}},tc={...io,checkEquality:!0};function ao(e,t){const n={...e};for(const o in t)t[o]!==void 0&&(n[o]=t[o]);return n}function nc(e,t,n){const o=ao(io,n);for(const r of e.values())if(r.parentId)co(r,e,t,o);else{const s=Lt(r,o.nodeOrigin),i=gt(r.extent)?r.extent:o.nodeExtent,a=nt(s,i,ze(r));r.internals.positionAbsolute=a}}function Un(e,t,n,o){var u,f;const r=ao(tc,o);let s=e.length>0;const i=new Map(t),a=r!=null&&r.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let d=i.get(l.id);if(r.checkEquality&&l===(d==null?void 0:d.internals.userNode))t.set(l.id,d);else{const c=Lt(l,r.nodeOrigin),g=gt(l.extent)?l.extent:r.nodeExtent,m=nt(c,g,ze(l));d={...r.defaults,...l,measured:{width:(u=l.measured)==null?void 0:u.width,height:(f=l.measured)==null?void 0:f.height},internals:{positionAbsolute:m,handleBounds:l.measured?d==null?void 0:d.internals.handleBounds:void 0,z:os(l,a),userNode:l}},t.set(l.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(s=!1),l.parentId&&co(d,t,n,o)}return s}function oc(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function co(e,t,n,o){const{elevateNodesOnSelect:r,nodeOrigin:s,nodeExtent:i}=ao(io,o),a=e.parentId,u=t.get(a);if(!u){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}oc(e,n);const f=r?1e3:0,{x:l,y:d,z:c}=rc(e,u,s,i,f),{positionAbsolute:g}=e.internals,m=l!==g.x||d!==g.y;(m||c!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:m?{x:l,y:d}:g,z:c}})}function os(e,t){return(Ne(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function rc(e,t,n,o,r){const{x:s,y:i}=t.internals.positionAbsolute,a=ze(e),u=Lt(e,n),f=gt(e.extent)?nt(u,e.extent,a):u;let l=nt({x:s+f.x,y:i+f.y},o,a);e.extent==="parent"&&(l=Yr(l,a,t));const d=os(e,r),c=t.internals.z??0;return{x:l.x,y:l.y,z:c>=d?c+1:d}}function lo(e,t,n,o=[0,0]){var i;const r=[],s=new Map;for(const a of e){const u=t.get(a.parentId);if(!u)continue;const f=((i=s.get(a.parentId))==null?void 0:i.expandedRect)??ft(u),l=Wr(f,a.rect);s.set(a.parentId,{expandedRect:l,parent:u})}return s.size>0&&s.forEach(({expandedRect:a,parent:u},f)=>{var h;const l=u.internals.positionAbsolute,d=ze(u),c=u.origin??o,g=a.x<l.x?Math.round(Math.abs(l.x-a.x)):0,m=a.y<l.y?Math.round(Math.abs(l.y-a.y)):0,p=Math.max(d.width,Math.round(a.width)),y=Math.max(d.height,Math.round(a.height)),v=(p-d.width)*c[0],S=(y-d.height)*c[1];(g>0||m>0||v||S)&&(r.push({id:f,type:"position",position:{x:u.position.x-g+v,y:u.position.y-m+S}}),(h=n.get(f))==null||h.forEach(w=>{e.some(E=>E.id===w.id)||r.push({id:w.id,type:"position",position:{x:w.position.x+g,y:w.position.y+m}})})),(d.width<a.width||d.height<a.height||g||m)&&r.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:p+(g?c[0]*g-v:0),height:y+(m?c[1]*m-S:0)}})}),r}function sc(e,t,n,o,r,s){const i=o==null?void 0:o.querySelector(".xyflow__viewport");let a=!1;if(!i)return{changes:[],updatedInternals:a};const u=[],f=window.getComputedStyle(i),{m22:l}=new window.DOMMatrixReadOnly(f.transform),d=[];for(const c of e.values()){const g=t.get(c.id);if(!g)continue;if(g.hidden){t.set(g.id,{...g,internals:{...g.internals,handleBounds:void 0}}),a=!0;continue}const m=so(c.nodeElement),p=g.measured.width!==m.width||g.measured.height!==m.height;if(!!(m.width&&m.height&&(p||!g.internals.handleBounds||c.force))){const v=c.nodeElement.getBoundingClientRect(),S=gt(g.extent)?g.extent:s;let{positionAbsolute:h}=g.internals;g.parentId&&g.extent==="parent"?h=Yr(h,m,t.get(g.parentId)):S&&(h=nt(h,S,m));const w={...g,measured:m,internals:{...g.internals,positionAbsolute:h,handleBounds:{source:To("source",c.nodeElement,v,l,g.id),target:To("target",c.nodeElement,v,l,g.id)}}};t.set(g.id,w),g.parentId&&co(w,t,n,{nodeOrigin:r}),a=!0,p&&(u.push({id:g.id,type:"dimensions",dimensions:m}),g.expandParent&&g.parentId&&d.push({id:g.id,parentId:g.parentId,rect:ft(w,r)}))}}if(d.length>0){const c=lo(d,t,n,r);u.push(...c)}return{changes:u,updatedInternals:a}}async function ic({delta:e,panZoom:t,transform:n,translateExtent:o,width:r,height:s}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,s]],o),a=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(a)}function Vo(e,t,n,o,r,s){let i=r;const a=o.get(i)||new Map;o.set(i,a.set(n,t)),i=`${r}-${e}`;const u=o.get(i)||new Map;if(o.set(i,u.set(n,t)),s){i=`${r}-${e}-${s}`;const f=o.get(i)||new Map;o.set(i,f.set(n,t))}}function rs(e,t,n){e.clear(),t.clear();for(const o of n){const{source:r,target:s,sourceHandle:i=null,targetHandle:a=null}=o,u={edgeId:o.id,source:r,target:s,sourceHandle:i,targetHandle:a},f=`${r}-${i}--${s}-${a}`,l=`${s}-${a}--${r}-${i}`;Vo("source",u,l,e,r,i),Vo("target",u,f,e,s,a),t.set(o.id,o)}}function ss(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:ss(n,t):!1}function Yo(e,t,n){var r;let o=e;do{if((r=o==null?void 0:o.matches)!=null&&r.call(o,t))return!0;if(o===n)return!1;o=o==null?void 0:o.parentElement}while(o);return!1}function ac(e,t,n,o){const r=new Map;for(const[s,i]of e)if((i.selected||i.id===o)&&(!i.parentId||!ss(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const a=e.get(s);a&&r.set(s,{id:s,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return r}function In({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var i,a,u;const r=[];for(const[f,l]of t){const d=(i=n.get(f))==null?void 0:i.internals.userNode;d&&r.push({...d,position:l.position,dragging:o})}if(!e)return[r[0],r];const s=(a=n.get(e))==null?void 0:a.internals.userNode;return[s?{...s,position:((u=t.get(e))==null?void 0:u.position)||s.position,dragging:o}:r[0],r]}function cc({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:r}){let s={x:null,y:null},i=0,a=new Map,u=!1,f={x:0,y:0},l=null,d=!1,c=null,g=!1,m=!1;function p({noDragClassName:v,handleSelector:S,domNode:h,isSelectable:w,nodeId:E,nodeClickDistance:C=0}){c=cn(h);function M({x:D,y:R},k){const{nodeLookup:j,nodeExtent:_,snapGrid:T,snapToGrid:P,nodeOrigin:z,onNodeDrag:I,onSelectionDrag:$,onError:O,updateNodePositions:H}=t();s={x:D,y:R};let V=!1,W={x:0,y:0,x2:0,y2:0};if(a.size>1&&_){const Z=Tt(a);W=Yn(Z)}for(const[Z,G]of a){if(!j.has(Z))continue;let Q={x:D-G.distance.x,y:R-G.distance.y};P&&(Q=dn(Q,T));let B=[[_[0][0],_[0][1]],[_[1][0],_[1][1]]];if(a.size>1&&_&&!G.extent){const{positionAbsolute:J}=G.internals,Y=J.x-W.x+_[0][0],K=J.x+G.measured.width-W.x2+_[1][0],U=J.y-W.y+_[0][1],te=J.y+G.measured.height-W.y2+_[1][1];B=[[Y,U],[K,te]]}const{position:q,positionAbsolute:F}=Vr({nodeId:Z,nextPosition:Q,nodeLookup:j,nodeExtent:B,nodeOrigin:z,onError:O});V=V||G.position.x!==q.x||G.position.y!==q.y,G.position=q,G.internals.positionAbsolute=F}if(m=m||V,!!V&&(H(a,!0),k&&(o||I||!E&&$))){const[Z,G]=In({nodeId:E,dragItems:a,nodeLookup:j});o==null||o(k,a,Z,G),I==null||I(k,Z,G),E||$==null||$(k,G)}}async function N(){if(!l)return;const{transform:D,panBy:R,autoPanSpeed:k,autoPanOnNodeDrag:j}=t();if(!j){u=!1,cancelAnimationFrame(i);return}const[_,T]=Xr(f,l,k);(_!==0||T!==0)&&(s.x=(s.x??0)-_/D[2],s.y=(s.y??0)-T/D[2],await R({x:_,y:T})&&M(s,null)),i=requestAnimationFrame(N)}function A(D){var V;const{nodeLookup:R,multiSelectionActive:k,nodesDraggable:j,transform:_,snapGrid:T,snapToGrid:P,selectNodesOnDrag:z,onNodeDragStart:I,onSelectionDragStart:$,unselectNodesAndEdges:O}=t();d=!0,(!z||!w)&&!k&&E&&((V=R.get(E))!=null&&V.selected||O()),w&&z&&E&&(e==null||e(E));const H=Et(D.sourceEvent,{transform:_,snapGrid:T,snapToGrid:P,containerBounds:l});if(s=H,a=ac(R,j,H,E),a.size>0&&(n||I||!E&&$)){const[W,Z]=In({nodeId:E,dragItems:a,nodeLookup:R});n==null||n(D.sourceEvent,a,W,Z),I==null||I(D.sourceEvent,W,Z),E||$==null||$(D.sourceEvent,Z)}}const L=$r().clickDistance(C).on("start",D=>{const{domNode:R,nodeDragThreshold:k,transform:j,snapGrid:_,snapToGrid:T}=t();l=(R==null?void 0:R.getBoundingClientRect())||null,g=!1,m=!1,k===0&&A(D),s=Et(D.sourceEvent,{transform:j,snapGrid:_,snapToGrid:T,containerBounds:l}),f=Pe(D.sourceEvent,l)}).on("drag",D=>{const{autoPanOnNodeDrag:R,transform:k,snapGrid:j,snapToGrid:_,nodeDragThreshold:T,nodeLookup:P}=t(),z=Et(D.sourceEvent,{transform:k,snapGrid:j,snapToGrid:_,containerBounds:l});if((D.sourceEvent.type==="touchmove"&&D.sourceEvent.touches.length>1||E&&!P.has(E))&&(g=!0),!g){if(!u&&R&&d&&(u=!0,N()),!d){const I=z.xSnapped-(s.x??0),$=z.ySnapped-(s.y??0);Math.sqrt(I*I+$*$)>T&&A(D)}(s.x!==z.xSnapped||s.y!==z.ySnapped)&&a&&d&&(f=Pe(D.sourceEvent,l),M(z,D.sourceEvent))}}).on("end",D=>{if(!(!d||g)&&(u=!1,d=!1,cancelAnimationFrame(i),a.size>0)){const{nodeLookup:R,updateNodePositions:k,onNodeDragStop:j,onSelectionDragStop:_}=t();if(m&&(k(a,!1),m=!1),r||j||!E&&_){const[T,P]=In({nodeId:E,dragItems:a,nodeLookup:R,dragging:!1});r==null||r(D.sourceEvent,a,T,P),j==null||j(D.sourceEvent,T,P),E||_==null||_(D.sourceEvent,P)}}}).filter(D=>{const R=D.target;return!D.button&&(!v||!Yo(R,`.${v}`,h))&&(!S||Yo(R,S,h))});c.call(L)}function y(){c==null||c.on(".drag",null)}return{update:p,destroy:y}}function lc(e,t,n){const o=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const s of t.values())At(r,ft(s))>0&&o.push(s);return o}const uc=250;function dc(e,t,n,o){var a,u;let r=[],s=1/0;const i=lc(e,n,t+uc);for(const f of i){const l=[...((a=f.internals.handleBounds)==null?void 0:a.source)??[],...((u=f.internals.handleBounds)==null?void 0:u.target)??[]];for(const d of l){if(o.nodeId===d.nodeId&&o.type===d.type&&o.id===d.id)continue;const{x:c,y:g}=Rt(f,d,d.position,!0),m=Math.sqrt(Math.pow(c-e.x,2)+Math.pow(g-e.y,2));m>t||(m<s?(r=[{...d,x:c,y:g}],s=m):m===s&&r.push({...d,x:c,y:g}))}}if(!r.length)return null;if(r.length>1){const f=o.type==="source"?"target":"source";return r.find(l=>l.type===f)??r[0]}return r[0]}function is(e,t,n,o,r,s=!1){var f,l,d;const i=o.get(e);if(!i)return null;const a=r==="strict"?(f=i.internals.handleBounds)==null?void 0:f[t]:[...((l=i.internals.handleBounds)==null?void 0:l.source)??[],...((d=i.internals.handleBounds)==null?void 0:d.target)??[]],u=(n?a==null?void 0:a.find(c=>c.id===n):a==null?void 0:a[0])??null;return u&&s?{...u,...Rt(i,u,u.position,!0)}:u}function as(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function fc(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const cs=()=>!0;function gc(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:r,edgeUpdaterType:s,isTarget:i,domNode:a,nodeLookup:u,lib:f,autoPanOnConnect:l,flowId:d,panBy:c,cancelConnection:g,onConnectStart:m,onConnect:p,onConnectEnd:y,isValidConnection:v=cs,onReconnectEnd:S,updateConnection:h,getTransform:w,getFromHandle:E,autoPanSpeed:C,dragThreshold:M=1}){const N=qr(e.target);let A=0,L;const{x:D,y:R}=Pe(e),k=N==null?void 0:N.elementFromPoint(D,R),j=as(s,k),_=a==null?void 0:a.getBoundingClientRect();let T=!1;if(!_||!j)return;const P=is(r,j,o,u,t);if(!P)return;let z=Pe(e,_),I=!1,$=null,O=!1,H=null;function V(){if(!l||!_)return;const[J,Y]=Xr(z,_,C);c({x:J,y:Y}),A=requestAnimationFrame(V)}const W={...P,nodeId:r,type:j,position:P.position},Z=u.get(r);let Q={inProgress:!0,isValid:null,from:Rt(Z,W,X.Left,!0),fromHandle:W,fromPosition:W.position,fromNode:Z,to:z,toHandle:null,toPosition:Po[W.position],toNode:null};function B(){T=!0,h(Q),m==null||m(e,{nodeId:r,handleId:o,handleType:j})}M===0&&B();function q(J){if(!T){const{x:te,y:oe}=Pe(J),xe=te-D,Le=oe-R;if(!(xe*xe+Le*Le>M*M))return;B()}if(!E()||!W){F(J);return}const Y=w();z=Pe(J,_),L=dc($t(z,Y,!1,[1,1]),n,u,W),I||(V(),I=!0);const K=ls(J,{handle:L,connectionMode:t,fromNodeId:r,fromHandleId:o,fromType:i?"target":"source",isValidConnection:v,doc:N,lib:f,flowId:d,nodeLookup:u});H=K.handleDomNode,$=K.connection,O=fc(!!L,K.isValid);const U={...Q,isValid:O,to:K.toHandle&&O?en({x:K.toHandle.x,y:K.toHandle.y},Y):z,toHandle:K.toHandle,toPosition:O&&K.toHandle?K.toHandle.position:Po[W.position],toNode:K.toHandle?u.get(K.toHandle.nodeId):null};O&&L&&Q.toHandle&&U.toHandle&&Q.toHandle.type===U.toHandle.type&&Q.toHandle.nodeId===U.toHandle.nodeId&&Q.toHandle.id===U.toHandle.id&&Q.to.x===U.to.x&&Q.to.y===U.to.y||(h(U),Q=U)}function F(J){if(T){(L||H)&&$&&O&&(p==null||p($));const{inProgress:Y,...K}=Q,U={...K,toPosition:Q.toHandle?Q.toPosition:null};y==null||y(J,U),s&&(S==null||S(J,U))}g(),cancelAnimationFrame(A),I=!1,O=!1,$=null,H=null,N.removeEventListener("mousemove",q),N.removeEventListener("mouseup",F),N.removeEventListener("touchmove",q),N.removeEventListener("touchend",F)}N.addEventListener("mousemove",q),N.addEventListener("mouseup",F),N.addEventListener("touchmove",q),N.addEventListener("touchend",F)}function ls(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:r,fromType:s,doc:i,lib:a,flowId:u,isValidConnection:f=cs,nodeLookup:l}){const d=s==="target",c=t?i.querySelector(`.${a}-flow__handle[data-id="${u}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:g,y:m}=Pe(e),p=i.elementFromPoint(g,m),y=p!=null&&p.classList.contains(`${a}-flow__handle`)?p:c,v={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const S=as(void 0,y),h=y.getAttribute("data-nodeid"),w=y.getAttribute("data-handleid"),E=y.classList.contains("connectable"),C=y.classList.contains("connectableend");if(!h||!S)return v;const M={source:d?h:o,sourceHandle:d?w:r,target:d?o:h,targetHandle:d?r:w};v.connection=M;const A=E&&C&&(n===ut.Strict?d&&S==="source"||!d&&S==="target":h!==o||w!==r);v.isValid=A&&f(M),v.toHandle=is(h,S,w,l,n,!0)}return v}const Gn={onPointerDown:gc,isValid:ls};function hc({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const r=cn(e);function s({translateExtent:a,width:u,height:f,zoomStep:l=10,pannable:d=!0,zoomable:c=!0,inversePan:g=!1}){const m=h=>{const w=n();if(h.sourceEvent.type!=="wheel"||!t)return;const E=-h.sourceEvent.deltaY*(h.sourceEvent.deltaMode===1?.05:h.sourceEvent.deltaMode?1:.002)*l,C=w[2]*Math.pow(2,E);t.scaleTo(C)};let p=[0,0];const y=h=>{(h.sourceEvent.type==="mousedown"||h.sourceEvent.type==="touchstart")&&(p=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY])},v=h=>{const w=n();if(h.sourceEvent.type!=="mousemove"&&h.sourceEvent.type!=="touchmove"||!t)return;const E=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY],C=[E[0]-p[0],E[1]-p[1]];p=E;const M=o()*Math.max(w[2],Math.log(w[2]))*(g?-1:1),N={x:w[0]-C[0]*M,y:w[1]-C[1]*M},A=[[0,0],[u,f]];t.setViewportConstrained({x:N.x,y:N.y,zoom:w[2]},A,a)},S=Tr().on("start",y).on("zoom",d?v:null).on("zoom.wheel",c?m:null);r.call(S,{})}function i(){r.on("zoom",null)}return{update:s,destroy:i,pointer:Lr}}const pc=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,fn=e=>({x:e.x,y:e.y,zoom:e.k}),An=({x:e,y:t,zoom:n})=>wa.translate(e,t).scale(n),at=(e,t)=>e.target.closest(`.${t}`),us=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),mc=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Rn=(e,t=0,n=mc,o=()=>{})=>{const r=typeof t=="number"&&t>0;return r||o(),r?e.transition().duration(t).ease(n).on("end",o):e},ds=e=>{const t=e.ctrlKey&&tn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function yc({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:r,panOnScrollSpeed:s,zoomOnPinch:i,onPanZoomStart:a,onPanZoom:u,onPanZoomEnd:f}){return l=>{if(at(l,t))return!1;l.preventDefault(),l.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(l.ctrlKey&&i){const y=Lr(l),v=ds(l),S=d*Math.pow(2,v);o.scaleTo(n,S,y,l);return}const c=l.deltaMode===1?20:1;let g=r===et.Vertical?0:l.deltaX*c,m=r===et.Horizontal?0:l.deltaY*c;!tn()&&l.shiftKey&&r!==et.Vertical&&(g=l.deltaY*c,m=0),o.translateBy(n,-(g/d)*s,-(m/d)*s,{internal:!0});const p=fn(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,a==null||a(l,p)),e.isPanScrolling&&(u==null||u(l,p),e.panScrollTimeout=setTimeout(()=>{f==null||f(l,p),e.isPanScrolling=!1},150))}}function xc({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,r){const s=o.type==="wheel",i=!t&&s&&!o.ctrlKey,a=at(o,e);if(o.ctrlKey&&s&&a&&o.preventDefault(),i||a)return null;o.preventDefault(),n.call(this,o,r)}}function vc({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var s,i,a;if((s=o.sourceEvent)!=null&&s.internal)return;const r=fn(o.transform);e.mouseButton=((i=o.sourceEvent)==null?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((a=o.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(o.sourceEvent,r))}}function bc({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:r}){return s=>{var i,a;e.usedRightMouseButton=!!(n&&us(t,e.mouseButton??0)),(i=s.sourceEvent)!=null&&i.sync||o([s.transform.x,s.transform.y,s.transform.k]),r&&!((a=s.sourceEvent)!=null&&a.internal)&&(r==null||r(s.sourceEvent,fn(s.transform)))}}function wc({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:r,onPaneContextMenu:s}){return i=>{var a;if(!((a=i.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,s&&us(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&s(i.sourceEvent),e.usedRightMouseButton=!1,o(!1),r&&pc(e.prevViewport,i.transform))){const u=fn(i.transform);e.prevViewport=u,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(i.sourceEvent,u)},n?150:0)}}}function Sc({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:r,zoomOnDoubleClick:s,userSelectionActive:i,noWheelClassName:a,noPanClassName:u,lib:f}){return l=>{var m;const d=e||t,c=n&&l.ctrlKey;if(l.button===1&&l.type==="mousedown"&&(at(l,`${f}-flow__node`)||at(l,`${f}-flow__edge`)))return!0;if(!o&&!d&&!r&&!s&&!n||i||at(l,a)&&l.type==="wheel"||at(l,u)&&(l.type!=="wheel"||r&&l.type==="wheel"&&!e)||!n&&l.ctrlKey&&l.type==="wheel")return!1;if(!n&&l.type==="touchstart"&&((m=l.touches)==null?void 0:m.length)>1)return l.preventDefault(),!1;if(!d&&!r&&!c&&l.type==="wheel"||!o&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(o)&&!o.includes(l.button)&&l.type==="mousedown")return!1;const g=Array.isArray(o)&&o.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||l.type==="wheel")&&g}}function Ec({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:o,translateExtent:r,viewport:s,onPanZoom:i,onPanZoomStart:a,onPanZoomEnd:u,onDraggingChange:f}){const l={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),c=Tr().clickDistance(!Ne(o)||o<0?0:o).scaleExtent([t,n]).translateExtent(r),g=cn(e).call(c);h({x:s.x,y:s.y,zoom:dt(s.zoom,t,n)},[[0,0],[d.width,d.height]],r);const m=g.on("wheel.zoom"),p=g.on("dblclick.zoom");c.wheelDelta(ds);function y(R,k){return g?new Promise(j=>{c==null||c.interpolate((k==null?void 0:k.interpolate)==="linear"?St:Dn).transform(Rn(g,k==null?void 0:k.duration,k==null?void 0:k.ease,()=>j(!0)),R)}):Promise.resolve(!1)}function v({noWheelClassName:R,noPanClassName:k,onPaneContextMenu:j,userSelectionActive:_,panOnScroll:T,panOnDrag:P,panOnScrollMode:z,panOnScrollSpeed:I,preventScrolling:$,zoomOnPinch:O,zoomOnScroll:H,zoomOnDoubleClick:V,zoomActivationKeyPressed:W,lib:Z,onTransformChange:G}){_&&!l.isZoomingOrPanning&&S();const B=T&&!W&&!_?yc({zoomPanValues:l,noWheelClassName:R,d3Selection:g,d3Zoom:c,panOnScrollMode:z,panOnScrollSpeed:I,zoomOnPinch:O,onPanZoomStart:a,onPanZoom:i,onPanZoomEnd:u}):xc({noWheelClassName:R,preventScrolling:$,d3ZoomHandler:m});if(g.on("wheel.zoom",B,{passive:!1}),!_){const F=vc({zoomPanValues:l,onDraggingChange:f,onPanZoomStart:a});c.on("start",F);const J=bc({zoomPanValues:l,panOnDrag:P,onPaneContextMenu:!!j,onPanZoom:i,onTransformChange:G});c.on("zoom",J);const Y=wc({zoomPanValues:l,panOnDrag:P,panOnScroll:T,onPaneContextMenu:j,onPanZoomEnd:u,onDraggingChange:f});c.on("end",Y)}const q=Sc({zoomActivationKeyPressed:W,panOnDrag:P,zoomOnScroll:H,panOnScroll:T,zoomOnDoubleClick:V,zoomOnPinch:O,userSelectionActive:_,noPanClassName:k,noWheelClassName:R,lib:Z});c.filter(q),V?g.on("dblclick.zoom",p):g.on("dblclick.zoom",null)}function S(){c.on("zoom",null)}async function h(R,k,j){const _=An(R),T=c==null?void 0:c.constrain()(_,k,j);return T&&await y(T),new Promise(P=>P(T))}async function w(R,k){const j=An(R);return await y(j,k),new Promise(_=>_(j))}function E(R){if(g){const k=An(R),j=g.property("__zoom");(j.k!==R.zoom||j.x!==R.x||j.y!==R.y)&&(c==null||c.transform(g,k,null,{sync:!0}))}}function C(){const R=g?Sa(g.node()):{x:0,y:0,k:1};return{x:R.x,y:R.y,zoom:R.k}}function M(R,k){return g?new Promise(j=>{c==null||c.interpolate((k==null?void 0:k.interpolate)==="linear"?St:Dn).scaleTo(Rn(g,k==null?void 0:k.duration,k==null?void 0:k.ease,()=>j(!0)),R)}):Promise.resolve(!1)}function N(R,k){return g?new Promise(j=>{c==null||c.interpolate((k==null?void 0:k.interpolate)==="linear"?St:Dn).scaleBy(Rn(g,k==null?void 0:k.duration,k==null?void 0:k.ease,()=>j(!0)),R)}):Promise.resolve(!1)}function A(R){c==null||c.scaleExtent(R)}function L(R){c==null||c.translateExtent(R)}function D(R){const k=!Ne(R)||R<0?0:R;c==null||c.clickDistance(k)}return{update:v,destroy:S,setViewport:w,setViewportConstrained:h,getViewport:C,scaleTo:M,scaleBy:N,setScaleExtent:A,setTranslateExtent:L,syncViewport:E,setClickDistance:D}}var ht;(function(e){e.Line="line",e.Handle="handle"})(ht||(ht={}));function Cc({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:r,affectsY:s}){const i=e-t,a=n-o,u=[i>0?1:i<0?-1:0,a>0?1:a<0?-1:0];return i&&r&&(u[0]=u[0]*-1),a&&s&&(u[1]=u[1]*-1),u}function Mc(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),o=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:o,affectsY:r}}function Ye(e,t){return Math.max(0,t-e)}function Xe(e,t){return Math.max(0,e-t)}function Wt(e,t,n){return Math.max(0,t-e,e-n)}function Xo(e,t){return e?!t:t}function Nc(e,t,n,o,r,s,i,a){let{affectsX:u,affectsY:f}=t;const{isHorizontal:l,isVertical:d}=t,c=l&&d,{xSnapped:g,ySnapped:m}=n,{minWidth:p,maxWidth:y,minHeight:v,maxHeight:S}=o,{x:h,y:w,width:E,height:C,aspectRatio:M}=e;let N=Math.floor(l?g-e.pointerX:0),A=Math.floor(d?m-e.pointerY:0);const L=E+(u?-N:N),D=C+(f?-A:A),R=-s[0]*E,k=-s[1]*C;let j=Wt(L,p,y),_=Wt(D,v,S);if(i){let z=0,I=0;u&&N<0?z=Ye(h+N+R,i[0][0]):!u&&N>0&&(z=Xe(h+L+R,i[1][0])),f&&A<0?I=Ye(w+A+k,i[0][1]):!f&&A>0&&(I=Xe(w+D+k,i[1][1])),j=Math.max(j,z),_=Math.max(_,I)}if(a){let z=0,I=0;u&&N>0?z=Xe(h+N,a[0][0]):!u&&N<0&&(z=Ye(h+L,a[1][0])),f&&A>0?I=Xe(w+A,a[0][1]):!f&&A<0&&(I=Ye(w+D,a[1][1])),j=Math.max(j,z),_=Math.max(_,I)}if(r){if(l){const z=Wt(L/M,v,S)*M;if(j=Math.max(j,z),i){let I=0;!u&&!f||u&&!f&&c?I=Xe(w+k+L/M,i[1][1])*M:I=Ye(w+k+(u?N:-N)/M,i[0][1])*M,j=Math.max(j,I)}if(a){let I=0;!u&&!f||u&&!f&&c?I=Ye(w+L/M,a[1][1])*M:I=Xe(w+(u?N:-N)/M,a[0][1])*M,j=Math.max(j,I)}}if(d){const z=Wt(D*M,p,y)/M;if(_=Math.max(_,z),i){let I=0;!u&&!f||f&&!u&&c?I=Xe(h+D*M+R,i[1][0])/M:I=Ye(h+(f?A:-A)*M+R,i[0][0])/M,_=Math.max(_,I)}if(a){let I=0;!u&&!f||f&&!u&&c?I=Ye(h+D*M,a[1][0])/M:I=Xe(h+(f?A:-A)*M,a[0][0])/M,_=Math.max(_,I)}}}A=A+(A<0?_:-_),N=N+(N<0?j:-j),r&&(c?L>D*M?A=(Xo(u,f)?-N:N)/M:N=(Xo(u,f)?-A:A)*M:l?(A=N/M,f=u):(N=A*M,u=f));const T=u?h+N:h,P=f?w+A:w;return{width:E+(u?-N:N),height:C+(f?-A:A),x:s[0]*N*(u?-1:1)+T,y:s[1]*A*(f?-1:1)+P}}const fs={width:0,height:0,x:0,y:0},Dc={...fs,pointerX:0,pointerY:0,aspectRatio:1};function Ic(e){return[[0,0],[e.measured.width,e.measured.height]]}function Ac(e,t,n){const o=t.position.x+e.position.x,r=t.position.y+e.position.y,s=e.measured.width??0,i=e.measured.height??0,a=n[0]*s,u=n[1]*i;return[[o-a,r-u],[o+s-a,r+i-u]]}function Rc({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:r}){const s=cn(e);function i({controlPosition:u,boundaries:f,keepAspectRatio:l,resizeDirection:d,onResizeStart:c,onResize:g,onResizeEnd:m,shouldResize:p}){let y={...fs},v={...Dc};const S=Mc(u);let h,w=null,E=[],C,M,N;const A=$r().on("start",L=>{const{nodeLookup:D,transform:R,snapGrid:k,snapToGrid:j,nodeOrigin:_,paneDomNode:T}=n();if(h=D.get(t),!h)return;w=(T==null?void 0:T.getBoundingClientRect())??null;const{xSnapped:P,ySnapped:z}=Et(L.sourceEvent,{transform:R,snapGrid:k,snapToGrid:j,containerBounds:w});y={width:h.measured.width??0,height:h.measured.height??0,x:h.position.x??0,y:h.position.y??0},v={...y,pointerX:P,pointerY:z,aspectRatio:y.width/y.height},C=void 0,h.parentId&&(h.extent==="parent"||h.expandParent)&&(C=D.get(h.parentId),M=C&&h.extent==="parent"?Ic(C):void 0),E=[],N=void 0;for(const[I,$]of D)if($.parentId===t&&(E.push({id:I,position:{...$.position},extent:$.extent}),$.extent==="parent"||$.expandParent)){const O=Ac($,h,$.origin??_);N?N=[[Math.min(O[0][0],N[0][0]),Math.min(O[0][1],N[0][1])],[Math.max(O[1][0],N[1][0]),Math.max(O[1][1],N[1][1])]]:N=O}c==null||c(L,{...y})}).on("drag",L=>{const{transform:D,snapGrid:R,snapToGrid:k,nodeOrigin:j}=n(),_=Et(L.sourceEvent,{transform:D,snapGrid:R,snapToGrid:k,containerBounds:w}),T=[];if(!h)return;const{x:P,y:z,width:I,height:$}=y,O={},H=h.origin??j,{width:V,height:W,x:Z,y:G}=Nc(v,S,_,f,l,H,M,N),Q=V!==I,B=W!==$,q=Z!==P&&Q,F=G!==z&&B;if(!q&&!F&&!Q&&!B)return;if((q||F||H[0]===1||H[1]===1)&&(O.x=q?Z:y.x,O.y=F?G:y.y,y.x=O.x,y.y=O.y,E.length>0)){const U=Z-P,te=G-z;for(const oe of E)oe.position={x:oe.position.x-U+H[0]*(V-I),y:oe.position.y-te+H[1]*(W-$)},T.push(oe)}if((Q||B)&&(O.width=Q&&(!d||d==="horizontal")?V:y.width,O.height=B&&(!d||d==="vertical")?W:y.height,y.width=O.width,y.height=O.height),C&&h.expandParent){const U=H[0]*(O.width??0);O.x&&O.x<U&&(y.x=U,v.x=v.x-(O.x-U));const te=H[1]*(O.height??0);O.y&&O.y<te&&(y.y=te,v.y=v.y-(O.y-te))}const J=Cc({width:y.width,prevWidth:I,height:y.height,prevHeight:$,affectsX:S.affectsX,affectsY:S.affectsY}),Y={...y,direction:J};(p==null?void 0:p(L,Y))!==!1&&(g==null||g(L,Y),o(O,T))}).on("end",L=>{m==null||m(L,{...y}),r==null||r({...y})});s.call(A)}function a(){s.on(".drag",null)}return{update:i,destroy:a}}var kn={exports:{}},Pn={},jn={exports:{}},_n={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wo;function kc(){if(Wo)return _n;Wo=1;var e=kr();function t(d,c){return d===c&&(d!==0||1/d===1/c)||d!==d&&c!==c}var n=typeof Object.is=="function"?Object.is:t,o=e.useState,r=e.useEffect,s=e.useLayoutEffect,i=e.useDebugValue;function a(d,c){var g=c(),m=o({inst:{value:g,getSnapshot:c}}),p=m[0].inst,y=m[1];return s(function(){p.value=g,p.getSnapshot=c,u(p)&&y({inst:p})},[d,g,c]),r(function(){return u(p)&&y({inst:p}),d(function(){u(p)&&y({inst:p})})},[d]),i(g),g}function u(d){var c=d.getSnapshot;d=d.value;try{var g=c();return!n(d,g)}catch{return!0}}function f(d,c){return c()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:a;return _n.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,_n}var Uo;function Pc(){return Uo||(Uo=1,jn.exports=kc()),jn.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Go;function jc(){if(Go)return Pn;Go=1;var e=kr(),t=Pc();function n(f,l){return f===l&&(f!==0||1/f===1/l)||f!==f&&l!==l}var o=typeof Object.is=="function"?Object.is:n,r=t.useSyncExternalStore,s=e.useRef,i=e.useEffect,a=e.useMemo,u=e.useDebugValue;return Pn.useSyncExternalStoreWithSelector=function(f,l,d,c,g){var m=s(null);if(m.current===null){var p={hasValue:!1,value:null};m.current=p}else p=m.current;m=a(function(){function v(C){if(!S){if(S=!0,h=C,C=c(C),g!==void 0&&p.hasValue){var M=p.value;if(g(M,C))return w=M}return w=C}if(M=w,o(h,C))return M;var N=c(C);return g!==void 0&&g(M,N)?(h=C,M):(h=C,w=N)}var S=!1,h,w,E=d===void 0?null:d;return[function(){return v(l())},E===null?void 0:function(){return v(E())}]},[l,d,c,g]);var y=r(f,m[0],m[1]);return i(function(){p.hasValue=!0,p.value=y},[y]),u(y),y},Pn}var qo;function _c(){return qo||(qo=1,kn.exports=jc()),kn.exports}var Lc=_c();const Tc=Yi(Lc),$c={},Ko=e=>{let t;const n=new Set,o=(l,d)=>{const c=typeof l=="function"?l(t):l;if(!Object.is(c,t)){const g=t;t=d??(typeof c!="object"||c===null)?c:Object.assign({},t,c),n.forEach(m=>m(t,g))}},r=()=>t,u={setState:o,getState:r,getInitialState:()=>f,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{($c?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},f=t=e(o,r,u);return u},Oc=e=>e?Ko(e):Ko,{useDebugValue:zc}=de,{useSyncExternalStoreWithSelector:Hc}=Tc,Bc=e=>e;function gs(e,t=Bc,n){const o=Hc(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return zc(o),o}const Zo=(e,t)=>{const n=Oc(e),o=(r,s=t)=>gs(n,r,s);return Object.assign(o,n),o},Fc=(e,t)=>e?Zo(e,t):Zo;function se(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[o,r]of e)if(!Object.is(r,t.get(o)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const gn=x.createContext(null),Vc=gn.Provider,hs=je.error001();function ee(e,t){const n=x.useContext(gn);if(n===null)throw new Error(hs);return gs(n,e,t)}function re(){const e=x.useContext(gn);if(e===null)throw new Error(hs);return x.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Qo={display:"none"},Yc={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},ps="react-flow__node-desc",ms="react-flow__edge-desc",Xc="react-flow__aria-live",Wc=e=>e.ariaLiveMessage,Uc=e=>e.ariaLabelConfig;function Gc({rfId:e}){const t=ee(Wc);return b.jsx("div",{id:`${Xc}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Yc,children:t})}function qc({rfId:e,disableKeyboardA11y:t}){const n=ee(Uc);return b.jsxs(b.Fragment,{children:[b.jsx("div",{id:`${ps}-${e}`,style:Qo,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),b.jsx("div",{id:`${ms}-${e}`,style:Qo,children:n["edge.a11yDescription.default"]}),!t&&b.jsx(Gc,{rfId:e})]})}const hn=x.forwardRef(({position:e="top-left",children:t,className:n,style:o,...r},s)=>{const i=`${e}`.split("-");return b.jsx("div",{className:ie(["react-flow__panel",n,...i]),style:o,ref:s,...r,children:t})});hn.displayName="Panel";function Kc({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:b.jsx(hn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:b.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Zc=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},Ut=e=>e.id;function Qc(e,t){return se(e.selectedNodes.map(Ut),t.selectedNodes.map(Ut))&&se(e.selectedEdges.map(Ut),t.selectedEdges.map(Ut))}function Jc({onSelectionChange:e}){const t=re(),{selectedNodes:n,selectedEdges:o}=ee(Zc,Qc);return x.useEffect(()=>{const r={nodes:n,edges:o};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(s=>s(r))},[n,o,e]),null}const el=e=>!!e.onSelectionChangeHandlers;function tl({onSelectionChange:e}){const t=ee(el);return e||t?b.jsx(Jc,{onSelectionChange:e}):null}const ys=[0,0],nl={x:0,y:0,zoom:1},ol=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],Jo=[...ol,"rfId"],rl=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),er={translateExtent:Dt,nodeOrigin:ys,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function sl(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:r,setTranslateExtent:s,setNodeExtent:i,reset:a,setDefaultNodesAndEdges:u,setPaneClickDistance:f}=ee(rl,se),l=re();x.useEffect(()=>(u(e.defaultNodes,e.defaultEdges),()=>{d.current=er,a()}),[]);const d=x.useRef(er);return x.useEffect(()=>{for(const c of Jo){const g=e[c],m=d.current[c];g!==m&&(typeof e[c]>"u"||(c==="nodes"?t(g):c==="edges"?n(g):c==="minZoom"?o(g):c==="maxZoom"?r(g):c==="translateExtent"?s(g):c==="nodeExtent"?i(g):c==="paneClickDistance"?f(g):c==="ariaLabelConfig"?l.setState({ariaLabelConfig:Ya(g)}):c==="fitView"?l.setState({fitViewQueued:g}):c==="fitViewOptions"?l.setState({fitViewOptions:g}):l.setState({[c]:g})))}d.current=e},Jo.map(c=>e[c])),null}function tr(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function il(e){var o;const[t,n]=x.useState(e==="system"?null:e);return x.useEffect(()=>{if(e!=="system"){n(e);return}const r=tr(),s=()=>n(r!=null&&r.matches?"dark":"light");return s(),r==null||r.addEventListener("change",s),()=>{r==null||r.removeEventListener("change",s)}},[e]),t!==null?t:(o=tr())!=null&&o.matches?"dark":"light"}const nr=typeof document<"u"?document:null;function kt(e=null,t={target:nr,actInsideInputWithModifier:!0}){const[n,o]=x.useState(!1),r=x.useRef(!1),s=x.useRef(new Set([])),[i,a]=x.useMemo(()=>{if(e!==null){const f=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=f.reduce((d,c)=>d.concat(...c),[]);return[f,l]}return[[],[]]},[e]);return x.useEffect(()=>{const u=(t==null?void 0:t.target)??nr,f=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const l=g=>{var y,v;if(r.current=g.ctrlKey||g.metaKey||g.shiftKey||g.altKey,(!r.current||r.current&&!f)&&Kr(g))return!1;const p=rr(g.code,a);if(s.current.add(g[p]),or(i,s.current,!1)){const S=((v=(y=g.composedPath)==null?void 0:y.call(g))==null?void 0:v[0])||g.target,h=(S==null?void 0:S.nodeName)==="BUTTON"||(S==null?void 0:S.nodeName)==="A";t.preventDefault!==!1&&(r.current||!h)&&g.preventDefault(),o(!0)}},d=g=>{const m=rr(g.code,a);or(i,s.current,!0)?(o(!1),s.current.clear()):s.current.delete(g[m]),g.key==="Meta"&&s.current.clear(),r.current=!1},c=()=>{s.current.clear(),o(!1)};return u==null||u.addEventListener("keydown",l),u==null||u.addEventListener("keyup",d),window.addEventListener("blur",c),window.addEventListener("contextmenu",c),()=>{u==null||u.removeEventListener("keydown",l),u==null||u.removeEventListener("keyup",d),window.removeEventListener("blur",c),window.removeEventListener("contextmenu",c)}}},[e,o]),n}function or(e,t,n){return e.filter(o=>n||o.length===t.size).some(o=>o.every(r=>t.has(r)))}function rr(e,t){return t.includes(e)?"code":"key"}const al=()=>{const e=re();return x.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,r,s],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??o,y:t.y??r,zoom:t.zoom??s},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:r,minZoom:s,maxZoom:i,panZoom:a}=e.getState(),u=ro(t,o,r,s,i,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(u,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:r,snapToGrid:s,domNode:i}=e.getState();if(!i)return t;const{x:a,y:u}=i.getBoundingClientRect(),f={x:t.x-a,y:t.y-u},l=n.snapGrid??r,d=n.snapToGrid??s;return $t(f,o,d,l)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:r,y:s}=o.getBoundingClientRect(),i=en(t,n);return{x:i.x+r,y:i.y+s}}}),[])};function xs(e,t){const n=[],o=new Map,r=[];for(const s of e)if(s.type==="add"){r.push(s);continue}else if(s.type==="remove"||s.type==="replace")o.set(s.id,[s]);else{const i=o.get(s.id);i?i.push(s):o.set(s.id,[s])}for(const s of t){const i=o.get(s.id);if(!i){n.push(s);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const a={...s};for(const u of i)cl(u,a);n.push(a)}return r.length&&r.forEach(s=>{s.index!==void 0?n.splice(s.index,0,{...s.item}):n.push({...s.item})}),n}function cl(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function vs(e,t){return xs(e,t)}function bs(e,t){return xs(e,t)}function Je(e,t){return{id:e,type:"select",selected:t}}function ct(e,t=new Set,n=!1){const o=[];for(const[r,s]of e){const i=t.has(r);!(s.selected===void 0&&!i)&&s.selected!==i&&(n&&(s.selected=i),o.push(Je(s.id,i)))}return o}function sr({items:e=[],lookup:t}){var r;const n=[],o=new Map(e.map(s=>[s.id,s]));for(const[s,i]of e.entries()){const a=t.get(i.id),u=((r=a==null?void 0:a.internals)==null?void 0:r.userNode)??a;u!==void 0&&u!==i&&n.push({id:i.id,item:i,type:"replace"}),u===void 0&&n.push({item:i,type:"add",index:s})}for(const[s]of t)o.get(s)===void 0&&n.push({id:s,type:"remove"});return n}function ir(e){return{id:e.id,type:"remove"}}const ar=e=>_a(e),ll=e=>Fr(e);function ws(e){return x.forwardRef(e)}const ul=typeof window<"u"?x.useLayoutEffect:x.useEffect;function cr(e){const[t,n]=x.useState(BigInt(0)),[o]=x.useState(()=>dl(()=>n(r=>r+BigInt(1))));return ul(()=>{const r=o.get();r.length&&(e(r),o.reset())},[t]),o}function dl(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Ss=x.createContext(null);function fl({children:e}){const t=re(),n=x.useCallback(a=>{const{nodes:u=[],setNodes:f,hasDefaultNodes:l,onNodesChange:d,nodeLookup:c,fitViewQueued:g}=t.getState();let m=u;for(const y of a)m=typeof y=="function"?y(m):y;const p=sr({items:m,lookup:c});l&&f(m),p.length>0?d==null||d(p):g&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:v,setNodes:S}=t.getState();y&&S(v)})},[]),o=cr(n),r=x.useCallback(a=>{const{edges:u=[],setEdges:f,hasDefaultEdges:l,onEdgesChange:d,edgeLookup:c}=t.getState();let g=u;for(const m of a)g=typeof m=="function"?m(g):m;l?f(g):d&&d(sr({items:g,lookup:c}))},[]),s=cr(r),i=x.useMemo(()=>({nodeQueue:o,edgeQueue:s}),[]);return b.jsx(Ss.Provider,{value:i,children:e})}function gl(){const e=x.useContext(Ss);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const hl=e=>!!e.panZoom;function uo(){const e=al(),t=re(),n=gl(),o=ee(hl),r=x.useMemo(()=>{const s=d=>t.getState().nodeLookup.get(d),i=d=>{n.nodeQueue.push(d)},a=d=>{n.edgeQueue.push(d)},u=d=>{var v,S;const{nodeLookup:c,nodeOrigin:g}=t.getState(),m=ar(d)?d:c.get(d.id),p=m.parentId?Gr(m.position,m.measured,m.parentId,c,g):m.position,y={...m,position:p,width:((v=m.measured)==null?void 0:v.width)??m.width,height:((S=m.measured)==null?void 0:S.height)??m.height};return ft(y)},f=(d,c,g={replace:!1})=>{i(m=>m.map(p=>{if(p.id===d){const y=typeof c=="function"?c(p):c;return g.replace&&ar(y)?y:{...p,...y}}return p}))},l=(d,c,g={replace:!1})=>{a(m=>m.map(p=>{if(p.id===d){const y=typeof c=="function"?c(p):c;return g.replace&&ll(y)?y:{...p,...y}}return p}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>{var c;return(c=s(d))==null?void 0:c.internals.userNode},getInternalNode:s,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(c=>({...c}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:i,setEdges:a,addNodes:d=>{const c=Array.isArray(d)?d:[d];n.nodeQueue.push(g=>[...g,...c])},addEdges:d=>{const c=Array.isArray(d)?d:[d];n.edgeQueue.push(g=>[...g,...c])},toObject:()=>{const{nodes:d=[],edges:c=[],transform:g}=t.getState(),[m,p,y]=g;return{nodes:d.map(v=>({...v})),edges:c.map(v=>({...v})),viewport:{x:m,y:p,zoom:y}}},deleteElements:async({nodes:d=[],edges:c=[]})=>{const{nodes:g,edges:m,onNodesDelete:p,onEdgesDelete:y,triggerNodeChanges:v,triggerEdgeChanges:S,onDelete:h,onBeforeDelete:w}=t.getState(),{nodes:E,edges:C}=await za({nodesToRemove:d,edgesToRemove:c,nodes:g,edges:m,onBeforeDelete:w}),M=C.length>0,N=E.length>0;if(M){const A=C.map(ir);y==null||y(C),S(A)}if(N){const A=E.map(ir);p==null||p(E),v(A)}return(N||M)&&(h==null||h({nodes:E,edges:C})),{deletedNodes:E,deletedEdges:C}},getIntersectingNodes:(d,c=!0,g)=>{const m=_o(d),p=m?d:u(d),y=g!==void 0;return p?(g||t.getState().nodes).filter(v=>{const S=t.getState().nodeLookup.get(v.id);if(S&&!m&&(v.id===d.id||!S.internals.positionAbsolute))return!1;const h=ft(y?v:S),w=At(h,p);return c&&w>0||w>=h.width*h.height||w>=p.width*p.height}):[]},isNodeIntersecting:(d,c,g=!0)=>{const p=_o(d)?d:u(d);if(!p)return!1;const y=At(p,c);return g&&y>0||y>=p.width*p.height},updateNode:f,updateNodeData:(d,c,g={replace:!1})=>{f(d,m=>{const p=typeof c=="function"?c(m):c;return g.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},g)},updateEdge:l,updateEdgeData:(d,c,g={replace:!1})=>{l(d,m=>{const p=typeof c=="function"?c(m):c;return g.replace?{...m,data:p}:{...m,data:{...m.data,...p}}},g)},getNodesBounds:d=>{const{nodeLookup:c,nodeOrigin:g}=t.getState();return La(d,{nodeLookup:c,nodeOrigin:g})},getHandleConnections:({type:d,id:c,nodeId:g})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${g}-${d}${c?`-${c}`:""}`))==null?void 0:m.values())??[])},getNodeConnections:({type:d,handleId:c,nodeId:g})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${g}${d?c?`-${d}-${c}`:`-${d}`:""}`))==null?void 0:m.values())??[])},fitView:async d=>{const c=t.getState().fitViewResolver??Va();return t.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:c}),n.nodeQueue.push(g=>[...g]),c.promise}}},[]);return x.useMemo(()=>({...r,...e,viewportInitialized:o}),[o])}const lr=e=>e.selected,pl=typeof window<"u"?window:void 0;function ml({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=re(),{deleteElements:o}=uo(),r=kt(e,{actInsideInputWithModifier:!1}),s=kt(t,{target:pl});x.useEffect(()=>{if(r){const{edges:i,nodes:a}=n.getState();o({nodes:a.filter(lr),edges:i.filter(lr)}),n.setState({nodesSelectionActive:!1})}},[r]),x.useEffect(()=>{n.setState({multiSelectionActive:s})},[s])}function yl(e){const t=re();x.useEffect(()=>{const n=()=>{var r,s;if(!e.current)return!1;const o=so(e.current);(o.height===0||o.width===0)&&((s=(r=t.getState()).onError)==null||s.call(r,"004",je.error004())),t.setState({width:o.width||500,height:o.height||500})};if(e.current){n(),window.addEventListener("resize",n);const o=new ResizeObserver(()=>n());return o.observe(e.current),()=>{window.removeEventListener("resize",n),o&&e.current&&o.unobserve(e.current)}}},[])}const pn={position:"absolute",width:"100%",height:"100%",top:0,left:0},xl=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function vl({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:r=.5,panOnScrollMode:s=et.Free,zoomOnDoubleClick:i=!0,panOnDrag:a=!0,defaultViewport:u,translateExtent:f,minZoom:l,maxZoom:d,zoomActivationKeyCode:c,preventScrolling:g=!0,children:m,noWheelClassName:p,noPanClassName:y,onViewportChange:v,isControlledViewport:S,paneClickDistance:h}){const w=re(),E=x.useRef(null),{userSelectionActive:C,lib:M}=ee(xl,se),N=kt(c),A=x.useRef();yl(E);const L=x.useCallback(D=>{v==null||v({x:D[0],y:D[1],zoom:D[2]}),S||w.setState({transform:D})},[v,S]);return x.useEffect(()=>{if(E.current){A.current=Ec({domNode:E.current,minZoom:l,maxZoom:d,translateExtent:f,viewport:u,paneClickDistance:h,onDraggingChange:j=>w.setState({paneDragging:j}),onPanZoomStart:(j,_)=>{const{onViewportChangeStart:T,onMoveStart:P}=w.getState();P==null||P(j,_),T==null||T(_)},onPanZoom:(j,_)=>{const{onViewportChange:T,onMove:P}=w.getState();P==null||P(j,_),T==null||T(_)},onPanZoomEnd:(j,_)=>{const{onViewportChangeEnd:T,onMoveEnd:P}=w.getState();P==null||P(j,_),T==null||T(_)}});const{x:D,y:R,zoom:k}=A.current.getViewport();return w.setState({panZoom:A.current,transform:[D,R,k],domNode:E.current.closest(".react-flow")}),()=>{var j;(j=A.current)==null||j.destroy()}}},[]),x.useEffect(()=>{var D;(D=A.current)==null||D.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:r,panOnScrollMode:s,zoomOnDoubleClick:i,panOnDrag:a,zoomActivationKeyPressed:N,preventScrolling:g,noPanClassName:y,userSelectionActive:C,noWheelClassName:p,lib:M,onTransformChange:L})},[e,t,n,o,r,s,i,a,N,g,y,C,p,M,L]),b.jsx("div",{className:"react-flow__renderer",ref:E,style:pn,children:m})}const bl=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function wl(){const{userSelectionActive:e,userSelectionRect:t}=ee(bl,se);return e&&t?b.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Ln=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Sl=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function El({isSelecting:e,selectionKeyPressed:t,selectionMode:n=It.Full,panOnDrag:o,selectionOnDrag:r,onSelectionStart:s,onSelectionEnd:i,onPaneClick:a,onPaneContextMenu:u,onPaneScroll:f,onPaneMouseEnter:l,onPaneMouseMove:d,onPaneMouseLeave:c,children:g}){const m=re(),{userSelectionActive:p,elementsSelectable:y,dragging:v,connectionInProgress:S}=ee(Sl,se),h=y&&(e||p),w=x.useRef(null),E=x.useRef(),C=x.useRef(new Set),M=x.useRef(new Set),N=x.useRef(!1),A=x.useRef(!1),L=P=>{if(N.current||S){N.current=!1;return}a==null||a(P),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},D=P=>{if(Array.isArray(o)&&(o!=null&&o.includes(2))){P.preventDefault();return}u==null||u(P)},R=f?P=>f(P):void 0,k=P=>{var H,V;const{resetSelectedElements:z,domNode:I}=m.getState();if(E.current=I==null?void 0:I.getBoundingClientRect(),!y||!e||P.button!==0||P.target!==w.current||!E.current)return;(V=(H=P.target)==null?void 0:H.setPointerCapture)==null||V.call(H,P.pointerId),A.current=!0,N.current=!1;const{x:$,y:O}=Pe(P.nativeEvent,E.current);z(),m.setState({userSelectionRect:{width:0,height:0,startX:$,startY:O,x:$,y:O}}),s==null||s(P)},j=P=>{const{userSelectionRect:z,transform:I,nodeLookup:$,edgeLookup:O,connectionLookup:H,triggerNodeChanges:V,triggerEdgeChanges:W,defaultEdgeOptions:Z}=m.getState();if(!E.current||!z)return;N.current=!0;const{x:G,y:Q}=Pe(P.nativeEvent,E.current),{startX:B,startY:q}=z,F={startX:B,startY:q,x:G<B?G:B,y:Q<q?Q:q,width:Math.abs(G-B),height:Math.abs(Q-q)},J=C.current,Y=M.current;C.current=new Set(oo($,F,I,n===It.Partial,!0).map(U=>U.id)),M.current=new Set;const K=(Z==null?void 0:Z.selectable)??!0;for(const U of C.current){const te=H.get(U);if(te)for(const{edgeId:oe}of te.values()){const xe=O.get(oe);xe&&(xe.selectable??K)&&M.current.add(oe)}}if(!Lo(J,C.current)){const U=ct($,C.current,!0);V(U)}if(!Lo(Y,M.current)){const U=ct(O,M.current);W(U)}m.setState({userSelectionRect:F,userSelectionActive:!0,nodesSelectionActive:!1})},_=P=>{var I,$;if(P.button!==0||!A.current)return;($=(I=P.target)==null?void 0:I.releasePointerCapture)==null||$.call(I,P.pointerId);const{userSelectionRect:z}=m.getState();!p&&z&&P.target===w.current&&(L==null||L(P)),m.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:C.current.size>0}),i==null||i(P),(t||r)&&(N.current=!1),A.current=!1},T=o===!0||Array.isArray(o)&&o.includes(0);return b.jsxs("div",{className:ie(["react-flow__pane",{draggable:T,dragging:v,selection:e}]),onClick:h?void 0:Ln(L,w),onContextMenu:Ln(D,w),onWheel:Ln(R,w),onPointerEnter:h?void 0:l,onPointerDown:h?k:d,onPointerMove:h?j:d,onPointerUp:h?_:void 0,onPointerLeave:c,ref:w,style:pn,children:[g,b.jsx(wl,{})]})}function qn({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:r,unselectNodesAndEdges:s,multiSelectionActive:i,nodeLookup:a,onError:u}=t.getState(),f=a.get(e);if(!f){u==null||u("012",je.error012(e));return}t.setState({nodesSelectionActive:!1}),f.selected?(n||f.selected&&i)&&(s({nodes:[f],edges:[]}),requestAnimationFrame(()=>{var l;return(l=o==null?void 0:o.current)==null?void 0:l.blur()})):r([e])}function Es({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:r,isSelectable:s,nodeClickDistance:i}){const a=re(),[u,f]=x.useState(!1),l=x.useRef();return x.useEffect(()=>{l.current=cc({getStoreItems:()=>a.getState(),onNodeMouseDown:d=>{qn({id:d,store:a,nodeRef:e})},onDragStart:()=>{f(!0)},onDragStop:()=>{f(!1)}})},[]),x.useEffect(()=>{var d,c;if(t)(d=l.current)==null||d.destroy();else if(e.current)return(c=l.current)==null||c.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:s,nodeId:r,nodeClickDistance:i}),()=>{var g;(g=l.current)==null||g.destroy()}},[n,o,t,s,e,r]),u}const Cl=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Cs(){const e=re();return x.useCallback(n=>{const{nodeExtent:o,snapToGrid:r,snapGrid:s,nodesDraggable:i,onError:a,updateNodePositions:u,nodeLookup:f,nodeOrigin:l}=e.getState(),d=new Map,c=Cl(i),g=r?s[0]:5,m=r?s[1]:5,p=n.direction.x*g*n.factor,y=n.direction.y*m*n.factor;for(const[,v]of f){if(!c(v))continue;let S={x:v.internals.positionAbsolute.x+p,y:v.internals.positionAbsolute.y+y};r&&(S=dn(S,s));const{position:h,positionAbsolute:w}=Vr({nodeId:v.id,nextPosition:S,nodeLookup:f,nodeExtent:o,nodeOrigin:l,onError:a});v.position=h,v.internals.positionAbsolute=w,d.set(v.id,v)}u(d)},[])}const fo=x.createContext(null),Ml=fo.Provider;fo.Consumer;const Ms=()=>x.useContext(fo),Nl=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Dl=(e,t,n)=>o=>{const{connectionClickStartHandle:r,connectionMode:s,connection:i}=o,{fromHandle:a,toHandle:u,isValid:f}=i,l=(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===t&&(u==null?void 0:u.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:l,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:s===ut.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!r,valid:l&&f}};function Il({type:e="source",position:t=X.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:r=!0,isConnectableEnd:s=!0,id:i,onConnect:a,children:u,className:f,onMouseDown:l,onTouchStart:d,...c},g){var _,T;const m=i||null,p=e==="target",y=re(),v=Ms(),{connectOnClick:S,noPanClassName:h,rfId:w}=ee(Nl,se),{connectingFrom:E,connectingTo:C,clickConnecting:M,isPossibleEndHandle:N,connectionInProcess:A,clickConnectionInProcess:L,valid:D}=ee(Dl(v,m,e),se);v||(T=(_=y.getState()).onError)==null||T.call(_,"010",je.error010());const R=P=>{const{defaultEdgeOptions:z,onConnect:I,hasDefaultEdges:$}=y.getState(),O={...z,...P};if($){const{edges:H,setEdges:V}=y.getState();V(ts(O,H))}I==null||I(O),a==null||a(O)},k=P=>{if(!v)return;const z=Zr(P.nativeEvent);if(r&&(z&&P.button===0||!z)){const I=y.getState();Gn.onPointerDown(P.nativeEvent,{autoPanOnConnect:I.autoPanOnConnect,connectionMode:I.connectionMode,connectionRadius:I.connectionRadius,domNode:I.domNode,nodeLookup:I.nodeLookup,lib:I.lib,isTarget:p,handleId:m,nodeId:v,flowId:I.rfId,panBy:I.panBy,cancelConnection:I.cancelConnection,onConnectStart:I.onConnectStart,onConnectEnd:I.onConnectEnd,updateConnection:I.updateConnection,onConnect:R,isValidConnection:n||I.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:I.autoPanSpeed,dragThreshold:I.connectionDragThreshold})}z?l==null||l(P):d==null||d(P)},j=P=>{const{onClickConnectStart:z,onClickConnectEnd:I,connectionClickStartHandle:$,connectionMode:O,isValidConnection:H,lib:V,rfId:W,nodeLookup:Z,connection:G}=y.getState();if(!v||!$&&!r)return;if(!$){z==null||z(P.nativeEvent,{nodeId:v,handleId:m,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:v,type:e,id:m}});return}const Q=qr(P.target),B=n||H,{connection:q,isValid:F}=Gn.isValid(P.nativeEvent,{handle:{nodeId:v,id:m,type:e},connectionMode:O,fromNodeId:$.nodeId,fromHandleId:$.id||null,fromType:$.type,isValidConnection:B,flowId:W,doc:Q,lib:V,nodeLookup:Z});F&&q&&R(q);const J=structuredClone(G);delete J.inProgress,J.toPosition=J.toHandle?J.toHandle.position:null,I==null||I(P,J),y.setState({connectionClickStartHandle:null})};return b.jsx("div",{"data-handleid":m,"data-nodeid":v,"data-handlepos":t,"data-id":`${w}-${v}-${m}-${e}`,className:ie(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",h,f,{source:!p,target:p,connectable:o,connectablestart:r,connectableend:s,clickconnecting:M,connectingfrom:E,connectingto:C,valid:D,connectionindicator:o&&(!A||N)&&(A||L?s:r)}]),onMouseDown:k,onTouchStart:k,onClick:S?j:void 0,ref:g,...c,children:u})}const Oe=x.memo(ws(Il));function Al({data:e,isConnectable:t,sourcePosition:n=X.Bottom}){return b.jsxs(b.Fragment,{children:[e==null?void 0:e.label,b.jsx(Oe,{type:"source",position:n,isConnectable:t})]})}function Rl({data:e,isConnectable:t,targetPosition:n=X.Top,sourcePosition:o=X.Bottom}){return b.jsxs(b.Fragment,{children:[b.jsx(Oe,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,b.jsx(Oe,{type:"source",position:o,isConnectable:t})]})}function kl(){return null}function Pl({data:e,isConnectable:t,targetPosition:n=X.Top}){return b.jsxs(b.Fragment,{children:[b.jsx(Oe,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const nn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},ur={input:Al,default:Rl,output:Pl,group:kl};function jl(e){var t,n,o,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((o=e.style)==null?void 0:o.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const _l=e=>{const{width:t,height:n,x:o,y:r}=Tt(e.nodeLookup,{filter:s=>!!s.selected});return{width:Ne(t)?t:null,height:Ne(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${r}px)`}};function Ll({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=re(),{width:r,height:s,transformString:i,userSelectionActive:a}=ee(_l,se),u=Cs(),f=x.useRef(null);if(x.useEffect(()=>{var c;n||(c=f.current)==null||c.focus({preventScroll:!0})},[n]),Es({nodeRef:f}),a||!r||!s)return null;const l=e?c=>{const g=o.getState().nodes.filter(m=>m.selected);e(c,g)}:void 0,d=c=>{Object.prototype.hasOwnProperty.call(nn,c.key)&&(c.preventDefault(),u({direction:nn[c.key],factor:c.shiftKey?4:1}))};return b.jsx("div",{className:ie(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:b.jsx("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:r,height:s}})})}const dr=typeof window<"u"?window:void 0,Tl=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Ns({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:s,onPaneScroll:i,paneClickDistance:a,deleteKeyCode:u,selectionKeyCode:f,selectionOnDrag:l,selectionMode:d,onSelectionStart:c,onSelectionEnd:g,multiSelectionKeyCode:m,panActivationKeyCode:p,zoomActivationKeyCode:y,elementsSelectable:v,zoomOnScroll:S,zoomOnPinch:h,panOnScroll:w,panOnScrollSpeed:E,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:N,defaultViewport:A,translateExtent:L,minZoom:D,maxZoom:R,preventScrolling:k,onSelectionContextMenu:j,noWheelClassName:_,noPanClassName:T,disableKeyboardA11y:P,onViewportChange:z,isControlledViewport:I}){const{nodesSelectionActive:$,userSelectionActive:O}=ee(Tl),H=kt(f,{target:dr}),V=kt(p,{target:dr}),W=V||N,Z=V||w,G=l&&W!==!0,Q=H||O||G;return ml({deleteKeyCode:u,multiSelectionKeyCode:m}),b.jsx(vl,{onPaneContextMenu:s,elementsSelectable:v,zoomOnScroll:S,zoomOnPinch:h,panOnScroll:Z,panOnScrollSpeed:E,panOnScrollMode:C,zoomOnDoubleClick:M,panOnDrag:!H&&W,defaultViewport:A,translateExtent:L,minZoom:D,maxZoom:R,zoomActivationKeyCode:y,preventScrolling:k,noWheelClassName:_,noPanClassName:T,onViewportChange:z,isControlledViewport:I,paneClickDistance:a,children:b.jsxs(El,{onSelectionStart:c,onSelectionEnd:g,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:s,onPaneScroll:i,panOnDrag:W,isSelecting:!!Q,selectionMode:d,selectionKeyPressed:H,selectionOnDrag:G,children:[e,$&&b.jsx(Ll,{onSelectionContextMenu:j,noPanClassName:T,disableKeyboardA11y:P})]})})}Ns.displayName="FlowRenderer";const $l=x.memo(Ns),Ol=e=>t=>e?oo(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function zl(e){return ee(x.useCallback(Ol(e),[e]),se)}const Hl=e=>e.updateNodeInternals;function Bl(){const e=ee(Hl),[t]=x.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const o=new Map;n.forEach(r=>{const s=r.target.getAttribute("data-id");o.set(s,{id:s,nodeElement:r.target,force:!0})}),e(o)}));return x.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function Fl({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const r=re(),s=x.useRef(null),i=x.useRef(null),a=x.useRef(e.sourcePosition),u=x.useRef(e.targetPosition),f=x.useRef(t),l=n&&!!e.internals.handleBounds;return x.useEffect(()=>{s.current&&!e.hidden&&(!l||i.current!==s.current)&&(i.current&&(o==null||o.unobserve(i.current)),o==null||o.observe(s.current),i.current=s.current)},[l,e.hidden]),x.useEffect(()=>()=>{i.current&&(o==null||o.unobserve(i.current),i.current=null)},[]),x.useEffect(()=>{if(s.current){const d=f.current!==t,c=a.current!==e.sourcePosition,g=u.current!==e.targetPosition;(d||c||g)&&(f.current=t,a.current=e.sourcePosition,u.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:s.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),s}function Vl({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:r,onContextMenu:s,onDoubleClick:i,nodesDraggable:a,elementsSelectable:u,nodesConnectable:f,nodesFocusable:l,resizeObserver:d,noDragClassName:c,noPanClassName:g,disableKeyboardA11y:m,rfId:p,nodeTypes:y,nodeClickDistance:v,onError:S}){const{node:h,internals:w,isParent:E}=ee(B=>{const q=B.nodeLookup.get(e),F=B.parentLookup.has(e);return{node:q,internals:q.internals,isParent:F}},se);let C=h.type||"default",M=(y==null?void 0:y[C])||ur[C];M===void 0&&(S==null||S("003",je.error003(C)),C="default",M=(y==null?void 0:y.default)||ur.default);const N=!!(h.draggable||a&&typeof h.draggable>"u"),A=!!(h.selectable||u&&typeof h.selectable>"u"),L=!!(h.connectable||f&&typeof h.connectable>"u"),D=!!(h.focusable||l&&typeof h.focusable>"u"),R=re(),k=Ur(h),j=Fl({node:h,nodeType:C,hasDimensions:k,resizeObserver:d}),_=Es({nodeRef:j,disabled:h.hidden||!N,noDragClassName:c,handleSelector:h.dragHandle,nodeId:e,isSelectable:A,nodeClickDistance:v}),T=Cs();if(h.hidden)return null;const P=ze(h),z=jl(h),I=A||N||t||n||o||r,$=n?B=>n(B,{...w.userNode}):void 0,O=o?B=>o(B,{...w.userNode}):void 0,H=r?B=>r(B,{...w.userNode}):void 0,V=s?B=>s(B,{...w.userNode}):void 0,W=i?B=>i(B,{...w.userNode}):void 0,Z=B=>{const{selectNodesOnDrag:q,nodeDragThreshold:F}=R.getState();A&&(!q||!N||F>0)&&qn({id:e,store:R,nodeRef:j}),t&&t(B,{...w.userNode})},G=B=>{if(!(Kr(B.nativeEvent)||m)){if(Or.includes(B.key)&&A){const q=B.key==="Escape";qn({id:e,store:R,unselect:q,nodeRef:j})}else if(N&&h.selected&&Object.prototype.hasOwnProperty.call(nn,B.key)){B.preventDefault();const{ariaLabelConfig:q}=R.getState();R.setState({ariaLiveMessage:q["node.a11yDescription.ariaLiveMessage"]({direction:B.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),T({direction:nn[B.key],factor:B.shiftKey?4:1})}}},Q=()=>{var U;if(m||!((U=j.current)!=null&&U.matches(":focus-visible")))return;const{transform:B,width:q,height:F,autoPanOnNodeFocus:J,setCenter:Y}=R.getState();if(!J)return;oo(new Map([[e,h]]),{x:0,y:0,width:q,height:F},B,!0).length>0||Y(h.position.x+P.width/2,h.position.y+P.height/2,{zoom:B[2]})};return b.jsx("div",{className:ie(["react-flow__node",`react-flow__node-${C}`,{[g]:N},h.className,{selected:h.selected,selectable:A,parent:E,draggable:N,dragging:_}]),ref:j,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:I?"all":"none",visibility:k?"visible":"hidden",...h.style,...z},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:$,onMouseMove:O,onMouseLeave:H,onContextMenu:V,onClick:Z,onDoubleClick:W,onKeyDown:D?G:void 0,tabIndex:D?0:void 0,onFocus:D?Q:void 0,role:h.ariaRole??(D?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${ps}-${p}`,"aria-label":h.ariaLabel,...h.domAttributes,children:b.jsx(Ml,{value:e,children:b.jsx(M,{id:e,data:h.data,type:C,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:h.selected??!1,selectable:A,draggable:N,deletable:h.deletable??!0,isConnectable:L,sourcePosition:h.sourcePosition,targetPosition:h.targetPosition,dragging:_,dragHandle:h.dragHandle,zIndex:w.z,parentId:h.parentId,...P})})})}const Yl=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Ds(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,onError:s}=ee(Yl,se),i=zl(e.onlyRenderVisibleElements),a=Bl();return b.jsx("div",{className:"react-flow__nodes",style:pn,children:i.map(u=>b.jsx(Vl,{id:u,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:s},u))})}Ds.displayName="NodeRenderer";const Xl=x.memo(Ds);function Wl(e){return ee(x.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const o=[];if(n.width&&n.height)for(const r of n.edges){const s=n.nodeLookup.get(r.source),i=n.nodeLookup.get(r.target);s&&i&&Ua({sourceNode:s,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&o.push(r.id)}return o},[e]),se)}const Ul=({color:e="none",strokeWidth:t=1})=>b.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),Gl=({color:e="none",strokeWidth:t=1})=>b.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),fr={[Qt.Arrow]:Ul,[Qt.ArrowClosed]:Gl};function ql(e){const t=re();return x.useMemo(()=>{var r,s;return Object.prototype.hasOwnProperty.call(fr,e)?fr[e]:((s=(r=t.getState()).onError)==null||s.call(r,"009",je.error009(e)),null)},[e])}const Kl=({id:e,type:t,color:n,width:o=12.5,height:r=12.5,markerUnits:s="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const u=ql(t);return u?b.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0",children:b.jsx(u,{color:n,strokeWidth:i})}):null},Is=({defaultColor:e,rfId:t})=>{const n=ee(s=>s.edges),o=ee(s=>s.defaultEdgeOptions),r=x.useMemo(()=>ec(n,{id:t,defaultColor:e,defaultMarkerStart:o==null?void 0:o.markerStart,defaultMarkerEnd:o==null?void 0:o.markerEnd}),[n,o,t,e]);return r.length?b.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:b.jsx("defs",{children:r.map(s=>b.jsx(Kl,{id:s.id,type:s.type,color:s.color,width:s.width,height:s.height,markerUnits:s.markerUnits,strokeWidth:s.strokeWidth,orient:s.orient},s.id))})}):null};Is.displayName="MarkerDefinitions";var Zl=x.memo(Is);function As({x:e,y:t,label:n,labelStyle:o,labelShowBg:r=!0,labelBgStyle:s,labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:u,className:f,...l}){const[d,c]=x.useState({x:1,y:0,width:0,height:0}),g=ie(["react-flow__edge-textwrapper",f]),m=x.useRef(null);return x.useEffect(()=>{if(m.current){const p=m.current.getBBox();c({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?b.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:g,visibility:d.width?"visible":"hidden",...l,children:[r&&b.jsx("rect",{width:d.width+2*i[0],x:-i[0],y:-i[1],height:d.height+2*i[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),b.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:m,style:o,children:n}),u]}):null}As.displayName="EdgeText";const Ql=x.memo(As);function mn({path:e,labelX:t,labelY:n,label:o,labelStyle:r,labelShowBg:s,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:u,interactionWidth:f=20,...l}){return b.jsxs(b.Fragment,{children:[b.jsx("path",{...l,d:e,fill:"none",className:ie(["react-flow__edge-path",l.className])}),f&&b.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),o&&Ne(t)&&Ne(n)?b.jsx(Ql,{x:t,y:n,label:o,labelStyle:r,labelShowBg:s,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:u}):null]})}function gr({pos:e,x1:t,y1:n,x2:o,y2:r}){return e===X.Left||e===X.Right?[.5*(t+o),n]:[t,.5*(n+r)]}function Rs({sourceX:e,sourceY:t,sourcePosition:n=X.Bottom,targetX:o,targetY:r,targetPosition:s=X.Top}){const[i,a]=gr({pos:n,x1:e,y1:t,x2:o,y2:r}),[u,f]=gr({pos:s,x1:o,y1:r,x2:e,y2:t}),[l,d,c,g]=Qr({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:i,sourceControlY:a,targetControlX:u,targetControlY:f});return[`M${e},${t} C${i},${a} ${u},${f} ${o},${r}`,l,d,c,g]}function ks(e){return x.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,sourcePosition:i,targetPosition:a,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:m,markerEnd:p,markerStart:y,interactionWidth:v})=>{const[S,h,w]=Rs({sourceX:n,sourceY:o,sourcePosition:i,targetX:r,targetY:s,targetPosition:a}),E=e.isInternal?void 0:t;return b.jsx(mn,{id:E,path:S,labelX:h,labelY:w,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:m,markerEnd:p,markerStart:y,interactionWidth:v})})}const Jl=ks({isInternal:!1}),Ps=ks({isInternal:!0});Jl.displayName="SimpleBezierEdge";Ps.displayName="SimpleBezierEdgeInternal";function js(e){return x.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,sourcePosition:g=X.Bottom,targetPosition:m=X.Top,markerEnd:p,markerStart:y,pathOptions:v,interactionWidth:S})=>{const[h,w,E]=Xn({sourceX:n,sourceY:o,sourcePosition:g,targetX:r,targetY:s,targetPosition:m,borderRadius:v==null?void 0:v.borderRadius,offset:v==null?void 0:v.offset,stepPosition:v==null?void 0:v.stepPosition}),C=e.isInternal?void 0:t;return b.jsx(mn,{id:C,path:h,labelX:w,labelY:E,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,markerEnd:p,markerStart:y,interactionWidth:S})})}const _s=js({isInternal:!1}),Ls=js({isInternal:!0});_s.displayName="SmoothStepEdge";Ls.displayName="SmoothStepEdgeInternal";function Ts(e){return x.memo(({id:t,...n})=>{var r;const o=e.isInternal?void 0:t;return b.jsx(_s,{...n,id:o,pathOptions:x.useMemo(()=>{var s;return{borderRadius:0,offset:(s=n.pathOptions)==null?void 0:s.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const eu=Ts({isInternal:!1}),$s=Ts({isInternal:!0});eu.displayName="StepEdge";$s.displayName="StepEdgeInternal";function Os(e){return x.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,markerEnd:g,markerStart:m,interactionWidth:p})=>{const[y,v,S]=ns({sourceX:n,sourceY:o,targetX:r,targetY:s}),h=e.isInternal?void 0:t;return b.jsx(mn,{id:h,path:y,labelX:v,labelY:S,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,markerEnd:g,markerStart:m,interactionWidth:p})})}const tu=Os({isInternal:!1}),zs=Os({isInternal:!0});tu.displayName="StraightEdge";zs.displayName="StraightEdgeInternal";function Hs(e){return x.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,sourcePosition:i=X.Bottom,targetPosition:a=X.Top,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:m,markerEnd:p,markerStart:y,pathOptions:v,interactionWidth:S})=>{const[h,w,E]=Jr({sourceX:n,sourceY:o,sourcePosition:i,targetX:r,targetY:s,targetPosition:a,curvature:v==null?void 0:v.curvature}),C=e.isInternal?void 0:t;return b.jsx(mn,{id:C,path:h,labelX:w,labelY:E,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:m,markerEnd:p,markerStart:y,interactionWidth:S})})}const nu=Hs({isInternal:!1}),Bs=Hs({isInternal:!0});nu.displayName="BezierEdge";Bs.displayName="BezierEdgeInternal";const hr={default:Bs,straight:zs,step:$s,smoothstep:Ls,simplebezier:Ps},pr={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},ou=(e,t,n)=>n===X.Left?e-t:n===X.Right?e+t:e,ru=(e,t,n)=>n===X.Top?e-t:n===X.Bottom?e+t:e,mr="react-flow__edgeupdater";function yr({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:r,onMouseEnter:s,onMouseOut:i,type:a}){return b.jsx("circle",{onMouseDown:r,onMouseEnter:s,onMouseOut:i,className:ie([mr,`${mr}-${a}`]),cx:ou(t,o,e),cy:ru(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function su({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:r,targetX:s,targetY:i,sourcePosition:a,targetPosition:u,onReconnect:f,onReconnectStart:l,onReconnectEnd:d,setReconnecting:c,setUpdateHover:g}){const m=re(),p=(w,E)=>{if(w.button!==0)return;const{autoPanOnConnect:C,domNode:M,isValidConnection:N,connectionMode:A,connectionRadius:L,lib:D,onConnectStart:R,onConnectEnd:k,cancelConnection:j,nodeLookup:_,rfId:T,panBy:P,updateConnection:z}=m.getState(),I=E.type==="target",$=(V,W)=>{c(!1),d==null||d(V,n,E.type,W)},O=V=>f==null?void 0:f(n,V),H=(V,W)=>{c(!0),l==null||l(w,n,E.type),R==null||R(V,W)};Gn.onPointerDown(w.nativeEvent,{autoPanOnConnect:C,connectionMode:A,connectionRadius:L,domNode:M,handleId:E.id,nodeId:E.nodeId,nodeLookup:_,isTarget:I,edgeUpdaterType:E.type,lib:D,flowId:T,cancelConnection:j,panBy:P,isValidConnection:N,onConnect:O,onConnectStart:H,onConnectEnd:k,onReconnectEnd:$,updateConnection:z,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold})},y=w=>p(w,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),v=w=>p(w,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),S=()=>g(!0),h=()=>g(!1);return b.jsxs(b.Fragment,{children:[(e===!0||e==="source")&&b.jsx(yr,{position:a,centerX:o,centerY:r,radius:t,onMouseDown:y,onMouseEnter:S,onMouseOut:h,type:"source"}),(e===!0||e==="target")&&b.jsx(yr,{position:u,centerX:s,centerY:i,radius:t,onMouseDown:v,onMouseEnter:S,onMouseOut:h,type:"target"})]})}function iu({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:r,onDoubleClick:s,onContextMenu:i,onMouseEnter:a,onMouseMove:u,onMouseLeave:f,reconnectRadius:l,onReconnect:d,onReconnectStart:c,onReconnectEnd:g,rfId:m,edgeTypes:p,noPanClassName:y,onError:v,disableKeyboardA11y:S}){let h=ee(Y=>Y.edgeLookup.get(e));const w=ee(Y=>Y.defaultEdgeOptions);h=w?{...w,...h}:h;let E=h.type||"default",C=(p==null?void 0:p[E])||hr[E];C===void 0&&(v==null||v("011",je.error011(E)),E="default",C=(p==null?void 0:p.default)||hr.default);const M=!!(h.focusable||t&&typeof h.focusable>"u"),N=typeof d<"u"&&(h.reconnectable||n&&typeof h.reconnectable>"u"),A=!!(h.selectable||o&&typeof h.selectable>"u"),L=x.useRef(null),[D,R]=x.useState(!1),[k,j]=x.useState(!1),_=re(),{zIndex:T,sourceX:P,sourceY:z,targetX:I,targetY:$,sourcePosition:O,targetPosition:H}=ee(x.useCallback(Y=>{const K=Y.nodeLookup.get(h.source),U=Y.nodeLookup.get(h.target);if(!K||!U)return{zIndex:h.zIndex,...pr};const te=Ja({id:e,sourceNode:K,targetNode:U,sourceHandle:h.sourceHandle||null,targetHandle:h.targetHandle||null,connectionMode:Y.connectionMode,onError:v});return{zIndex:Wa({selected:h.selected,zIndex:h.zIndex,sourceNode:K,targetNode:U,elevateOnSelect:Y.elevateEdgesOnSelect}),...te||pr}},[h.source,h.target,h.sourceHandle,h.targetHandle,h.selected,h.zIndex]),se),V=x.useMemo(()=>h.markerStart?`url('#${Wn(h.markerStart,m)}')`:void 0,[h.markerStart,m]),W=x.useMemo(()=>h.markerEnd?`url('#${Wn(h.markerEnd,m)}')`:void 0,[h.markerEnd,m]);if(h.hidden||P===null||z===null||I===null||$===null)return null;const Z=Y=>{var oe;const{addSelectedEdges:K,unselectNodesAndEdges:U,multiSelectionActive:te}=_.getState();A&&(_.setState({nodesSelectionActive:!1}),h.selected&&te?(U({nodes:[],edges:[h]}),(oe=L.current)==null||oe.blur()):K([e])),r&&r(Y,h)},G=s?Y=>{s(Y,{...h})}:void 0,Q=i?Y=>{i(Y,{...h})}:void 0,B=a?Y=>{a(Y,{...h})}:void 0,q=u?Y=>{u(Y,{...h})}:void 0,F=f?Y=>{f(Y,{...h})}:void 0,J=Y=>{var K;if(!S&&Or.includes(Y.key)&&A){const{unselectNodesAndEdges:U,addSelectedEdges:te}=_.getState();Y.key==="Escape"?((K=L.current)==null||K.blur(),U({edges:[h]})):te([e])}};return b.jsx("svg",{style:{zIndex:T},children:b.jsxs("g",{className:ie(["react-flow__edge",`react-flow__edge-${E}`,h.className,y,{selected:h.selected,animated:h.animated,inactive:!A&&!r,updating:D,selectable:A}]),onClick:Z,onDoubleClick:G,onContextMenu:Q,onMouseEnter:B,onMouseMove:q,onMouseLeave:F,onKeyDown:M?J:void 0,tabIndex:M?0:void 0,role:h.ariaRole??(M?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":h.ariaLabel===null?void 0:h.ariaLabel||`Edge from ${h.source} to ${h.target}`,"aria-describedby":M?`${ms}-${m}`:void 0,ref:L,...h.domAttributes,children:[!k&&b.jsx(C,{id:e,source:h.source,target:h.target,type:h.type,selected:h.selected,animated:h.animated,selectable:A,deletable:h.deletable??!0,label:h.label,labelStyle:h.labelStyle,labelShowBg:h.labelShowBg,labelBgStyle:h.labelBgStyle,labelBgPadding:h.labelBgPadding,labelBgBorderRadius:h.labelBgBorderRadius,sourceX:P,sourceY:z,targetX:I,targetY:$,sourcePosition:O,targetPosition:H,data:h.data,style:h.style,sourceHandleId:h.sourceHandle,targetHandleId:h.targetHandle,markerStart:V,markerEnd:W,pathOptions:"pathOptions"in h?h.pathOptions:void 0,interactionWidth:h.interactionWidth}),N&&b.jsx(su,{edge:h,isReconnectable:N,reconnectRadius:l,onReconnect:d,onReconnectStart:c,onReconnectEnd:g,sourceX:P,sourceY:z,targetX:I,targetY:$,sourcePosition:O,targetPosition:H,setUpdateHover:R,setReconnecting:j})]})})}const au=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function Fs({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:r,onReconnect:s,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:u,onEdgeMouseLeave:f,onEdgeClick:l,reconnectRadius:d,onEdgeDoubleClick:c,onReconnectStart:g,onReconnectEnd:m,disableKeyboardA11y:p}){const{edgesFocusable:y,edgesReconnectable:v,elementsSelectable:S,onError:h}=ee(au,se),w=Wl(t);return b.jsxs("div",{className:"react-flow__edges",children:[b.jsx(Zl,{defaultColor:e,rfId:n}),w.map(E=>b.jsx(iu,{id:E,edgesFocusable:y,edgesReconnectable:v,elementsSelectable:S,noPanClassName:r,onReconnect:s,onContextMenu:i,onMouseEnter:a,onMouseMove:u,onMouseLeave:f,onClick:l,reconnectRadius:d,onDoubleClick:c,onReconnectStart:g,onReconnectEnd:m,rfId:n,onError:h,edgeTypes:o,disableKeyboardA11y:p},E))]})}Fs.displayName="EdgeRenderer";const cu=x.memo(Fs),lu=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function uu({children:e}){const t=ee(lu);return b.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function du(e){const t=uo(),n=x.useRef(!1);x.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const fu=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function gu(e){const t=ee(fu),n=re();return x.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function hu(e){return e.connection.inProgress?{...e.connection,to:$t(e.connection.to,e.transform)}:{...e.connection}}function pu(e){return hu}function mu(e){const t=pu();return ee(t,se)}const yu=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function xu({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:r,width:s,height:i,isValid:a,inProgress:u}=ee(yu,se);return!(s&&r&&u)?null:b.jsx("svg",{style:e,width:s,height:i,className:"react-flow__connectionline react-flow__container",children:b.jsx("g",{className:ie(["react-flow__connection",Br(a)]),children:b.jsx(Vs,{style:t,type:n,CustomComponent:o,isValid:a})})})}const Vs=({style:e,type:t=Ue.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:r,from:s,fromNode:i,fromHandle:a,fromPosition:u,to:f,toNode:l,toHandle:d,toPosition:c}=mu();if(!r)return;if(n)return b.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:a,fromX:s.x,fromY:s.y,toX:f.x,toY:f.y,fromPosition:u,toPosition:c,connectionStatus:Br(o),toNode:l,toHandle:d});let g="";const m={sourceX:s.x,sourceY:s.y,sourcePosition:u,targetX:f.x,targetY:f.y,targetPosition:c};switch(t){case Ue.Bezier:[g]=Jr(m);break;case Ue.SimpleBezier:[g]=Rs(m);break;case Ue.Step:[g]=Xn({...m,borderRadius:0});break;case Ue.SmoothStep:[g]=Xn(m);break;default:[g]=ns(m)}return b.jsx("path",{d:g,fill:"none",className:"react-flow__connection-path",style:e})};Vs.displayName="ConnectionLine";const vu={};function xr(e=vu){x.useRef(e),re(),x.useEffect(()=>{},[e])}function bu(){re(),x.useRef(!1),x.useEffect(()=>{},[])}function Ys({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:r,onNodeDoubleClick:s,onEdgeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:u,onNodeMouseLeave:f,onNodeContextMenu:l,onSelectionContextMenu:d,onSelectionStart:c,onSelectionEnd:g,connectionLineType:m,connectionLineStyle:p,connectionLineComponent:y,connectionLineContainerStyle:v,selectionKeyCode:S,selectionOnDrag:h,selectionMode:w,multiSelectionKeyCode:E,panActivationKeyCode:C,zoomActivationKeyCode:M,deleteKeyCode:N,onlyRenderVisibleElements:A,elementsSelectable:L,defaultViewport:D,translateExtent:R,minZoom:k,maxZoom:j,preventScrolling:_,defaultMarkerColor:T,zoomOnScroll:P,zoomOnPinch:z,panOnScroll:I,panOnScrollSpeed:$,panOnScrollMode:O,zoomOnDoubleClick:H,panOnDrag:V,onPaneClick:W,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:Q,onPaneScroll:B,onPaneContextMenu:q,paneClickDistance:F,nodeClickDistance:J,onEdgeContextMenu:Y,onEdgeMouseEnter:K,onEdgeMouseMove:U,onEdgeMouseLeave:te,reconnectRadius:oe,onReconnect:xe,onReconnectStart:Le,onReconnectEnd:He,noDragClassName:ye,noWheelClassName:Te,noPanClassName:Ie,disableKeyboardA11y:Be,nodeExtent:ot,rfId:rt,viewport:Fe,onViewportChange:ve}){return xr(e),xr(t),bu(),du(n),gu(Fe),b.jsx($l,{onPaneClick:W,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:Q,onPaneContextMenu:q,onPaneScroll:B,paneClickDistance:F,deleteKeyCode:N,selectionKeyCode:S,selectionOnDrag:h,selectionMode:w,onSelectionStart:c,onSelectionEnd:g,multiSelectionKeyCode:E,panActivationKeyCode:C,zoomActivationKeyCode:M,elementsSelectable:L,zoomOnScroll:P,zoomOnPinch:z,zoomOnDoubleClick:H,panOnScroll:I,panOnScrollSpeed:$,panOnScrollMode:O,panOnDrag:V,defaultViewport:D,translateExtent:R,minZoom:k,maxZoom:j,onSelectionContextMenu:d,preventScrolling:_,noDragClassName:ye,noWheelClassName:Te,noPanClassName:Ie,disableKeyboardA11y:Be,onViewportChange:ve,isControlledViewport:!!Fe,children:b.jsxs(uu,{children:[b.jsx(cu,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:i,onReconnect:xe,onReconnectStart:Le,onReconnectEnd:He,onlyRenderVisibleElements:A,onEdgeContextMenu:Y,onEdgeMouseEnter:K,onEdgeMouseMove:U,onEdgeMouseLeave:te,reconnectRadius:oe,defaultMarkerColor:T,noPanClassName:Ie,disableKeyboardA11y:Be,rfId:rt}),b.jsx(xu,{style:p,type:m,component:y,containerStyle:v}),b.jsx("div",{className:"react-flow__edgelabel-renderer"}),b.jsx(Xl,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:u,onNodeMouseLeave:f,onNodeContextMenu:l,nodeClickDistance:J,onlyRenderVisibleElements:A,noPanClassName:Ie,noDragClassName:ye,disableKeyboardA11y:Be,nodeExtent:ot,rfId:rt}),b.jsx("div",{className:"react-flow__viewport-portal"})]})})}Ys.displayName="GraphView";const wu=x.memo(Ys),vr=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:s,fitView:i,fitViewOptions:a,minZoom:u=.5,maxZoom:f=2,nodeOrigin:l,nodeExtent:d}={})=>{const c=new Map,g=new Map,m=new Map,p=new Map,y=o??t??[],v=n??e??[],S=l??[0,0],h=d??Dt;rs(m,p,y);const w=Un(v,c,g,{nodeOrigin:S,nodeExtent:h,elevateNodesOnSelect:!1});let E=[0,0,1];if(i&&r&&s){const C=Tt(c,{filter:L=>!!((L.width||L.initialWidth)&&(L.height||L.initialHeight))}),{x:M,y:N,zoom:A}=ro(C,r,s,u,f,(a==null?void 0:a.padding)??.1);E=[M,N,A]}return{rfId:"1",width:0,height:0,transform:E,nodes:v,nodesInitialized:w,nodeLookup:c,parentLookup:g,edges:y,edgeLookup:p,connectionLookup:m,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:o!==void 0,panZoom:null,minZoom:u,maxZoom:f,translateExtent:Dt,nodeExtent:h,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:ut.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:S,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Hr},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Ha,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:zr}},Su=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:s,fitView:i,fitViewOptions:a,minZoom:u,maxZoom:f,nodeOrigin:l,nodeExtent:d})=>Fc((c,g)=>{async function m(){const{nodeLookup:p,panZoom:y,fitViewOptions:v,fitViewResolver:S,width:h,height:w,minZoom:E,maxZoom:C}=g();y&&(await Oa({nodes:p,width:h,height:w,panZoom:y,minZoom:E,maxZoom:C},v),S==null||S.resolve(!0),c({fitViewResolver:null}))}return{...vr({nodes:e,edges:t,width:r,height:s,fitView:i,fitViewOptions:a,minZoom:u,maxZoom:f,nodeOrigin:l,nodeExtent:d,defaultNodes:n,defaultEdges:o}),setNodes:p=>{const{nodeLookup:y,parentLookup:v,nodeOrigin:S,elevateNodesOnSelect:h,fitViewQueued:w}=g(),E=Un(p,y,v,{nodeOrigin:S,nodeExtent:d,elevateNodesOnSelect:h,checkEquality:!0});w&&E?(m(),c({nodes:p,nodesInitialized:E,fitViewQueued:!1,fitViewOptions:void 0})):c({nodes:p,nodesInitialized:E})},setEdges:p=>{const{connectionLookup:y,edgeLookup:v}=g();rs(y,v,p),c({edges:p})},setDefaultNodesAndEdges:(p,y)=>{if(p){const{setNodes:v}=g();v(p),c({hasDefaultNodes:!0})}if(y){const{setEdges:v}=g();v(y),c({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:y,nodeLookup:v,parentLookup:S,domNode:h,nodeOrigin:w,nodeExtent:E,debug:C,fitViewQueued:M}=g(),{changes:N,updatedInternals:A}=sc(p,v,S,h,w,E);A&&(nc(v,S,{nodeOrigin:w,nodeExtent:E}),M?(m(),c({fitViewQueued:!1,fitViewOptions:void 0})):c({}),(N==null?void 0:N.length)>0&&(C&&console.log("React Flow: trigger node changes",N),y==null||y(N)))},updateNodePositions:(p,y=!1)=>{const v=[],S=[],{nodeLookup:h,triggerNodeChanges:w}=g();for(const[E,C]of p){const M=h.get(E),N=!!(M!=null&&M.expandParent&&(M!=null&&M.parentId)&&(C!=null&&C.position)),A={id:E,type:"position",position:N?{x:Math.max(0,C.position.x),y:Math.max(0,C.position.y)}:C.position,dragging:y};N&&M.parentId&&v.push({id:E,parentId:M.parentId,rect:{...C.internals.positionAbsolute,width:C.measured.width??0,height:C.measured.height??0}}),S.push(A)}if(v.length>0){const{parentLookup:E,nodeOrigin:C}=g(),M=lo(v,h,E,C);S.push(...M)}w(S)},triggerNodeChanges:p=>{const{onNodesChange:y,setNodes:v,nodes:S,hasDefaultNodes:h,debug:w}=g();if(p!=null&&p.length){if(h){const E=vs(p,S);v(E)}w&&console.log("React Flow: trigger node changes",p),y==null||y(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:y,setEdges:v,edges:S,hasDefaultEdges:h,debug:w}=g();if(p!=null&&p.length){if(h){const E=bs(p,S);v(E)}w&&console.log("React Flow: trigger edge changes",p),y==null||y(p)}},addSelectedNodes:p=>{const{multiSelectionActive:y,edgeLookup:v,nodeLookup:S,triggerNodeChanges:h,triggerEdgeChanges:w}=g();if(y){const E=p.map(C=>Je(C,!0));h(E);return}h(ct(S,new Set([...p]),!0)),w(ct(v))},addSelectedEdges:p=>{const{multiSelectionActive:y,edgeLookup:v,nodeLookup:S,triggerNodeChanges:h,triggerEdgeChanges:w}=g();if(y){const E=p.map(C=>Je(C,!0));w(E);return}w(ct(v,new Set([...p]))),h(ct(S,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:y}={})=>{const{edges:v,nodes:S,nodeLookup:h,triggerNodeChanges:w,triggerEdgeChanges:E}=g(),C=p||S,M=y||v,N=C.map(L=>{const D=h.get(L.id);return D&&(D.selected=!1),Je(L.id,!1)}),A=M.map(L=>Je(L.id,!1));w(N),E(A)},setMinZoom:p=>{const{panZoom:y,maxZoom:v}=g();y==null||y.setScaleExtent([p,v]),c({minZoom:p})},setMaxZoom:p=>{const{panZoom:y,minZoom:v}=g();y==null||y.setScaleExtent([v,p]),c({maxZoom:p})},setTranslateExtent:p=>{var y;(y=g().panZoom)==null||y.setTranslateExtent(p),c({translateExtent:p})},setPaneClickDistance:p=>{var y;(y=g().panZoom)==null||y.setClickDistance(p)},resetSelectedElements:()=>{const{edges:p,nodes:y,triggerNodeChanges:v,triggerEdgeChanges:S,elementsSelectable:h}=g();if(!h)return;const w=y.reduce((C,M)=>M.selected?[...C,Je(M.id,!1)]:C,[]),E=p.reduce((C,M)=>M.selected?[...C,Je(M.id,!1)]:C,[]);v(w),S(E)},setNodeExtent:p=>{const{nodes:y,nodeLookup:v,parentLookup:S,nodeOrigin:h,elevateNodesOnSelect:w,nodeExtent:E}=g();p[0][0]===E[0][0]&&p[0][1]===E[0][1]&&p[1][0]===E[1][0]&&p[1][1]===E[1][1]||(Un(y,v,S,{nodeOrigin:h,nodeExtent:p,elevateNodesOnSelect:w,checkEquality:!1}),c({nodeExtent:p}))},panBy:p=>{const{transform:y,width:v,height:S,panZoom:h,translateExtent:w}=g();return ic({delta:p,panZoom:h,transform:y,translateExtent:w,width:v,height:S})},setCenter:async(p,y,v)=>{const{width:S,height:h,maxZoom:w,panZoom:E}=g();if(!E)return Promise.resolve(!1);const C=typeof(v==null?void 0:v.zoom)<"u"?v.zoom:w;return await E.setViewport({x:S/2-p*C,y:h/2-y*C,zoom:C},{duration:v==null?void 0:v.duration,ease:v==null?void 0:v.ease,interpolate:v==null?void 0:v.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{c({connection:{...Hr}})},updateConnection:p=>{c({connection:p})},reset:()=>c({...vr()})}},Object.is);function Eu({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:r,initialHeight:s,initialMinZoom:i,initialMaxZoom:a,initialFitViewOptions:u,fitView:f,nodeOrigin:l,nodeExtent:d,children:c}){const[g]=x.useState(()=>Su({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:s,fitView:f,minZoom:i,maxZoom:a,fitViewOptions:u,nodeOrigin:l,nodeExtent:d}));return b.jsx(Vc,{value:g,children:b.jsx(fl,{children:c})})}function Cu({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:r,width:s,height:i,fitView:a,fitViewOptions:u,minZoom:f,maxZoom:l,nodeOrigin:d,nodeExtent:c}){return x.useContext(gn)?b.jsx(b.Fragment,{children:e}):b.jsx(Eu,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:r,initialWidth:s,initialHeight:i,fitView:a,initialFitViewOptions:u,initialMinZoom:f,initialMaxZoom:l,nodeOrigin:d,nodeExtent:c,children:e})}const Mu={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Nu({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:r,nodeTypes:s,edgeTypes:i,onNodeClick:a,onEdgeClick:u,onInit:f,onMove:l,onMoveStart:d,onMoveEnd:c,onConnect:g,onConnectStart:m,onConnectEnd:p,onClickConnectStart:y,onClickConnectEnd:v,onNodeMouseEnter:S,onNodeMouseMove:h,onNodeMouseLeave:w,onNodeContextMenu:E,onNodeDoubleClick:C,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:A,onNodesDelete:L,onEdgesDelete:D,onDelete:R,onSelectionChange:k,onSelectionDragStart:j,onSelectionDrag:_,onSelectionDragStop:T,onSelectionContextMenu:P,onSelectionStart:z,onSelectionEnd:I,onBeforeDelete:$,connectionMode:O,connectionLineType:H=Ue.Bezier,connectionLineStyle:V,connectionLineComponent:W,connectionLineContainerStyle:Z,deleteKeyCode:G="Backspace",selectionKeyCode:Q="Shift",selectionOnDrag:B=!1,selectionMode:q=It.Full,panActivationKeyCode:F="Space",multiSelectionKeyCode:J=tn()?"Meta":"Control",zoomActivationKeyCode:Y=tn()?"Meta":"Control",snapToGrid:K,snapGrid:U,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:oe,nodesDraggable:xe,autoPanOnNodeFocus:Le,nodesConnectable:He,nodesFocusable:ye,nodeOrigin:Te=ys,edgesFocusable:Ie,edgesReconnectable:Be,elementsSelectable:ot=!0,defaultViewport:rt=nl,minZoom:Fe=.5,maxZoom:ve=2,translateExtent:$e=Dt,preventScrolling:qe=!0,nodeExtent:st,defaultMarkerColor:Ae="#b1b1b7",zoomOnScroll:Bt=!0,zoomOnPinch:bn=!0,panOnScroll:wn=!1,panOnScrollSpeed:xt=.5,panOnScrollMode:Ft=et.Free,zoomOnDoubleClick:Sn=!0,panOnDrag:Vt=!0,onPaneClick:En,onPaneMouseEnter:Cn,onPaneMouseMove:Mn,onPaneMouseLeave:le,onPaneScroll:fe,onPaneContextMenu:ge,paneClickDistance:Ee=0,nodeClickDistance:pe=0,children:he,onReconnect:be,onReconnectStart:Ve,onReconnectEnd:ae,onEdgeContextMenu:Re,onEdgeDoubleClick:we,onEdgeMouseEnter:Ce,onEdgeMouseMove:Ke,onEdgeMouseLeave:Ze,reconnectRadius:ke=10,onNodesChange:Qe,onEdgesChange:vt,noDragClassName:hi="nodrag",noWheelClassName:pi="nowheel",noPanClassName:So="nopan",fitView:Eo,fitViewOptions:Co,connectOnClick:mi,attributionPosition:yi,proOptions:xi,defaultEdgeOptions:vi,elevateNodesOnSelect:bi,elevateEdgesOnSelect:wi,disableKeyboardA11y:Mo=!1,autoPanOnConnect:Si,autoPanOnNodeDrag:Ei,autoPanSpeed:Ci,connectionRadius:Mi,isValidConnection:Ni,onError:Di,style:Ii,id:No,nodeDragThreshold:Ai,connectionDragThreshold:Ri,viewport:ki,onViewportChange:Pi,width:ji,height:_i,colorMode:Li="light",debug:Ti,onScroll:Yt,ariaLabelConfig:$i,...Oi},zi){const Nn=No||"1",Hi=il(Li),Bi=x.useCallback(Do=>{Do.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Yt==null||Yt(Do)},[Yt]);return b.jsx("div",{"data-testid":"rf__wrapper",...Oi,onScroll:Bi,style:{...Ii,...Mu},ref:zi,className:ie(["react-flow",r,Hi]),id:No,role:"application",children:b.jsxs(Cu,{nodes:e,edges:t,width:ji,height:_i,fitView:Eo,fitViewOptions:Co,minZoom:Fe,maxZoom:ve,nodeOrigin:Te,nodeExtent:st,children:[b.jsx(wu,{onInit:f,onNodeClick:a,onEdgeClick:u,onNodeMouseEnter:S,onNodeMouseMove:h,onNodeMouseLeave:w,onNodeContextMenu:E,onNodeDoubleClick:C,nodeTypes:s,edgeTypes:i,connectionLineType:H,connectionLineStyle:V,connectionLineComponent:W,connectionLineContainerStyle:Z,selectionKeyCode:Q,selectionOnDrag:B,selectionMode:q,deleteKeyCode:G,multiSelectionKeyCode:J,panActivationKeyCode:F,zoomActivationKeyCode:Y,onlyRenderVisibleElements:te,defaultViewport:rt,translateExtent:$e,minZoom:Fe,maxZoom:ve,preventScrolling:qe,zoomOnScroll:Bt,zoomOnPinch:bn,zoomOnDoubleClick:Sn,panOnScroll:wn,panOnScrollSpeed:xt,panOnScrollMode:Ft,panOnDrag:Vt,onPaneClick:En,onPaneMouseEnter:Cn,onPaneMouseMove:Mn,onPaneMouseLeave:le,onPaneScroll:fe,onPaneContextMenu:ge,paneClickDistance:Ee,nodeClickDistance:pe,onSelectionContextMenu:P,onSelectionStart:z,onSelectionEnd:I,onReconnect:be,onReconnectStart:Ve,onReconnectEnd:ae,onEdgeContextMenu:Re,onEdgeDoubleClick:we,onEdgeMouseEnter:Ce,onEdgeMouseMove:Ke,onEdgeMouseLeave:Ze,reconnectRadius:ke,defaultMarkerColor:Ae,noDragClassName:hi,noWheelClassName:pi,noPanClassName:So,rfId:Nn,disableKeyboardA11y:Mo,nodeExtent:st,viewport:ki,onViewportChange:Pi}),b.jsx(sl,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:g,onConnectStart:m,onConnectEnd:p,onClickConnectStart:y,onClickConnectEnd:v,nodesDraggable:xe,autoPanOnNodeFocus:Le,nodesConnectable:He,nodesFocusable:ye,edgesFocusable:Ie,edgesReconnectable:Be,elementsSelectable:ot,elevateNodesOnSelect:bi,elevateEdgesOnSelect:wi,minZoom:Fe,maxZoom:ve,nodeExtent:st,onNodesChange:Qe,onEdgesChange:vt,snapToGrid:K,snapGrid:U,connectionMode:O,translateExtent:$e,connectOnClick:mi,defaultEdgeOptions:vi,fitView:Eo,fitViewOptions:Co,onNodesDelete:L,onEdgesDelete:D,onDelete:R,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:A,onSelectionDrag:_,onSelectionDragStart:j,onSelectionDragStop:T,onMove:l,onMoveStart:d,onMoveEnd:c,noPanClassName:So,nodeOrigin:Te,rfId:Nn,autoPanOnConnect:Si,autoPanOnNodeDrag:Ei,autoPanSpeed:Ci,onError:Di,connectionRadius:Mi,isValidConnection:Ni,selectNodesOnDrag:oe,nodeDragThreshold:Ai,connectionDragThreshold:Ri,onBeforeDelete:$,paneClickDistance:Ee,debug:Ti,ariaLabelConfig:$i}),b.jsx(tl,{onSelectionChange:k}),he,b.jsx(Kc,{proOptions:xi,position:yi}),b.jsx(qc,{rfId:Nn,disableKeyboardA11y:Mo})]})})}var Du=ws(Nu);function Iu({dimensions:e,lineWidth:t,variant:n,className:o}){return b.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:ie(["react-flow__background-pattern",n,o])})}function Au({radius:e,className:t}){return b.jsx("circle",{cx:e,cy:e,r:e,className:ie(["react-flow__background-pattern","dots",t])})}var Ge;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ge||(Ge={}));const Ru={[Ge.Dots]:1,[Ge.Lines]:1,[Ge.Cross]:6},ku=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Xs({id:e,variant:t=Ge.Dots,gap:n=20,size:o,lineWidth:r=1,offset:s=0,color:i,bgColor:a,style:u,className:f,patternClassName:l}){const d=x.useRef(null),{transform:c,patternId:g}=ee(ku,se),m=o||Ru[t],p=t===Ge.Dots,y=t===Ge.Cross,v=Array.isArray(n)?n:[n,n],S=[v[0]*c[2]||1,v[1]*c[2]||1],h=m*c[2],w=Array.isArray(s)?s:[s,s],E=y?[h,h]:S,C=[w[0]*c[2]||1+E[0]/2,w[1]*c[2]||1+E[1]/2],M=`${g}${e||""}`;return b.jsxs("svg",{className:ie(["react-flow__background",f]),style:{...u,...pn,"--xy-background-color-props":a,"--xy-background-pattern-color-props":i},ref:d,"data-testid":"rf__background",children:[b.jsx("pattern",{id:M,x:c[0]%S[0],y:c[1]%S[1],width:S[0],height:S[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`,children:p?b.jsx(Au,{radius:h/2,className:l}):b.jsx(Iu,{dimensions:E,lineWidth:r,variant:t,className:l})}),b.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${M})`})]})}Xs.displayName="Background";const Pu=x.memo(Xs);function ju(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:b.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function _u(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:b.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Lu(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:b.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Tu(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function $u(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Gt({children:e,className:t,...n}){return b.jsx("button",{type:"button",className:ie(["react-flow__controls-button",t]),...n,children:e})}const Ou=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function Ws({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:r,onZoomIn:s,onZoomOut:i,onFitView:a,onInteractiveChange:u,className:f,children:l,position:d="bottom-left",orientation:c="vertical","aria-label":g}){const m=re(),{isInteractive:p,minZoomReached:y,maxZoomReached:v,ariaLabelConfig:S}=ee(Ou,se),{zoomIn:h,zoomOut:w,fitView:E}=uo(),C=()=>{h(),s==null||s()},M=()=>{w(),i==null||i()},N=()=>{E(r),a==null||a()},A=()=>{m.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),u==null||u(!p)},L=c==="horizontal"?"horizontal":"vertical";return b.jsxs(hn,{className:ie(["react-flow__controls",L,f]),position:d,style:e,"data-testid":"rf__controls","aria-label":g??S["controls.ariaLabel"],children:[t&&b.jsxs(b.Fragment,{children:[b.jsx(Gt,{onClick:C,className:"react-flow__controls-zoomin",title:S["controls.zoomIn.ariaLabel"],"aria-label":S["controls.zoomIn.ariaLabel"],disabled:v,children:b.jsx(ju,{})}),b.jsx(Gt,{onClick:M,className:"react-flow__controls-zoomout",title:S["controls.zoomOut.ariaLabel"],"aria-label":S["controls.zoomOut.ariaLabel"],disabled:y,children:b.jsx(_u,{})})]}),n&&b.jsx(Gt,{className:"react-flow__controls-fitview",onClick:N,title:S["controls.fitView.ariaLabel"],"aria-label":S["controls.fitView.ariaLabel"],children:b.jsx(Lu,{})}),o&&b.jsx(Gt,{className:"react-flow__controls-interactive",onClick:A,title:S["controls.interactive.ariaLabel"],"aria-label":S["controls.interactive.ariaLabel"],children:p?b.jsx($u,{}):b.jsx(Tu,{})}),l]})}Ws.displayName="Controls";const zu=x.memo(Ws);function Hu({id:e,x:t,y:n,width:o,height:r,style:s,color:i,strokeColor:a,strokeWidth:u,className:f,borderRadius:l,shapeRendering:d,selected:c,onClick:g}){const{background:m,backgroundColor:p}=s||{},y=i||m||p;return b.jsx("rect",{className:ie(["react-flow__minimap-node",{selected:c},f]),x:t,y:n,rx:l,ry:l,width:o,height:r,style:{fill:y,stroke:a,strokeWidth:u},shapeRendering:d,onClick:g?v=>g(v,e):void 0})}const Bu=x.memo(Hu),Fu=e=>e.nodes.map(t=>t.id),Tn=e=>e instanceof Function?e:()=>e;function Vu({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:r,nodeComponent:s=Bu,onClick:i}){const a=ee(Fu,se),u=Tn(t),f=Tn(e),l=Tn(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return b.jsx(b.Fragment,{children:a.map(c=>b.jsx(Xu,{id:c,nodeColorFunc:u,nodeStrokeColorFunc:f,nodeClassNameFunc:l,nodeBorderRadius:o,nodeStrokeWidth:r,NodeComponent:s,onClick:i,shapeRendering:d},c))})}function Yu({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:r,nodeStrokeWidth:s,shapeRendering:i,NodeComponent:a,onClick:u}){const{node:f,x:l,y:d,width:c,height:g}=ee(m=>{const{internals:p}=m.nodeLookup.get(e),y=p.userNode,{x:v,y:S}=p.positionAbsolute,{width:h,height:w}=ze(y);return{node:y,x:v,y:S,width:h,height:w}},se);return!f||f.hidden||!Ur(f)?null:b.jsx(a,{x:l,y:d,width:c,height:g,style:f.style,selected:!!f.selected,className:o(f),color:t(f),borderRadius:r,strokeColor:n(f),strokeWidth:s,shapeRendering:i,onClick:u,id:f.id})}const Xu=x.memo(Yu);var Wu=x.memo(Vu);const Uu=200,Gu=150,qu=e=>!e.hidden,Ku=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?Wr(Tt(e.nodeLookup,{filter:qu}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Zu="react-flow__minimap-desc";function Us({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:r="",nodeBorderRadius:s=5,nodeStrokeWidth:i,nodeComponent:a,bgColor:u,maskColor:f,maskStrokeColor:l,maskStrokeWidth:d,position:c="bottom-right",onClick:g,onNodeClick:m,pannable:p=!1,zoomable:y=!1,ariaLabel:v,inversePan:S,zoomStep:h=10,offsetScale:w=5}){const E=re(),C=x.useRef(null),{boundingRect:M,viewBB:N,rfId:A,panZoom:L,translateExtent:D,flowWidth:R,flowHeight:k,ariaLabelConfig:j}=ee(Ku,se),_=(e==null?void 0:e.width)??Uu,T=(e==null?void 0:e.height)??Gu,P=M.width/_,z=M.height/T,I=Math.max(P,z),$=I*_,O=I*T,H=w*I,V=M.x-($-M.width)/2-H,W=M.y-(O-M.height)/2-H,Z=$+H*2,G=O+H*2,Q=`${Zu}-${A}`,B=x.useRef(0),q=x.useRef();B.current=I,x.useEffect(()=>{if(C.current&&L)return q.current=hc({domNode:C.current,panZoom:L,getTransform:()=>E.getState().transform,getViewScale:()=>B.current}),()=>{var K;(K=q.current)==null||K.destroy()}},[L]),x.useEffect(()=>{var K;(K=q.current)==null||K.update({translateExtent:D,width:R,height:k,inversePan:S,pannable:p,zoomStep:h,zoomable:y})},[p,y,S,h,D,R,k]);const F=g?K=>{var oe;const[U,te]=((oe=q.current)==null?void 0:oe.pointer(K))||[0,0];g(K,{x:U,y:te})}:void 0,J=m?x.useCallback((K,U)=>{const te=E.getState().nodeLookup.get(U).internals.userNode;m(K,te)},[]):void 0,Y=v??j["minimap.ariaLabel"];return b.jsx(hn,{position:c,style:{...e,"--xy-minimap-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-background-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*I:void 0,"--xy-minimap-node-background-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:ie(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:b.jsxs("svg",{width:_,height:T,viewBox:`${V} ${W} ${Z} ${G}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Q,ref:C,onClick:F,children:[Y&&b.jsx("title",{id:Q,children:Y}),b.jsx(Wu,{onClick:J,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:s,nodeClassName:r,nodeStrokeWidth:i,nodeComponent:a}),b.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-H},${W-H}h${Z+H*2}v${G+H*2}h${-Z-H*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Us.displayName="MiniMap";const Qu=x.memo(Us),Ju=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,ed={[ht.Line]:"right",[ht.Handle]:"bottom-right"};function td({nodeId:e,position:t,variant:n=ht.Handle,className:o,style:r=void 0,children:s,color:i,minWidth:a=10,minHeight:u=10,maxWidth:f=Number.MAX_VALUE,maxHeight:l=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:c,autoScale:g=!0,shouldResize:m,onResizeStart:p,onResize:y,onResizeEnd:v}){const S=Ms(),h=typeof e=="string"?e:S,w=re(),E=x.useRef(null),C=n===ht.Handle,M=ee(x.useCallback(Ju(C&&g),[C,g]),se),N=x.useRef(null),A=t??ed[n];x.useEffect(()=>{if(!(!E.current||!h))return N.current||(N.current=Rc({domNode:E.current,nodeId:h,getStoreItems:()=>{const{nodeLookup:D,transform:R,snapGrid:k,snapToGrid:j,nodeOrigin:_,domNode:T}=w.getState();return{nodeLookup:D,transform:R,snapGrid:k,snapToGrid:j,nodeOrigin:_,paneDomNode:T}},onChange:(D,R)=>{const{triggerNodeChanges:k,nodeLookup:j,parentLookup:_,nodeOrigin:T}=w.getState(),P=[],z={x:D.x,y:D.y},I=j.get(h);if(I&&I.expandParent&&I.parentId){const $=I.origin??T,O=D.width??I.measured.width??0,H=D.height??I.measured.height??0,V={id:I.id,parentId:I.parentId,rect:{width:O,height:H,...Gr({x:D.x??I.position.x,y:D.y??I.position.y},{width:O,height:H},I.parentId,j,$)}},W=lo([V],j,_,T);P.push(...W),z.x=D.x?Math.max($[0]*O,D.x):void 0,z.y=D.y?Math.max($[1]*H,D.y):void 0}if(z.x!==void 0&&z.y!==void 0){const $={id:h,type:"position",position:{...z}};P.push($)}if(D.width!==void 0&&D.height!==void 0){const O={id:h,type:"dimensions",resizing:!0,setAttributes:c?c==="horizontal"?"width":"height":!0,dimensions:{width:D.width,height:D.height}};P.push(O)}for(const $ of R){const O={...$,type:"position"};P.push(O)}k(P)},onEnd:({width:D,height:R})=>{const k={id:h,type:"dimensions",resizing:!1,dimensions:{width:D,height:R}};w.getState().triggerNodeChanges([k])}})),N.current.update({controlPosition:A,boundaries:{minWidth:a,minHeight:u,maxWidth:f,maxHeight:l},keepAspectRatio:d,resizeDirection:c,onResizeStart:p,onResize:y,onResizeEnd:v,shouldResize:m}),()=>{var D;(D=N.current)==null||D.destroy()}},[A,a,u,f,l,d,p,y,v,m]);const L=A.split("-");return b.jsx("div",{className:ie(["react-flow__resize-control","nodrag",...L,n,o]),ref:E,style:{...r,scale:M,...i&&{[C?"backgroundColor":"borderColor"]:i}},children:s})}x.memo(td);const $n={width:10,height:10,bottom:-5};x.memo(({data:e,isConnectable:t})=>b.jsx(b.Fragment,{children:b.jsxs("div",{style:{padding:25},children:[b.jsx("div",{children:"Node"}),b.jsx(Oe,{type:"source",id:"red",position:X.Bottom,style:{...$n,left:"15%",background:"red"},onConnect:n=>console.log("handle onConnect",n),isConnectable:t}),b.jsx(Oe,{type:"source",position:X.Bottom,id:"blue",style:{...$n,left:"50%",background:"blue"},isConnectable:t}),b.jsx(Oe,{type:"target",position:X.Bottom,id:"orange",style:{...$n,left:"85%",background:"orange"},isConnectable:t})]})}));const nd={custom:rd};function od({initialNodes:e,initialEdges:t,component:n}){const{messageApi:o}=tt(),[r,s]=x.useState(e),[i,a]=x.useState(t);x.useEffect(()=>{s(e)},[e]);const u=x.useCallback(c=>s(g=>vs(c,g)),[]),f=x.useCallback(c=>a(g=>bs(c,g)),[]),l=x.useCallback(c=>a(g=>ts(c,g)),[]),d=async()=>{const c=r.map(p=>({component_id:p.id,position:p.position})),g={position:JSON.stringify(c),edges:JSON.stringify(i),component_id:n.component_id},m=await sa(g);console.log(m),o.success("保存成功")};return b.jsx(Ca,{title:"流程图",extra:b.jsx(Me,{size:"small",color:"cyan",variant:"solid",onClick:d,children:"保存"}),bodyStyle:{padding:0},children:b.jsx("div",{style:{height:"40vh"},children:b.jsxs(Du,{nodes:r,edges:i,nodeTypes:nd,onNodesChange:u,onEdgesChange:f,onConnect:l,fitView:!0,children:[b.jsx(zu,{}),b.jsx(Qu,{}),b.jsx(Pu,{gap:12,size:1})]})})})}function rd({data:e}){const t=e.inputs||[],n=e.outputs||[];return b.jsxs("div",{style:{background:e.color||"#1976d2",color:"white",padding:10,borderRadius:12,minWidth:150,position:"relative"},children:[b.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:e.label}),t.map((o,r)=>b.jsx(Io,{content:b.jsx("div",{children:o.component_name}),children:b.jsx(Oe,{type:"target",position:X.Left,id:o.component_id,style:{top:30+r*20,background:"#555"}},o.component_id)})),n.map((o,r)=>b.jsx(Io,{content:b.jsx("div",{children:o.component_name}),children:b.jsx(Oe,{type:"source",position:X.Right,id:o.component_id,style:{top:30+r*20,background:"#888"}},o.component_id)}))]})}function sd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return x.useMemo(()=>o=>{t.forEach(r=>r(o))},t)}const yn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function pt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function go(e){return"nodeType"in e}function me(e){var t,n;return e?pt(e)?e:go(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function ho(e){const{Document:t}=me(e);return e instanceof t}function Ot(e){return pt(e)?!1:e instanceof me(e).HTMLElement}function Gs(e){return e instanceof me(e).SVGElement}function mt(e){return e?pt(e)?e.document:go(e)?ho(e)?e:Ot(e)||Gs(e)?e.ownerDocument:document:document:document}const _e=yn?x.useLayoutEffect:x.useEffect;function po(e){const t=x.useRef(e);return _e(()=>{t.current=e}),x.useCallback(function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t.current==null?void 0:t.current(...o)},[])}function id(){const e=x.useRef(null),t=x.useCallback((o,r)=>{e.current=setInterval(o,r)},[]),n=x.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Pt(e,t){t===void 0&&(t=[e]);const n=x.useRef(e);return _e(()=>{n.current!==e&&(n.current=e)},t),n}function zt(e,t){const n=x.useRef();return x.useMemo(()=>{const o=e(n.current);return n.current=o,o},[...t])}function on(e){const t=po(e),n=x.useRef(null),o=x.useCallback(r=>{r!==n.current&&(t==null||t(r,n.current)),n.current=r},[]);return[n,o]}function Kn(e){const t=x.useRef();return x.useEffect(()=>{t.current=e},[e]),t.current}let On={};function Ht(e,t){return x.useMemo(()=>{if(t)return t;const n=On[e]==null?0:On[e]+1;return On[e]=n,e+"-"+n},[e,t])}function qs(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return o.reduce((s,i)=>{const a=Object.entries(i);for(const[u,f]of a){const l=s[u];l!=null&&(s[u]=l+e*f)}return s},{...t})}}const lt=qs(1),rn=qs(-1);function ad(e){return"clientX"in e&&"clientY"in e}function mo(e){if(!e)return!1;const{KeyboardEvent:t}=me(e.target);return t&&e instanceof t}function cd(e){if(!e)return!1;const{TouchEvent:t}=me(e.target);return t&&e instanceof t}function Zn(e){if(cd(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return ad(e)?{x:e.clientX,y:e.clientY}:null}const jt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[jt.Translate.toString(e),jt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:o}=e;return t+" "+n+"ms "+o}}}),br="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ld(e){return e.matches(br)?e:e.querySelector(br)}const ud={display:"none"};function dd(e){let{id:t,value:n}=e;return de.createElement("div",{id:t,style:ud},n)}function fd(e){let{id:t,announcement:n,ariaLiveType:o="assertive"}=e;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return de.createElement("div",{id:t,style:r,role:"status","aria-live":o,"aria-atomic":!0},n)}function gd(){const[e,t]=x.useState("");return{announce:x.useCallback(o=>{o!=null&&t(o)},[]),announcement:e}}const Ks=x.createContext(null);function hd(e){const t=x.useContext(Ks);x.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function pd(){const[e]=x.useState(()=>new Set),t=x.useCallback(o=>(e.add(o),()=>e.delete(o)),[e]);return[x.useCallback(o=>{let{type:r,event:s}=o;e.forEach(i=>{var a;return(a=i[r])==null?void 0:a.call(i,s)})},[e]),t]}const md={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},yd={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function xd(e){let{announcements:t=yd,container:n,hiddenTextDescribedById:o,screenReaderInstructions:r=md}=e;const{announce:s,announcement:i}=gd(),a=Ht("DndLiveRegion"),[u,f]=x.useState(!1);if(x.useEffect(()=>{f(!0)},[]),hd(x.useMemo(()=>({onDragStart(d){let{active:c}=d;s(t.onDragStart({active:c}))},onDragMove(d){let{active:c,over:g}=d;t.onDragMove&&s(t.onDragMove({active:c,over:g}))},onDragOver(d){let{active:c,over:g}=d;s(t.onDragOver({active:c,over:g}))},onDragEnd(d){let{active:c,over:g}=d;s(t.onDragEnd({active:c,over:g}))},onDragCancel(d){let{active:c,over:g}=d;s(t.onDragCancel({active:c,over:g}))}}),[s,t])),!u)return null;const l=de.createElement(de.Fragment,null,de.createElement(dd,{id:o,value:r.draggable}),de.createElement(fd,{id:a,announcement:i}));return n?wt.createPortal(l,n):l}var ce;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ce||(ce={}));function sn(){}function vd(e,t){return x.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function bd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return x.useMemo(()=>[...t].filter(o=>o!=null),[...t])}const De=Object.freeze({x:0,y:0});function wd(e,t){let{data:{value:n}}=e,{data:{value:o}}=t;return o-n}function Sd(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Ed(e,t){const n=Math.max(t.top,e.top),o=Math.max(t.left,e.left),r=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),i=r-o,a=s-n;if(o<r&&n<s){const u=t.width*t.height,f=e.width*e.height,l=i*a,d=l/(u+f-l);return Number(d.toFixed(4))}return 0}const Cd=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const r=[];for(const s of o){const{id:i}=s,a=n.get(i);if(a){const u=Ed(a,t);u>0&&r.push({id:i,data:{droppableContainer:s,value:u}})}}return r.sort(wd)};function Md(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Zs(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:De}function Nd(e){return function(n){for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];return r.reduce((i,a)=>({...i,top:i.top+e*a.y,bottom:i.bottom+e*a.y,left:i.left+e*a.x,right:i.right+e*a.x}),{...n})}}const Dd=Nd(1);function Id(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ad(e,t,n){const o=Id(t);if(!o)return e;const{scaleX:r,scaleY:s,x:i,y:a}=o,u=e.left-i-(1-r)*parseFloat(n),f=e.top-a-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),l=r?e.width/r:e.width,d=s?e.height/s:e.height;return{width:l,height:d,top:f,right:u+l,bottom:f+d,left:u}}const Rd={ignoreTransform:!1};function yt(e,t){t===void 0&&(t=Rd);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:f,transformOrigin:l}=me(e).getComputedStyle(e);f&&(n=Ad(n,f,l))}const{top:o,left:r,width:s,height:i,bottom:a,right:u}=n;return{top:o,left:r,width:s,height:i,bottom:a,right:u}}function wr(e){return yt(e,{ignoreTransform:!0})}function kd(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Pd(e,t){return t===void 0&&(t=me(e).getComputedStyle(e)),t.position==="fixed"}function jd(e,t){t===void 0&&(t=me(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const s=t[r];return typeof s=="string"?n.test(s):!1})}function yo(e,t){const n=[];function o(r){if(t!=null&&n.length>=t||!r)return n;if(ho(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!Ot(r)||Gs(r)||n.includes(r))return n;const s=me(e).getComputedStyle(r);return r!==e&&jd(r,s)&&n.push(r),Pd(r,s)?n:o(r.parentNode)}return e?o(e):n}function Qs(e){const[t]=yo(e,1);return t??null}function zn(e){return!yn||!e?null:pt(e)?e:go(e)?ho(e)||e===mt(e).scrollingElement?window:Ot(e)?e:null:null}function Js(e){return pt(e)?e.scrollX:e.scrollLeft}function ei(e){return pt(e)?e.scrollY:e.scrollTop}function Qn(e){return{x:Js(e),y:ei(e)}}var ue;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(ue||(ue={}));function ti(e){return!yn||!e?!1:e===document.scrollingElement}function ni(e){const t={x:0,y:0},n=ti(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},o={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},r=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,i=e.scrollTop>=o.y,a=e.scrollLeft>=o.x;return{isTop:r,isLeft:s,isBottom:i,isRight:a,maxScroll:o,minScroll:t}}const _d={x:.2,y:.2};function Ld(e,t,n,o,r){let{top:s,left:i,right:a,bottom:u}=n;o===void 0&&(o=10),r===void 0&&(r=_d);const{isTop:f,isBottom:l,isLeft:d,isRight:c}=ni(e),g={x:0,y:0},m={x:0,y:0},p={height:t.height*r.y,width:t.width*r.x};return!f&&s<=t.top+p.height?(g.y=ue.Backward,m.y=o*Math.abs((t.top+p.height-s)/p.height)):!l&&u>=t.bottom-p.height&&(g.y=ue.Forward,m.y=o*Math.abs((t.bottom-p.height-u)/p.height)),!c&&a>=t.right-p.width?(g.x=ue.Forward,m.x=o*Math.abs((t.right-p.width-a)/p.width)):!d&&i<=t.left+p.width&&(g.x=ue.Backward,m.x=o*Math.abs((t.left+p.width-i)/p.width)),{direction:g,speed:m}}function Td(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:i}=window;return{top:0,left:0,right:s,bottom:i,width:s,height:i}}const{top:t,left:n,right:o,bottom:r}=e.getBoundingClientRect();return{top:t,left:n,right:o,bottom:r,width:e.clientWidth,height:e.clientHeight}}function oi(e){return e.reduce((t,n)=>lt(t,Qn(n)),De)}function $d(e){return e.reduce((t,n)=>t+Js(n),0)}function Od(e){return e.reduce((t,n)=>t+ei(n),0)}function zd(e,t){if(t===void 0&&(t=yt),!e)return;const{top:n,left:o,bottom:r,right:s}=t(e);Qs(e)&&(r<=0||s<=0||n>=window.innerHeight||o>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Hd=[["x",["left","right"],$d],["y",["top","bottom"],Od]];class xo{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const o=yo(n),r=oi(o);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,i,a]of Hd)for(const u of i)Object.defineProperty(this,u,{get:()=>{const f=a(o),l=r[s]-f;return this.rect[u]+l},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ct{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var o;return(o=this.target)==null?void 0:o.removeEventListener(...n)})},this.target=t}add(t,n,o){var r;(r=this.target)==null||r.addEventListener(t,n,o),this.listeners.push([t,n,o])}}function Bd(e){const{EventTarget:t}=me(e);return e instanceof t?e:mt(e)}function Hn(e,t){const n=Math.abs(e.x),o=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+o**2)>t:"x"in t&&"y"in t?n>t.x&&o>t.y:"x"in t?n>t.x:"y"in t?o>t.y:!1}var Se;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Se||(Se={}));function Sr(e){e.preventDefault()}function Fd(e){e.stopPropagation()}var ne;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ne||(ne={}));const ri={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},Vd=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class si{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ct(mt(n)),this.windowListeners=new Ct(me(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Se.Resize,this.handleCancel),this.windowListeners.add(Se.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Se.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,o=t.node.current;o&&zd(o),n(De)}handleKeyDown(t){if(mo(t)){const{active:n,context:o,options:r}=this.props,{keyboardCodes:s=ri,coordinateGetter:i=Vd,scrollBehavior:a="smooth"}=r,{code:u}=t;if(s.end.includes(u)){this.handleEnd(t);return}if(s.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:f}=o.current,l=f?{x:f.left,y:f.top}:De;this.referenceCoordinates||(this.referenceCoordinates=l);const d=i(t,{active:n,context:o.current,currentCoordinates:l});if(d){const c=rn(d,l),g={x:0,y:0},{scrollableAncestors:m}=o.current;for(const p of m){const y=t.code,{isTop:v,isRight:S,isLeft:h,isBottom:w,maxScroll:E,minScroll:C}=ni(p),M=Td(p),N={x:Math.min(y===ne.Right?M.right-M.width/2:M.right,Math.max(y===ne.Right?M.left:M.left+M.width/2,d.x)),y:Math.min(y===ne.Down?M.bottom-M.height/2:M.bottom,Math.max(y===ne.Down?M.top:M.top+M.height/2,d.y))},A=y===ne.Right&&!S||y===ne.Left&&!h,L=y===ne.Down&&!w||y===ne.Up&&!v;if(A&&N.x!==d.x){const D=p.scrollLeft+c.x,R=y===ne.Right&&D<=E.x||y===ne.Left&&D>=C.x;if(R&&!c.y){p.scrollTo({left:D,behavior:a});return}R?g.x=p.scrollLeft-D:g.x=y===ne.Right?p.scrollLeft-E.x:p.scrollLeft-C.x,g.x&&p.scrollBy({left:-g.x,behavior:a});break}else if(L&&N.y!==d.y){const D=p.scrollTop+c.y,R=y===ne.Down&&D<=E.y||y===ne.Up&&D>=C.y;if(R&&!c.x){p.scrollTo({top:D,behavior:a});return}R?g.y=p.scrollTop-D:g.y=y===ne.Down?p.scrollTop-E.y:p.scrollTop-C.y,g.y&&p.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(t,lt(rn(d,this.referenceCoordinates),g))}}}handleMove(t,n){const{onMove:o}=this.props;t.preventDefault(),o(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}si.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:o=ri,onActivation:r}=t,{active:s}=n;const{code:i}=e.nativeEvent;if(o.start.includes(i)){const a=s.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),r==null||r({event:e.nativeEvent}),!0)}return!1}}];function Er(e){return!!(e&&"distance"in e)}function Cr(e){return!!(e&&"delay"in e)}class vo{constructor(t,n,o){var r;o===void 0&&(o=Bd(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:i}=s;this.props=t,this.events=n,this.document=mt(i),this.documentListeners=new Ct(this.document),this.listeners=new Ct(o),this.windowListeners=new Ct(me(i)),this.initialCoordinates=(r=Zn(s))!=null?r:De,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:o}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Se.Resize,this.handleCancel),this.windowListeners.add(Se.DragStart,Sr),this.windowListeners.add(Se.VisibilityChange,this.handleCancel),this.windowListeners.add(Se.ContextMenu,Sr),this.documentListeners.add(Se.Keydown,this.handleKeydown),n){if(o!=null&&o({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Cr(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Er(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:o,onPending:r}=this.props;r(o,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Se.Click,Fd,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Se.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:o,initialCoordinates:r,props:s}=this,{onMove:i,options:{activationConstraint:a}}=s;if(!r)return;const u=(n=Zn(t))!=null?n:De,f=rn(r,u);if(!o&&a){if(Er(a)){if(a.tolerance!=null&&Hn(f,a.tolerance))return this.handleCancel();if(Hn(f,a.distance))return this.handleStart()}if(Cr(a)&&Hn(f,a.tolerance))return this.handleCancel();this.handlePending(a,f);return}t.cancelable&&t.preventDefault(),i(u)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Yd={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class bo extends vo{constructor(t){const{event:n}=t,o=mt(n.target);super(t,Yd,o)}}bo.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return!n.isPrimary||n.button!==0?!1:(o==null||o({event:n}),!0)}}];const Xd={move:{name:"mousemove"},end:{name:"mouseup"}};var Jn;(function(e){e[e.RightClick=2]="RightClick"})(Jn||(Jn={}));class Wd extends vo{constructor(t){super(t,Xd,mt(t.event.target))}}Wd.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return n.button===Jn.RightClick?!1:(o==null||o({event:n}),!0)}}];const Bn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Ud extends vo{constructor(t){super(t,Bn)}static setup(){return window.addEventListener(Bn.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Bn.move.name,t)};function t(){}}}Ud.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;const{touches:r}=n;return r.length>1?!1:(o==null||o({event:n}),!0)}}];var Mt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Mt||(Mt={}));var an;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(an||(an={}));function Gd(e){let{acceleration:t,activator:n=Mt.Pointer,canScroll:o,draggingRect:r,enabled:s,interval:i=5,order:a=an.TreeOrder,pointerCoordinates:u,scrollableAncestors:f,scrollableAncestorRects:l,delta:d,threshold:c}=e;const g=Kd({delta:d,disabled:!s}),[m,p]=id(),y=x.useRef({x:0,y:0}),v=x.useRef({x:0,y:0}),S=x.useMemo(()=>{switch(n){case Mt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Mt.DraggableRect:return r}},[n,r,u]),h=x.useRef(null),w=x.useCallback(()=>{const C=h.current;if(!C)return;const M=y.current.x*v.current.x,N=y.current.y*v.current.y;C.scrollBy(M,N)},[]),E=x.useMemo(()=>a===an.TreeOrder?[...f].reverse():f,[a,f]);x.useEffect(()=>{if(!s||!f.length||!S){p();return}for(const C of E){if((o==null?void 0:o(C))===!1)continue;const M=f.indexOf(C),N=l[M];if(!N)continue;const{direction:A,speed:L}=Ld(C,N,S,t,c);for(const D of["x","y"])g[D][A[D]]||(L[D]=0,A[D]=0);if(L.x>0||L.y>0){p(),h.current=C,m(w,i),y.current=L,v.current=A;return}}y.current={x:0,y:0},v.current={x:0,y:0},p()},[t,w,o,p,s,i,JSON.stringify(S),JSON.stringify(g),m,f,E,l,JSON.stringify(c)])}const qd={x:{[ue.Backward]:!1,[ue.Forward]:!1},y:{[ue.Backward]:!1,[ue.Forward]:!1}};function Kd(e){let{delta:t,disabled:n}=e;const o=Kn(t);return zt(r=>{if(n||!o||!r)return qd;const s={x:Math.sign(t.x-o.x),y:Math.sign(t.y-o.y)};return{x:{[ue.Backward]:r.x[ue.Backward]||s.x===-1,[ue.Forward]:r.x[ue.Forward]||s.x===1},y:{[ue.Backward]:r.y[ue.Backward]||s.y===-1,[ue.Forward]:r.y[ue.Forward]||s.y===1}}},[n,t,o])}function Zd(e,t){const n=t!=null?e.get(t):void 0,o=n?n.node.current:null;return zt(r=>{var s;return t==null?null:(s=o??r)!=null?s:null},[o,t])}function Qd(e,t){return x.useMemo(()=>e.reduce((n,o)=>{const{sensor:r}=o,s=r.activators.map(i=>({eventName:i.eventName,handler:t(i.handler,o)}));return[...n,...s]},[]),[e,t])}var _t;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(_t||(_t={}));var eo;(function(e){e.Optimized="optimized"})(eo||(eo={}));const Mr=new Map;function Jd(e,t){let{dragging:n,dependencies:o,config:r}=t;const[s,i]=x.useState(null),{frequency:a,measure:u,strategy:f}=r,l=x.useRef(e),d=y(),c=Pt(d),g=x.useCallback(function(v){v===void 0&&(v=[]),!c.current&&i(S=>S===null?v:S.concat(v.filter(h=>!S.includes(h))))},[c]),m=x.useRef(null),p=zt(v=>{if(d&&!n)return Mr;if(!v||v===Mr||l.current!==e||s!=null){const S=new Map;for(let h of e){if(!h)continue;if(s&&s.length>0&&!s.includes(h.id)&&h.rect.current){S.set(h.id,h.rect.current);continue}const w=h.node.current,E=w?new xo(u(w),w):null;h.rect.current=E,E&&S.set(h.id,E)}return S}return v},[e,s,n,d,u]);return x.useEffect(()=>{l.current=e},[e]),x.useEffect(()=>{d||g()},[n,d]),x.useEffect(()=>{s&&s.length>0&&i(null)},[JSON.stringify(s)]),x.useEffect(()=>{d||typeof a!="number"||m.current!==null||(m.current=setTimeout(()=>{g(),m.current=null},a))},[a,d,g,...o]),{droppableRects:p,measureDroppableContainers:g,measuringScheduled:s!=null};function y(){switch(f){case _t.Always:return!1;case _t.BeforeDragging:return n;default:return!n}}}function ii(e,t){return zt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function ef(e,t){return ii(e,t)}function tf(e){let{callback:t,disabled:n}=e;const o=po(t),r=x.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(o)},[o,n]);return x.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function xn(e){let{callback:t,disabled:n}=e;const o=po(t),r=x.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(o)},[n]);return x.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function nf(e){return new xo(yt(e),e)}function Nr(e,t,n){t===void 0&&(t=nf);const[o,r]=x.useState(null);function s(){r(u=>{if(!e)return null;if(e.isConnected===!1){var f;return(f=u??n)!=null?f:null}const l=t(e);return JSON.stringify(u)===JSON.stringify(l)?u:l})}const i=tf({callback(u){if(e)for(const f of u){const{type:l,target:d}=f;if(l==="childList"&&d instanceof HTMLElement&&d.contains(e)){s();break}}}}),a=xn({callback:s});return _e(()=>{s(),e?(a==null||a.observe(e),i==null||i.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),i==null||i.disconnect())},[e]),o}function of(e){const t=ii(e);return Zs(e,t)}const Dr=[];function rf(e){const t=x.useRef(e),n=zt(o=>e?o&&o!==Dr&&e&&t.current&&e.parentNode===t.current.parentNode?o:yo(e):Dr,[e]);return x.useEffect(()=>{t.current=e},[e]),n}function sf(e){const[t,n]=x.useState(null),o=x.useRef(e),r=x.useCallback(s=>{const i=zn(s.target);i&&n(a=>a?(a.set(i,Qn(i)),new Map(a)):null)},[]);return x.useEffect(()=>{const s=o.current;if(e!==s){i(s);const a=e.map(u=>{const f=zn(u);return f?(f.addEventListener("scroll",r,{passive:!0}),[f,Qn(f)]):null}).filter(u=>u!=null);n(a.length?new Map(a):null),o.current=e}return()=>{i(e),i(s)};function i(a){a.forEach(u=>{const f=zn(u);f==null||f.removeEventListener("scroll",r)})}},[r,e]),x.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,i)=>lt(s,i),De):oi(e):De,[e,t])}function Ir(e,t){t===void 0&&(t=[]);const n=x.useRef(null);return x.useEffect(()=>{n.current=null},t),x.useEffect(()=>{const o=e!==De;o&&!n.current&&(n.current=e),!o&&n.current&&(n.current=null)},[e]),n.current?rn(e,n.current):De}function af(e){x.useEffect(()=>{if(!yn)return;const t=e.map(n=>{let{sensor:o}=n;return o.setup==null?void 0:o.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function cf(e,t){return x.useMemo(()=>e.reduce((n,o)=>{let{eventName:r,handler:s}=o;return n[r]=i=>{s(i,t)},n},{}),[e,t])}function ai(e){return x.useMemo(()=>e?kd(e):null,[e])}const Ar=[];function lf(e,t){t===void 0&&(t=yt);const[n]=e,o=ai(n?me(n):null),[r,s]=x.useState(Ar);function i(){s(()=>e.length?e.map(u=>ti(u)?o:new xo(t(u),u)):Ar)}const a=xn({callback:i});return _e(()=>{a==null||a.disconnect(),i(),e.forEach(u=>a==null?void 0:a.observe(u))},[e]),r}function uf(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Ot(t)?t:e}function df(e){let{measure:t}=e;const[n,o]=x.useState(null),r=x.useCallback(f=>{for(const{target:l}of f)if(Ot(l)){o(d=>{const c=t(l);return d?{...d,width:c.width,height:c.height}:c});break}},[t]),s=xn({callback:r}),i=x.useCallback(f=>{const l=uf(f);s==null||s.disconnect(),l&&(s==null||s.observe(l)),o(l?t(l):null)},[t,s]),[a,u]=on(i);return x.useMemo(()=>({nodeRef:a,rect:n,setRef:u}),[n,a,u])}const ff=[{sensor:bo,options:{}},{sensor:si,options:{}}],gf={current:{}},Zt={draggable:{measure:wr},droppable:{measure:wr,strategy:_t.WhileDragging,frequency:eo.Optimized},dragOverlay:{measure:yt}};class Nt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,o;return(n=(o=this.get(t))==null?void 0:o.node.current)!=null?n:void 0}}const hf={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Nt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:sn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Zt,measureDroppableContainers:sn,windowRect:null,measuringScheduled:!1},pf={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:sn,draggableNodes:new Map,over:null,measureDroppableContainers:sn},vn=x.createContext(pf),ci=x.createContext(hf);function mf(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Nt}}}function yf(e,t){switch(t.type){case ce.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ce.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ce.DragEnd:case ce.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ce.RegisterDroppable:{const{element:n}=t,{id:o}=n,r=new Nt(e.droppable.containers);return r.set(o,n),{...e,droppable:{...e.droppable,containers:r}}}case ce.SetDroppableDisabled:{const{id:n,key:o,disabled:r}=t,s=e.droppable.containers.get(n);if(!s||o!==s.key)return e;const i=new Nt(e.droppable.containers);return i.set(n,{...s,disabled:r}),{...e,droppable:{...e.droppable,containers:i}}}case ce.UnregisterDroppable:{const{id:n,key:o}=t,r=e.droppable.containers.get(n);if(!r||o!==r.key)return e;const s=new Nt(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function xf(e){let{disabled:t}=e;const{active:n,activatorEvent:o,draggableNodes:r}=x.useContext(vn),s=Kn(o),i=Kn(n==null?void 0:n.id);return x.useEffect(()=>{if(!t&&!o&&s&&i!=null){if(!mo(s)||document.activeElement===s.target)return;const a=r.get(i);if(!a)return;const{activatorNode:u,node:f}=a;if(!u.current&&!f.current)return;requestAnimationFrame(()=>{for(const l of[u.current,f.current]){if(!l)continue;const d=ld(l);if(d){d.focus();break}}})}},[o,t,r,i,s]),null}function vf(e,t){let{transform:n,...o}=t;return e!=null&&e.length?e.reduce((r,s)=>s({transform:r,...o}),n):n}function bf(e){return x.useMemo(()=>({draggable:{...Zt.draggable,...e==null?void 0:e.draggable},droppable:{...Zt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Zt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function wf(e){let{activeNode:t,measure:n,initialRect:o,config:r=!0}=e;const s=x.useRef(!1),{x:i,y:a}=typeof r=="boolean"?{x:r,y:r}:r;_e(()=>{if(!i&&!a||!t){s.current=!1;return}if(s.current||!o)return;const f=t==null?void 0:t.node.current;if(!f||f.isConnected===!1)return;const l=n(f),d=Zs(l,o);if(i||(d.x=0),a||(d.y=0),s.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const c=Qs(f);c&&c.scrollBy({top:d.y,left:d.x})}},[t,i,a,o,n])}const li=x.createContext({...De,scaleX:1,scaleY:1});var We;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(We||(We={}));const Sf=x.memo(function(t){var n,o,r,s;let{id:i,accessibility:a,autoScroll:u=!0,children:f,sensors:l=ff,collisionDetection:d=Cd,measuring:c,modifiers:g,...m}=t;const p=x.useReducer(yf,void 0,mf),[y,v]=p,[S,h]=pd(),[w,E]=x.useState(We.Uninitialized),C=w===We.Initialized,{draggable:{active:M,nodes:N,translate:A},droppable:{containers:L}}=y,D=M!=null?N.get(M):null,R=x.useRef({initial:null,translated:null}),k=x.useMemo(()=>{var le;return M!=null?{id:M,data:(le=D==null?void 0:D.data)!=null?le:gf,rect:R}:null},[M,D]),j=x.useRef(null),[_,T]=x.useState(null),[P,z]=x.useState(null),I=Pt(m,Object.values(m)),$=Ht("DndDescribedBy",i),O=x.useMemo(()=>L.getEnabled(),[L]),H=bf(c),{droppableRects:V,measureDroppableContainers:W,measuringScheduled:Z}=Jd(O,{dragging:C,dependencies:[A.x,A.y],config:H.droppable}),G=Zd(N,M),Q=x.useMemo(()=>P?Zn(P):null,[P]),B=Mn(),q=ef(G,H.draggable.measure);wf({activeNode:M!=null?N.get(M):null,config:B.layoutShiftCompensation,initialRect:q,measure:H.draggable.measure});const F=Nr(G,H.draggable.measure,q),J=Nr(G?G.parentElement:null),Y=x.useRef({activatorEvent:null,active:null,activeNode:G,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:L,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),K=L.getNodeFor((n=Y.current.over)==null?void 0:n.id),U=df({measure:H.dragOverlay.measure}),te=(o=U.nodeRef.current)!=null?o:G,oe=C?(r=U.rect)!=null?r:F:null,xe=!!(U.nodeRef.current&&U.rect),Le=of(xe?null:F),He=ai(te?me(te):null),ye=rf(C?K??G:null),Te=lf(ye),Ie=vf(g,{transform:{x:A.x-Le.x,y:A.y-Le.y,scaleX:1,scaleY:1},activatorEvent:P,active:k,activeNodeRect:F,containerNodeRect:J,draggingNodeRect:oe,over:Y.current.over,overlayNodeRect:U.rect,scrollableAncestors:ye,scrollableAncestorRects:Te,windowRect:He}),Be=Q?lt(Q,A):null,ot=sf(ye),rt=Ir(ot),Fe=Ir(ot,[F]),ve=lt(Ie,rt),$e=oe?Dd(oe,Ie):null,qe=k&&$e?d({active:k,collisionRect:$e,droppableRects:V,droppableContainers:O,pointerCoordinates:Be}):null,st=Sd(qe,"id"),[Ae,Bt]=x.useState(null),bn=xe?Ie:lt(Ie,Fe),wn=Md(bn,(s=Ae==null?void 0:Ae.rect)!=null?s:null,F),xt=x.useRef(null),Ft=x.useCallback((le,fe)=>{let{sensor:ge,options:Ee}=fe;if(j.current==null)return;const pe=N.get(j.current);if(!pe)return;const he=le.nativeEvent,be=new ge({active:j.current,activeNode:pe,event:he,options:Ee,context:Y,onAbort(ae){if(!N.get(ae))return;const{onDragAbort:we}=I.current,Ce={id:ae};we==null||we(Ce),S({type:"onDragAbort",event:Ce})},onPending(ae,Re,we,Ce){if(!N.get(ae))return;const{onDragPending:Ze}=I.current,ke={id:ae,constraint:Re,initialCoordinates:we,offset:Ce};Ze==null||Ze(ke),S({type:"onDragPending",event:ke})},onStart(ae){const Re=j.current;if(Re==null)return;const we=N.get(Re);if(!we)return;const{onDragStart:Ce}=I.current,Ke={activatorEvent:he,active:{id:Re,data:we.data,rect:R}};wt.unstable_batchedUpdates(()=>{Ce==null||Ce(Ke),E(We.Initializing),v({type:ce.DragStart,initialCoordinates:ae,active:Re}),S({type:"onDragStart",event:Ke}),T(xt.current),z(he)})},onMove(ae){v({type:ce.DragMove,coordinates:ae})},onEnd:Ve(ce.DragEnd),onCancel:Ve(ce.DragCancel)});xt.current=be;function Ve(ae){return async function(){const{active:we,collisions:Ce,over:Ke,scrollAdjustedTranslate:Ze}=Y.current;let ke=null;if(we&&Ze){const{cancelDrop:Qe}=I.current;ke={activatorEvent:he,active:we,collisions:Ce,delta:Ze,over:Ke},ae===ce.DragEnd&&typeof Qe=="function"&&await Promise.resolve(Qe(ke))&&(ae=ce.DragCancel)}j.current=null,wt.unstable_batchedUpdates(()=>{v({type:ae}),E(We.Uninitialized),Bt(null),T(null),z(null),xt.current=null;const Qe=ae===ce.DragEnd?"onDragEnd":"onDragCancel";if(ke){const vt=I.current[Qe];vt==null||vt(ke),S({type:Qe,event:ke})}})}}},[N]),Sn=x.useCallback((le,fe)=>(ge,Ee)=>{const pe=ge.nativeEvent,he=N.get(Ee);if(j.current!==null||!he||pe.dndKit||pe.defaultPrevented)return;const be={active:he};le(ge,fe.options,be)===!0&&(pe.dndKit={capturedBy:fe.sensor},j.current=Ee,Ft(ge,fe))},[N,Ft]),Vt=Qd(l,Sn);af(l),_e(()=>{F&&w===We.Initializing&&E(We.Initialized)},[F,w]),x.useEffect(()=>{const{onDragMove:le}=I.current,{active:fe,activatorEvent:ge,collisions:Ee,over:pe}=Y.current;if(!fe||!ge)return;const he={active:fe,activatorEvent:ge,collisions:Ee,delta:{x:ve.x,y:ve.y},over:pe};wt.unstable_batchedUpdates(()=>{le==null||le(he),S({type:"onDragMove",event:he})})},[ve.x,ve.y]),x.useEffect(()=>{const{active:le,activatorEvent:fe,collisions:ge,droppableContainers:Ee,scrollAdjustedTranslate:pe}=Y.current;if(!le||j.current==null||!fe||!pe)return;const{onDragOver:he}=I.current,be=Ee.get(st),Ve=be&&be.rect.current?{id:be.id,rect:be.rect.current,data:be.data,disabled:be.disabled}:null,ae={active:le,activatorEvent:fe,collisions:ge,delta:{x:pe.x,y:pe.y},over:Ve};wt.unstable_batchedUpdates(()=>{Bt(Ve),he==null||he(ae),S({type:"onDragOver",event:ae})})},[st]),_e(()=>{Y.current={activatorEvent:P,active:k,activeNode:G,collisionRect:$e,collisions:qe,droppableRects:V,draggableNodes:N,draggingNode:te,draggingNodeRect:oe,droppableContainers:L,over:Ae,scrollableAncestors:ye,scrollAdjustedTranslate:ve},R.current={initial:oe,translated:$e}},[k,G,qe,$e,N,te,oe,V,L,Ae,ye,ve]),Gd({...B,delta:A,draggingRect:$e,pointerCoordinates:Be,scrollableAncestors:ye,scrollableAncestorRects:Te});const En=x.useMemo(()=>({active:k,activeNode:G,activeNodeRect:F,activatorEvent:P,collisions:qe,containerNodeRect:J,dragOverlay:U,draggableNodes:N,droppableContainers:L,droppableRects:V,over:Ae,measureDroppableContainers:W,scrollableAncestors:ye,scrollableAncestorRects:Te,measuringConfiguration:H,measuringScheduled:Z,windowRect:He}),[k,G,F,P,qe,J,U,N,L,V,Ae,W,ye,Te,H,Z,He]),Cn=x.useMemo(()=>({activatorEvent:P,activators:Vt,active:k,activeNodeRect:F,ariaDescribedById:{draggable:$},dispatch:v,draggableNodes:N,over:Ae,measureDroppableContainers:W}),[P,Vt,k,F,v,$,N,Ae,W]);return de.createElement(Ks.Provider,{value:h},de.createElement(vn.Provider,{value:Cn},de.createElement(ci.Provider,{value:En},de.createElement(li.Provider,{value:wn},f)),de.createElement(xf,{disabled:(a==null?void 0:a.restoreFocus)===!1})),de.createElement(xd,{...a,hiddenTextDescribedById:$}));function Mn(){const le=(_==null?void 0:_.autoScrollEnabled)===!1,fe=typeof u=="object"?u.enabled===!1:u===!1,ge=C&&!le&&!fe;return typeof u=="object"?{...u,enabled:ge}:{enabled:ge}}}),Ef=x.createContext(null),Rr="button",Cf="Draggable";function Mf(e){let{id:t,data:n,disabled:o=!1,attributes:r}=e;const s=Ht(Cf),{activators:i,activatorEvent:a,active:u,activeNodeRect:f,ariaDescribedById:l,draggableNodes:d,over:c}=x.useContext(vn),{role:g=Rr,roleDescription:m="draggable",tabIndex:p=0}=r??{},y=(u==null?void 0:u.id)===t,v=x.useContext(y?li:Ef),[S,h]=on(),[w,E]=on(),C=cf(i,t),M=Pt(n);_e(()=>(d.set(t,{id:t,key:s,node:S,activatorNode:w,data:M}),()=>{const A=d.get(t);A&&A.key===s&&d.delete(t)}),[d,t]);const N=x.useMemo(()=>({role:g,tabIndex:p,"aria-disabled":o,"aria-pressed":y&&g===Rr?!0:void 0,"aria-roledescription":m,"aria-describedby":l.draggable}),[o,g,p,y,m,l.draggable]);return{active:u,activatorEvent:a,activeNodeRect:f,attributes:N,isDragging:y,listeners:o?void 0:C,node:S,over:c,setNodeRef:h,setActivatorNodeRef:E,transform:v}}function Nf(){return x.useContext(ci)}const Df="Droppable",If={timeout:25};function Af(e){let{data:t,disabled:n=!1,id:o,resizeObserverConfig:r}=e;const s=Ht(Df),{active:i,dispatch:a,over:u,measureDroppableContainers:f}=x.useContext(vn),l=x.useRef({disabled:n}),d=x.useRef(!1),c=x.useRef(null),g=x.useRef(null),{disabled:m,updateMeasurementsFor:p,timeout:y}={...If,...r},v=Pt(p??o),S=x.useCallback(()=>{if(!d.current){d.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{f(Array.isArray(v.current)?v.current:[v.current]),g.current=null},y)},[y]),h=xn({callback:S,disabled:m||!i}),w=x.useCallback((N,A)=>{h&&(A&&(h.unobserve(A),d.current=!1),N&&h.observe(N))},[h]),[E,C]=on(w),M=Pt(t);return x.useEffect(()=>{!h||!E.current||(h.disconnect(),d.current=!1,h.observe(E.current))},[E,h]),x.useEffect(()=>(a({type:ce.RegisterDroppable,element:{id:o,key:s,disabled:n,node:E,rect:c,data:M}}),()=>a({type:ce.UnregisterDroppable,key:s,id:o})),[o]),x.useEffect(()=>{n!==l.current.disabled&&(a({type:ce.SetDroppableDisabled,id:o,key:s,disabled:n}),l.current.disabled=n)},[o,s,n,a]),{active:i,rect:c,isOver:(u==null?void 0:u.id)===o,node:E,over:u,setNodeRef:C}}const Rf=e=>{let{transform:t}=e;return{...t,x:0}};function wo(e,t,n){const o=e.slice();return o.splice(n<0?o.length+n:n,0,o.splice(t,1)[0]),o}function kf(e,t){return e.reduce((n,o,r)=>{const s=t.get(o);return s&&(n[r]=s),n},Array(e.length))}function qt(e){return e!==null&&e>=0}function Pf(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function jf(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const ui=e=>{let{rects:t,activeIndex:n,overIndex:o,index:r}=e;const s=wo(t,o,n),i=t[r],a=s[r];return!a||!i?null:{x:a.left-i.left,y:a.top-i.top,scaleX:a.width/i.width,scaleY:a.height/i.height}},Kt={scaleX:1,scaleY:1},_f=e=>{var t;let{activeIndex:n,activeNodeRect:o,index:r,rects:s,overIndex:i}=e;const a=(t=s[n])!=null?t:o;if(!a)return null;if(r===n){const f=s[i];return f?{x:0,y:n<i?f.top+f.height-(a.top+a.height):f.top-a.top,...Kt}:null}const u=Lf(s,r,n);return r>n&&r<=i?{x:0,y:-a.height-u,...Kt}:r<n&&r>=i?{x:0,y:a.height+u,...Kt}:{x:0,y:0,...Kt}};function Lf(e,t,n){const o=e[t],r=e[t-1],s=e[t+1];return o?n<t?r?o.top-(r.top+r.height):s?s.top-(o.top+o.height):0:s?s.top-(o.top+o.height):r?o.top-(r.top+r.height):0:0}const di="Sortable",fi=de.createContext({activeIndex:-1,containerId:di,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:ui,disabled:{draggable:!1,droppable:!1}});function Tf(e){let{children:t,id:n,items:o,strategy:r=ui,disabled:s=!1}=e;const{active:i,dragOverlay:a,droppableRects:u,over:f,measureDroppableContainers:l}=Nf(),d=Ht(di,n),c=a.rect!==null,g=x.useMemo(()=>o.map(C=>typeof C=="object"&&"id"in C?C.id:C),[o]),m=i!=null,p=i?g.indexOf(i.id):-1,y=f?g.indexOf(f.id):-1,v=x.useRef(g),S=!Pf(g,v.current),h=y!==-1&&p===-1||S,w=jf(s);_e(()=>{S&&m&&l(g)},[S,g,m,l]),x.useEffect(()=>{v.current=g},[g]);const E=x.useMemo(()=>({activeIndex:p,containerId:d,disabled:w,disableTransforms:h,items:g,overIndex:y,useDragOverlay:c,sortedRects:kf(g,u),strategy:r}),[p,d,w.draggable,w.droppable,h,g,y,u,c,r]);return de.createElement(fi.Provider,{value:E},t)}const $f=e=>{let{id:t,items:n,activeIndex:o,overIndex:r}=e;return wo(n,o,r).indexOf(t)},Of=e=>{let{containerId:t,isSorting:n,wasDragging:o,index:r,items:s,newIndex:i,previousItems:a,previousContainerId:u,transition:f}=e;return!f||!o||a!==s&&r===i?!1:n?!0:i!==r&&t===u},zf={duration:200,easing:"ease"},gi="transform",Hf=jt.Transition.toString({property:gi,duration:0,easing:"linear"}),Bf={roleDescription:"sortable"};function Ff(e){let{disabled:t,index:n,node:o,rect:r}=e;const[s,i]=x.useState(null),a=x.useRef(n);return _e(()=>{if(!t&&n!==a.current&&o.current){const u=r.current;if(u){const f=yt(o.current,{ignoreTransform:!0}),l={x:u.left-f.left,y:u.top-f.top,scaleX:u.width/f.width,scaleY:u.height/f.height};(l.x||l.y)&&i(l)}}n!==a.current&&(a.current=n)},[t,n,o,r]),x.useEffect(()=>{s&&i(null)},[s]),s}function Vf(e){let{animateLayoutChanges:t=Of,attributes:n,disabled:o,data:r,getNewIndex:s=$f,id:i,strategy:a,resizeObserverConfig:u,transition:f=zf}=e;const{items:l,containerId:d,activeIndex:c,disabled:g,disableTransforms:m,sortedRects:p,overIndex:y,useDragOverlay:v,strategy:S}=x.useContext(fi),h=Yf(o,g),w=l.indexOf(i),E=x.useMemo(()=>({sortable:{containerId:d,index:w,items:l},...r}),[d,r,w,l]),C=x.useMemo(()=>l.slice(l.indexOf(i)),[l,i]),{rect:M,node:N,isOver:A,setNodeRef:L}=Af({id:i,data:E,disabled:h.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...u}}),{active:D,activatorEvent:R,activeNodeRect:k,attributes:j,setNodeRef:_,listeners:T,isDragging:P,over:z,setActivatorNodeRef:I,transform:$}=Mf({id:i,data:E,attributes:{...Bf,...n},disabled:h.draggable}),O=sd(L,_),H=!!D,V=H&&!m&&qt(c)&&qt(y),W=!v&&P,Z=W&&V?$:null,Q=V?Z??(a??S)({rects:p,activeNodeRect:k,activeIndex:c,overIndex:y,index:w}):null,B=qt(c)&&qt(y)?s({id:i,items:l,activeIndex:c,overIndex:y}):w,q=D==null?void 0:D.id,F=x.useRef({activeId:q,items:l,newIndex:B,containerId:d}),J=l!==F.current.items,Y=t({active:D,containerId:d,isDragging:P,isSorting:H,id:i,index:w,items:l,newIndex:F.current.newIndex,previousItems:F.current.items,previousContainerId:F.current.containerId,transition:f,wasDragging:F.current.activeId!=null}),K=Ff({disabled:!Y,index:w,node:N,rect:M});return x.useEffect(()=>{H&&F.current.newIndex!==B&&(F.current.newIndex=B),d!==F.current.containerId&&(F.current.containerId=d),l!==F.current.items&&(F.current.items=l)},[H,B,d,l]),x.useEffect(()=>{if(q===F.current.activeId)return;if(q!=null&&F.current.activeId==null){F.current.activeId=q;return}const te=setTimeout(()=>{F.current.activeId=q},50);return()=>clearTimeout(te)},[q]),{active:D,activeIndex:c,attributes:j,data:E,rect:M,index:w,newIndex:B,items:l,isOver:A,isSorting:H,isDragging:P,listeners:T,node:N,overIndex:y,over:z,setNodeRef:O,setActivatorNodeRef:I,setDroppableNodeRef:L,setDraggableNodeRef:_,transform:K??Q,transition:U()};function U(){if(K||J&&F.current.newIndex===w)return Hf;if(!(W&&!mo(R)||!f)&&(H||Y))return jt.Transition.toString({...f,property:gi})}}function Yf(e,t){var n,o;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(o=e==null?void 0:e.droppable)!=null?o:t.droppable}}ne.Down,ne.Right,ne.Up,ne.Left;const Xf=[{title:"component_name",dataIndex:"component_name",render:(e,t)=>b.jsx(Pr,{placement:"right",title:b.jsx(b.Fragment,{children:b.jsxs("ul",{children:[b.jsxs("li",{children:["component_id: ",t.component_id]}),b.jsxs("li",{children:["relation_id: ",t.relation_id]})]})}),children:t.component_name})}],Wf=e=>{const{attributes:t,listeners:n,setNodeRef:o,transform:r,transition:s,isDragging:i}=Vf({id:e["data-row-key"]}),a={...e.style,transform:jt.Translate.toString(r),transition:s,cursor:"move",...i?{position:"relative",zIndex:9999}:{}};return b.jsx("tr",{...e,ref:o,style:a,...t,...n})},Uf=({data:e,callback:t})=>{const[n,o]=x.useState(e),{messageApi:r}=tt(),s=bd(vd(bo,{activationConstraint:{distance:1}})),i=async()=>{const u=n.map((f,l)=>({order_index:l,relation_id:f.relation_id}));await ia(u),r.success("保存成功"),t&&t()},a=({active:u,over:f})=>{u.id!==(f==null?void 0:f.id)&&o(l=>{const d=l.findIndex(g=>g.key===u.id),c=l.findIndex(g=>g.key===(f==null?void 0:f.id));return wo(l,d,c)})};return b.jsx(Sf,{sensors:s,modifiers:[Rf],onDragEnd:a,children:b.jsx(Tf,{items:n.map(u=>u.key),strategy:_f,children:b.jsx(Ma,{pagination:!1,size:"small",components:{body:{row:Wf}},rowKey:"key",columns:Xf,dataSource:n,footer:()=>b.jsx(Vn,{justify:"end",children:b.jsx(Me,{size:"small",color:"cyan",variant:"solid",onClick:i,children:"保存"})})})})})},Gf=({visible:e,onClose:t,params:n,callback:o})=>e?b.jsx(to,{footer:null,open:e,onCancel:t,title:"更新排序",children:b.jsx(Uf,{data:n.software.map(r=>({...r,key:r.component_id})),callback:o})}):null,qf=({visible:e,onClose:t,params:n,callback:o})=>e?b.jsx(to,{title:"Illustrate",width:"50%",onCancel:t,onClose:t,open:e,footer:!1,children:b.jsx(Na,{data:n})}):null,zg=({})=>{console.log("Pipeline");const{component_type:e,component_id:t}=Xi(),[n,o]=x.useState(),r=Wi(),[s,i]=x.useState(!0),[a,u]=Ui.useMessage(),f={inputFile:x.useRef(null),outputFile:x.useRef(null)},{modal:l,openModal:d,closeModal:c}=Gi(),{modals:g,openModals:m,closeModals:p}=qi(["modalD","metadataModal","bindSample"]),{project:y}=Ki(w=>w.user),v=async()=>{let w=`/get-pipeline-v2/${t}?component_type=${e}`;e=="script"&&(w=`/get-component-parent/${t}?component_type=${e}`);let C=(await ta.get(w)).data;"content"in C&&(C={...JSON.parse(C.content),...C}),C.tags&&(C.tags=JSON.parse(C.tags)),o(C),console.log(C)},h={deletePipelineRelation:async w=>{try{const E=await la(w);a.success("删除成功!"),v()}catch(E){console.log(E),a.error(`${E.response.data.detail}`)}},openModal:d,openModals:m};return x.useEffect(()=>{v()},[]),b.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[u,b.jsxs(Vn,{style:{marginBottom:"1rem"},justify:"space-between",align:"center",gap:"small",children:[b.jsx("div",{children:n?b.jsxs(b.Fragment,{children:[b.jsxs("h2",{style:{margin:0},children:[n==null?void 0:n.component_name,b.jsx(Pr,{title:n==null?void 0:n.namespace,children:b.jsxs("span",{style:{margin:"0",color:"rgba(0, 0, 0, 0.45)",fontSize:"1rem"},children:[" ",n==null?void 0:n.namespace_name]})})]}),!1,n.tags&&Array.isArray(n.tags)&&n.tags.map((w,E)=>b.jsx(Zi,{style:{marginTop:"0.5rem"},color:ra[E],children:w},E))]}):b.jsx(Qi,{active:!0})}),b.jsxs(Vn,{gap:"small",wrap:!0,children:[e=="pipeline"&&b.jsx(b.Fragment,{children:b.jsx(Me,{size:"small",color:"cyan",variant:"solid",onClick:()=>{d("sortSoftware",{software:n.software})},children:"Update Sorting"})}),b.jsx(Me,{size:"small",color:"cyan",variant:"solid",onClick:()=>{h.openModal("projectForm",{project_id:y})},children:"Edit Project"}),b.jsx(Me,{size:"small",color:"cyan",variant:"solid",onClick:()=>{h.openModal("modalG",n)},children:"View Dependencies"}),b.jsx(Me,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m("metadataModal",{...n,operatePipeline:h})},children:"Metadata"}),b.jsxs(Me,{size:"small",color:"cyan",variant:"solid",onClick:()=>{d("modalC",{data:n,structure:{component_type:e}})},children:["Update ",e]}),b.jsx(Me,{size:"small",color:"primary",variant:"solid",onClick:v,children:"Refresh"}),b.jsx(Me,{size:"small",color:"primary",variant:"solid",onClick:()=>r(`/${e}-card`),children:"Back"})]})]}),b.jsx(Zf,{component_type:e||"",component:n,tableRef:f,operatePipeline:h}),b.jsx(ua,{visible:l.key=="modalB"&&l.visible,onClose:c,callback:v,params:l.params}),b.jsx(aa,{callback:v,visible:l.key=="modalA"&&l.visible,onClose:c,params:{...l.params,namespace:n==null?void 0:n.namespace}}),b.jsx(ca,{callback:v,visible:l.key=="modalC"&&l.visible,onClose:c,params:l.params}),b.jsx(da,{visible:l.key=="modalE"&&l.visible,onClose:c,params:l.params}),b.jsx(fa,{visible:l.key=="modalF"&&l.visible,onClose:c,params:l.params}),b.jsx(ga,{visible:l.key=="modalG"&&l.visible,onClose:c,callback:v,params:l.params}),b.jsx(Ji,{visible:l.key=="modalH"&&l.visible,onClose:c,value:l.params}),b.jsx(ya,{visible:g.metadataModal.visible,onClose:()=>p("metadataModal"),params:g.metadataModal.params}),b.jsx(ja,{visible:l.key=="metadataForm"&&l.visible,onClose:c,params:l.params}),b.jsx(xa,{visible:g.bindSample.visible,onClose:()=>p("bindSample"),operatePipeline:h,params:g.bindSample.params}),b.jsx(ea,{params:l.params,visible:l.key=="projectForm"&&l.visible,onClose:c}),b.jsx(va,{visible:l.key=="openFile"&&l.visible,onClose:c,params:l.params}),b.jsx(Gf,{visible:l.key=="sortSoftware"&&l.visible,onClose:c,params:l.params,callback:v}),b.jsx(qf,{visible:l.key=="descriptionModal"&&l.visible,onClose:c,params:l.params,callback:v})]})},Kf=({component_type:e,operatePipeline:t,component:n,...o})=>{if(!e||!n)return null;const s={pipeline:tg,software:Qf,file:Jf,script:eg,module:"module-card"}[e];return s?b.jsx(s,{operatePipeline:t,component:n,...o}):null},Zf=de.memo(Kf,(e,t)=>JSON.stringify(e)===JSON.stringify(t)),Qf=({operatePipeline:e,component:t,...n})=>b.jsx(b.Fragment,{children:b.jsx(_r,{...t,operatePipeline:e})}),Jf=({operatePipeline:e,component:t,...n})=>{const{project:o}=tt();return b.jsx(b.Fragment,{children:b.jsx(jr,{...t,analysisMethod:[t],operatePipeline:e,project:o})})},eg=({operatePipeline:e,component:t,...n})=>{const{project:o}=tt();return b.jsx(b.Fragment,{children:b.jsx(jr,{component_type:t.component_type,script:t,analysisMethod:t.parent||[],operatePipeline:e,project:o})})},tg=({operatePipeline:e,component:t,...n})=>{const[o,r]=x.useState([]),{project:s}=tt(),i=f=>{const l=f.software;return l?l.map((d,c)=>({key:d.component_id,label:d.component_name||d.component_id,children:b.jsx(_r,{...n,...d,hiddenUpstreamAnalysis:!0,pipeline:{component_id:f.component_id},operatePipeline:e})})):[]},a=f=>{const l=f.software;if(!l)return[];const c=(JSON.parse(f.position)||[]).reduce((m,p)=>(m[p.component_id]=p.position,m),{});return l.map((m,p)=>{const y=m.component_name,v=(m.inputFile||[]).map(h=>h),S=(m.outputFile||[]).map(h=>h);return{id:m.component_id,type:"custom",position:c[m.component_id]||{x:p*300,y:100},data:{label:y,color:"#"+((1<<24)*Math.random()|0).toString(16),inputs:v,outputs:S}}})||[]},u=f=>JSON.parse(f.edges)||[];return x.useEffect(()=>{t&&r(i(t))},[JSON.stringify(t)]),console.log("--->PipelineComponent渲染"),b.jsxs(b.Fragment,{children:[b.jsx(od,{initialEdges:u(t),initialNodes:a(t),component:t}),b.jsx("div",{style:{marginTop:"1rem"}}),b.jsx(oa,{...t,project:s,operatePipeline:e,inputAnalysisMethod:t.inputFile}),t&&Array.isArray(t==null?void 0:t.software)?b.jsx(Da,{destroyInactiveTabPane:!0,items:o}):b.jsxs(na,{children:[b.jsx(Me,{style:{marginRight:"0.5rem"},color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalC",{data:void 0,structure:{component_type:"software",relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"新增软件"}),b.jsx(Me,{color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"添加软件"})]})]})};export{zg as default};

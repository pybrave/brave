import{a as g,r as c,f as U,d as R,p as B,j as e,g as $,B as T,P as K,F as a,M as q,I as S,T as O,S as k,i as M,c as A}from"./index-DnaNKChN.js";import{M as L}from"./index-Cr0FOZlH.js";import{T as W,C as H}from"./index-Be9gn9ci.js";import{F as Q,S as X}from"./Table-DYq57zsl.js";import{P as Y}from"./index-FpYd8_0n.js";const ge=async t=>await g.post("/page-pipeline-components",t),Z=async t=>await g.post("/list-pipeline-components",t),xe=async t=>await g.delete(`/delete-pipeline-relation/${t}`),je=async t=>await g.delete(`/delete-component/${t}`),he=async t=>await g.post("/save-component-relation-order",t),ye=async t=>await g.post("/save-pipeline-components-edges",t),ee={script_type:"nextflow",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/nextflow:25.06.0",databases:[{name:"metaphlan_database",dataKey:"metaphlan_database",label:"metaphlan_database",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}],upstreamFormJson:[{name:"stat_q",data:[{label:"0.2",value:.2},{label:"0",value:0}],initialValue:.2,label:" Quantile value for the robust average(--stat_q)",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}]},te={name:"丰度矩阵",script_type:"python",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/datascience-notebook:x86_64-ubuntu-22.04",sampleGroupJSON:!0,saveAnalysisMethod:"metaphlan_sam_abundance_matrix",moduleName:"abundance_matrix",formJson:[{name:"group_field",label:"分组列",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"},{name:"metaphlan_sam_abundance",label:"丰度文件",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupSelectSampleButton",group:"group_field"}],tableDesc:""},ne={name:"raw_reads",label:"下机原始reads",mode:"multiple",type:"GroupSelectSampleButton",group:"group_field",rules:[{required:!0,message:"该字段不能为空!"}],dir:"metaphlan",fileFormat:{profile:"*/*_profile.txt"},inputForm:[{name:["content","fastq1"],initialValue:"/data/wangyang/NGS_TEST/*_1.fastq.gz",label:"fastq1",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]},{name:["content","fastq2"],initialValue:"/data/wangyang/NGS_TEST/*_2.fastq.gz",label:"fastq2",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]}]},ae=async t=>await g.post("/container/page",t),se=({pageApi:t,params:n,map:s,initialPageSize:p=12})=>{const[l,o]=c.useState([]),[r,d]=c.useState(1),[f,w]=c.useState(0),[h,F]=c.useState(!1),[v]=c.useState(p),[C,y]=c.useState(""),I=i=>{y(i),d(1)},P=async i=>{F(!0);try{const m=await t({...n,page_number:i,page_size:v,keywords:C||void 0}),{items:N,total:z,..._}=m.data;s?(m.data=N.map(s),o(m.data)):o(m.data.items),w(z)}catch(m){console.error("Error fetching data:",m)}finally{F(!1)}},x=()=>{P(r)};return c.useEffect(()=>{P(r)},[r,C]),{data:l,pageNumber:r,totalPage:f,loading:h,setPageNumber:d,pageSize:v,reload:x,search:I}},V=({params:t,rowSelection:n})=>{const{data:s,pageNumber:p,totalPage:l,loading:o,reload:r,pageSize:d,setPageNumber:f}=se({pageApi:ae,params:t||{}});U();const{messageApi:w}=R(),{modal:h,openModal:F,closeModal:v}=B(),C=[{title:"namespace",dataIndex:"namespace_name",key:"namespace_name"},{title:"container_id",dataIndex:"container_id",key:"container_id"},{title:"名称",dataIndex:"name",key:"name"},{title:"镜像",dataIndex:"image",key:"image"},{title:"操作",key:"action",fixed:"right",width:200,render:(y,I)=>e.jsxs(X,{size:"middle",children:[e.jsx(T,{size:"small",color:"cyan",variant:"solid",onClick:()=>{F("modalA",I.container_id)},children:"更新"}),e.jsx(K,{title:"确认删除?",onConfirm:()=>{},children:e.jsx(T,{size:"small",danger:!0,variant:"solid",children:"删除"})})]})}];return e.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[e.jsxs($,{justify:"flex-end",gap:"small",children:[e.jsx(T,{size:"small",color:"cyan",variant:"solid",onClick:()=>{F("modalA")},children:"新增"}),e.jsx(T,{size:"small",color:"cyan",variant:"solid",onClick:r,children:"刷新"})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:" "}),e.jsx(Q,{rowKey:y=>y.id,size:"small",rowSelection:n,pagination:!1,loading:o,columns:C,dataSource:s}),l!=0&&e.jsxs($,{style:{marginTop:"1rem"},align:"center",children:["一共",l,"条数据  ",e.jsx(Y,{current:p,pageSize:d,total:l,onChange:y=>f(y),showSizeChanger:!1})]}),e.jsx(oe,{callback:r,visible:h.key=="modalA"&&h.visible,params:h.params,onClose:v})]})},oe=({visible:t,params:n,onClose:s,callback:p})=>{const[l]=a.useForm(),{messageApi:o}=R();c.useEffect(()=>{t&&n&&r()},[t]);const r=async()=>{const f=await g.get(`/container/find-by-id/${n}`);l.setFieldsValue(f.data)},d=async()=>{const f=await l.validateFields();console.log(f),n&&(f.container_id=n),await g.post("/container/add-or-update-container",f),s(),p&&p(),o.success("操作成功!")};return e.jsx(q,{title:n?"编辑容器":"创建容器",onOk:d,width:"50%",open:t,onClose:s,onCancel:s,children:e.jsxs(a,{form:l,children:[e.jsx(a.Item,{name:"namespace",label:"namespace",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(D,{})}),e.jsx(a.Item,{name:"name",label:"名称",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(S,{})}),e.jsx(a.Item,{name:"image",label:"镜像",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(S,{})}),e.jsx(a.Item,{name:"description",label:"描述",children:e.jsx(O,{})}),e.jsx(a.Item,{name:"envionment",label:"环境变量",children:e.jsx(O,{})}),e.jsx(a.Item,{name:"command",label:"命令",children:e.jsx(O,{})}),e.jsx(a.Item,{name:"labels",label:"标签",children:e.jsx(O,{})}),e.jsx(a.Item,{name:"port",label:"端口",children:e.jsx(S,{})}),e.jsx(a.Item,{name:"change_uid",label:"修改用户",children:e.jsx(k,{options:[{label:"是",value:!0},{label:"否",value:!1}]})}),e.jsx(M,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(a.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(l.getFieldsValue(),null,2)})})})})}]})]})})},_e=Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"})),be=({visible:t,onClose:n,params:s,callback:p})=>{if(!t)return null;const{data:l,pipelineStructure:o,namespace:r}=s,[d]=a.useForm(),[f,w]=c.useState(),[h,F]=c.useState(),[v,C]=c.useState([]),[y,I]=c.useState(!1),P={pipeline_software:J,software_input_file:J,software_output_file:J,file_script:J},x=({relation_type:_,data:u,form:b})=>{const j=P[_]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(u)]}));return e.jsx(j,{data:u,form:b,components:v})},i=async _=>{const u=await Z({component_type:_,namespace:r}),b=u.data.map(j=>(JSON.parse(j.content),o.relation_type=="pipeline_software"?{label:`${j.component_name}(${j.component_id})`,value:j.component_id}:o.relation_type=="file_script"?{label:`${j.component_name}(${j.component_id})`,value:j.component_id}:{label:`${j.component_name}(${j.component_id})`,value:j.component_id}));console.log(b),C(b),console.log(u)},m=async _=>{const b=(await g.post(`/find-pipeline-relation/${_}`)).data;F(b),d.setFieldsValue(b)};c.useEffect(()=>{t&&(o.relation_type=="pipeline_software"?i("software"):o.relation_type=="software_input_file"||o.relation_type=="software_output_file"?i("file"):o.relation_type=="file_script"&&i("script"),l?m(l.relation_id):d.resetFields())},[t]);const N=_=>{const u={..._,...o};return l&&(u.relation_id=h.relation_id),u},z=async()=>{I(!0);const _=await d.validateFields(),u=N(_);typeof u.content!="string"&&(u.content=JSON.stringify(u.content)),console.log(u);const b=await g.post("/save-pipeline-relation",u);console.log(b),I(!1),p&&p(),n()};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:y,title:`${l?"更新":"新增"}流程(${o==null?void 0:o.relation_type})`,okText:l?"更新":"新增",onOk:z,open:t,footer:(_,{OkBtn:u,CancelBtn:b})=>e.jsxs(e.Fragment,{children:[e.jsx(b,{}),e.jsx(u,{})]}),onClose:()=>n(),onCancel:()=>n(),children:e.jsxs(a,{form:d,children:[h&&e.jsx(e.Fragment,{}),e.jsx(x,{...o,data:f,form:d}),e.jsx(M,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(a.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(N(d.getFieldsValue()),null,2)})})})})}]})]})})})},Se=({visible:t,onClose:n,params:s,callback:p})=>{if(!t)return null;const{data:l,structure:o}=s,[r]=a.useForm(),[d,f]=c.useState(),[w,h]=c.useState(!1),F={pipeline:ce,software:le,file:re,script:ie},v=({component_type:x,data:i,form:m})=>{const N=F[x]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(i)]}));return e.jsx(N,{data:i,form:m,structure:o})},C=async x=>{const m=(await g.post("/find-pipeline",{component_id:x})).data;m.tags&&(m.tags=JSON.parse(m.tags)),f(m),console.log(m),o.component_type=="pipeline"&&(m.content=JSON.parse(m.content)),r.setFieldsValue(m)};c.useEffect(()=>{t&&(l?C(l.component_id):r.resetFields())},[t]);const y=x=>{const i={...x,...o};return l&&(i.component_id=d.component_id),i},I=x=>{const i=y(x);return typeof i.content=="string"&&(i.content=JSON.parse(i.content)),i},P=async()=>{h(!0);const x=await r.validateFields(),i=y(x);typeof i.content!="string"&&(i.content=JSON.stringify(i.content)),typeof i.tags!="string"&&(i.tags=JSON.stringify(i.tags)),console.log(i);const m=await g.post("/save-pipeline",i);console.log(m),h(!1),p&&p(),n()};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:w,title:`${l?"更新":"新增"}流程(${o==null?void 0:o.component_type})`,okText:l?"更新":"新增",onOk:P,open:t,width:"60%",onClose:()=>n(),onCancel:()=>n(),children:e.jsxs(a,{form:r,children:[e.jsx(W,{items:[{label:"组件信息",key:"1",children:e.jsxs(e.Fragment,{children:[e.jsx(a.Item,{name:"component_name",label:"组件名称",children:e.jsx(S,{})}),e.jsx(a.Item,{name:"namespace",label:"namespace",children:e.jsx(D,{disabled:l==null?void 0:l.componemt_id})}),e.jsx(a.Item,{name:"tags",label:"tags",children:e.jsx(k,{mode:"tags",style:{width:"100%"}})}),e.jsx(a.Item,{name:"img",label:"图片",children:e.jsx(S,{})}),e.jsx(v,{...o,data:d,form:r})]})},{label:"组件描述",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(a.Item,{name:"description",label:"组件名称",children:e.jsx(E,{templete:""})})})}]}),e.jsx(M,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(a.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(I(r.getFieldsValue()),null,2)})})})})}]})]})})})},J=({data:t,form:n,components:s})=>e.jsx(e.Fragment,{children:e.jsx(a.Item,{name:"component_id",label:"组件",children:e.jsx(k,{showSearch:!0,options:s})})}),le=({data:t,form:n})=>{const[s,p]=c.useState();return c.useEffect(()=>{t!=null&&t.componemt_id||p(JSON.stringify(ee,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(a.Item,{name:"container_id",label:"容器",children:e.jsx(G,{data:t})}),e.jsx(a.Item,{name:"content",label:"content",children:e.jsx(E,{templete:s})})]})},ie=({data:t,form:n})=>{const[s,p]=c.useState();return c.useEffect(()=>{t!=null&&t.componemt_id||p(JSON.stringify(te,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(a.Item,{name:"container_id",label:"容器",children:e.jsx(G,{data:t})}),e.jsx(a.Item,{name:"content",label:"content",children:e.jsx(E,{templete:s})})]})},re=({data:t,form:n,structure:s})=>{const[p,l]=c.useState();return c.useEffect(()=>{t!=null&&t.componemt_id||l(JSON.stringify(ne,null,2))},[]),e.jsxs(e.Fragment,{children:[(s==null?void 0:s.files)&&e.jsx(H,{style:{maxHeight:"20rem",overflow:"auto",marginBottom:"1rem"},children:e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(s==null?void 0:s.files,null,2)})})}),e.jsx(a.Item,{name:"content",label:"content",children:e.jsx(E,{templete:p})})]})},G=({value:t,onChange:n,data:s})=>{const{modal:p,openModal:l,closeModal:o}=B(),[r,d]=c.useState(s==null?void 0:s.container);return e.jsxs(e.Fragment,{children:[e.jsx(S,{value:r==null?void 0:r.name,style:{cursor:"pointer"},onClick:()=>l("modalA")}),e.jsx(q,{footer:!1,width:"50%",title:"选择容器",open:p.visible&&p.key=="modalA",onClose:o,onCancel:o,children:e.jsx(V,{rowSelection:{type:"radio",onChange:(f,w)=>{w.length>0&&(d(w[0]),n(w[0].container_id),o())}}})})]})},E=({value:t,onChange:n,templete:s})=>{const p=c.useRef(null);return c.useEffect(()=>{s&&n(s)},[]),e.jsx(e.Fragment,{children:e.jsx(L,{value:t,onChange:n,editorRef:p,defaultLanguage:"json"})})},ce=({data:t,form:n})=>e.jsxs(e.Fragment,{children:[e.jsx(a.Item,{name:["content","name"],label:"name",children:e.jsx(S,{})}),e.jsx(a.Item,{name:["content","script_type"],label:"脚本类型",children:e.jsx(k,{options:[{label:"python",value:"python"},{label:"nextflow",value:"nextflow"},{label:"shell",value:"shell"},{label:"R",value:"R"}]})}),e.jsx(a.Item,{name:["content","image"],label:"镜像",children:e.jsx(S,{})}),e.jsx(a.Item,{name:["content","img"],label:"img",children:e.jsx(S,{})}),e.jsx(a.Item,{name:["content","category"],label:"category",children:e.jsx(S,{})}),e.jsx(a.Item,{name:["content","description"],label:"description",children:e.jsx(O,{})})]}),D=({value:t,onChange:n,disabled:s})=>{const[p,l]=c.useState([]),o=async()=>{const d=(await g.get("/list-namespace")).data;l(d)};return c.useEffect(()=>{o()},[]),e.jsx(e.Fragment,{children:e.jsx($,{justify:"space-between",children:e.jsx(k,{disabled:s,value:t,onChange:n,options:p.map(r=>({label:r.name,value:r.namespace_id}))})})})};export{be as C,he as a,Se as b,je as c,xe as d,_e as i,ge as p,ye as s,se as u};

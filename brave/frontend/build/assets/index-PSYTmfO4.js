const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./graph-view-BOfZ0_K9.js","./index-CWx5cHtj.js","./index-DLoYsyAm.css","./zoom-BGsqVsDF.js","./rgb-BwIoVOhg.js","./index-BhpvB4Wv.js","./index-BgXoXwrY.js","./index-BAlUq73q.js","./index-Dlnhd9Is.js","./index-DNPu2izs.js"])))=>i.map(i=>d[i]);
import{r as l,ad as V,aN as Ce,aj as _e,ac as G,O as q,ak as se,ag as Ie,ar as Re,aO as Oe,_ as ae,ae as A,aB as de,Z as Ne,$ as Me,a0 as Pe,a2 as Ee,a1 as F,aP as ze,aF as He,aQ as Fe,a5 as De,a6 as Te,j as n,t as ce,a as K,o as Ve,p as Be,g as ue,B as L,f as Ae,d as me,P as ne,I as he,F as U,M as ge,i as Le,c as Ke,aR as We}from"./index-CWx5cHtj.js";import{u as Xe}from"./usePagination-C22RRT6M.js";import{T as qe,F as Ue}from"./Table-Dwkq00mB.js";import{S as Ge}from"./index-BAlUq73q.js";import{T as ke}from"./index-BgXoXwrY.js";import{S as Ye}from"./index-Dlnhd9Is.js";import{P as Ze}from"./Pagination-DILAiJSE.js";import"./addEventListener-DnVv1X44.js";var ie=function(t,i){if(!t)return null;var a={left:t.offsetLeft,right:t.parentElement.clientWidth-t.clientWidth-t.offsetLeft,width:t.clientWidth,top:t.offsetTop,bottom:t.parentElement.clientHeight-t.clientHeight-t.offsetTop,height:t.clientHeight};return i?{left:0,right:0,width:0,top:a.top,bottom:a.bottom,height:a.height}:{left:a.left,right:a.right,width:a.width,top:0,bottom:0,height:0}},P=function(t){return t!==void 0?"".concat(t,"px"):void 0};function Je(e){var t=e.prefixCls,i=e.containerRef,a=e.value,r=e.getValueIndex,s=e.motionName,y=e.onMotionStart,m=e.onMotionEnd,v=e.direction,f=e.vertical,d=f===void 0?!1:f,$=l.useRef(null),R=l.useState(a),x=V(R,2),g=x[0],j=x[1],S=function(H){var E,T=r(H),z=(E=i.current)===null||E===void 0?void 0:E.querySelectorAll(".".concat(t,"-item"))[T];return(z==null?void 0:z.offsetParent)&&z},c=l.useState(null),u=V(c,2),o=u[0],C=u[1],O=l.useState(null),_=V(O,2),h=_[0],N=_[1];Ce(function(){if(g!==a){var b=S(g),H=S(a),E=ie(b,d),T=ie(H,d);j(a),C(E),N(T),b&&H?y():m()}},[a]);var p=l.useMemo(function(){if(d){var b;return P((b=o==null?void 0:o.top)!==null&&b!==void 0?b:0)}return P(v==="rtl"?-(o==null?void 0:o.right):o==null?void 0:o.left)},[d,v,o]),M=l.useMemo(function(){if(d){var b;return P((b=h==null?void 0:h.top)!==null&&b!==void 0?b:0)}return P(v==="rtl"?-(h==null?void 0:h.right):h==null?void 0:h.left)},[d,v,h]),W=function(){return d?{transform:"translateY(var(--thumb-start-top))",height:"var(--thumb-start-height)"}:{transform:"translateX(var(--thumb-start-left))",width:"var(--thumb-start-width)"}},D=function(){return d?{transform:"translateY(var(--thumb-active-top))",height:"var(--thumb-active-height)"}:{transform:"translateX(var(--thumb-active-left))",width:"var(--thumb-active-width)"}},X=function(){C(null),N(null),m()};return!o||!h?null:l.createElement(_e,{visible:!0,motionName:s,motionAppear:!0,onAppearStart:W,onAppearActive:D,onVisibleChanged:X},function(b,H){var E=b.className,T=b.style,z=G(G({},T),{},{"--thumb-start-left":p,"--thumb-start-width":P(o==null?void 0:o.width),"--thumb-active-left":M,"--thumb-active-width":P(h==null?void 0:h.width),"--thumb-start-top":p,"--thumb-start-height":P(o==null?void 0:o.height),"--thumb-active-top":M,"--thumb-active-height":P(h==null?void 0:h.height)}),k={ref:se($,H),style:z,className:q("".concat(t,"-thumb"),E)};return l.createElement("div",k)})}var Qe=["prefixCls","direction","vertical","options","disabled","defaultValue","value","name","onChange","className","motionName"];function et(e){if(typeof e.title<"u")return e.title;if(de(e.label)!=="object"){var t;return(t=e.label)===null||t===void 0?void 0:t.toString()}}function tt(e){return e.map(function(t){if(de(t)==="object"&&t!==null){var i=et(t);return G(G({},t),{},{title:i})}return{label:t==null?void 0:t.toString(),title:t==null?void 0:t.toString(),value:t}})}var at=function(t){var i=t.prefixCls,a=t.className,r=t.disabled,s=t.checked,y=t.label,m=t.title,v=t.value,f=t.name,d=t.onChange,$=t.onFocus,R=t.onBlur,x=t.onKeyDown,g=t.onKeyUp,j=t.onMouseDown,S=function(u){r||d(u,v)};return l.createElement("label",{className:q(a,A({},"".concat(i,"-item-disabled"),r)),onMouseDown:j},l.createElement("input",{name:f,className:"".concat(i,"-item-input"),type:"radio",disabled:r,checked:s,onChange:S,onFocus:$,onBlur:R,onKeyDown:x,onKeyUp:g}),l.createElement("div",{className:"".concat(i,"-item-label"),title:m,"aria-selected":s},y))},nt=l.forwardRef(function(e,t){var i,a,r=e.prefixCls,s=r===void 0?"rc-segmented":r,y=e.direction,m=e.vertical,v=e.options,f=v===void 0?[]:v,d=e.disabled,$=e.defaultValue,R=e.value,x=e.name,g=e.onChange,j=e.className,S=j===void 0?"":j,c=e.motionName,u=c===void 0?"thumb-motion":c,o=Ie(e,Qe),C=l.useRef(null),O=l.useMemo(function(){return se(C,t)},[C,t]),_=l.useMemo(function(){return tt(f)},[f]),h=Re((i=_[0])===null||i===void 0?void 0:i.value,{value:R,defaultValue:$}),N=V(h,2),p=N[0],M=N[1],W=l.useState(!1),D=V(W,2),X=D[0],b=D[1],H=function(I,B){M(B),g==null||g(B)},E=Oe(o,["children"]),T=l.useState(!1),z=V(T,2),k=z[0],Z=z[1],fe=l.useState(!1),J=V(fe,2),be=J[0],Q=J[1],ye=function(){Q(!0)},xe=function(){Q(!1)},Se=function(){Z(!1)},pe=function(I){I.key==="Tab"&&Z(!0)},ee=function(I){var B=_.findIndex(function(je){return je.value===p}),te=_.length,$e=(B+I+te)%te,Y=_[$e];Y&&(M(Y.value),g==null||g(Y.value))},we=function(I){switch(I.key){case"ArrowLeft":case"ArrowUp":ee(-1);break;case"ArrowRight":case"ArrowDown":ee(1);break}};return l.createElement("div",ae({role:"radiogroup","aria-label":"segmented control",tabIndex:d?void 0:0},E,{className:q(s,(a={},A(a,"".concat(s,"-rtl"),y==="rtl"),A(a,"".concat(s,"-disabled"),d),A(a,"".concat(s,"-vertical"),m),a),S),ref:O}),l.createElement("div",{className:"".concat(s,"-group")},l.createElement(Je,{vertical:m,prefixCls:s,value:p,containerRef:C,motionName:"".concat(s,"-").concat(u),direction:y,getValueIndex:function(I){return _.findIndex(function(B){return B.value===I})},onMotionStart:function(){b(!0)},onMotionEnd:function(){b(!1)}}),_.map(function(w){var I;return l.createElement(at,ae({},w,{name:x,key:w.value,prefixCls:s,className:q(w.className,"".concat(s,"-item"),(I={},A(I,"".concat(s,"-item-selected"),w.value===p&&!X),A(I,"".concat(s,"-item-focused"),be&&k&&w.value===p),I)),checked:w.value===p,onChange:H,onFocus:ye,onBlur:xe,onKeyDown:we,onKeyUp:pe,onMouseDown:Se,disabled:!!d||!!w.disabled}))})))}),it=nt;function le(e,t){return{[`${e}, ${e}:hover, ${e}:focus`]:{color:t.colorTextDisabled,cursor:"not-allowed"}}}function oe(e){return{backgroundColor:e.itemSelectedBg,boxShadow:e.boxShadowTertiary}}const lt=Object.assign({overflow:"hidden"},He),ot=e=>{const{componentCls:t}=e,i=e.calc(e.controlHeight).sub(e.calc(e.trackPadding).mul(2)).equal(),a=e.calc(e.controlHeightLG).sub(e.calc(e.trackPadding).mul(2)).equal(),r=e.calc(e.controlHeightSM).sub(e.calc(e.trackPadding).mul(2)).equal();return{[t]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Pe(e)),{display:"inline-block",padding:e.trackPadding,color:e.itemColor,background:e.trackBg,borderRadius:e.borderRadius,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`}),Ee(e)),{[`${t}-group`]:{position:"relative",display:"flex",alignItems:"stretch",justifyItems:"flex-start",flexDirection:"row",width:"100%"},[`&${t}-rtl`]:{direction:"rtl"},[`&${t}-vertical`]:{[`${t}-group`]:{flexDirection:"column"},[`${t}-thumb`]:{width:"100%",height:0,padding:`0 ${F(e.paddingXXS)}`}},[`&${t}-block`]:{display:"flex"},[`&${t}-block ${t}-item`]:{flex:1,minWidth:0},[`${t}-item`]:{position:"relative",textAlign:"center",cursor:"pointer",transition:`color ${e.motionDurationMid} ${e.motionEaseInOut}`,borderRadius:e.borderRadiusSM,transform:"translateZ(0)","&-selected":Object.assign(Object.assign({},oe(e)),{color:e.itemSelectedColor}),"&-focused":Object.assign({},ze(e)),"&::after":{content:'""',position:"absolute",zIndex:-1,width:"100%",height:"100%",top:0,insetInlineStart:0,borderRadius:"inherit",opacity:0,transition:`opacity ${e.motionDurationMid}`,pointerEvents:"none"},[`&:hover:not(${t}-item-selected):not(${t}-item-disabled)`]:{color:e.itemHoverColor,"&::after":{opacity:1,backgroundColor:e.itemHoverBg}},[`&:active:not(${t}-item-selected):not(${t}-item-disabled)`]:{color:e.itemHoverColor,"&::after":{opacity:1,backgroundColor:e.itemActiveBg}},"&-label":Object.assign({minHeight:i,lineHeight:F(i),padding:`0 ${F(e.segmentedPaddingHorizontal)}`},lt),"&-icon + *":{marginInlineStart:e.calc(e.marginSM).div(2).equal()},"&-input":{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:0,height:0,opacity:0,pointerEvents:"none"}},[`${t}-thumb`]:Object.assign(Object.assign({},oe(e)),{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:0,height:"100%",padding:`${F(e.paddingXXS)} 0`,borderRadius:e.borderRadiusSM,transition:`transform ${e.motionDurationSlow} ${e.motionEaseInOut}, height ${e.motionDurationSlow} ${e.motionEaseInOut}`,[`& ~ ${t}-item:not(${t}-item-selected):not(${t}-item-disabled)::after`]:{backgroundColor:"transparent"}}),[`&${t}-lg`]:{borderRadius:e.borderRadiusLG,[`${t}-item-label`]:{minHeight:a,lineHeight:F(a),padding:`0 ${F(e.segmentedPaddingHorizontal)}`,fontSize:e.fontSizeLG},[`${t}-item, ${t}-thumb`]:{borderRadius:e.borderRadius}},[`&${t}-sm`]:{borderRadius:e.borderRadiusSM,[`${t}-item-label`]:{minHeight:r,lineHeight:F(r),padding:`0 ${F(e.segmentedPaddingHorizontalSM)}`},[`${t}-item, ${t}-thumb`]:{borderRadius:e.borderRadiusXS}}}),le(`&-disabled ${t}-item`,e)),le(`${t}-item-disabled`,e)),{[`${t}-thumb-motion-appear-active`]:{transition:`transform ${e.motionDurationSlow} ${e.motionEaseInOut}, width ${e.motionDurationSlow} ${e.motionEaseInOut}`,willChange:"transform, width"},[`&${t}-shape-round`]:{borderRadius:9999,[`${t}-item, ${t}-thumb`]:{borderRadius:9999}}})}},rt=e=>{const{colorTextLabel:t,colorText:i,colorFillSecondary:a,colorBgElevated:r,colorFill:s,lineWidthBold:y,colorBgLayout:m}=e;return{trackPadding:y,trackBg:m,itemColor:t,itemHoverColor:i,itemHoverBg:a,itemSelectedBg:r,itemActiveBg:s,itemSelectedColor:i}},st=Ne("Segmented",e=>{const{lineWidth:t,calc:i}=e,a=Me(e,{segmentedPaddingHorizontal:i(e.controlPaddingHorizontal).sub(t).equal(),segmentedPaddingHorizontalSM:i(e.controlPaddingHorizontalSM).sub(t).equal()});return[ot(a)]},rt);var re=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(i[a[r]]=e[a[r]]);return i};function dt(e){return typeof e=="object"&&!!(e!=null&&e.icon)}const ct=l.forwardRef((e,t)=>{const i=Fe(),{prefixCls:a,className:r,rootClassName:s,block:y,options:m=[],size:v="middle",style:f,vertical:d,shape:$="default",name:R=i}=e,x=re(e,["prefixCls","className","rootClassName","block","options","size","style","vertical","shape","name"]),{getPrefixCls:g,direction:j,className:S,style:c}=De("segmented"),u=g("segmented",a),[o,C,O]=st(u),_=Te(v),h=l.useMemo(()=>m.map(M=>{if(dt(M)){const{icon:W,label:D}=M,X=re(M,["icon","label"]);return Object.assign(Object.assign({},X),{label:l.createElement(l.Fragment,null,l.createElement("span",{className:`${u}-item-icon`},W),D&&l.createElement("span",null,D))})}return M}),[m,u]),N=q(r,s,S,{[`${u}-block`]:y,[`${u}-sm`]:_==="small",[`${u}-lg`]:_==="large",[`${u}-vertical`]:d,[`${u}-shape-${$}`]:$==="round"},C,O),p=Object.assign(Object.assign({},c),f);return o(l.createElement(it,Object.assign({},x,{name:R,className:N,style:p,options:h,ref:t,prefixCls:u,direction:j,vertical:d})))}),ut=ct,mt=e=>{let t=[{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id"},{title:"entity_name",dataIndex:"entity_name",key:"entity_name"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(i,a)=>i?"存在":"不存在"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(i,a)=>i?"存在":"不存在"}];switch(e){case"taxonomy":t=[...t,{title:"rank",dataIndex:"rank",key:"rank"},{title:"division_name",dataIndex:"division_name",key:"division_name"}];break}return t},ht=()=>n.jsx(n.Fragment,{}),gt={taxonomy:ht},vt=({type:e})=>{const t=gt[e]||(()=>n.jsx("div",{}));return n.jsx(t,{})},ve=(e,t,i)=>e.map(a=>a.key===t?{...a,children:i}:a.children?{...a,children:ve(a.children,t,i)}:a),ft=l.forwardRef(({entityType:e},t)=>{const[i,a]=l.useState(),[r,s]=l.useState(new Set),[y,m]=l.useState(),[v,f]=l.useState(1),d=async(c,u,o,C="")=>{const O=await K.post(`/entity/page/${e}`,{page_number:u,page_size:o,parent_id:c,keyword:C}),{items:_,total:h}=O.data,N=_.map(p=>({title:n.jsx(n.Fragment,{children:n.jsxs(Ve,{title:`${p.entity_name}(${p.rank})(${p.tax_id})`,children:[p.entity_name," (",p.rank,")"]})}),key:p.tax_id,isLeaf:!p.has_children}));return m(N),{children:N,total:h}},$=async()=>{const{children:c}=await d(v,1,-1);a(c)};l.useImperativeHandle(t,()=>({reload:$})),l.useEffect(()=>{$()},[e]);const R=async({key:c,children:u})=>{if(u)return;s(C=>new Set(C).add(c));const{children:o}=await d(Number(c),1,-1);a(C=>ve(C,c,[...o])),s(C=>{const O=new Set(C);return O.delete(c),O})},x=l.useRef(null),[g,j]=l.useState(null),S=()=>{if(x.current){const c=x.current.getBoundingClientRect().top;j(window.innerHeight-c)}};return l.useEffect(()=>(S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}),[]),n.jsx("div",{ref:x,children:i?n.jsx(n.Fragment,{children:n.jsx(qe,{height:g,loadData:R,treeData:i,showLine:!0,titleRender:c=>r.has(Number(c.key))?n.jsx(Ge,{size:"small"}):c.title})}):n.jsx(ce,{active:!0})})}),bt=l.lazy(()=>We(()=>import("./graph-view-BOfZ0_K9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)),yt=l.forwardRef(({openModal:e,entityType:t},i)=>{const{data:a,pageNumber:r,totalPage:s,loading:y,reload:m,pageSize:v,setPageNumber:f,search:d}=Xe({url:`/entity/page/${t}`,params:{}});l.useImperativeHandle(i,()=>({reload:m})),Ae();const{messageApi:$}=me(),R=[...mt(t),{title:"操作",key:"action",fixed:"right",width:200,render:(x,g)=>n.jsxs(Ye,{size:"middle",children:[n.jsx(L,{size:"small",color:"cyan",variant:"solid",onClick:()=>{e("modalA",{entityType:t,entityId:g.entity_id})},children:"更新"}),g.is_exist_graph?n.jsxs(n.Fragment,{children:[n.jsx(L,{size:"small",color:"cyan",variant:"solid",onClick:()=>{e("graphView",{entityType:t,entityId:g.entity_id,entityName:g.entity_name})},children:"网络"}),n.jsx(ne,{title:"确认删除节点?",onConfirm:async()=>{var j,S,c,u;try{await K.delete(`/entity/delete-node/${t}/${g.entity_id}`),$.success("删除成功!"),m()}catch(o){console.log((S=(j=o==null?void 0:o.response)==null?void 0:j.data)==null?void 0:S.detail),$.error((u=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:u.detail)}},children:n.jsx(L,{size:"small",danger:!0,variant:"solid",children:"删除节点"})})]}):n.jsx(ne,{title:"确认删除?",onConfirm:async()=>{var j,S,c,u;try{await K.delete(`/entity/delete/${t}/${g.entity_id}`),$.success("删除成功!"),m()}catch(o){console.log((S=(j=o==null?void 0:o.response)==null?void 0:j.data)==null?void 0:S.detail),$.error((u=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:u.detail)}},children:n.jsx(L,{size:"small",danger:!0,variant:"solid",children:"删除"})})]})}];return n.jsx("div",{children:n.jsx(Ue,{title:()=>n.jsx(he.Search,{size:"small",placeholder:"搜索...",allowClear:!0,enterButton:!0,onSearch:x=>{d(x)},style:{width:300}}),rowKey:x=>x.id,size:"small",bordered:!0,pagination:!1,loading:y,columns:R,dataSource:a,footer:()=>n.jsx(n.Fragment,{children:s!=0&&n.jsxs(ue,{style:{marginTop:"1rem"},align:"center",children:["一共",s,"条数据  ",n.jsx(Ze,{size:"small",current:r,pageSize:v,total:s,onChange:x=>f(x),showSizeChanger:!1})]})})})})}),Ot=()=>{const[e,t]=l.useState("taxonomy"),{modal:i,openModal:a,closeModal:r}=Be(),s=l.useRef(null),[y,m]=l.useState("table"),v=()=>{var f;(f=s.current)==null||f.reload()};return n.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[n.jsxs(ue,{justify:"flex-end",gap:"small",children:[n.jsx(L,{size:"small",color:"cyan",variant:"solid",onClick:()=>{a("modalA",{entityType:e})},children:"新增"}),n.jsx(L,{size:"small",color:"cyan",variant:"solid",onClick:v,children:"刷新"})]}),n.jsx("div",{style:{marginBottom:"1rem"},children:" "}),n.jsx(ke,{size:"small",onChange:f=>{t(f)},tabBarExtraContent:n.jsx(n.Fragment,{children:n.jsx(ut,{size:"small",value:y,onChange:f=>m(f),options:[{label:"table",value:"table"},{label:"tree",value:"tree"}]})}),items:[{key:"taxonomy",label:"Microbiota"},{key:"study",label:"Study"},{key:"disease",label:"Psychiatric Disorder"},{key:"chemicals_and_drugs",label:"chemicals_and_drugs"},{key:"diet_and_food",label:"diet_and_food"}]}),y=="table"&&n.jsx(n.Fragment,{children:n.jsx(yt,{ref:s,openModal:a,entityType:e})}),y=="tree"&&n.jsx(n.Fragment,{children:n.jsx(ft,{ref:s,entityType:e})}),n.jsx(St,{callback:v,visible:i.key=="modalA"&&i.visible,params:i.params,onClose:r}),n.jsx(xt,{callback:v,visible:i.key=="graphView"&&i.visible,params:i.params,onClose:r})]})},xt=({visible:e,params:t,onClose:i,callback:a})=>n.jsx(ge,{title:t==null?void 0:t.entityName,width:"60%",footer:null,open:e,onClose:i,onCancel:i,children:n.jsx(l.Suspense,{fallback:n.jsx(ce,{active:!0}),children:n.jsx(bt,{entity_id:t==null?void 0:t.entityId})})}),St=({visible:e,params:t,onClose:i,callback:a})=>{const[r]=U.useForm(),{messageApi:s}=me(),[y,m]=l.useState(!1);l.useEffect(()=>{e&&(t!=null&&t.entityId)?v():r.resetFields()},[e]);const v=async()=>{m(!0);const d=await K.get(`/entity/get/${t.entityType}/${t.entityId}`);r.setFieldsValue(d.data),m(!1)},f=async()=>{const d=await r.validateFields();t!=null&&t.entityId?await K.put(`/entity/update/${t.entityType}/${t.entityId}`,d):await K.post(`/entity/add/${t.entityType}`,d),i(),a&&a(),s.success("操作成功!")};return n.jsx(ge,{loading:y,title:t!=null&&t.entityId?"编辑实体":"创建实体",onOk:f,width:"50%",open:e,onClose:i,onCancel:i,children:n.jsxs(U,{form:r,children:[n.jsx(U.Item,{name:"entity_name",label:"实体名称",children:n.jsx(he,{})}),n.jsx(vt,{type:t==null?void 0:t.entityType}),n.jsx(Le,{ghost:!0,items:[{key:"1",label:"更多",children:n.jsx(n.Fragment,{children:n.jsx(U.Item,{noStyle:!0,shouldUpdate:!0,children:()=>n.jsx(Ke,{children:n.jsx("pre",{children:JSON.stringify(r.getFieldsValue(),null,2)})})})})}]})]})})};export{Ot as default};

import{r as i,z as de,_ as me,d as F,k as Re,u as $e,j as e,F as E,B as w,I as q,E as Qe,m as Xe,i as re,a as I,M as pe,$ as Ye,b as Ze,t as g,p as Pe,P as M,al as Ke,y as Ae,a0 as Me,A as el,l as ce,am as De}from"./main-yPEfeT9f.js";import{F as ll}from"./index-Bv2V4S_7.js";import{C as Ee}from"./index-DiBhs9OC.js";import{S as nl}from"./index-CmYnMcha.js";import{F as ze,S as Se,D as tl,b as al}from"./Table-Ds-W4yE8.js";import{A as sl}from"./react-window-CojtseHm.js";import{u as ol}from"./index-DElqJASa.js";import{D as il,U as rl}from"./index-BeIbeBzw.js";import{S as ke}from"./index-6fbrPPXM.js";import{T as cl}from"./index-DWk5UzQP.js";import{T as dl,R as ye}from"./index-BN-A2AYH.js";import{R as Ie}from"./DeleteOutlined-B-ExLEZC.js";import{R as Fe}from"./RedoOutlined-BC_aoZT6.js";var ml={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},pl=function(a,o){return i.createElement(de,me({},a,{ref:o,icon:ml}))},ul=i.forwardRef(pl),xl={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},fl=function(a,o){return i.createElement(de,me({},a,{ref:o,icon:xl}))},jl=i.forwardRef(fl),gl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},_l=function(a,o){return i.createElement(de,me({},a,{ref:o,icon:gl}))},hl=i.forwardRef(_l);const vl=({parseData:s,columns:a,importData:o})=>e.jsx(ze,{size:"small",bordered:!0,pagination:!1,footer:()=>e.jsxs("div",{style:{textAlign:"right"},children:["A total of",s.length," records   ",e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:o,children:"Ok"})]}),columns:a,dataSource:s}),ie=({component_type:s,component_id:a,component_name:o,inputForm:c,operatePipeline:u,name:_,file_type:C,callback:O})=>{const[k]=F.useForm();console.log("-->ImportFile渲染");const{messageApi:R,project:te}=Re(),[ee,d]=i.useState([]);$e(p=>p.global.setting);const[$,B]=i.useState(!1),[W,ae]=i.useState(),f=i.useRef(null);i.useEffect(()=>{if(c){let j=c.map(r=>Array.isArray(r.name)?r.name[1]:r.name).map(r=>({title:r,dataIndex:r,key:r,render:x=>e.jsx("span",{children:x})}));j=[{title:"Sample Name",dataIndex:"sample_name",key:"sample_name",render:r=>e.jsx("span",{children:r})},...j,{title:"Action",dataIndex:"action",key:"action",ellipsis:!0,render:(r,x)=>e.jsx(E,{gap:"small",children:e.jsx(w,{size:"small",danger:!0,onClick:()=>{G(x.sample_name)},children:"删除"})})}],console.log(j),f.current=j,ae(j)}},[c]);const G=p=>{d(j=>j.filter(r=>r.sample_name!==p))},l=p=>{const{content:j,sample_name:r,file_name:x}=p;return $?ee.map(V=>{const{sample_name:b,...z}=V;return{...p,project:te,component_id:a,file_type:C,content:JSON.stringify(z),sample_name:b}}):[{...p,project:te,component_id:a,file_name:x,file_type:C,content:C&&C=="collected"?j:JSON.stringify(j),sample_name:r}]},Q=async()=>{const p=await k.validateFields();if(p.length==0){R.error("No data added!");return}if(c&&c.length==0){R.error("This component does not have inputForm configured!");return}const j=l(p);try{const r=await I.post("/import-data",j);R.success("Imported successfully!"),O&&O()}catch(r){R.error(r.response.data.detail)}},le=async()=>{const p=await k.validateFields();if(c&&c.length==0){R.error("This component does not have inputForm configured!");return}const j=await I.post("/parse-import-data",{content:JSON.stringify(p.content)});console.log(j),d(j.data)};return i.useEffect(()=>{const p=j=>{var ne;const r=((ne=j.clipboardData)==null?void 0:ne.getData("Text"))||"";if(!r)return;const x=r.includes("	")?"	":",",b=r.split(/\r?\n/).filter(D=>D.trim()!=="").map(D=>D.split(x).map(T=>T.trim()));console.log(b);const z=b.map(D=>{const T={};return f.current.forEach((U,L)=>{D.length<=L?T[U.dataIndex]="unknown":T[U.dataIndex]=D[L]}),T});d(z),R.success("Paste successful!")};return document.addEventListener("paste",p),()=>{document.removeEventListener("paste",p)}},[]),e.jsx(e.Fragment,{children:e.jsx(Ee,{variant:"borderless",size:"small",style:{boxShadow:"none"},title:`${o}(${a})`,extra:e.jsxs(E,{gap:"small",children:[e.jsx(nl,{value:$,onChange:p=>B(p)}),e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:()=>{u.openModal("modalC",{data:{component_id:a},structure:{component_type:s}})},children:"Edit InputForm"}),e.jsx(w,{size:"small",color:"cyan",variant:"solid",disabled:!ee,onClick:()=>d([]),children:"Clear"}),e.jsx(w,{size:"small",color:"cyan",variant:"solid",disabled:!c,onClick:le,children:"Parse"})]}),children:e.jsxs(F,{form:k,children:[e.jsx(F.Item,{name:"sample_source",label:"Sample Source",rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(q,{placeholder:"gut,brain..."})}),!$&&e.jsx(e.Fragment,{children:C&&C=="collected"?e.jsx(F.Item,{name:"file_name",label:"File Name",rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(q,{})}):e.jsx(F.Item,{name:"sample_name",label:"Sample Name",rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(q,{})})}),c?e.jsx(e.Fragment,{children:e.jsx(ll,{formJson:c,dataMap:{}})}):e.jsx(e.Fragment,{children:e.jsx(Qe,{description:"This component does not have inputForm configured!",children:e.jsx(w,{color:"cyan",variant:"solid",onClick:()=>{u.openModal("modalC",{data:{component_id:a},structure:{component_type:s}})},children:"Config InputForm"})})}),$&&e.jsx(vl,{parseData:ee,columns:W,importData:Q}),!$&&e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:Q,children:"Ok"}),e.jsx(Xe,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(F.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(re,{children:e.jsx("pre",{children:JSON.stringify(l(k.getFieldsValue()),null,2)})})})})}]})]})})})},wl=({visible:s,onClose:a,params:o,callback:c})=>s?e.jsx(e.Fragment,{children:e.jsx(pe,{open:s,onClose:a,width:"80%",onCancel:a,title:"Import Data",footer:null,children:e.jsx(bl,{params:o,type:"inputFile",callback:()=>{a(),c&&c()}})})}):null,Cl=({params:s,type:a,callback:o})=>{if(!s)return e.jsx(e.Fragment,{children:"无数据"});if(s.component_type=="software"){if(s[a]&&Array.isArray(s[a])&&s[a].length>0)return s[a].map((c,u)=>i.createElement(ie,{...c,operatePipeline:s.operatePipeline,key:u,callback:o}))}else{if(s.component_type=="pipeline")return e.jsx(ie,{...s});if(s.component_type=="file")return e.jsx(ie,{...s,callback:o})}},bl=i.memo(Cl),Sl=({visible:s,onClose:a,params:o,callback:c})=>{if(!s)return null;const[u]=F.useForm(),_=async()=>{const O=await I(`/analysis-result/find-by-id/${o==null?void 0:o.analysis_result_id}`);u.setFieldsValue(O.data)};i.useEffect(()=>{o!=null&&o.analysis_result_id&&_()},[o==null?void 0:o.analysis_result_id]);const C=async()=>{const k={...await u.validateFields(),id:o.id};console.log(k);const R=await ol(o==null?void 0:o.analysis_result_id,k);console.log(R),c&&c(),a()};return e.jsx(pe,{title:"Edit Analsyis Result",open:s,onClose:a,onCancel:a,onOk:C,children:e.jsxs(F,{form:u,children:[e.jsx(F.Item,{label:"File Name",name:"file_name",children:e.jsx(q,{})}),e.jsx(F.Item,{label:"Sample Source",name:"sample_source",children:e.jsx(q,{})})]})})},kl=i.forwardRef(({pipeline:s,software:a,title:o,form:c,appendSampleColumns:u=[],setResultTableList:_,cleanDom:C,analysisType:O,setRecord:k,setTableLoading:R,setTabletData:te,shouldTrigger:ee,analysisMethod:d,columnsParamsALL:$,activeTabKey:B,setActiveTabKey:W,cardExtra:ae,operatePipeline:f,relationType:G,currentAnalysisMethod:l,setCurrentAnalysisMethod:Q,params:le,...p},j)=>{i.useImperativeHandle(j,()=>({reload:h}));const{project:r,projectObj:x}=Re(),V=Ae(),[b,z]=i.useState([]),[ne,D]=i.useState(),[T,U]=i.useState(!0),{eventSourceRef:L,status:Fl,reconnect:Rl}=Ye(),{modal:J,openModal:ue,closeModal:xe}=Ze(),[X,fe]=i.useState([]),[Te,Le]=i.useState({}),[Ne,Oe]=i.useState([]),[Be,se]=i.useState(!0),[y,Y]=i.useState(),[je,Ve]=i.useState(200),{baseURL:ge}=$e(n=>n.user),Z=n=>{n.map(t=>t.columns_name),Oe([])};i.useEffect(()=>{var t;if(!L)return;const n=m=>{const v=JSON.parse(m.data);if(v.msgType==="analysis_result"){const S=d.map(A=>A.component_id);console.log("componentIdList",S),console.log("data.component_id ",v.component_id),console.log(" componentIdList.includes(data.component_id) ",S.includes(v.component_id)),S.includes(v.component_id)&&h()}};return(t=L.current)==null||t.addEventListener("message",n),()=>{var m;console.log("removeEventListener"),(m=L.current)==null||m.removeEventListener("message",n)}},[L.current]);const h=()=>{if(console.log("analysisMethod: ",d),d&&Array.isArray(d)){const n=d.flatMap(t=>t.component_id);ve({componentIdList:n})}else ve({params:le})},_e=n=>d.reduce((v,S)=>(v[S==null?void 0:S.component_id]=S,v),{})[n];i.useEffect(()=>{var n,t;if(d&&Array.isArray(d)&&d.length>0&&W){W((n=d[0])==null?void 0:n.component_id);const m=_e((t=d[0])==null?void 0:t.component_id);Q(m)}h()},[JSON.stringify(le),JSON.stringify(d),r,x==null?void 0:x.metadata_form]);const Ue=n=>{const t=ne[n];z(t),W(n);const m=_e(n);Q(m),t.length>0?(Y(t[0].analysis_result_id),Z(t[0].columns)):(Z([]),Y(void 0))},he=async()=>{if((l==null?void 0:l.file_type)=="collected"&&y){se(!0);const n=await I.get(`/analysis-result/table/${y}?row_num=${je}`,{timeout:2e4});fe(n.data.tables),Le({nrow:n.data.nrow,ncol:n.data.ncol}),se(!1)}else fe([]),se(!1)};i.useEffect(()=>{he()},[y]);const ve=async({analysisMethodValues:n,params:t,componentIdList:m})=>{var v,S;if(U(!0),m){let A=await I.post("/analysis-result/list-analysis-result-grouped",{project:r,component_ids:m,...t});U(!1);const N=A.data;console.log("groupedData",N),_&&_(N),D(N);let H;B?H=N[B]?N[B]:[]:H=N[(v=d[0])==null?void 0:v.component_id]?N[(S=d[0])==null?void 0:S.component_id]:[],z(H),H.length>0?(Y(H[0].analysis_result_id),Z(H[0].columns)):(Z([]),Y(void 0))}else{let A=await I.post("/analysis-result/list-analysis-result",{project:r,component_ids:m,...t});z(A.data)}U(!1)},we=async n=>{await I.delete(`/analyais-result/delete-by-id/${n}`),V.success("删除成功!"),h()};let Je=[{title:"Project Name",dataIndex:"project_name",key:"project_name",width:100,ellipsis:!0,render:(n,t)=>e.jsx(g,{title:t.project,children:e.jsx("span",{style:{cursor:"pointer"},children:n})})},{title:"Analysis Result ID",dataIndex:"analysis_result_id",key:"analysis_result_id",width:50,ellipsis:!0,render:(n,t)=>e.jsx(g,{title:t.analysis_result_id,children:e.jsx("span",{style:{cursor:"pointer"},children:String(n).slice(0,8)})})},{title:"Analysis Id",dataIndex:"analysis_id",key:"analysis_id",width:50,ellipsis:!0,render:(n,t)=>e.jsx(g,{title:t.analysis_id,children:e.jsx("span",{style:{cursor:"pointer"},children:n?String(n).slice(0,8):""})})},{title:"Component Name",dataIndex:"component_name",key:"component_name",width:100,ellipsis:!0,render:(n,t)=>e.jsx(g,{title:e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["analysis_id: ",t.analysis_id]}),e.jsxs("li",{children:["component_id: ",t.component_id]}),e.jsxs("li",{children:["analysis_result_id: ",t.analysis_result_id]}),e.jsxs("li",{children:["sample_id: ",t.sample_id]}),e.jsxs("li",{children:["file_name: ",t.file_name]}),e.jsxs("li",{children:["analysis_result_hash: ",t.analysis_result_hash]})]})}),children:e.jsx("span",{style:{cursor:"pointer"},children:n})})},{title:"Sample Name",dataIndex:"sample_name",key:"sample_name",width:100,ellipsis:!0,render:(n,t)=>e.jsx(g,{title:e.jsx(e.Fragment,{children:e.jsx("ul",{children:e.jsxs("li",{children:["sample_id: ",t.sample_id]})})}),children:e.jsx("span",{style:{cursor:"pointer"},children:n})})},{title:"Sample Source",dataIndex:"sample_source",key:"sample_source",width:100,ellipsis:!0},...(()=>{var n;return!(x!=null&&x.metadata_form)||!Array.isArray(x==null?void 0:x.metadata_form)?[]:(n=x==null?void 0:x.metadata_form)==null?void 0:n.map(t=>({title:t.label,dataIndex:t.name,key:t.name,ellipsis:!0}))})(),...u,{title:"Action",key:"action",fixed:"right",ellipsis:!0,width:200,render:(n,t)=>e.jsxs(Se,{size:"middle",children:[e.jsx(Pe,{content:e.jsx(e.Fragment,{children:e.jsx(re,{children:e.jsx("pre",{children:JSON.stringify(t.content,null,2)})})}),children:e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:()=>{k&&k(t),f.openModal("openFile",{content:t.content,fileType:t.file_type,description:l.description})},children:"Open"})}),t.sample_name?e.jsx(e.Fragment,{children:e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f.openModal("metadataForm",{analysis_result_id:t.analysis_result_id,sample_id:t.sample_id,callback:h})},children:"metadata"})}):e.jsx(e.Fragment,{children:e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f.openModal("metadataForm",{analysis_result_id:t.analysis_result_id,callback:h})},children:"Add Metadata"})}),e.jsx(w,{size:"small",color:"cyan",variant:"solid",onClick:()=>{console.log(f),f.openModals("bindSample",{analysis_result_id:t.analysis_result_id,callback:h})},children:"Bind Sample "}),e.jsx(M,{title:"Are you sure you want to delete it?",onConfirm:async()=>{await we(t.analysis_result_id)},children:e.jsx(w,{size:"small",color:"danger",variant:"solid",children:"Delete"})})]})}];const[P,He]=i.useState("");let K=i.useMemo(()=>P?(l==null?void 0:l.file_type)=="collected"?X.filter(n=>Object.values(n).some(t=>String(t).toLowerCase().includes(P.toLowerCase()))):b.filter(n=>Object.values(n).some(t=>String(t).toLowerCase().includes(P.toLowerCase()))):(l==null?void 0:l.file_type)=="collected"?X:b,[b,X,P]);const[oe,qe]=i.useState([]),[We,Ce]=i.useState(!1),be={onRemove:n=>{const t=oe.indexOf(n),m=oe.slice();m.splice(t,1),qe(m)},beforeUpload:n=>(Ge(n),!1),fileList:oe},Ge=async n=>{Ce(!0);const t=new FormData;t.append("file",n),t.append("project",r),t.append("component_id",l==null?void 0:l.component_id);for(let[m,v]of t.entries())console.log(m,v);try{const m=await I.post("/analysis-result/upload",t,{timeout:6e4});V.success(`${m.data.file_path} file uploaded successfully`)}catch{}Ce(!1),h()};return e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{size:"small",variant:"borderless",style:{boxShadow:"none"},styles:{body:{padding:"0.5rem"}},title:e.jsxs(E,{gap:"small",children:[e.jsx(al,{})," ",o,(l==null?void 0:l.component_name)&&e.jsx(g,{title:e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["namespace: ",l==null?void 0:l.namespace_name]}),(s==null?void 0:s.component_id)&&e.jsxs("li",{children:["pipeline: ",s==null?void 0:s.component_id]}),(a==null?void 0:a.component_id)&&e.jsxs("li",{children:["software: ",a==null?void 0:a.component_id]}),(l==null?void 0:l.component_id)&&e.jsxs("li",{children:["file: ",l==null?void 0:l.component_id]}),(l==null?void 0:l.name)&&e.jsxs("li",{children:["name: ",l==null?void 0:l.name]})]})}),children:e.jsxs("span",{style:{cursor:"pointer"},children:["(",l==null?void 0:l.component_name,")"]})}),e.jsx(ce,{color:"success",children:l==null?void 0:l.file_type})]}),extra:e.jsxs(e.Fragment,{children:[ae,e.jsxs(E,{gap:"small",wrap:!0,children:[e.jsx(q.Search,{size:"small",placeholder:"搜索结果...",allowClear:!0,enterButton:!0,value:P,onChange:n=>He(n.target.value),style:{width:300}}),e.jsx(M,{title:"Confirm adding example?",onConfirm:async()=>{await I.post(`/analysis-result/add-example/${l.component_id}?project=${r}`),V.success("Example added successfully!"),h()},children:e.jsx("a",{children:"Example"})}),e.jsxs("a",{onClick:async()=>{const n=await I.get(`/analysis-result/download-example/${l.component_id}`);window.open(`${ge}${n.data.example_url}`,"_blank")},children:["Example ",e.jsx(ye,{})]}),(l==null?void 0:l.relation_id)&&e.jsx(M,{title:"Are you sure to delete?",onConfirm:()=>{f.deletePipelineRelation(l.relation_id)},children:e.jsx(g,{title:`Delete ${l==null?void 0:l.component_name}`,children:e.jsx(Ie,{style:{cursor:"pointer",color:"red"}})})}),(f==null?void 0:f.openModal)&&e.jsxs(e.Fragment,{children:[e.jsx(ul,{style:{cursor:"pointer"},onClick:()=>{ue("importFile",{...l,operatePipeline:f})}}),e.jsx(Fe,{style:{cursor:"pointer"},onClick:h}),(p.component_type=="software"||p.component_type=="file"||p.component_type=="script")&&e.jsx(e.Fragment,{children:e.jsx(tl,{menu:{items:[{key:"4",label:e.jsx(g,{title:l==null?void 0:l.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalC",{data:void 0,structure:{relation_type:G,parent_component_id:a.component_id,component_type:"file"}})},children:"Add File"})})},{key:"3",label:e.jsx(g,{title:l==null?void 0:l.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalC",{data:l,structure:{component_type:"file"}})},children:"Edit File"})})},{key:"2",label:e.jsx(g,{title:l==null?void 0:l.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:G,parent_component_id:a.component_id}})},children:"New File"})})},{key:"1",label:e.jsx(g,{title:l==null?void 0:l.component_name,children:e.jsx("a",{onClick:()=>{f.openModal("modalA",{data:l,pipelineStructure:{relation_type:G}})},children:"Replace File"})})},{label:e.jsx(g,{title:l==null?void 0:l.component_name,children:e.jsx(M,{title:"Whether to remove file?",onConfirm:()=>{f.deletePipelineRelation(l.relation_id)},children:e.jsx("a",{children:"Remove File"})})}),key:"0"}]},children:e.jsx("a",{onClick:n=>n.preventDefault(),children:e.jsxs(Se,{children:["More",e.jsx(Me,{})]})})})})]}),e.jsx(el,{onClick:()=>{f.openModal("descriptionModal",l.description)},style:{cursor:"pointer"}})]})]}),tabList:d&&Array.isArray(d)&&d.length>1?d.map(n=>({key:n.component_id,label:e.jsx(g,{title:n.component_id,children:n.component_name?n.component_name:"no_name"})})):void 0,activeTabKey:B,onTabChange:Ue,children:[(l==null?void 0:l.file_type)=="collected"?e.jsx(e.Fragment,{children:e.jsx(ke,{spinning:Be,tip:"Loading table data...",children:Array.isArray(X)&&X.length==0?e.jsx(e.Fragment,{children:e.jsx(ke,{spinning:We,tip:"Uploading...",children:e.jsxs(il,{...be,maxCount:1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(jl,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(cl,{activeKey:y,onChange:n=>{const t=b.filter(m=>m.analysis_result_id==n);t.length>0&&Z(t[0].columns),Y(n)},tabBarExtraContent:e.jsxs(E,{gap:"small",children:[e.jsx(dl,{size:"small",value:je,onChange:n=>Ve(n)}),e.jsx(rl,{...be,children:e.jsx(g,{title:"Upload new file",children:e.jsx(hl,{style:{cursor:"pointer"}})})}),e.jsx(ye,{style:{cursor:"pointer"},onClick:()=>{const n=b.find(t=>t.analysis_result_id==y);console.log("currentData",n),window.open(`${ge}${n.url}`,"_blank")}}),e.jsx(Ke,{style:{cursor:"pointer"},onClick:()=>{console.log("analysisResultId",y),ue("analysisResultEdit",{analysis_result_id:y})}}),e.jsx(M,{title:`Are you sure you want to delete ${y}?`,onConfirm:async()=>{await we(y)},children:e.jsx(g,{title:`Delete current tab ${y}`,children:e.jsx(Ie,{style:{cursor:"pointer",color:"red"}})})}),e.jsx(Fe,{style:{cursor:"pointer"},onClick:()=>he()})]}),items:b.map((n,t)=>({key:n.analysis_result_id,label:e.jsx(g,{title:`${n==null?void 0:n.content} ${n.analysis_result_id}`,children:`${n==null?void 0:n.file_name}`})}))}),e.jsx("div",{style:{height:"50vh"},children:e.jsx(yl,{shape:Te,rows:[Ne,...K]})})]})})}):e.jsx(e.Fragment,{children:e.jsx(ze,{rowKey:n=>n.id,size:"small",pagination:{pageSize:10},loading:T,scroll:{x:"max-content",y:55*5},columns:$||Je,footer:()=>`A total of ${K&&Array.isArray(K)&&K.length} records`,dataSource:K})}),(l==null?void 0:l.parseFormat)&&(l==null?void 0:l.relation_type)=="software_output_file"&&e.jsx(re,{children:e.jsx("pre",{children:JSON.stringify(l.parseFormat,null,2)})})]}),e.jsx(wl,{visible:J.visible&&J.key=="importFile",params:J.params,callback:h,onClose:xe}),e.jsx(Sl,{visible:J.visible&&J.key=="analysisResultEdit",params:J.params,callback:h,onClose:xe})]})}),Wl=({visible:s,onClose:a,params:o})=>s?e.jsx(e.Fragment,{children:e.jsx(pe,{title:"分析结果",open:s,onCancel:a,width:"80%",children:e.jsx(kl,{...o,analysisType:"sample"})})}):null;function yl({rows:s,shape:a,columns:o}){const{token:c}=De.useToken();return e.jsxs(e.Fragment,{children:[o&&e.jsx(E,{align:"center",style:{background:c.colorBgContainerDisabled,borderBottom:`1px solid ${c.colorBorderSecondary}`,padding:"0 8px",fontWeight:500},children:Array.isArray(o)&&e.jsx(e.Fragment,{children:o.map((u,_)=>e.jsx("span",{children:e.jsx("div",{style:{flex:"0 0 200px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",padding:"0 8px"},title:u.columns_name,children:e.jsx(g,{title:u.analysis_result_id,children:u.columns_name})},_)},_))})}),e.jsx(sl,{rowComponent:Il,rowCount:s==null?void 0:s.length,rowHeight:30,rowProps:{rows:s}}),e.jsxs(E,{justify:"end",gap:"small",children:[e.jsxs(ce,{color:"default",children:["Rows: ",a==null?void 0:a.nrow]}),e.jsxs(ce,{color:"default",children:["Columns: ",a==null?void 0:a.ncol]})]})]})}function Il({index:s,rows:a,style:o}){const c=a[s],{token:u}=De.useToken();return e.jsx(E,{align:"center",style:{...o,backgroundColor:s%2?u.colorBgContainer:u.colorFillQuaternary,borderBottom:`1px solid ${u.colorBorderSecondary}`,padding:"0 8px",fontSize:13,minWidth:"fit-content",transition:"background-color 0.2s"},className:"table-row",onMouseEnter:_=>{_.currentTarget.style.backgroundColor=u.colorFillTertiary},onMouseLeave:_=>{_.currentTarget.style.backgroundColor=s%2?u.colorBgContainer:u.colorFillQuaternary},children:c.map((_,C)=>e.jsx("div",{style:{flex:"0 0 200px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",padding:"0 8px"},title:String(_),children:String(_)},C))})}export{Wl as A,kl as R};

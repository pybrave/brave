import{Z as de,a0 as ue,a1 as _,r as h,a5 as Ne,O as B,Y as Te,aj as Pe,ak as Le,al as Be,am as We,an as He,ao as Ve,ap as Re,aq as qe,w as Ke,z as Ge,y as Je,ag as Ue,ar as he,ad as Xe,ae as ee,_ as Ye,as as te,$ as Qe,a2 as Ze,at as et,X as tt,au as nt,a6 as st,av as it,aw as rt,c as W,j as i,F as w,S as H,I as L,T as ot,B as $,a as M,f as N,m as at,b as V,M as me,P as K,p as ge,h as lt,e as pe,U as ct,q as dt,R as ut,C as ht,l as fe}from"./index-B_3LX8Sv.js";import{M as mt}from"./index-D0T1H4s6.js";import{C as xe,T as be}from"./index-BKM-36RV.js";import{T as O}from"./index-CnwY4WqK.js";import{T as gt,M as ye}from"./index-ufbsmYFx.js";import{F as Se}from"./Table-DPfHYlNE.js";import{D as pt}from"./index-BWj5Fyk7.js";import{S as ft}from"./index-T5bbXZ1z.js";import{_ as xt}from"./callSuper-DcPjgIPQ.js";import{I as bt}from"./index-iZ4aO8fm.js";const R=(e,r,t,s,n)=>({background:e,border:`${_(s.lineWidth)} ${s.lineType} ${r}`,[`${n}-icon`]:{color:t}}),yt=e=>{const{componentCls:r,motionDurationSlow:t,marginXS:s,marginSM:n,fontSize:o,fontSizeLG:c,lineHeight:a,borderRadiusLG:l,motionEaseInOutCirc:d,withDescriptionIconSize:u,colorText:m,colorTextHeading:g,withDescriptionPadding:f,defaultPadding:p}=e;return{[r]:Object.assign(Object.assign({},ue(e)),{position:"relative",display:"flex",alignItems:"center",padding:p,wordWrap:"break-word",borderRadius:l,[`&${r}-rtl`]:{direction:"rtl"},[`${r}-content`]:{flex:1,minWidth:0},[`${r}-icon`]:{marginInlineEnd:s,lineHeight:0},"&-description":{display:"none",fontSize:o,lineHeight:a},"&-message":{color:g},[`&${r}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${t} ${d}, opacity ${t} ${d},
        padding-top ${t} ${d}, padding-bottom ${t} ${d},
        margin-bottom ${t} ${d}`},[`&${r}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${r}-with-description`]:{alignItems:"flex-start",padding:f,[`${r}-icon`]:{marginInlineEnd:n,fontSize:u,lineHeight:0},[`${r}-message`]:{display:"block",marginBottom:s,color:g,fontSize:c},[`${r}-description`]:{display:"block",color:m}},[`${r}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},St=e=>{const{componentCls:r,colorSuccess:t,colorSuccessBorder:s,colorSuccessBg:n,colorWarning:o,colorWarningBorder:c,colorWarningBg:a,colorError:l,colorErrorBorder:d,colorErrorBg:u,colorInfo:m,colorInfoBorder:g,colorInfoBg:f}=e;return{[r]:{"&-success":R(n,s,t,e,r),"&-info":R(f,g,m,e,r),"&-warning":R(a,c,o,e,r),"&-error":Object.assign(Object.assign({},R(u,d,l,e,r)),{[`${r}-description > pre`]:{margin:0,padding:0}})}}},vt=e=>{const{componentCls:r,iconCls:t,motionDurationMid:s,marginXS:n,fontSizeIcon:o,colorIcon:c,colorIconHover:a}=e;return{[r]:{"&-action":{marginInlineStart:n},[`${r}-close-icon`]:{marginInlineStart:n,padding:0,overflow:"hidden",fontSize:o,lineHeight:_(o),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${t}-close`]:{color:c,transition:`color ${s}`,"&:hover":{color:a}}},"&-close-text":{color:c,transition:`color ${s}`,"&:hover":{color:a}}}}},jt=e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:`${e.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${e.paddingMD}px ${e.paddingContentHorizontalLG}px`}),Ct=de("Alert",e=>[yt(e),St(e),vt(e)],jt);var ne=function(e,r){var t={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(t[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)r.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(t[s[n]]=e[s[n]]);return t};const wt={success:Re,info:Ve,error:He,warning:We},It=e=>{const{icon:r,prefixCls:t,type:s}=e,n=wt[s]||null;return r?Be(r,h.createElement("span",{className:`${t}-icon`},r),()=>({className:B(`${t}-icon`,r.props.className)})):h.createElement(n,{className:`${t}-icon`})},$t=e=>{const{isClosable:r,prefixCls:t,closeIcon:s,handleClose:n,ariaProps:o}=e,c=s===!0||s===void 0?h.createElement(qe,null):s;return r?h.createElement("button",Object.assign({type:"button",onClick:n,className:`${t}-close-icon`,tabIndex:0},o),c):null},ve=h.forwardRef((e,r)=>{const{description:t,prefixCls:s,message:n,banner:o,className:c,rootClassName:a,style:l,onMouseEnter:d,onMouseLeave:u,onClick:m,afterClose:g,showIcon:f,closable:p,closeText:v,closeIcon:b,action:j,id:C}=e,y=ne(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[x,S]=h.useState(!1),E=h.useRef(null);h.useImperativeHandle(r,()=>({nativeElement:E.current}));const{getPrefixCls:z,direction:I,closable:k,closeIcon:D,className:G,style:J}=Ne("alert"),F=z("alert",s),[U,Ee,Fe]=Ct(F),Me=A=>{var T;S(!0),(T=e.onClose)===null||T===void 0||T.call(e,A)},Y=h.useMemo(()=>e.type!==void 0?e.type:o?"warning":"info",[e.type,o]),ze=h.useMemo(()=>typeof p=="object"&&p.closeIcon||v?!0:typeof p=="boolean"?p:b!==!1&&b!==null&&b!==void 0?!0:!!k,[v,b,p,k]),Q=o&&f===void 0?!0:f,ke=B(F,`${F}-${Y}`,{[`${F}-with-description`]:!!t,[`${F}-no-icon`]:!Q,[`${F}-banner`]:!!o,[`${F}-rtl`]:I==="rtl"},G,c,a,Fe,Ee),Oe=Te(y,{aria:!0,data:!0}),_e=h.useMemo(()=>typeof p=="object"&&p.closeIcon?p.closeIcon:v||(b!==void 0?b:typeof k=="object"&&k.closeIcon?k.closeIcon:D),[b,p,v,D]),De=h.useMemo(()=>{const A=p??k;if(typeof A=="object"){const{closeIcon:T}=A;return ne(A,["closeIcon"])}return{}},[p,k]);return U(h.createElement(Pe,{visible:!x,motionName:`${F}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:A=>({maxHeight:A.offsetHeight}),onLeaveEnd:g},(A,T)=>{let{className:Z,style:Ae}=A;return h.createElement("div",Object.assign({id:C,ref:Le(E,T),"data-show":!x,className:B(ke,Z),style:Object.assign(Object.assign(Object.assign({},J),l),Ae),onMouseEnter:d,onMouseLeave:u,onClick:m,role:"alert"},Oe),Q?h.createElement(It,{description:t,icon:e.icon,prefixCls:F,type:Y}):null,h.createElement("div",{className:`${F}-content`},n?h.createElement("div",{className:`${F}-message`},n):null,t?h.createElement("div",{className:`${F}-description`},t):null),j?h.createElement("div",{className:`${F}-action`},j):null,h.createElement($t,{isClosable:ze,prefixCls:F,closeIcon:_e,handleClose:Me,ariaProps:De}))}))});let Et=function(e){function r(){var t;return Je(this,r),t=xt(this,r,arguments),t.state={error:void 0,info:{componentStack:""}},t}return Ke(r,e),Ge(r,[{key:"componentDidCatch",value:function(s,n){this.setState({error:s,info:n})}},{key:"render",value:function(){const{message:s,description:n,id:o,children:c}=this.props,{error:a,info:l}=this.state,d=(l==null?void 0:l.componentStack)||null,u=typeof s>"u"?(a||"").toString():s,m=typeof n>"u"?d:n;return a?h.createElement(ve,{id:o,type:"error",message:u,description:h.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},m)}):c}}])}(h.Component);const je=ve;je.ErrorBoundary=Et;var Ft=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],Ce=h.forwardRef(function(e,r){var t,s=e.prefixCls,n=s===void 0?"rc-switch":s,o=e.className,c=e.checked,a=e.defaultChecked,l=e.disabled,d=e.loadingIcon,u=e.checkedChildren,m=e.unCheckedChildren,g=e.onClick,f=e.onChange,p=e.onKeyDown,v=Ue(e,Ft),b=he(!1,{value:c,defaultValue:a}),j=Xe(b,2),C=j[0],y=j[1];function x(I,k){var D=C;return l||(D=I,y(D),f==null||f(D,k)),D}function S(I){I.which===te.LEFT?x(!1,I):I.which===te.RIGHT&&x(!0,I),p==null||p(I)}function E(I){var k=x(!C,I);g==null||g(k,I)}var z=B(n,o,(t={},ee(t,"".concat(n,"-checked"),C),ee(t,"".concat(n,"-disabled"),l),t));return h.createElement("button",Ye({},v,{type:"button",role:"switch","aria-checked":C,disabled:l,className:z,ref:r,onKeyDown:S,onClick:E}),d,h.createElement("span",{className:"".concat(n,"-inner")},h.createElement("span",{className:"".concat(n,"-inner-checked")},u),h.createElement("span",{className:"".concat(n,"-inner-unchecked")},m)))});Ce.displayName="Switch";const Mt=e=>{const{componentCls:r,trackHeightSM:t,trackPadding:s,trackMinWidthSM:n,innerMinMarginSM:o,innerMaxMarginSM:c,handleSizeSM:a,calc:l}=e,d=`${r}-inner`,u=_(l(a).add(l(s).mul(2)).equal()),m=_(l(c).mul(2).equal());return{[r]:{[`&${r}-small`]:{minWidth:n,height:t,lineHeight:_(t),[`${r}-inner`]:{paddingInlineStart:c,paddingInlineEnd:o,[`${d}-checked, ${d}-unchecked`]:{minHeight:t},[`${d}-checked`]:{marginInlineStart:`calc(-100% + ${u} - ${m})`,marginInlineEnd:`calc(100% - ${u} + ${m})`},[`${d}-unchecked`]:{marginTop:l(t).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${r}-handle`]:{width:a,height:a},[`${r}-loading-icon`]:{top:l(l(a).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${r}-checked`]:{[`${r}-inner`]:{paddingInlineStart:o,paddingInlineEnd:c,[`${d}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${d}-unchecked`]:{marginInlineStart:`calc(100% - ${u} + ${m})`,marginInlineEnd:`calc(-100% + ${u} - ${m})`}},[`${r}-handle`]:{insetInlineStart:`calc(100% - ${_(l(a).add(s).equal())})`}},[`&:not(${r}-disabled):active`]:{[`&:not(${r}-checked) ${d}`]:{[`${d}-unchecked`]:{marginInlineStart:l(e.marginXXS).div(2).equal(),marginInlineEnd:l(e.marginXXS).mul(-1).div(2).equal()}},[`&${r}-checked ${d}`]:{[`${d}-checked`]:{marginInlineStart:l(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:l(e.marginXXS).div(2).equal()}}}}}}},zt=e=>{const{componentCls:r,handleSize:t,calc:s}=e;return{[r]:{[`${r}-loading-icon${e.iconCls}`]:{position:"relative",top:s(s(t).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${r}-checked ${r}-loading-icon`]:{color:e.switchColor}}}},kt=e=>{const{componentCls:r,trackPadding:t,handleBg:s,handleShadow:n,handleSize:o,calc:c}=e,a=`${r}-handle`;return{[r]:{[a]:{position:"absolute",top:t,insetInlineStart:t,width:o,height:o,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:s,borderRadius:c(o).div(2).equal(),boxShadow:n,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${r}-checked ${a}`]:{insetInlineStart:`calc(100% - ${_(c(o).add(t).equal())})`},[`&:not(${r}-disabled):active`]:{[`${a}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${r}-checked ${a}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Ot=e=>{const{componentCls:r,trackHeight:t,trackPadding:s,innerMinMargin:n,innerMaxMargin:o,handleSize:c,calc:a}=e,l=`${r}-inner`,d=_(a(c).add(a(s).mul(2)).equal()),u=_(a(o).mul(2).equal());return{[r]:{[l]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:o,paddingInlineEnd:n,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${l}-checked, ${l}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:t},[`${l}-checked`]:{marginInlineStart:`calc(-100% + ${d} - ${u})`,marginInlineEnd:`calc(100% - ${d} + ${u})`},[`${l}-unchecked`]:{marginTop:a(t).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${r}-checked ${l}`]:{paddingInlineStart:n,paddingInlineEnd:o,[`${l}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${l}-unchecked`]:{marginInlineStart:`calc(100% - ${d} + ${u})`,marginInlineEnd:`calc(-100% + ${d} - ${u})`}},[`&:not(${r}-disabled):active`]:{[`&:not(${r}-checked) ${l}`]:{[`${l}-unchecked`]:{marginInlineStart:a(s).mul(2).equal(),marginInlineEnd:a(s).mul(-1).mul(2).equal()}},[`&${r}-checked ${l}`]:{[`${l}-checked`]:{marginInlineStart:a(s).mul(-1).mul(2).equal(),marginInlineEnd:a(s).mul(2).equal()}}}}}},_t=e=>{const{componentCls:r,trackHeight:t,trackMinWidth:s}=e;return{[r]:Object.assign(Object.assign(Object.assign(Object.assign({},ue(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:s,height:t,lineHeight:_(t),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${r}-disabled)`]:{background:e.colorTextTertiary}}),Ze(e)),{[`&${r}-checked`]:{background:e.switchColor,[`&:hover:not(${r}-disabled)`]:{background:e.colorPrimaryHover}},[`&${r}-loading, &${r}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${r}-rtl`]:{direction:"rtl"}})}},Dt=e=>{const{fontSize:r,lineHeight:t,controlHeight:s,colorWhite:n}=e,o=r*t,c=s/2,a=2,l=o-a*2,d=c-a*2;return{trackHeight:o,trackHeightSM:c,trackMinWidth:l*2+a*4,trackMinWidthSM:d*2+a*2,trackPadding:a,handleBg:n,handleSize:l,handleSizeSM:d,handleShadow:`0 2px 4px 0 ${new et("#00230b").setA(.2).toRgbString()}`,innerMinMargin:l/2,innerMaxMargin:l+a+a*2,innerMinMarginSM:d/2,innerMaxMarginSM:d+a+a*2}},At=de("Switch",e=>{const r=Qe(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[_t(r),Ot(r),kt(r),zt(r),Mt(r)]},Dt);var Nt=function(e,r){var t={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(t[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)r.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(t[s[n]]=e[s[n]]);return t};const Tt=h.forwardRef((e,r)=>{const{prefixCls:t,size:s,disabled:n,loading:o,className:c,rootClassName:a,style:l,checked:d,value:u,defaultChecked:m,defaultValue:g,onChange:f}=e,p=Nt(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[v,b]=he(!1,{value:d??u,defaultValue:m??g}),{getPrefixCls:j,direction:C,switch:y}=h.useContext(tt),x=h.useContext(nt),S=(n??x)||o,E=j("switch",t),z=h.createElement("div",{className:`${E}-handle`},o&&h.createElement(rt,{className:`${E}-loading-icon`})),[I,k,D]=At(E),G=st(s),J=B(y==null?void 0:y.className,{[`${E}-small`]:G==="small",[`${E}-loading`]:o,[`${E}-rtl`]:C==="rtl"},c,a,k,D),F=Object.assign(Object.assign({},y==null?void 0:y.style),l),U=function(){b(arguments.length<=0?void 0:arguments[0]),f==null||f.apply(void 0,arguments)};return I(h.createElement(it,{component:"Switch"},h.createElement(Ce,Object.assign({},p,{checked:v,onChange:U,prefixCls:E,className:J,style:F,disabled:S,ref:r,loadingIcon:z}))))}),we=Tt;we.__ANT_SWITCH=!0;const Pt=({type:e,dataMap:r,constDataMap:t,componentMap:s,inputAnalysisMethod:n,dataKey:o,data:c,name:a,component_id:l,inputKey:d,...u})=>{if(!r)return i.jsx("div",{children:"加载中...."});r={...r,...t};const m=s[e];if(!m)return i.jsxs("div",{children:["未知类型 ",e]});const{Component:g,dataKey:f,...p}=m;console.log(p);let v=[];return c?v=c:n?v=r[n]:o?o in r&&(v=r[o]):f?f in r&&(v=r[f]):"first_data_key"in r?v=r[r.first_data_key]:l in r&&(v=r[l]),i.jsx(g,{...p,...u,data:v,name:a})},X=h.memo(({formJson:e,dataMap:r})=>{if(!e)return null;const{projectObj:t}=W(),o={rank:[{label:"SGB",value:"SGB"},{label:"SPECIES",value:"SPECIES"},{label:"GENUS",value:"GENUS"},{label:"FAMILY",value:"FAMILY"},{label:"ORDER",value:"ORDER"},{label:"CLASS",value:"CLASS"},{label:"PHYLUM",value:"PHYLUM"}],group_field:t!=null&&t.metadata_form?t==null?void 0:t.metadata_form.map(a=>({label:a.label,value:a.name})):[]},c={GroupSelect:{Component:q,dataKey:"sample_group_list"},Input:{Component:Ht},GroupCompareSelect:{Component:Wt},BaseSelect:{Component:q},BaseInputNumber:{Component:qt},BaseInput:{Component:Vt},BaseSwitch:{Component:Rt},RankSelect:{Component:q,dataKey:"rank",mode:void 0,initialValue:"SPECIES"},GroupFieldSelect:{Component:q,dataKey:"group_field",mode:void 0,initialValue:"group"},FilterFieldSelect:{Component:Lt,dataKey:"sample_group_list",mode:void 0},GroupSelectSampleButton:{Component:Kt},MetaphlanCladeSelect:{Component:Bt},SelectAll:{Component:Gt,dataKey:"sample_group_list"}};return i.jsx(i.Fragment,{children:e.map((a,l)=>i.jsx(Pt,{...a,dataMap:r,componentMap:c,constDataMap:o},l))})},(e,r)=>(console.log(JSON.stringify(e)===JSON.stringify(r)),JSON.stringify(e)===JSON.stringify(r))),Lt=({label:e,name:r,data:t,rules:s,field:n,...o})=>{const[c,a]=h.useState(),l=w.useFormInstance();return h.useEffect(()=>{if(t&&n){const d=[...new Set(t.map(n))],u=d.map(m=>({label:m,value:m}));a(u),l.setFieldValue(r,d[0])}},[t]),i.jsx(i.Fragment,{children:i.jsx(w.Item,{label:e,name:r,rules:s,children:i.jsx(Ie,{...o,options:c})})})},Ie=({options:e,clear:r,value:t,onChange:s,...n})=>{const o=w.useFormInstance(),c=a=>{s(a),r&&o.resetFields(r)};return i.jsx(H,{showSearch:!0,filterOption:(a,l)=>((l==null?void 0:l.label)??"").toLowerCase().includes(a.toLowerCase()),...n,options:e,value:t,onChange:c})},Bt=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>{const[c,a]=h.useState(),l=async()=>{let u=(await M.get("/fast-api/get_metaphlan_clade")).data.map(m=>({label:`${m.taxon.replaceAll(" ","_")}_${m.clade}`,value:m.clade}));a(u)};return h.useEffect(()=>{l()},[]),i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(H,{...o,options:c,showSearch:!0,filterOption:(d,u)=>((u==null?void 0:u.label)??"").toLowerCase().includes(d.toLowerCase())})})})},Wt=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>{const c=w.useFormInstance(),a=w.useWatch(["sites1","group"],c),l=w.useWatch(["sites2","group"],c),[d,u]=h.useState();return h.useEffect(()=>{a&&l&&u([{label:"Prevalent in both sites",value:"Prevalent in both sites"},{label:`Prevalent in ${l.join("-")}`,value:`Prevalent in ${l.join("-")}`},{label:`Prevalent in ${a.join("-")}`,value:`Prevalent in ${a.join("-")}`},{label:"Not prevalent in either sites",value:"Not prevalent in either sites"}])},[a,l]),i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(H,{showSearch:!0,filterOption:(m,g)=>((g==null?void 0:g.label)??"").toLowerCase().includes(m.toLowerCase()),...o,options:d})})})},Ht=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(ot,{...o})})}),Vt=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(L,{...o})})}),Rt=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(we,{...o})})}),qt=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(gt,{...o})})}),q=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s||null,label:e,name:r,rules:n,children:i.jsx(Ie,{...o,options:t})})}),Kt=({label:e,name:r,rules:t,data:s,filter:n,group:o,groupField:c})=>{const[a,l]=h.useState(),[d,u]=h.useState([]),m=w.useFormInstance();let g=[];n&&(g=n.map(b=>b.name));const f=w.useWatch(b=>{const j=Object.entries(b).filter(([C])=>g.includes(C));return Object.fromEntries(j)},m),p=w.useWatch(o,m),v=(b,j)=>{const C=b.reduce((y,x)=>{const S=x[j];return y[S]||(y[S]=[]),y[S].push(x.value),y},{});l(C)};return h.useEffect(()=>{n&&f&&(s=n.reduce((b,j)=>b.filter(C=>j.method(C)===f[j.name]),s),s=s.map(b=>{const{label:j,id:C,value:y,...x}=b;return{label:`${b.label}(${n[0].method(b)})`,value:b.value,...x}})),s&&c?v(s,c):s&&p&&v(s,p),u(s)},[s,p,f]),i.jsxs(i.Fragment,{children:[i.jsx(w.Item,{label:e,name:[r,"sample"],rules:t,children:i.jsx(Ut,{sampleGrouped:a,sampleGroup:d,watch:[r,"group"]})}),i.jsx(w.Item,{label:e,name:[r,"group"],children:i.jsx(Xt,{sampleGrouped:a})})]})},Gt=({label:e,name:r,data:t,initialValue:s,rules:n,...o})=>i.jsx(i.Fragment,{children:i.jsx(w.Item,{initialValue:s,label:e,name:r,rules:n,children:i.jsx(Jt,{data:t,...o})})}),Jt=({data:e,value:r,onChange:t,mode:s,...n})=>{const[o,c]=h.useState(r),a=l=>{console.log(l),t(l),c(l)};return i.jsxs(i.Fragment,{children:[i.jsx(H,{...n,mode:s,value:o,onChange:a,allowClear:!0,options:e}),s=="multiple"&&i.jsxs($,{onClick:()=>{const l=e.map(d=>d.value);c(l),t(l)},children:["选择全部",o&&i.jsxs(i.Fragment,{children:["(",o.length,")"]})]})]})},Ut=({value:e,onChange:r,sampleGroup:t,watch:s,sampleGrouped:n})=>{const[o,c]=h.useState(),a=w.useFormInstance(),l=w.useWatch(s,a);h.useEffect(()=>{c(l)},[l]);const d=u=>{const m=Object.entries(n||{}).filter(([g])=>u.includes(g)).flatMap(([,g])=>g);r(m)};return h.useEffect(()=>{o&&d(o)},[o]),i.jsxs(i.Fragment,{children:[i.jsx(H,{showSearch:!0,filterOption:(u,m)=>((m==null?void 0:m.label)??"").toLowerCase().includes(u.toLowerCase()),mode:"multiple",value:e,onChange:r,options:t}),e&&i.jsxs(i.Fragment,{children:["一共选择",e.length,"个样本"]})]})},Xt=({value:e,onChange:r,sampleGrouped:t})=>{const s=n=>{if((e||[]).includes(n)){const o=(e||[]).filter(c=>!c.includes(n));r(o)}else{const o=[...e||[],n];r(o)}};return i.jsx(i.Fragment,{children:i.jsx(N,{gap:"small",wrap:!0,children:Object.entries(t||{}).map(([n,o])=>i.jsx("span",{children:i.jsxs($,{size:"small",type:(e||[]).includes(n)?"primary":"dashed",onClick:()=>s(n),children:[n,"(",o.length,")"]})},n))})})},Ln=async e=>await M.get("/file-operation/read-file",{params:{file_path:e}}),Yt=async(e,r=0)=>await M.get("/file-operation/read-log-file",{params:{file_path:e,offset:r}}),Bn=async(e,r)=>await M.post("/file-operation/write-file",{file_path:e,content:r}),Wn=async e=>await M.get(`/find-analysis-by-id/${e}`),Qt=async(e,r)=>await M.post(`/run-analysis-v2/${e}?run_type=${r}`),Zt=async e=>await M.post(`/analysis/stop-analysis/${e}`);function P(e,r,t){let s=t.initialDeps??[],n;function o(){var c,a,l,d;let u;t.key&&((c=t.debug)!=null&&c.call(t))&&(u=Date.now());const m=e();if(!(m.length!==s.length||m.some((p,v)=>s[v]!==p)))return n;s=m;let f;if(t.key&&((a=t.debug)!=null&&a.call(t))&&(f=Date.now()),n=r(...m),t.key&&((l=t.debug)!=null&&l.call(t))){const p=Math.round((Date.now()-u)*100)/100,v=Math.round((Date.now()-f)*100)/100,b=v/16,j=(C,y)=>{for(C=String(C);C.length<y;)C=" "+C;return C};console.info(`%c⏱ ${j(v,5)} /${j(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*b,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(d=t==null?void 0:t.onChange)==null||d.call(t,n),n}return o.updateDeps=c=>{s=c},o}function se(e,r){if(e===void 0)throw new Error("Unexpected undefined");return e}const en=(e,r)=>Math.abs(e-r)<1.01,tn=(e,r,t)=>{let s;return function(...n){e.clearTimeout(s),s=e.setTimeout(()=>r.apply(this,n),t)}},ie=e=>{const{offsetWidth:r,offsetHeight:t}=e;return{width:r,height:t}},nn=e=>e,sn=e=>{const r=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),s=[];for(let n=r;n<=t;n++)s.push(n);return s},rn=(e,r)=>{const t=e.scrollElement;if(!t)return;const s=e.targetWindow;if(!s)return;const n=c=>{const{width:a,height:l}=c;r({width:Math.round(a),height:Math.round(l)})};if(n(ie(t)),!s.ResizeObserver)return()=>{};const o=new s.ResizeObserver(c=>{const a=()=>{const l=c[0];if(l!=null&&l.borderBoxSize){const d=l.borderBoxSize[0];if(d){n({width:d.inlineSize,height:d.blockSize});return}}n(ie(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return o.observe(t,{box:"border-box"}),()=>{o.unobserve(t)}},re={passive:!0},oe=typeof window>"u"?!0:"onscrollend"in window,on=(e,r)=>{const t=e.scrollElement;if(!t)return;const s=e.targetWindow;if(!s)return;let n=0;const o=e.options.useScrollendEvent&&oe?()=>{}:tn(s,()=>{r(n,!1)},e.options.isScrollingResetDelay),c=u=>()=>{const{horizontal:m,isRtl:g}=e.options;n=m?t.scrollLeft*(g&&-1||1):t.scrollTop,o(),r(n,u)},a=c(!0),l=c(!1);l(),t.addEventListener("scroll",a,re);const d=e.options.useScrollendEvent&&oe;return d&&t.addEventListener("scrollend",l,re),()=>{t.removeEventListener("scroll",a),d&&t.removeEventListener("scrollend",l)}},an=(e,r,t)=>{if(r!=null&&r.borderBoxSize){const s=r.borderBoxSize[0];if(s)return Math.round(s[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},ln=(e,{adjustments:r=0,behavior:t},s)=>{var n,o;const c=e+r;(o=(n=s.scrollElement)==null?void 0:n.scrollTo)==null||o.call(n,{[s.options.horizontal?"left":"top"]:c,behavior:t})};class cn{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const s=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(n=>{n.forEach(o=>{const c=()=>{this._measureElement(o.target,o)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()})}));return{disconnect:()=>{var n;(n=s())==null||n.disconnect(),t=null},observe:n=>{var o;return(o=s())==null?void 0:o.observe(n,{box:"border-box"})},unobserve:n=>{var o;return(o=s())==null?void 0:o.unobserve(n)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([s,n])=>{typeof n>"u"&&delete t[s]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:nn,rangeExtractor:sn,onChange:()=>{},measureElement:an,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var s,n;(n=(s=this.options).onChange)==null||n.call(s,this,t)},this.maybeNotify=P(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const s=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==s){if(this.cleanup(),!s){this.maybeNotify();return}this.scrollElement=s,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(n=>{this.observer.observe(n)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,n=>{this.scrollRect=n,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(n,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<n?"forward":"backward":null,this.scrollOffset=n,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,s)=>{const n=new Map,o=new Map;for(let c=s-1;c>=0;c--){const a=t[c];if(n.has(a.lane))continue;const l=o.get(a.lane);if(l==null||a.end>l.end?o.set(a.lane,a):a.end<l.end&&n.set(a.lane,!0),n.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((c,a)=>c.end===a.end?c.index-a.index:c.end-a.end)[0]:void 0},this.getMeasurementOptions=P(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,s,n,o,c)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:s,scrollMargin:n,getItemKey:o,enabled:c}),{key:!1}),this.getMeasurements=P(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:s,scrollMargin:n,getItemKey:o,enabled:c},a)=>{if(!c)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const d=this.measurementsCache.slice(0,l);for(let u=l;u<t;u++){const m=o(u),g=this.options.lanes===1?d[u-1]:this.getFurthestMeasurement(d,u),f=g?g.end+this.options.gap:s+n,p=a.get(m),v=typeof p=="number"?p:this.options.estimateSize(u),b=f+v,j=g?g.lane:u%this.options.lanes;d[u]={index:u,start:f,size:v,end:b,key:m,lane:j}}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=P(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,s,n,o)=>this.range=t.length>0&&s>0?dn({measurements:t,outerSize:s,scrollOffset:n,lanes:o}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=P(()=>{let t=null,s=null;const n=this.calculateRange();return n&&(t=n.startIndex,s=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,s]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,s]},(t,s,n,o,c)=>o===null||c===null?[]:t({startIndex:o,endIndex:c,overscan:s,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const s=this.options.indexAttribute,n=t.getAttribute(s);return n?parseInt(n,10):(console.warn(`Missing attribute name '${s}={index}' on measured element.`),-1)},this._measureElement=(t,s)=>{const n=this.indexFromElement(t),o=this.measurementsCache[n];if(!o)return;const c=o.key,a=this.elementsCache.get(c);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(c,t)),t.isConnected&&this.resizeItem(n,this.options.measureElement(t,s,this))},this.resizeItem=(t,s)=>{const n=this.measurementsCache[t];if(!n)return;const o=this.itemSizeCache.get(n.key)??n.size,c=s-o;c!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(n,c,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=c,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,s)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((s,n)=>{s.isConnected||(this.observer.unobserve(s),this.elementsCache.delete(n))});return}this._measureElement(t,void 0)},this.getVirtualItems=P(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,s)=>{const n=[];for(let o=0,c=t.length;o<c;o++){const a=t[o],l=s[a];n.push(l)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const s=this.getMeasurements();if(s.length!==0)return se(s[$e(0,s.length-1,n=>se(s[n]).start,t)])},this.getOffsetForAlignment=(t,s,n=0)=>{const o=this.getSize(),c=this.getScrollOffset();s==="auto"&&(s=t>=c+o?"end":"start"),s==="center"?t+=(n-o)/2:s==="end"&&(t-=o);const a=this.getTotalSize()+this.options.scrollMargin-o;return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,s="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const n=this.measurementsCache[t];if(!n)return;const o=this.getSize(),c=this.getScrollOffset();if(s==="auto")if(n.end>=c+o-this.options.scrollPaddingEnd)s="end";else if(n.start<=c+this.options.scrollPaddingStart)s="start";else return[c,s];const a=s==="end"?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,s,n.size),s]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:s="start",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,s),{adjustments:void 0,behavior:n})},this.scrollToIndex=(t,{align:s="auto",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1));let o=0;const c=10,a=d=>{if(!this.targetWindow)return;const u=this.getOffsetForIndex(t,d);if(!u){console.warn("Failed to get offset for index:",t);return}const[m,g]=u;this._scrollToOffset(m,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const f=this.getScrollOffset(),p=this.getOffsetForIndex(t,g);if(!p){console.warn("Failed to get offset for index:",t);return}en(p[0],f)||l(g)})},l=d=>{this.targetWindow&&(o++,o<c?this.targetWindow.requestAnimationFrame(()=>a(d)):console.warn(`Failed to scroll to index ${t} after ${c} attempts.`))};a(s)},this.scrollBy=(t,{behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:s})},this.getTotalSize=()=>{var t;const s=this.getMeasurements();let n;if(s.length===0)n=this.options.paddingStart;else if(this.options.lanes===1)n=((t=s[s.length-1])==null?void 0:t.end)??0;else{const o=Array(this.options.lanes).fill(null);let c=s.length-1;for(;c>=0&&o.some(a=>a===null);){const a=s[c];o[a.lane]===null&&(o[a.lane]=a.end),c--}n=Math.max(...o.filter(a=>a!==null))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:s,behavior:n})=>{this.options.scrollToFn(t,{behavior:n,adjustments:s},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(r)}}const $e=(e,r,t,s)=>{for(;e<=r;){const n=(e+r)/2|0,o=t(n);if(o<s)e=n+1;else if(o>s)r=n-1;else return n}return e>0?e-1:0};function dn({measurements:e,outerSize:r,scrollOffset:t,lanes:s}){const n=e.length-1,o=l=>e[l].start;if(e.length<=s)return{startIndex:0,endIndex:n};let c=$e(0,n,o,t),a=c;if(s===1)for(;a<n&&e[a].end<t+r;)a++;else if(s>1){const l=Array(s).fill(0);for(;a<n&&l.some(u=>u<t+r);){const u=e[a];l[u.lane]=u.end,a++}const d=Array(s).fill(t+r);for(;c>=0&&d.some(u=>u>=t);){const u=e[c];d[u.lane]=u.start,c--}c=Math.max(0,c-c%s),a=Math.min(n,a+(s-1-a%s))}return{startIndex:c,endIndex:a}}const ae=typeof document<"u"?h.useLayoutEffect:h.useEffect;function un(e){const r=h.useReducer(()=>({}),{})[1],t={...e,onChange:(n,o)=>{var c;o?at.flushSync(r):r(),(c=e.onChange)==null||c.call(e,n,o)}},[s]=h.useState(()=>new cn(t));return s.setOptions(t),ae(()=>s._didMount(),[]),ae(()=>s._willUpdate()),s}function hn(e){return un({observeElementRect:rn,observeElementOffset:on,scrollToFn:ln,...e})}const{Text:le}=V,mn=({file_path:e})=>{var d;h.useEffect(()=>{console.log("fileKey",e),e&&o(e)},[e]);const{messageApi:r}=W(),t=h.useRef(0),[s,n]=h.useState([]),o=async(u,m=!1)=>{const g=await Yt(u);t.current=g.data.offset,n(g.data.content),m&&r.success(`日志加载成功: ${u}`)},c=h.useRef(null),a=hn({count:s.length,getScrollElement:()=>c.current,estimateSize:()=>30,overscan:10});h.useEffect(()=>{(s==null?void 0:s.length)>0&&a.scrollToIndex(s.length-1,{align:"end",behavior:"smooth"})},[s==null?void 0:s.length]);const l=a.getVirtualItems();return i.jsx(xe,{size:"small",extra:i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:()=>{o(e)},children:"刷新日志"}),title:i.jsxs(N,{gap:"small",wrap:"wrap",children:[i.jsxs(O,{color:"blue",children:["文件: ",e]}),i.jsxs(O,{color:"purple",children:["偏移量: ",t.current]})]}),bodyStyle:{padding:0},children:i.jsx("div",{ref:c,style:{height:400,overflowY:"auto",fontFamily:"monospace",backgroundColor:"#1e1e1e",color:"#d4d4d4",padding:"0 12px"},children:i.jsx("div",{style:{height:a.getTotalSize(),width:"100%",position:"relative"},children:i.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${((d=l[0])==null?void 0:d.start)??0}px)`},children:l.map(u=>i.jsx("div",{"data-index":u.index,ref:a.measureElement,style:{padding:"4px 0",borderBottom:"1px solid #333"},children:i.jsxs(N,{gap:"middle",children:[i.jsxs(le,{type:"secondary",style:{width:60,color:"#d4d4d4"},children:["#",u.index+1]}),i.jsx(le,{style:{whiteSpace:"pre-wrap",color:"#d4d4d4"},children:s[u.index]})]})},u.key))})})})})},gn=({visible:e,onClose:r,params:t})=>i.jsx(me,{footer:null,title:"参数",width:"50%",open:e,onCancel:r,children:i.jsx(V,{children:i.jsx("pre",{children:JSON.stringify(t,null,2)})})}),pn=({formJson:e,openModal:r})=>{if(!e)return null;const[t,s]=h.useState([]),n=async()=>{const o=e.map(l=>l.dataKey),a=((await M.post("/list-bio-database",{type_list:o})).data||[]).reduce((l,d)=>{const u=d.type;l[u]||(l[u]=[]);const{name:m,database_id:g,...f}=d;return l[u].push({label:m,value:g,...f}),l},{});s(a),console.log(a)};return h.useEffect(()=>{n()},[e]),i.jsx(i.Fragment,{children:i.jsxs(N,{gap:"small",children:[i.jsx("div",{style:{flex:1},children:i.jsx(X,{formJson:e,dataMap:t})}),i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:r,children:"配置数据库"}),i.jsx($,{onClick:n,size:"small",type:"primary",children:"刷新"})]})})},fn=({visible:e,onClose:r,params:t,callback:s})=>{if(!e)return null;const[n,o]=h.useState([]),[c,a]=h.useState(!1),[l]=w.useForm(),[d,u]=h.useState(t[0].dataKey),[m,g]=h.useState(null),f=async x=>{a(!0);const S=await M.post("/list-bio-database",x);o(S.data),a(!1)},p=async()=>({...await l.validateFields(),type:d}),v=async()=>{const x=await p();m?await M.post("/update-bio-database",{...x,database_id:m.database_id}):await M.post("/add-bio-database",x),b(),g(void 0),l.resetFields()},b=()=>{f({type:d})};h.useEffect(()=>{f({type:d})},[t]);const j=x=>{u(x),f({type:x})},C=async x=>{await M.delete(`/delete-bio-database/${x.id}`),b()},y=x=>{l.setFieldsValue(x),g(x)};return i.jsxs(me,{title:"数据库操作",open:e,onCancel:r,width:"50%",footer:null,children:[i.jsx(be,{tabBarExtraContent:i.jsxs(i.Fragment,{children:[i.jsx($,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:b,children:" 刷新"}),i.jsxs($,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{g(void 0),v()},children:[" ",m?"更新":"添加"]})]}),activeKey:d,onChange:j,items:t.map(x=>({key:x.name,label:x.label,children:i.jsx("div",{})}))}),i.jsxs(w,{form:l,style:{maxWidth:600},labelCol:{span:3},children:[i.jsx(w.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:i.jsx(L,{})}),i.jsx(w.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:i.jsx(L,{})}),i.jsx(w.Item,{name:"db_index",label:"索引",children:i.jsx(L,{})})]}),i.jsx(Se,{dataSource:n,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(x,S)=>i.jsxs(N,{gap:"small",children:[i.jsx(K,{title:"确定删除吗？",onConfirm:()=>{C(S)},children:i.jsx($,{size:"small",type:"primary",danger:!0,children:"删除"})}),i.jsx($,{size:"small",type:"primary",onClick:()=>{y(S)},children:"编辑"})]})}],loading:c,pagination:!1})]})},xn=({visible:e,params:r,onClose:t,callback:s})=>{var b,j,C;h.useEffect(()=>{e&&p()},[r]);const[n,o]=h.useState(),[c,a]=h.useState(),l=()=>{t(),s&&s()};pe();const[d,u]=h.useState(),[m]=w.useForm(),{messageApi:g,project:f}=W(),p=async()=>{u(!0);const y=await M.get(`/analysis/edit-params/${r}`);o(y.data),a(y.data.analysis_result),m.resetFields(),m.setFieldsValue(y.data.request_param),u(!1)},v=y=>{if(y&&Object.keys(y).length>0)return Object.keys(y)[0]};return i.jsx(i.Fragment,{children:i.jsx(pt,{size:"default",loading:d,title:i.jsx(i.Fragment,{children:n&&i.jsxs(i.Fragment,{children:[i.jsx(O,{children:n==null?void 0:n.component_name}),i.jsx(O,{children:n==null?void 0:n.analysis_name}),i.jsx(O,{children:String(n==null?void 0:n.analysis_id).slice(0,8)})]})}),width:"50%",open:e,onClose:t,children:n&&i.jsx(i.Fragment,{children:i.jsx(bn,{form:m,requestParam:{...n.request_param,analysis_id:n==null?void 0:n.analysis_id},dataMap:{...c,first_data_key:v(c)},formJson:[...((b=n.content)==null?void 0:b.formJson)||[],...((j=n.content)==null?void 0:j.upstreamFormJson)||[],...(n==null?void 0:n.inputFormJson)||[]],databases:(C=n.content)==null?void 0:C.databases,upstreamFormJson:n==null?void 0:n.upstreamFormJson,callback:l})})})})},bn=({form:e,requestParam:r,dataMap:t,formJson:s,databases:n,callback:o,showCancal:c=!1})=>{const{modals:a,openModals:l,closeModals:d}=ge(["paramsView","bioDatabases"]),[u,m]=h.useState([]),[g,f]=h.useState([]),{messageApi:p,project:v}=W(),b=()=>{if(Array.isArray(s)){const y=s.filter(S=>!(S!=null&&S.required)&&!(S!=null&&S.db)&&!S.component_id),x=s.filter(S=>(S==null?void 0:S.required)||(S==null?void 0:S.db)||S.component_id);m(x),f(y)}};h.useEffect(()=>{b()},[]);const j=y=>({...r,...y}),C=async(y,x=!1)=>{var z;const S=await e.validateFields(),E=j(S);try{const I=await M.post(`/fast-api/analysis-controller?save=${y}&is_submit=${x}`,E);console.log(I),y?(p.success("执行成功!"),o&&o()):l("paramsView",I.data)}catch(I){console.log(I),(z=I.response)!=null&&z.data&&p.error(I.response.data.detail)}};return i.jsxs(i.Fragment,{children:[i.jsxs(w,{form:e,children:[i.jsx(be,{items:[{key:"1",label:"必填参数",forceRender:!0,children:i.jsxs(i.Fragment,{children:[i.jsx(X,{formJson:[{name:"group_field",label:"分组列",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"},...u],dataMap:t}),n&&i.jsx(pn,{openModal:()=>{l("bioDatabases",n)},formJson:n})]})},{key:"2",label:"可选参数",forceRender:!0,children:i.jsx(i.Fragment,{children:i.jsx(X,{formJson:g,dataMap:{}})})}]}),i.jsx(w.Item,{label:"分析名称",name:"analysis_name",style:{maxWidth:600},rules:[{required:!0,message:"该字段不能为空!"}],children:i.jsx(L,{})}),i.jsxs(N,{gap:"small",children:[i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:()=>{C(!1)},children:"查看参数"}),i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:()=>C(!0),children:r!=null&&r.analysis_id?i.jsxs(i.Fragment,{children:["更新分析(",r.analysis_name,")(",String(r.analysis_id).slice(0,8),")"]}):i.jsx(i.Fragment,{children:"保存分析"})}),(r==null?void 0:r.analysis_id)&&c&&i.jsx($,{size:"small",color:"cyan",onClick:()=>e.setFieldValue("analysis_id",void 0),children:"取消更新"})]}),i.jsx(lt,{ghost:!0,items:[{key:"1",label:"更多",children:i.jsx(i.Fragment,{children:i.jsx(w.Item,{noStyle:!0,shouldUpdate:!0,children:()=>i.jsx(V,{children:i.jsx("pre",{children:JSON.stringify(j(e.getFieldsValue()),null,2)})})})})}]})]}),i.jsx(gn,{visible:a.paramsView.visible,onClose:()=>d("paramsView"),params:a.paramsView.params}),i.jsx(fn,{visible:a.bioDatabases.visible,onClose:()=>d("bioDatabases"),params:a.bioDatabases.params})]})},yn=({data:e,url:r,filename:t})=>{const{Search:s}=L,[n,o]=h.useState([]),c=a=>a?Object.keys(a).map(l=>({title:l,dataIndex:l,key:l,ellipsis:!0,width:150})):[];return h.useEffect(()=>{if(e){const a=e.map((l,d)=>({...l,key:d}));o(a)}},[e]),i.jsx(i.Fragment,{children:Array.isArray(n)&&i.jsx(i.Fragment,{children:i.jsx(Se,{size:"small",title:()=>i.jsxs(N,{gap:"small",children:[i.jsx(s,{size:"small",placeholder:"input search text",allowClear:!0,onSearch:a=>{const l=e.filter(d=>Object.values(d).some(u=>typeof u=="string"&&u.includes(a)));o(l)},style:{width:304}}),r&&i.jsx(fe,{title:`${window.location.origin}${r}`,children:i.jsx($,{size:"small",onClick:()=>{window.open(`${r}?t=${Date.now()}`,"_blank")},type:"primary",children:"下载"})}),i.jsx("span",{children:t})]}),scroll:{x:"max-content",y:55*5},dataSource:n,pagination:!1,virtual:!0,columns:c(e[0]),footer:()=>`一共${e.length}条记录`})})})},ce=({data:e,url:r,filename:t})=>i.jsx("div",{children:i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx(bt,{src:t!=null&&t.endsWith("pdf")?e:`${e}?t=${Date.now()}`,style:{maxWidth:"20rem",marginRight:"0.5rem"}}),r&&i.jsxs("div",{children:[i.jsx(fe,{title:`${window.location.origin}${r}`,children:i.jsx($,{size:"small",onClick:()=>{window.open(`${r}?t=${Date.now()}`,"_blank")},type:"primary",children:"下载"})}),t]})]})}),{Paragraph:Hn}=V,Sn=({data:e})=>i.jsx(i.Fragment,{children:i.jsx(ye,{value:e})}),vn=({data:e})=>i.jsx("div",{style:{padding:"1rem"},children:i.jsx(je,{closable:!0,message:e,type:"info",showIcon:!0})}),jn=({data:e})=>i.jsx(i.Fragment,{children:i.jsx(V,{children:i.jsx("pre",{style:{margin:0},children:e})})}),Cn=({data:e})=>i.jsx(i.Fragment,{children:i.jsx(ye,{value:e,defaultLanguage:"json"})}),wn=({data:e})=>i.jsx(i.Fragment,{children:e&&e.startsWith("/brave")?i.jsx(i.Fragment,{children:i.jsx("iframe",{src:e,width:"100%",style:{height:"80vh",border:"none"}})}):i.jsx(i.Fragment,{children:e})}),In={table:yn,string:Sn,html:wn,json:Cn,text:jn,info:vn},$n=({type:e,...r})=>{const t=In[e]||(()=>i.jsxs("div",{children:["未知类型 ",e]}));return i.jsx(t,{...r})},Vn=h.forwardRef(({params:e,visible:r,onClose:t},s)=>{const{output_dir:n,analysis_id:o}=e||{};return r?i.jsx(i.Fragment,{children:o&&i.jsx(En,{onClose:t,analysis_id:o})}):null}),En=({analysis_id:e,onClose:r,cancalReportCallback:t})=>{var C,y;const[s,n]=h.useState(!1),[o,c]=h.useState(null),a=pe(),{eventSourceRef:l,status:d,reconnect:u}=ct(),m=h.useRef(null),g=h.useRef(null),{messageApi:f}=W(),{modals:p,openModals:v,closeModals:b}=ge(["editParams"]),j=async x=>{n(!0);const S=await M.get(`/analysis/visualization-results/${x}`);c(S.data),m.current=x,n(!1)};return h.useEffect(()=>{j(e)},[e]),h.useEffect(()=>{var x;if(l){const S=E=>{const z=JSON.parse(E.data);g.current=z,m.current==z.analysis_id&&(z.event=="analysis_complete"||z.event=="analysis_failed"||z.event=="analysis_started")&&j(m.current)};return(x=l.current)==null||x.addEventListener("message",S),()=>{var E;console.log("removeEventListener"),(E=l.current)==null||E.removeEventListener("message",S)}}},[l.current]),i.jsx(i.Fragment,{children:i.jsxs(xe,{size:"small",title:i.jsx(i.Fragment,{children:o?i.jsxs(i.Fragment,{children:[i.jsx(O,{style:{cursor:"pointer"},onClick:()=>{a(`/component/${o==null?void 0:o.component_type}/${o==null?void 0:o.component_id}`)},children:o==null?void 0:o.component_name}),i.jsx(O,{children:o==null?void 0:o.analysis_name}),i.jsx(O,{children:String(o==null?void 0:o.analysis_id).slice(0,8)}),i.jsx(O,{children:o==null?void 0:o.analysis_status}),m.current==((C=g.current)==null?void 0:C.analysis_id)&&i.jsxs(O,{children:[" ",i.jsx(i.Fragment,{children:(y=g.current)==null?void 0:y.event})]})]}):i.jsx(i.Fragment,{})}),extra:i.jsxs(N,{gap:"small",children:[r&&i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:()=>r(),children:"关闭"}),o&&i.jsxs(i.Fragment,{children:[i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:()=>{v("editParams",o.analysis_id)},children:"编辑参数"}),(o==null?void 0:o.analysis_status)=="running"?i.jsx(i.Fragment,{children:i.jsx(K,{title:"是否停止!",onConfirm:async()=>{await Zt(o.analysis_id),f.success("停止成功")},children:i.jsx($,{size:"small",color:"cyan",variant:"solid",children:"停止"})})}):i.jsx(i.Fragment,{children:i.jsx(K,{title:"是否运行!",onConfirm:async()=>{await Qt(o.analysis_id,"job"),f.success("运行成功")},children:i.jsx($,{size:"small",color:"cyan",variant:"solid",children:o.analysis_status=="created"?"运行":"重新运行"})})})]}),i.jsx(K,{title:o!=null&&o.is_report?"是否取消报告":"是否报告",onConfirm:async()=>{await M.post(`/analysis/update-report/${o==null?void 0:o.analysis_id}`),f.success("操作成功!"),c(null),t&&t()},children:i.jsx($,{size:"small",color:"cyan",variant:"solid",children:o!=null&&o.is_report?"取消报告":"报告"})}),i.jsx($,{size:"small",color:"cyan",variant:"solid",onClick:()=>j(e),children:"刷新"})]}),children:[(o==null?void 0:o.analysis_status)=="failed"?i.jsx("div",{style:{textAlign:"center"},children:i.jsx(mn,{file_path:o==null?void 0:o.command_log_path})}):i.jsx(i.Fragment,{children:(o==null?void 0:o.analysis_status)=="running"&&(o==null?void 0:o.run_type)!="server"?i.jsx(dt,{active:!0}):i.jsx(i.Fragment,{children:e&&i.jsx(Fn,{analsyisResult:o,loading:s})})}),i.jsx(xn,{callback:()=>j(e),visible:p.editParams.visible,params:p.editParams.params,onClose:()=>b("editParams")})]})})},Fn=({analsyisResult:e,loading:r})=>i.jsxs(ft,{spinning:r,children:[e&&i.jsxs(i.Fragment,{children:[e.images&&i.jsx("div",{children:Array.isArray(e.images)?i.jsx(ut,{gutter:{xs:8,sm:16,md:24,lg:32},children:e.images.map((t,s)=>i.jsx(ht,{span:4,children:i.jsx(ce,{...t})},s))}):i.jsx(i.Fragment,{children:i.jsx(ce,{...e.images})})}),e.tables&&Array.isArray(e.tables)&&i.jsx(i.Fragment,{children:e.tables.map((t,s)=>i.jsx($n,{...t},s))})]}),i.jsx(mt,{data:e==null?void 0:e.description})]});export{Vn as A,fn as B,bn as C,xn as E,X as F,mn as L,gn as P,pn as a,Ln as b,$n as c,En as d,Wn as f,Qt as r,Zt as s,Bn as w};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BLND9VNM.js","./main-DDCpF10P.js","./main-PWR3lu3V.css","./index-DOr26GHb.js","./Dropdown-BENEu6xl.js","./Table-DSu9PW9f.js","./addEventListener-CeJuYbwj.js","./index-Bmw2VUkj.js","./index-36mrdQic.js","./index-UTRMrFLi.js","./index-DB4VWWzg.js","./index-3M1DwGQt.js","./UpOutlined-ChaI2Zov.js","./DeleteOutlined-CIqb_GHe.js","./index-CrxX4M_e.js","./createForOfIteratorHelper-CMm9xPXw.js","./DeploymentUnitOutlined-CQS9e9a3.js","./UserSwitchOutlined-ZboVIKUL.js","./AudioOutlined-DbeWwT6X.js","./ClearOutlined-ajVE4DvC.js","./TableOutlined-D0jaCC3Y.js","./NodeIndexOutlined-Robcb9kt.js","./index-Fu9C-8S6.js","./RedoOutlined-CqafmfEh.js","./UndoOutlined-UutLNt3R.js","./react-window-Y-oFBpKE.js","./index-DLKz2xoN.js","./index-B4mMhqXR.js"])))=>i.map(i=>d[i]);
import{j as e,M as R,i as O,r,F as z,B as j,a as C,d as g,I as J,P as T,v as P,k as B,m as U,S as $,D as q,l as A,t as N,U as G}from"./main-DDCpF10P.js";import L from"./index-BLND9VNM.js";import{T as K}from"./index-UTRMrFLi.js";import{F as W}from"./Table-DSu9PW9f.js";const H=({visible:l,onClose:m,params:a})=>e.jsx(R,{footer:null,title:"参数",width:"50%",open:l,onCancel:m,children:e.jsx(O,{children:e.jsx("pre",{children:JSON.stringify(a,null,2)})})}),Q=({formJson:l,openModal:m})=>{if(!l)return null;const[a,w]=r.useState([]),c=async()=>{const F=l.map(i=>i.dataKey),s=((await C.post("/list-bio-database",{type_list:F})).data||[]).reduce((i,o)=>{const y=o.type;i[y]||(i[y]=[]);const{name:x,database_id:b,...h}=o;return i[y].push({label:x,value:b,...h}),i},{});w(s),console.log(s)};return r.useEffect(()=>{c()},[l]),e.jsx(e.Fragment,{children:e.jsxs(z,{gap:"small",children:[e.jsx("div",{style:{flex:1},children:e.jsx(L,{formJson:l,dataMap:a})}),e.jsx(j,{size:"small",color:"cyan",variant:"solid",onClick:m,children:"DB Settings"}),e.jsx(j,{onClick:c,size:"small",type:"primary",children:"Refresh"})]})})},X=({visible:l,onClose:m,params:a,callback:w})=>{if(!l)return null;const[c,F]=r.useState([]),[_,s]=r.useState(!1),[i]=g.useForm(),[o,y]=r.useState(a[0].dataKey),[x,b]=r.useState(null),h=async t=>{s(!0);const d=await C.post("/list-bio-database",t);F(d.data),s(!1)},V=async()=>({...await i.validateFields(),type:o}),I=async()=>{const t=await V();x?await C.post("/update-bio-database",{...t,database_id:x.database_id}):await C.post("/add-bio-database",t),p(),b(void 0),i.resetFields()},p=()=>{h({type:o})};r.useEffect(()=>{h({type:o})},[a]);const k=t=>{y(t),h({type:t})},v=async t=>{await C.delete(`/delete-bio-database/${t.id}`),p()},u=t=>{i.setFieldsValue(t),b(t)};return e.jsxs(R,{title:"数据库操作",open:l,onCancel:m,width:"50%",footer:null,children:[e.jsx(K,{tabBarExtraContent:e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:p,children:" 刷新"}),e.jsxs(j,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{b(void 0),I()},children:[" ",x?"更新":"添加"]})]}),activeKey:o,onChange:k,items:a.map(t=>({key:t.name,label:t.label,children:e.jsx("div",{})}))}),e.jsxs(g,{form:i,style:{maxWidth:600},labelCol:{span:3},children:[e.jsx(g.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:e.jsx(J,{})}),e.jsx(g.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:e.jsx(J,{})}),e.jsx(g.Item,{name:"db_index",label:"索引",children:e.jsx(J,{})})]}),e.jsx(W,{dataSource:c,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(t,d)=>e.jsxs(z,{gap:"small",children:[e.jsx(T,{title:"确定删除吗？",onConfirm:()=>{v(d)},children:e.jsx(j,{size:"small",type:"primary",danger:!0,children:"删除"})}),e.jsx(j,{size:"small",type:"primary",onClick:()=>{u(d)},children:"编辑"})]})}],loading:_,pagination:!1})]})},M=r.lazy(()=>G(()=>import("./index-BLND9VNM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),import.meta.url)),te=({visible:l,params:m,onClose:a,callback:w})=>{var p,k,v;const[c]=g.useForm(),{messageApi:F,project:_}=B();r.useEffect(()=>{l&&V()},[m]);const[s,i]=r.useState(),[o,y]=r.useState(),x=()=>{a(),w&&w()},[b,h]=r.useState(),V=async()=>{h(!0);const u=await C.post(`/analysis/edit-params/${m}`);i(u.data),y(u.data.analysis_result),c.resetFields(),c.setFieldsValue(u.data.request_param),h(!1)},I=u=>{if(u&&Object.keys(u).length>0)return Object.keys(u)[0]};return e.jsx(e.Fragment,{children:e.jsx(q,{extra:e.jsx(e.Fragment,{}),size:"default",loading:b,title:e.jsx(e.Fragment,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(A,{children:s==null?void 0:s.component_name}),e.jsx(A,{color:"success",children:s==null?void 0:s.analysis_name}),e.jsx(N,{title:s==null?void 0:s.analysis_id,children:e.jsx(A,{children:String(s==null?void 0:s.analysis_id).slice(0,8)})})]})}),width:"50%",open:l,onClose:a,children:s&&e.jsx(e.Fragment,{children:e.jsx(Y,{showCreate:!0,form:c,requestParam:{...s.request_param,analysis_id:s==null?void 0:s.analysis_id},dataMap:{...o,first_data_key:I(o)},formJson:[...((p=s.content)==null?void 0:p.formJson)||[],...((k=s.content)==null?void 0:k.upstreamFormJson)||[],...(s==null?void 0:s.inputFormJson)||[],(s==null?void 0:s.component_type)=="software"?{name:"group_field",label:"Group Field",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"}:{}],databases:(v=s.content)==null?void 0:v.databases,upstreamFormJson:s==null?void 0:s.upstreamFormJson,callback:x})})})})},Y=({form:l,showCreate:m=!1,requestParam:a,dataMap:w,formJson:c,databases:F,callback:_,analysisResultId:s,showCancal:i=!1})=>{const{modals:o,openModals:y,closeModals:x}=P(["paramsView","bioDatabases"]),[b,h]=r.useState([]),[V,I]=r.useState([]),{messageApi:p}=B();r.useEffect(()=>{k()},[JSON.stringify(c)]);const k=()=>{if(Array.isArray(c)){const d=c.filter(n=>!(n!=null&&n.required)&&!(n!=null&&n.db)&&!n.component_id),f=c.filter(n=>(n==null?void 0:n.required)||(n==null?void 0:n.db)||n.component_id);h(f),I(d)}},v=d=>({...a,...d}),u=async()=>{var n;const d=await l.validateFields(),f=v(d);delete f.analysis_id,console.log(f);try{const S=await C.post("/fast-api/analysis-controller?save=true&is_submit=true&is_report=true",f);console.log(S),p.success("Created Successfully!"),_&&_()}catch(S){console.log(S),(n=S.response)!=null&&n.data&&p.error(S.response.data.detail)}},t=async(d,f=!1)=>{var E;const n=await l.validateFields(),S=v(n);try{const D=await C.post(`/fast-api/analysis-controller?save=${d}&is_submit=${f}`,S);console.log(D),d?(p.success("执行成功!"),_&&_()):y("paramsView",D.data)}catch(D){console.log(D),(E=D.response)!=null&&E.data&&p.error(D.response.data.detail)}};return e.jsxs(r.Suspense,{fallback:e.jsx($,{active:!0}),children:[e.jsxs(g,{form:l,onValuesChange:(d,f)=>{},children:[e.jsx(K,{items:[{key:"1",label:"Required Parameters",forceRender:!0,children:e.jsxs(e.Fragment,{children:[e.jsx(M,{analysisResultId:s,formJson:[...b],dataMap:w}),F&&e.jsx(Q,{openModal:()=>{y("bioDatabases",F)},formJson:F})]})},{key:"2",label:"Optional parameters",forceRender:!0,children:e.jsx(e.Fragment,{children:e.jsx(M,{formJson:[...V],dataMap:{}})})}]}),e.jsx(g.Item,{label:"Analysyis Name",name:"analysis_name",style:{maxWidth:600},rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(J,{})}),e.jsxs(z,{gap:"small",children:[e.jsx(j,{size:"small",color:"cyan",variant:"solid",onClick:()=>{t(!1)},children:"View Parameters"}),e.jsx(j,{size:"small",color:"cyan",variant:"solid",onClick:()=>t(!0),children:a!=null&&a.analysis_id?e.jsxs(e.Fragment,{children:["Update Analysis(",a.analysis_name,")(",String(a.analysis_id).slice(0,8),")"]}):e.jsx(e.Fragment,{children:"Create Analysis"})}),(a==null?void 0:a.analysis_id)&&i&&e.jsx(j,{size:"small",color:"cyan",onClick:()=>l.setFieldValue("analysis_id",void 0),children:"Cancel Analysis"}),m&&e.jsx(T,{title:"Are you sure to create a new analysis?",onConfirm:u,children:e.jsx(j,{size:"small",color:"orange",variant:"solid",onClick:()=>l.setFieldValue("analysis_id",void 0),children:"Create Analysis"})})]}),e.jsx(U,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(g.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(O,{children:e.jsx("pre",{children:JSON.stringify(v(l.getFieldsValue()),null,2)})})})})}]})]}),e.jsx(H,{visible:o.paramsView.visible,onClose:()=>x("paramsView"),params:o.paramsView.params}),e.jsx(X,{visible:o.bioDatabases.visible,onClose:()=>x("bioDatabases"),params:o.bioDatabases.params})]})};export{X as B,Y as C,te as E,H as P,Q as a};

{
    "name": "基于marker gene的丰度分析",
    "description":"使用reads基于marker gene的丰度分析",
    "tags": [
        "metaphlan",
        "bowtie2",
        "Alignment-based strategies"
    ],
    "img":"pipeline.jpg",
    "category": "metagenomics",
    "order":1,
    "items": [
        {
            "name": "比对到metaphlan marker库",
            "analysisPipline": "pipeline_align_metaphlan_marker",
            "inputAnalysisMethod": [
                {
                    "name": "remove_hosts_reads",
                    "label": "remove_hosts_reads",
                    "inputKey": [
                        "samtools_remove_hosts"
                    ],
                    "mode": "multiple",
                    "type": "GroupSelectSampleButton",
                    "groupField": "sample_group",
                    "rules": [
                        {
                            "required": true,
                            "message": "该字段不能为空!"
                        }
                    ]
                },
                {
                    "name": "clean_reads",
                    "label": "clean_reads",
                    "inputKey": [
                        "fastp_clean_reads"
                    ],
                    "mode": "multiple",
                    "type": "GroupSelectSampleButton",
                    "groupField": "sample_group"
                }
            ],
            "analysisMethod": [
                {
                    "name": "bowtie2_align_metaphlan",
                    "label": "marker比对bam文件",
                    "inputKey": [
                        "bowtie2_align_metaphlan"
                    ],
                    "mode": "multiple"
                }
            ],
            "downstreamAnalysis": [
                {
                    "name": "查看比对日志",
                    "analysisType": "one",
                    "sampleGroupJSON": false,
                    "paramsFun": "record => ({ text: record.content.log })",
                    "sampleGroupApI": false,
                    "saveAnalysisMethod": "text",
                    "moduleName": "text",
                    "sampleSelectComp": false,
                    "tableDesc": ""
                }
            ]
        },{
            "name": "丰度估计",
            "analysisPipline":"pipeline_metaphlan_abundance",
            "inputAnalysisMethod":[
                {
                    "name": "bowtie2_align_metaphlan",
                    "label": "marker比对bam文件",
                    "inputKey": ["bowtie2_align_metaphlan"],
                    "mode": "multiple",
                    "type": "GroupSelectSampleButton",
                    "groupField": "sample_group",
                    "rules": [{ "required": true, "message": "该字段不能为空!" }]
                }
            ],
            "analysisMethod":[
                {
                    "name": "metaphlan_sam_abundance",
                    "label": "metaphlan abundance",
                    "inputKey": ["metaphlan_sam_abundance"],
                    "mode": "multiple"
                }
            ],
            "upstreamFormJson":[
                {
                    "name": "stat_q",
                    "data": [
                        {
                            "label": "0.2",
                            "value": 0.2
                        }, {
                            "label": "0",
                            "value": 0
                        }
                    ],
                    "initialValue": 0.2,
                    "label": " Quantile value for the robust average(--stat_q)",
                    "rules": [{ "required": true, "message": "该字段不能为空!" }],
                    "type": "BaseSelect"
                }
            ],"downstreamAnalysis":[
                {
                    "name": "丰度矩阵",
                    "sampleGroupJSON":true,
                    "saveAnalysisMethod": "metaphlan_sam_abundance_matrix",
                    "moduleName": "abundance_matrix",
                    "formJson": [
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        },{
                            "name": "metaphlan_sam_abundance",
                            "label": "丰度文件",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }
                    ],
                    "tableDesc": ""
                },{
                    "name": "alpha多样性",
                    "formJson": [
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        }, {
                            "name": "treatment",
                            "label": "处理组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "control",
                            "label": "对照组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        },{
                            "name": "rank",
                            "label": "rank",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "RankSelect"
                        }
                    ],
                    "saveAnalysisMethod": "metaphlan_abundance_alpha_diversity",
                    "moduleName": "abundance_alpha_diversity",
                    "tableDesc": ""
                },{
                    "name": "beta多样性",
                    "moduleName": "abundance_beta_diversity",
                    "saveAnalysisMethod":"metaphlan_abundance_beta_diversity",
                    "formJson":[
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        }, {
                            "name": "treatment",
                            "label": "处理组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "control",
                            "label": "对照组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        },{
                            "name": "rank",
                            "label": "rank",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "RankSelect"
                        }
                    ]
                },{
                    "name": "差异分析",
                    "moduleName": "abundance_difference",
                    "saveAnalysisMethod":"metaphlan_abundance_difference_matrix",
                    "formJson":[
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        }, {
                            "name": "treatment",
                            "label": "处理组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "control",
                            "label": "对照组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        },{
                            "name": "rank",
                            "label": "rank",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "RankSelect"
                        }
                    ]
                },{
                    "name": "ROC分析",
                    "moduleName": "abundance_roc",
                    "saveAnalysisMethod":"abundance_roc",
                    "formJson":[
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        }, {
                            "name": "treatment",
                            "label": "处理组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "control",
                            "label": "对照组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        },{
                            "name": "rank",
                            "label": "rank",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "RankSelect"
                        }
                    ]
                },{
                    "name": "流行度分析",
                    "moduleName": "abundance_prevalence",
                    "saveAnalysisMethod":"metaphlan_prevalence_matrix",
                    "formJson":[
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        }, {
                            "name": "sites1",
                            "label": "部位一",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "sites2",
                            "label": "部位二",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        },{
                            "name": "rank",
                            "label": "rank",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "RankSelect"
                        }
                    ]
                },{
                    "name": "累积丰度分析",
                    "moduleName": "abundance_cumulative_abundance",
                    "saveAnalysisMethod":"abundance_cumulative_abundance",
                    "formJson":[
                        {
                            "name": "group_field",
                            "label": "分组列",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupFieldSelect"
                        }, {
                            "name": "sites1",
                            "label": "部位一",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "sites2",
                            "label": "部位二",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "treatment",
                            "label": "累积丰度处理组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "control",
                            "label": "累积丰度对照组",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupSelectSampleButton",
                            "group": "group_field"
                        }, {
                            "name": "rank",
                            "label": "rank",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "RankSelect"
                        }, {
                            "name": "query",
                            "label": "累积丰度菌定义",
                            "mode": "multiple",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "GroupCompareSelect"
                        },{
                            "name": "calculation_method",
                            "data":[
                                {
                                    "label": "sum",
                                    "value": "sum"
                                }, {
                                    "label": "count",
                                    "value": "count"
                                }
                            ],
                            "initialValue": "sum",
                            "label": "计算方式",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "BaseSelect"
                        }, {
                            "name": "hypothesis",
                            "data":[
                                {
                                    "label": "Mann–Whitney U(Wilcoxon rank-sum)",
                                    "value": "mannwhitneyu"
                                }, {
                                    "label": "Poisson regression",
                                    "value": "poisson"
                                }
                            ],
                            "initialValue": "mannwhitneyu",
                            "label": "统计检验方法",
                            "rules": [{ "required": true, "message": "该字段不能为空!" }],
                            "type": "BaseSelect"
                        }
                    ]
                }
            ]
        },{
            "name": "提取marker基因",
            "analysisPipline":"pipeline_consensus_marker",
            "inputAnalysisMethod":[
                {
                    "name": "bowtie2_align_metaphlan",
                    "label": "marker比对bam文件",
                    "inputKey": ["bowtie2_align_metaphlan"],
                    "mode": "multiple",
                    "type": "GroupSelectSampleButton",
                    "groupField": "sample_group",
                    "rules": [{ "required": true, "message": "该字段不能为空!" }]
                }
            ],
            "analysisMethod":[
                {
                    "name": "consensus_marker",
                    "label": "consensus_marker",
                    "inputKey": ["consensus_marker"],
                    "mode": "multiple"
                }
            ]
        },{
            "name": "菌株水平分析",
            "analysisPipline":"pipeline_strain_level_profiling",
            "inputAnalysisMethod":[
                {
                    "name": "consensus_marker",
                    "label": "consensus_marker",
                    "inputKey": ["consensus_marker"],
                    "mode": "multiple",
                    "type": "GroupSelectSampleButton",
                    "groupField": "sample_group",
                    "rules": [{ "required": true, "message":"该字段不能为空!" }]
                }, {
                    "name": "assembly_genome",
                    "label": "assembly_genome",
                    "inputKey": ["tgs_individual_assembly"],
                    "mode": "single",
                    "labelInValue": true,
                    "type": "BaseSelect"
                }, {
                    "name": "samples_abundance",
                    "label": "选择鉴定出SGB的样本",
                    "inputKey": ["metaphlan_sam_abundance"],
                    "mode": "multiple",
                    "type": "GroupSelectSampleButton",
                    "groupField": "sample_group"
                }
            ],
            "analysisMethod":[
                {
                    "name": "strain_level_profiling",
                    "label": "strain_level_profiling",
                    "inputKey": ["strain_level_profiling"]
                }
            ],"upstreamFormJson":[
                {
                    "name": "clade",
                    "labelInValue": true,
                    "label": "clade",
                    "mode": "multiple",
                    "type": "MetaphlanCladeSelect"
                }
            ],"downstreamAnalysis":[
                {
                    "name": "菌株水平系统发育树",
                    "analysisType": "one",
                    "sampleGroupJSON": false,
                    "paramsFun": "record =>({'best_tree': record.content.best_tree,'tree_pairwisedists':record.content.tree_pairwisedists})",
                    "sampleGroupApI": false,
                    "saveAnalysisMethod": "strain_level_profiling_tree",
                    "moduleName": "strain_level_profiling_tree",
                    "sampleSelectComp": false,
                    "tableDesc": ""

                }
            ],"appendSampleColumns":[
                {
                    "title": "参考基因组",
                    "dataIndex": "reference",
                    "key": "reference",
                    "ellipsis": true,
                    "render": "record=>record?.content?.reference"
                }
            ]

        }
    ]
}